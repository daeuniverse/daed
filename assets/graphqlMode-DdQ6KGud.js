const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./monaco.contribution-BT2NcqMq.js","./mouseTarget-ChzHDmDJ.js","./index-D2GMyZqf.js","./index-BaBPMFsM.css","./editor.api-1YMXvL8Z.js","./editor-S6Orim2W.css","./monaco.contribution-CJsCJYfZ.js"])))=>i.map(i=>d[i]);
import{d as e,l as t,lr as n,u as r}from"./index-D2GMyZqf.js";import"./mouseTarget-ChzHDmDJ.js";import{f as i,h as a,p as o}from"./editor.api-1YMXvL8Z.js";import"./monaco.contribution-CJsCJYfZ.js";import"./monaco-editor-d5hhqmkB.js";var s=120*1e3,c=class{_defaults;_idleCheckInterval;_lastUsedTime=0;_configChangeListener;_worker=null;_client=null;constructor(e){this._defaults=e,this._idleCheckInterval=window.setInterval(()=>this._checkIfIdle(),30*1e3),this._configChangeListener=this._defaults.onDidChange(()=>{this._stopWorker()})}_stopWorker(){this._worker&&=(this._worker.dispose(),null),this._client=null}dispose(){clearInterval(this._idleCheckInterval),this._configChangeListener.dispose(),this._stopWorker()}_checkIfIdle(){this._worker&&Date.now()-this._lastUsedTime>s&&this._stopWorker()}async _getClient(){if(this._lastUsedTime=Date.now(),!this._client&&!this._worker)try{let{languageId:e,formattingOptions:t,schemas:n,externalFragmentDefinitions:i,completionSettings:a}=this._defaults;this._worker=o.createWebWorker({moduleId:`monaco-graphql/esm/GraphQLWorker.js`,label:e,createData:{languageId:e,formattingOptions:t,languageConfig:{schemas:n?.map(r),externalFragmentDefinitions:i,fillLeafsOnComplete:a.__experimental__fillLeafsOnComplete}}}),this._client=this._worker.getProxy()}catch(e){console.error(`error loading worker`,e)}return this._client}async getLanguageServiceWorker(...e){let t=await this._getClient();return await this._worker.withSyncedResources(e),t}},l=class{defaults;_worker;_disposables=[];_listener=Object.create(null);constructor(e,n){this.defaults=e,this._worker=n,this._worker=n;let r,i=n=>{let i=t(n);if(i!==this.defaults.languageId)return;let a=n.uri.toString(),o=e.diagnosticSettings.validateVariablesJSON?.[a];r=setTimeout(()=>{this._doValidate(n.uri,i,o)},400),this._listener[a]=n.onDidChangeContent(()=>{clearTimeout(r),r=setTimeout(()=>{this._doValidate(n.uri,i,o)},400)})},a=e=>{o.setModelMarkers(e,this.defaults.languageId,[]);let t=e.uri.toString(),n=this._listener[t];n&&(n.dispose(),delete this._listener[t])};this._disposables.push(o.onDidCreateModel(i),{dispose(){clearTimeout(r)}},o.onWillDisposeModel(e=>{a(e)}),o.onDidChangeModelLanguage(e=>{a(e.model),i(e.model)}),{dispose:()=>{for(let e of Object.values(this._listener))e.dispose()}},e.onDidChange(()=>{for(let e of o.getModels())t(e)===this.defaults.languageId&&(a(e),i(e))}));for(let e of o.getModels())t(e)===this.defaults.languageId&&i(e)}dispose(){for(let e of this._disposables)e.dispose();this._disposables=[]}async _doValidate(e,t,r){let s=await this._worker(e);if(!s)return;let c=await s.doValidation(e.toString());if(o.setModelMarkers(o.getModel(e),t,c),r){if(await n(()=>import(`./monaco.contribution-BT2NcqMq.js`),__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url),!r.length)throw Error(`No variables URI strings provided to validate`);let t=await s.doGetVariablesJSONSchema(e.toString());if(!t)return;let o=i.file(r[0].replace(`.json`,`-schema.json`)).toString(),c={uri:o,schema:t,fileMatch:r},l=a.json.jsonDefaults.diagnosticsOptions.schemas?.filter(e=>e.uri!==o)||[];a.json.jsonDefaults.setDiagnosticsOptions({schemaValidation:`error`,validate:!0,...this.defaults.diagnosticSettings.jsonDiagnosticSettings,schemas:[...l,c],enableSchemaRequest:!1})}}},u=a.CompletionItemKind,d={[e.Text]:u.Text,[e.Method]:u.Method,[e.Function]:u.Function,[e.Constructor]:u.Constructor,[e.Field]:u.Field,[e.Variable]:u.Variable,[e.Class]:u.Class,[e.Interface]:u.Interface,[e.Module]:u.Module,[e.Property]:u.Property,[e.Unit]:u.Unit,[e.Value]:u.Value,[e.Enum]:u.Enum,[e.Keyword]:u.Keyword,[e.Snippet]:u.Snippet,[e.Color]:u.Color,[e.File]:u.File,[e.Reference]:u.Reference,[e.Folder]:u.Folder,[e.EnumMember]:u.EnumMember,[e.Constant]:u.Constant,[e.Struct]:u.Struct,[e.Event]:u.Event,[e.Operator]:u.Operator,[e.TypeParameter]:u.TypeParameter};function f(e){return e in d?d[e]:u.Text}function p(e){return{range:e.range,kind:f(e.kind),label:e.label,insertText:e.insertText??e.label,insertTextRules:e.insertText?a.CompletionItemInsertTextRule.InsertAsSnippet:void 0,sortText:e.sortText,filterText:e.filterText,documentation:e.documentation,detail:e.detail,command:e.command}}var m=class{_worker;constructor(e){this._worker=e,this._worker=e}get triggerCharacters(){return[`:`,`$`,` `,`(`,`@`]}async provideCompletionItems(e,t,n,r){try{return{incomplete:!0,suggestions:(await(await this._worker(e.uri)).doComplete(e.uri.toString(),t)).map(p)}}catch(e){return console.error(`Error fetching completion items`,e),{suggestions:[]}}}},h=class{_worker;constructor(e){this._worker=e,this._worker=e}async provideDocumentFormattingEdits(e,t,n){let r=await(await this._worker(e.uri)).doFormat(e.uri.toString());return r?[{range:e.getFullModelRange(),text:r}]:[]}},g=class{_worker;constructor(e){this._worker=e}async provideHover(e,t,n){let r=e.uri,i=await(await this._worker(e.uri)).doHover(r.toString(),t);return i?{range:i.range,contents:[{value:i.content}]}:{contents:[]}}dispose(){}};function _(e){let t=[],n=[],r=new c(e);t.push(r);let i=(...e)=>{try{return r.getLanguageServiceWorker(...e)}catch{throw Error(`Error fetching graphql language service worker`)}};function o(){let{modeConfiguration:t,languageId:r}=e;t.documentFormattingEdits&&n.push(a.registerDocumentFormattingEditProvider(r,new h(i)))}function s(t){let{modeConfiguration:r,languageId:s}=e;y(n),r.completionItems&&n.push(a.registerCompletionItemProvider(s,new m(i))),r.diagnostics&&n.push(new l(t,i)),r.hovers&&n.push(a.registerHoverProvider(s,new g(i))),o()}let{modeConfiguration:u,formattingOptions:d,diagnosticSettings:f,externalFragmentDefinitions:p,schemas:_}=e;return s(e),e.onDidChange(e=>{e.modeConfiguration!==u&&(u=e.modeConfiguration,s(e)),e.formattingOptions!==d&&(d=e.formattingOptions,o()),e.externalFragmentDefinitions!==p&&(p=e.externalFragmentDefinitions,s(e)),e.diagnosticSettings!==f&&(f=e.diagnosticSettings,s(e)),e.schemas!==_&&(_=e.schemas,s(e))}),t.push(v(n)),v(t)}function v(e){return{dispose:()=>y(e)}}function y(e){for(;e.length;)e.pop().dispose()}export{_ as setupMode};