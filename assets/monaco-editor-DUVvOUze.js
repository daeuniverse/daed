import{$n as e,$t as t,Bn as n,Bt as r,Ct as i,En as a,Et as o,Ft as s,Gn as c,Hn as l,In as u,Kn as d,Ln as f,Mt as p,Nn as m,Nt as h,On as g,Ot as ee,Qn as te,Rn as _,Rt as v,Sn as ne,St as re,Tn as ie,Tt as ae,Un as oe,Ut as se,Vt as y,Wn as ce,Wt as le,Yn as b,Zn as ue,Zt as de,_n as x,an as fe,ar as pe,ct as me,dn as he,er as ge,fn as _e,ft as ve,gn as S,gt as ye,ht as be,in as xe,it as Se,jt as Ce,kn as we,kt as Te,ln as Ee,lr as De,lt as Oe,mt as ke,nt as Ae,on as je,or as C,ot as Me,pn as Ne,pt as Pe,rr as Fe,rt as Ie,sn as Le,sr as Re,st as ze,tt as Be,ut as Ve,vt as He,wn as w,xt as Ue,zt as T}from"./index-BIPwVg8A.js";import{$i as We,$n as Ge,$r as Ke,A as qe,Aa as Je,Ao as Ye,As as Xe,B as Ze,Ba as Qe,Bi as $e,Bs as et,Ci as tt,Cs as nt,Ct as rt,Di as it,E as at,Ea as ot,En as st,Fo as ct,G as lt,Ga as ut,Gr as dt,Gt as ft,Ha as pt,Hs as mt,I as ht,Ia as gt,Ii as _t,Io as vt,Is as yt,J as bt,Ji as xt,Jo as St,Jr as Ct,Js as wt,K as Tt,Ki as Et,Kr as Dt,Ks as Ot,Li as kt,Lo as At,Ma as jt,Mo as Mt,Ms as Nt,Na as Pt,Nr as Ft,O as It,Oa as Lt,Oi as Rt,On as zt,Oo as Bt,Ot as Vt,Pt as Ht,Q as Ut,Qn as Wt,Qo as Gt,Qr as Kt,Ra as qt,Ro as Jt,Rs as Yt,Si as Xt,St as Zt,Ts as Qt,Tt as $t,U as en,Ui as tn,Uo as nn,Va as rn,Vo as an,Vs as on,Ws as sn,X as cn,Xa as ln,Xi as un,Xo as dn,Xr as fn,Xs as pn,Ya as mn,Yo as hn,Yr as gn,Z as _n,Zi as E,Zn as vn,Zr as yn,Zs as bn,_ as xn,_i as Sn,_o as Cn,aa as wn,ai as Tn,an as En,as as Dn,at as On,bi as kn,bo as An,bs as jn,bt as Mn,ci as Nn,cs as Pn,da as Fn,di as In,ds as Ln,ea as Rn,ei as zn,eo as Bn,er as Vn,fa as Hn,fi as Un,fo as Wn,ga as Gn,go as Kn,ha as qn,hi as Jn,in as Yn,it as Xn,js as Zn,ka as Qn,ko as $n,kr as er,l as tr,la as nr,li as rr,lo as ir,ls as ar,m as or,ma as D,ms as sr,na as cr,ni as lr,nr as ur,o as dr,oa as O,oc as fr,oi as pr,ot as mr,p as hr,pi as gr,po as _r,pt as vr,qa as yr,qi as k,qr as br,ri as xr,rn as Sr,rs as Cr,rt as wr,sa as A,si as Tr,ss as Er,tr as Dr,ua as j,uc as Or,ui as kr,uo as Ar,us as jr,ut as Mr,vi as Nr,vo as Pr,wa as Fr,wo as Ir,ws as Lr,y as Rr,ya as M,yi as zr,yo as Br,ys as Vr,yt as Hr,za as Ur,zi as Wr,zs as Gr}from"./mouseTarget-DZt5Kv_T.js";import{$ as Kr,$a as qr,$i as Jr,$n as Yr,$r as Xr,$t as Zr,A as Qr,Aa as $r,Ai as ei,An as ti,Ar as ni,At as ri,B as ii,Ba as ai,Bi as oi,Bn as si,Br as ci,Bt as li,C as ui,Ca as di,Ci as fi,Cn as pi,Cr as mi,Ct as hi,D as gi,Da as _i,Di as vi,Dn as yi,Dr as bi,Dt as xi,E as Si,Ea as Ci,Ei as wi,En as Ti,Er as Ei,Et as Di,F as Oi,Fa as N,Fi as ki,Fn as Ai,Fr as ji,Ft as Mi,G as Ni,Ga as Pi,Gi as Fi,Gn as Ii,Gr as Li,Gt as Ri,H as zi,Ha as P,Hi as Bi,Hn as Vi,Hr as Hi,Ht as Ui,I as Wi,Ia as Gi,Ii as Ki,In as qi,Ir as Ji,It as Yi,J as Xi,Ja as Zi,Ji as Qi,Jn as $i,Jr as ea,Jt as ta,K as na,Ka as ra,Ki as ia,Kn as aa,Kr as oa,Kt as sa,L as ca,La as la,Li as ua,Ln as da,Lr as fa,Lt as pa,M as ma,Ma as F,Mi as ha,Mn as ga,Mr as _a,Mt as va,N as ya,Na as ba,Ni as xa,Nn as Sa,Nr as Ca,Nt as wa,O as Ta,Oa as Ea,Oi as Da,On as Oa,Or as ka,Ot as Aa,P as ja,Pa as Ma,Pi as Na,Pn as Pa,Pr as Fa,Pt as Ia,Q as La,Qa as Ra,Qi as za,Qn as Ba,Qr as Va,Qt as Ha,R as Ua,Ra as Wa,Ri as Ga,Rn as Ka,Rr as qa,Rt as Ja,S as Ya,Sa as Xa,Si as Za,Sn as Qa,So as $a,Sr as eo,St as to,T as no,Ta as ro,Ti as io,Tn as ao,Tr as oo,Tt as so,U as co,Ua as I,Ui as lo,Un as uo,Ur as fo,Ut as po,V as mo,Va as L,Vi as ho,Vn as go,Vr as _o,Vt as vo,W as yo,Wa as bo,Wi as xo,Wn as So,Wr as Co,Wt as wo,X as To,Xa as Eo,Xi as Do,Xn as Oo,Xr as ko,Xt as Ao,Y as jo,Ya as Mo,Yi as No,Yn as Po,Yr as Fo,Yt as Io,Z as Lo,Za as R,Zi as Ro,Zn as zo,Zr as Bo,Zt as Vo,_ as Ho,_a as Uo,_i as Wo,_n as Go,_o as Ko,_r as qo,_t as Jo,aa as Yo,ai as Xo,an as Zo,ao as z,ar as Qo,at as $o,b as es,ba as ts,bi as ns,bn as rs,bo as is,br as as,bt as os,ca as ss,ci as cs,cn as ls,co as B,cr as us,ct as ds,da as fs,di as ps,dn as ms,do as hs,dr as gs,dt as _s,ea as vs,ei as ys,en as bs,eo as xs,er as Ss,et as Cs,fa as ws,fi as Ts,fn as Es,fo as Ds,fr as Os,ft as ks,g as As,ga as js,gi as Ms,gn as Ns,go as Ps,gr as Fs,gt as Is,ha as Ls,hi as Rs,hn as zs,ho as Bs,hr as Vs,ht as Hs,ia as V,ii as Us,in as Ws,io as Gs,ir as Ks,it as qs,j as Js,ja as Ys,ji as Xs,jn as Zs,jr as Qs,jt as $s,k as ec,ka as tc,ki as nc,kn as rc,kr as ic,kt as ac,la as oc,li as sc,ln as cc,lo as lc,lr as uc,lt as dc,m as fc,ma as pc,mi as mc,mn as hc,mo as gc,mr as _c,mt as vc,na as yc,ni as bc,nn as xc,no as H,nr as Sc,nt as Cc,oa as wc,oi as Tc,on as U,oo as W,or as Ec,ot as Dc,pa as Oc,pi as kc,pn as Ac,po as jc,pr as Mc,pt as Nc,q as Pc,qa as Fc,qi as Ic,qn as Lc,qr as Rc,qt as zc,ra as Bc,ri as Vc,rn as Hc,ro as Uc,rr as Wc,rt as Gc,sa as Kc,si as qc,sn as Jc,so as G,sr as Yc,st as Xc,ta as Zc,ti as Qc,tn as $c,to as el,tr as K,tt as q,ua as tl,ui as nl,un as rl,uo as J,ur as il,ut as al,v as ol,va as sl,vi as cl,vn as ll,vo as Y,vr as ul,vt as dl,w as fl,wa as pl,wi as ml,wn as hl,wr as gl,wt as _l,x as vl,xa as yl,xi as bl,xn as xl,xo as Sl,xr as Cl,xt as wl,y as Tl,ya as El,yi as Dl,yn as Ol,yo as kl,yr as Al,yt as jl,z as Ml,za as Nl,zi as Pl,zn as Fl,zr as Il,zt as Ll}from"./editor.api-DYyNsVb0.js";var Rl=Object.defineProperty,zl=Object.getOwnPropertyDescriptor,Bl=Object.getOwnPropertyNames,Vl=Object.prototype.hasOwnProperty,Hl=(e,t,n,r)=>{if(t&&typeof t==`object`||typeof t==`function`)for(let i of Bl(t))!Vl.call(e,i)&&i!==n&&Rl(e,i,{get:()=>t[i],enumerable:!(r=zl(t,i))||r.enumerable});return e},Ul=(e,t,n)=>(Hl(e,t,`default`),n&&Hl(n,t,`default`)),Wl={};Ul(Wl,fc);var Gl={},Kl={},ql=class e{static getOrCreate(t){return Kl[t]||(Kl[t]=new e(t)),Kl[t]}constructor(e){this._languageId=e,this._loadingTriggered=!1,this._lazyLoadPromise=new Promise((e,t)=>{this._lazyLoadPromiseResolve=e,this._lazyLoadPromiseReject=t})}load(){return this._loadingTriggered||(this._loadingTriggered=!0,Gl[this._languageId].loader().then(e=>this._lazyLoadPromiseResolve(e),e=>this._lazyLoadPromiseReject(e))),this._lazyLoadPromise}};function Jl(e){let t=e.id;Gl[t]=e,Wl.languages.register(e);let n=ql.getOrCreate(t);Wl.languages.registerTokensProviderFactory(t,{create:async()=>(await n.load()).language}),Wl.languages.onLanguageEncountered(t,async()=>{let e=await n.load();Wl.languages.setLanguageConfiguration(t,e.conf)})}Jl({id:`graphql`,extensions:[`.graphql`,`.gql`],aliases:[`GraphQL`,`graphql`,`gql`],mimetypes:[`application/graphql`],loader:()=>De(()=>import(`./graphql-BB-R2Fi8.js`),[],import.meta.url)});var Yl=class extends Mo{constructor(){super({id:`diffEditor.toggleCollapseUnchangedRegions`,title:x(`toggleCollapseUnchangedRegions`,`Toggle Collapse Unchanged Regions`),icon:i.map,toggled:z.has(`config.diffEditor.hideUnchangedRegions.enabled`),precondition:z.has(`isInDiffEditor`),menu:{when:z.has(`isInDiffEditor`),id:R.EditorTitle,order:22,group:`navigation`}})}run(e,...t){let n=e.get(F),r=!n.getValue(`diffEditor.hideUnchangedRegions.enabled`);n.updateValue(`diffEditor.hideUnchangedRegions.enabled`,r)}},Xl=class extends Mo{constructor(){super({id:`diffEditor.toggleShowMovedCodeBlocks`,title:x(`toggleShowMovedCodeBlocks`,`Toggle Show Moved Code Blocks`),precondition:z.has(`isInDiffEditor`)})}run(e,...t){let n=e.get(F),r=!n.getValue(`diffEditor.experimental.showMoves`);n.updateValue(`diffEditor.experimental.showMoves`,r)}},Zl=class extends Mo{constructor(){super({id:`diffEditor.toggleUseInlineViewWhenSpaceIsLimited`,title:x(`toggleUseInlineViewWhenSpaceIsLimited`,`Toggle Use Inline View When Space Is Limited`),precondition:z.has(`isInDiffEditor`)})}run(e,...t){let n=e.get(F),r=!n.getValue(`diffEditor.useInlineViewWhenSpaceIsLimited`);n.updateValue(`diffEditor.useInlineViewWhenSpaceIsLimited`,r)}},Ql=x(`diffEditor`,`Diff Editor`),$l=class extends Gi{constructor(){super({id:`diffEditor.switchSide`,title:x(`switchSide`,`Switch Side`),icon:i.arrowSwap,precondition:z.has(`isInDiffEditor`),f1:!0,category:Ql})}runEditorCommand(e,t,n){let r=cu(e);if(r instanceof Si){if(n&&n.dryRun)return{destinationSelection:r.mapToOtherSide().destinationSelection};r.switchSide()}}},eu=class extends Gi{constructor(){super({id:`diffEditor.exitCompareMove`,title:x(`exitCompareMove`,`Exit Compare Move`),icon:i.close,precondition:q.comparingMovedCode,f1:!1,category:Ql,keybinding:{weight:1e4,primary:9}})}runEditorCommand(e,t,...n){let r=cu(e);r instanceof Si&&r.exitCompareMove()}},tu=class extends Gi{constructor(){super({id:`diffEditor.collapseAllUnchangedRegions`,title:x(`collapseAllUnchangedRegions`,`Collapse All Unchanged Regions`),icon:i.fold,precondition:z.has(`isInDiffEditor`),f1:!0,category:Ql})}runEditorCommand(e,t,...n){let r=cu(e);r instanceof Si&&r.collapseAllUnchangedRegions()}},nu=class extends Gi{constructor(){super({id:`diffEditor.showAllUnchangedRegions`,title:x(`showAllUnchangedRegions`,`Show All Unchanged Regions`),icon:i.unfold,precondition:z.has(`isInDiffEditor`),f1:!0,category:Ql})}runEditorCommand(e,t,...n){let r=cu(e);r instanceof Si&&r.showAllUnchangedRegions()}},ru=class extends Mo{constructor(){super({id:`diffEditor.revert`,title:x(`revert`,`Revert`),f1:!1,category:Ql})}run(e,t){let n=su(e,t.originalUri,t.modifiedUri);n instanceof Si&&n.revertRangeMappings(t.mapping.innerChanges??[])}},iu=x(`accessibleDiffViewer`,`Accessible Diff Viewer`),au=class e extends Mo{static#e=this.id=`editor.action.accessibleDiffViewer.next`;constructor(){super({id:e.id,title:x(`editor.action.accessibleDiffViewer.next`,`Go to Next Difference`),category:iu,precondition:z.has(`isInDiffEditor`),keybinding:{primary:65,weight:100},f1:!0})}run(e){cu(e)?.accessibleDiffViewerNext()}},ou=class e extends Mo{static#e=this.id=`editor.action.accessibleDiffViewer.prev`;constructor(){super({id:e.id,title:x(`editor.action.accessibleDiffViewer.prev`,`Go to Previous Difference`),category:iu,precondition:z.has(`isInDiffEditor`),keybinding:{primary:1089,weight:100},f1:!0})}run(e){cu(e)?.accessibleDiffViewerPrev()}};function su(e,t,n){return e.get(Ko).listDiffEditors().find(e=>{let r=e.getModifiedEditor(),i=e.getOriginalEditor();return r&&r.getModel()?.uri.toString()===n.toString()&&i&&i.getModel()?.uri.toString()===t.toString()})||null}function cu(e){let t=e.get(Ko).listDiffEditors(),n=Je();if(n){for(let e of t)if(lu(e.getContainerDomNode(),n))return e}return null}function lu(e,t){let n=t;for(;n;){if(n===e)return!0;n=n.parentElement}return!1}H(Yl),H(Xl),H(Zl),qr.appendMenuItem(R.EditorTitle,{command:{id:new Zl().desc.id,title:S(`useInlineViewWhenSpaceIsLimited`,`Use Inline View When Space Is Limited`),toggled:z.has(`config.diffEditor.useInlineViewWhenSpaceIsLimited`),precondition:z.has(`isInDiffEditor`)},order:11,group:`1_diff`,when:z.and(q.diffEditorRenderSideBySideInlineBreakpointReached,z.has(`isInDiffEditor`))}),qr.appendMenuItem(R.EditorTitle,{command:{id:new Xl().desc.id,title:S(`showMoves`,`Show Moved Code Blocks`),icon:i.move,toggled:Gs.create(`config.diffEditor.experimental.showMoves`,!0),precondition:z.has(`isInDiffEditor`)},order:10,group:`1_diff`,when:z.has(`isInDiffEditor`)}),H(ru);for(let e of[{icon:i.arrowRight,key:q.diffEditorInlineMode.toNegated()},{icon:i.discard,key:q.diffEditorInlineMode}])qr.appendMenuItem(R.DiffEditorHunkToolbar,{command:{id:new ru().desc.id,title:S(`revertHunk`,`Revert Block`),icon:e.icon},when:z.and(q.diffEditorModifiedWritable,e.key),order:5,group:`primary`}),qr.appendMenuItem(R.DiffEditorSelectionToolbar,{command:{id:new ru().desc.id,title:S(`revertSelection`,`Revert Selection`),icon:e.icon},when:z.and(q.diffEditorModifiedWritable,e.key),order:5,group:`primary`});H($l),H(eu),H(tu),H(nu),qr.appendMenuItem(R.EditorTitle,{command:{id:au.id,title:S(`Open Accessible Diff Viewer`,`Open Accessible Diff Viewer`),precondition:z.has(`isInDiffEditor`)},order:10,group:`2_diff`,when:z.and(q.accessibleDiffViewerVisible.negate(),z.has(`isInDiffEditor`))}),B.registerCommandAlias(`editor.action.diffReview.next`,au.id),H(au),B.registerCommandAlias(`editor.action.diffReview.prev`,ou.id),H(ou);var uu=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},du=function(e,t){return function(n,r){t(n,r,e)}},fu;const pu=new G(`selectionAnchorSet`,!1);var mu=class{static#e=fu=this;static#t=this.ID=`editor.contrib.selectionAnchorController`;static get(e){return e.getContribution(fu.ID)}constructor(e,t){this.editor=e,this.selectionAnchorSetContextKey=pu.bindTo(t),this.modelChangeListener=e.onDidChangeModel(()=>this.selectionAnchorSetContextKey.reset())}setSelectionAnchor(){if(this.editor.hasModel()){let e=this.editor.getPosition();this.editor.changeDecorations(t=>{this.decorationId&&t.removeDecoration(this.decorationId),this.decorationId=t.addDecoration(v.fromPositions(e,e),{description:`selection-anchor`,stickiness:1,hoverMessage:new Va().appendText(S(`selectionAnchor`,`Selection Anchor`)),className:`selection-anchor`})}),this.selectionAnchorSetContextKey.set(!!this.decorationId),qa(S(`anchorSet`,`Anchor set at {0}:{1}`,e.lineNumber,e.column))}}goToSelectionAnchor(){if(this.editor.hasModel()&&this.decorationId){let e=this.editor.getModel().getDecorationRange(this.decorationId);e&&this.editor.setPosition(e.getStartPosition())}}selectFromAnchorToCursor(){if(this.editor.hasModel()&&this.decorationId){let e=this.editor.getModel().getDecorationRange(this.decorationId);if(e){let t=this.editor.getPosition();this.editor.setSelection(v.fromPositions(e.getStartPosition(),t)),this.cancelSelectionAnchor()}}}cancelSelectionAnchor(){if(this.decorationId){let e=this.decorationId;this.editor.changeDecorations(t=>{t.removeDecoration(e),this.decorationId=void 0}),this.selectionAnchorSetContextKey.set(!1)}}dispose(){this.cancelSelectionAnchor(),this.modelChangeListener.dispose()}};mu=fu=uu([du(1,W)],mu);var hu=class extends N{constructor(){super({id:`editor.action.setSelectionAnchor`,label:S(`setSelectionAnchor`,`Set Selection Anchor`),alias:`Set Selection Anchor`,precondition:void 0,kbOpts:{kbExpr:q.editorTextFocus,primary:ne(2089,2080),weight:100}})}async run(e,t){mu.get(t)?.setSelectionAnchor()}},gu=class extends N{constructor(){super({id:`editor.action.goToSelectionAnchor`,label:S(`goToSelectionAnchor`,`Go to Selection Anchor`),alias:`Go to Selection Anchor`,precondition:pu})}async run(e,t){mu.get(t)?.goToSelectionAnchor()}},_u=class extends N{constructor(){super({id:`editor.action.selectFromAnchorToCursor`,label:S(`selectFromAnchorToCursor`,`Select from Anchor to Cursor`),alias:`Select from Anchor to Cursor`,precondition:pu,kbOpts:{kbExpr:q.editorTextFocus,primary:ne(2089,2089),weight:100}})}async run(e,t){mu.get(t)?.selectFromAnchorToCursor()}},vu=class extends N{constructor(){super({id:`editor.action.cancelSelectionAnchor`,label:S(`cancelSelectionAnchor`,`Cancel Selection Anchor`),alias:`Cancel Selection Anchor`,precondition:pu,kbOpts:{kbExpr:q.editorTextFocus,primary:9,weight:100}})}async run(e,t){mu.get(t)?.cancelSelectionAnchor()}};I(mu.ID,mu,4),L(hu),L(gu),L(_u),L(vu);var yu=k(`editorOverviewRuler.bracketMatchForeground`,`#A0A0A0`,S(`overviewRulerBracketMatchForeground`,`Overview ruler marker color for matching brackets.`)),bu=class extends N{constructor(){super({id:`editor.action.jumpToBracket`,label:S(`smartSelect.jumpBracket`,`Go to Bracket`),alias:`Go to Bracket`,precondition:void 0,kbOpts:{kbExpr:q.editorTextFocus,primary:3165,weight:100}})}run(e,t){wu.get(t)?.jumpToBracket()}},xu=class extends N{constructor(){super({id:`editor.action.selectToBracket`,label:S(`smartSelect.selectToBracket`,`Select to Bracket`),alias:`Select to Bracket`,precondition:void 0,metadata:{description:x(`smartSelect.selectToBracketDescription`,`Select the text inside and including the brackets or curly braces`),args:[{name:`args`,schema:{type:`object`,properties:{selectBrackets:{type:`boolean`,default:!0}}}}]}})}run(e,t,n){let r=!0;n&&n.selectBrackets===!1&&(r=!1),wu.get(t)?.selectToBracket(r)}},Su=class extends N{constructor(){super({id:`editor.action.removeBrackets`,label:S(`smartSelect.removeBrackets`,`Remove Brackets`),alias:`Remove Brackets`,precondition:void 0,kbOpts:{kbExpr:q.editorTextFocus,primary:2561,weight:100}})}run(e,t){wu.get(t)?.removeBrackets(this.id)}},Cu=class{constructor(e,t,n){this.position=e,this.brackets=t,this.options=n}},wu=class e extends _{static#e=this.ID=`editor.contrib.bracketMatchingController`;static get(t){return t.getContribution(e.ID)}constructor(e){super(),this._editor=e,this._lastBracketsData=[],this._lastVersionId=0,this._decorations=this._editor.createDecorationsCollection(),this._updateBracketsSoon=this._register(new yt(()=>this._updateBrackets(),50)),this._matchBrackets=this._editor.getOption(72),this._updateBracketsSoon.schedule(),this._register(e.onDidChangeCursorPosition(e=>{this._matchBrackets!==`never`&&this._updateBracketsSoon.schedule()})),this._register(e.onDidChangeModelContent(e=>{this._updateBracketsSoon.schedule()})),this._register(e.onDidChangeModel(e=>{this._lastBracketsData=[],this._updateBracketsSoon.schedule()})),this._register(e.onDidChangeModelLanguageConfiguration(e=>{this._lastBracketsData=[],this._updateBracketsSoon.schedule()})),this._register(e.onDidChangeConfiguration(e=>{e.hasChanged(72)&&(this._matchBrackets=this._editor.getOption(72),this._decorations.clear(),this._lastBracketsData=[],this._lastVersionId=0,this._updateBracketsSoon.schedule())})),this._register(e.onDidBlurEditorWidget(()=>{this._updateBracketsSoon.schedule()})),this._register(e.onDidFocusEditorWidget(()=>{this._updateBracketsSoon.schedule()}))}jumpToBracket(){if(!this._editor.hasModel())return;let e=this._editor.getModel(),t=this._editor.getSelections().map(t=>{let n=t.getStartPosition(),r=e.bracketPairs.matchBracket(n),i=null;if(r)r[0].containsPosition(n)&&!r[1].containsPosition(n)?i=r[1].getStartPosition():r[1].containsPosition(n)&&(i=r[0].getStartPosition());else{let t=e.bracketPairs.findEnclosingBrackets(n);if(t)i=t[1].getStartPosition();else{let t=e.bracketPairs.findNextBracket(n);t&&t.range&&(i=t.range.getStartPosition())}}return i?new v(i.lineNumber,i.column,i.lineNumber,i.column):new v(n.lineNumber,n.column,n.lineNumber,n.column)});this._editor.setSelections(t),this._editor.revealRange(t[0])}selectToBracket(e){if(!this._editor.hasModel())return;let t=this._editor.getModel(),n=[];this._editor.getSelections().forEach(r=>{let i=r.getStartPosition(),a=t.bracketPairs.matchBracket(i);if(!a&&(a=t.bracketPairs.findEnclosingBrackets(i),!a)){let e=t.bracketPairs.findNextBracket(i);e&&e.range&&(a=t.bracketPairs.matchBracket(e.range.getStartPosition()))}let o=null,s=null;if(a){a.sort(T.compareRangesUsingStarts);let[t,n]=a;if(o=e?t.getStartPosition():t.getEndPosition(),s=e?n.getEndPosition():n.getStartPosition(),n.containsPosition(i)){let e=o;o=s,s=e}}o&&s&&n.push(new v(o.lineNumber,o.column,s.lineNumber,s.column))}),n.length>0&&(this._editor.setSelections(n),this._editor.revealRange(n[0]))}removeBrackets(e){if(!this._editor.hasModel())return;let t=this._editor.getModel();this._editor.getSelections().forEach(n=>{let r=n.getPosition(),i=t.bracketPairs.matchBracket(r);i||=t.bracketPairs.findEnclosingBrackets(r),i&&(this._editor.pushUndoStop(),this._editor.executeEdits(e,[{range:i[0],text:``},{range:i[1],text:``}]),this._editor.pushUndoStop())})}static#t=this._DECORATION_OPTIONS_WITH_OVERVIEW_RULER=U.register({description:`bracket-match-overview`,stickiness:1,className:`bracket-match`,overviewRuler:{color:Bc(yu),position:sl.Center}});static#n=this._DECORATION_OPTIONS_WITHOUT_OVERVIEW_RULER=U.register({description:`bracket-match-no-overview`,stickiness:1,className:`bracket-match`});_updateBrackets(){if(this._matchBrackets===`never`)return;this._recomputeBrackets();let e=[],t=0;for(let n of this._lastBracketsData){let r=n.brackets;r&&(e[t++]={range:r[0],options:n.options},e[t++]={range:r[1],options:n.options})}this._decorations.set(e)}_recomputeBrackets(){if(!this._editor.hasModel()||!this._editor.hasWidgetFocus()){this._lastBracketsData=[],this._lastVersionId=0;return}let t=this._editor.getSelections();if(t.length>100){this._lastBracketsData=[],this._lastVersionId=0;return}let n=this._editor.getModel(),i=n.getVersionId(),a=[];this._lastVersionId===i&&(a=this._lastBracketsData);let o=[],s=0;for(let e=0,n=t.length;e<n;e++){let n=t[e];n.isEmpty()&&(o[s++]=n.getStartPosition())}o.length>1&&o.sort(r.compare);let c=[],l=0,u=0,d=a.length;for(let t=0,r=o.length;t<r;t++){let r=o[t];for(;u<d&&a[u].position.isBefore(r);)u++;if(u<d&&a[u].position.equals(r))c[l++]=a[u];else{let t=n.bracketPairs.matchBracket(r,20),i=e._DECORATION_OPTIONS_WITH_OVERVIEW_RULER;!t&&this._matchBrackets===`always`&&(t=n.bracketPairs.findEnclosingBrackets(r,20),i=e._DECORATION_OPTIONS_WITHOUT_OVERVIEW_RULER),c[l++]=new Cu(r,t,i)}}this._lastBracketsData=c,this._lastVersionId=i}};I(wu.ID,wu,1),L(xu),L(bu),L(Su),qr.appendMenuItem(R.MenubarGoMenu,{group:`5_infile_nav`,command:{id:`editor.action.jumpToBracket`,title:S({key:`miGoToBracket`,comment:[`&& denotes a mnemonic`]},`Go to &&Bracket`)},order:2});var Tu=class{constructor(e,t){this._selection=e,this._isMovingLeft=t}getEditOperations(e,t){if(this._selection.startLineNumber!==this._selection.endLineNumber||this._selection.isEmpty())return;let n=this._selection.startLineNumber,r=this._selection.startColumn,i=this._selection.endColumn;if(!(this._isMovingLeft&&r===1)&&!(!this._isMovingLeft&&i===e.getLineMaxColumn(n)))if(this._isMovingLeft){let a=new T(n,r-1,n,r),o=e.getValueInRange(a);t.addEditOperation(a,null),t.addEditOperation(new T(n,i,n,i),o)}else{let a=new T(n,i,n,i+1),o=e.getValueInRange(a);t.addEditOperation(a,null),t.addEditOperation(new T(n,r,n,r),o)}}computeCursorState(e,t){return this._isMovingLeft?new v(this._selection.startLineNumber,this._selection.startColumn-1,this._selection.endLineNumber,this._selection.endColumn-1):new v(this._selection.startLineNumber,this._selection.startColumn+1,this._selection.endLineNumber,this._selection.endColumn+1)}},Eu=class extends N{constructor(e,t){super(t),this.left=e}run(e,t){if(!t.hasModel())return;let n=[],r=t.getSelections();for(let e of r)n.push(new Tu(e,this.left));t.pushUndoStop(),t.executeCommands(this.id,n),t.pushUndoStop()}},Du=class extends Eu{constructor(){super(!0,{id:`editor.action.moveCarretLeftAction`,label:S(`caret.moveLeft`,`Move Selected Text Left`),alias:`Move Selected Text Left`,precondition:q.writable})}},Ou=class extends Eu{constructor(){super(!1,{id:`editor.action.moveCarretRightAction`,label:S(`caret.moveRight`,`Move Selected Text Right`),alias:`Move Selected Text Right`,precondition:q.writable})}};L(Du),L(Ou),L(class extends N{constructor(){super({id:`editor.action.transposeLetters`,label:S(`transposeLetters.label`,`Transpose Letters`),alias:`Transpose Letters`,precondition:q.writable,kbOpts:{kbExpr:q.textInputFocus,primary:0,mac:{primary:306},weight:100}})}run(e,t){if(!t.hasModel())return;let n=t.getModel(),r=[],i=t.getSelections();for(let e of i){if(!e.isEmpty())continue;let t=e.startLineNumber,i=e.startColumn,a=n.getLineMaxColumn(t);if(t===1&&(i===1||i===2&&a===2))continue;let o=i===a?e.getPosition():ks.rightPosition(n,e.getPosition().lineNumber,e.getPosition().column),s=ks.leftPosition(n,o),c=ks.leftPosition(n,s),l=n.getValueInRange(T.fromPositions(c,s)),u=n.getValueInRange(T.fromPositions(s,o)),d=T.fromPositions(c,o);r.push(new Nc(d,u+l))}r.length>0&&(t.pushUndoStop(),t.executeCommands(this.id,r),t.pushUndoStop())}});const ku=(function(){if(typeof crypto==`object`&&typeof crypto.randomUUID==`function`)return crypto.randomUUID.bind(crypto);let e;e=typeof crypto==`object`&&typeof crypto.getRandomValues==`function`?crypto.getRandomValues.bind(crypto):function(e){for(let t=0;t<e.length;t++)e[t]=Math.floor(Math.random()*256);return e};let t=new Uint8Array(16),n=[];for(let e=0;e<256;e++)n.push(e.toString(16).padStart(2,`0`));return function(){e(t),t[6]=t[6]&15|64,t[8]=t[8]&63|128;let r=0,i=``;return i+=n[t[r++]],i+=n[t[r++]],i+=n[t[r++]],i+=n[t[r++]],i+=`-`,i+=n[t[r++]],i+=n[t[r++]],i+=`-`,i+=n[t[r++]],i+=n[t[r++]],i+=`-`,i+=n[t[r++]],i+=n[t[r++]],i+=`-`,i+=n[t[r++]],i+=n[t[r++]],i+=n[t[r++]],i+=n[t[r++]],i+=n[t[r++]],i+=n[t[r++]],i}})();function Au(e){return{asString:async()=>e,asFile:()=>void 0,value:typeof e==`string`?e:void 0}}function ju(e,t,n){let r={id:ku(),name:e,uri:t,data:n};return{asString:async()=>``,asFile:()=>r,value:void 0}}var Mu=class{constructor(){this._entries=new Map}get size(){let e=0;for(let t of this._entries)e++;return e}has(e){return this._entries.has(this.toKey(e))}matches(e){let t=[...this._entries.keys()];return ue.some(this,([e,t])=>t.asFile())&&t.push(`files`),Fu(Nu(e),t)}get(e){return this._entries.get(this.toKey(e))?.[0]}append(e,t){let n=this._entries.get(e);n?n.push(t):this._entries.set(this.toKey(e),[t])}replace(e,t){this._entries.set(this.toKey(e),[t])}delete(e){this._entries.delete(this.toKey(e))}*[Symbol.iterator](){for(let[e,t]of this._entries)for(let n of t)yield[e,n]}toKey(e){return Nu(e)}};function Nu(e){return e.toLowerCase()}function Pu(e,t){return Fu(Nu(e),t.map(Nu))}function Fu(e,t){if(e===`*/*`)return t.length>0;if(t.includes(e))return!0;let n=e.match(/^([a-z]+)\/([a-z]+|\*)$/i);if(!n)return!1;let[r,i,a]=n;return a===`*`?t.some(e=>e.startsWith(i+`/`)):!1}const Iu=Object.freeze({create:e=>_n(e.map(e=>e.toString())).join(`\r
`),split:e=>e.split(`\r
`),parse:e=>Iu.split(e).filter(e=>!e.startsWith(`#`))});var X=class e{static#e=this.sep=`.`;static#t=this.None=new e(`@@none@@`);static#n=this.Empty=new e(``);constructor(e){this.value=e}equals(e){return this.value===e.value}contains(t){return this.equals(t)||this.value===``||t.value.startsWith(this.value+e.sep)}intersects(e){return this.contains(e)||e.contains(this)}append(...t){return new e((this.value?[this.value,...t]:t).join(e.sep))}};const Lu={EDITORS:`CodeEditors`,FILES:`CodeFiles`};var Ru=class{};un.add({DragAndDropContribution:`workbench.contributions.dragAndDrop`}.DragAndDropContribution,new Ru);var zu=class e{static#e=this.INSTANCE=new e;constructor(){}static getInstance(){return e.INSTANCE}hasData(e){return e&&e===this.proto}getData(e){if(this.hasData(e))return this.data}};function Bu(e){let t=new Mu;for(let n of e.items){let e=n.type;if(n.kind===`string`){let r=new Promise(e=>n.getAsString(e));t.append(e,Au(r))}else if(n.kind===`file`){let r=n.getAsFile();r&&t.append(e,Vu(r))}}return t}function Vu(e){let t=e.path?y.parse(e.path):void 0;return ju(e.name,t,async()=>new Uint8Array(await e.arrayBuffer()))}var Hu=Object.freeze([Lu.EDITORS,Lu.FILES,Vi.RESOURCES,Vi.INTERNAL_URI_LIST]);function Uu(e,t=!1){let n=Bu(e),r=n.get(Vi.INTERNAL_URI_LIST);if(r)n.replace(tc.uriList,r);else if(t||!n.has(tc.uriList)){let t=[];for(let n of e.items){let e=n.getAsFile();if(e){let n=e.path;try{n?t.push(y.file(n).toString()):t.push(y.parse(e.name,!0).toString())}catch{}}}t.length&&n.replace(tc.uriList,Au(Iu.create(t)))}for(let e of Hu)n.delete(e);return n}var Wu=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Gu=function(e,t){return function(n,r){t(n,r,e)}},Ku=class{async provideDocumentPasteEdits(e,t,n,r,i){let a=await this.getEdit(n,i);if(a)return{edits:[{insertText:a.insertText,title:a.title,kind:a.kind,handledMimeType:a.handledMimeType,yieldTo:a.yieldTo}],dispose(){}}}async provideDocumentDropEdits(e,t,n,r){let i=await this.getEdit(n,r);if(i)return{edits:[{insertText:i.insertText,title:i.title,kind:i.kind,handledMimeType:i.handledMimeType,yieldTo:i.yieldTo}],dispose(){}}}},qu=class e extends Ku{constructor(){super(...arguments),this.kind=e.kind,this.dropMimeTypes=[tc.text],this.pasteMimeTypes=[tc.text]}static#e=this.id=`text`;static#t=this.kind=new X(`text.plain`);async getEdit(e,t){let n=e.get(tc.text);if(!n||e.has(tc.uriList))return;let r=await n.asString();return{handledMimeType:tc.text,title:S(`text.label`,`Insert Plain Text`),insertText:r,kind:this.kind}}},Ju=class extends Ku{constructor(){super(...arguments),this.kind=new X(`uri.absolute`),this.dropMimeTypes=[tc.uriList],this.pasteMimeTypes=[tc.uriList]}async getEdit(e,t){let n=await Zu(e);if(!n.length||t.isCancellationRequested)return;let r=0,i=n.map(({uri:e,originalText:t})=>e.scheme===Bt.file?e.fsPath:(r++,t)).join(` `),a;return a=r>0?n.length>1?S(`defaultDropProvider.uriList.uris`,`Insert Uris`):S(`defaultDropProvider.uriList.uri`,`Insert Uri`):n.length>1?S(`defaultDropProvider.uriList.paths`,`Insert Paths`):S(`defaultDropProvider.uriList.path`,`Insert Path`),{handledMimeType:tc.uriList,insertText:i,title:a,kind:this.kind}}},Yu=class extends Ku{constructor(e){super(),this._workspaceContextService=e,this.kind=new X(`uri.relative`),this.dropMimeTypes=[tc.uriList],this.pasteMimeTypes=[tc.uriList]}async getEdit(e,t){let n=await Zu(e);if(!n.length||t.isCancellationRequested)return;let r=bt(n.map(({uri:e})=>{let t=this._workspaceContextService.getWorkspaceFolder(e);return t?nl(t.uri,e):void 0}));if(r.length)return{handledMimeType:tc.uriList,insertText:r.join(` `),title:n.length>1?S(`defaultDropProvider.uriList.relativePaths`,`Insert Relative Paths`):S(`defaultDropProvider.uriList.relativePath`,`Insert Relative Path`),kind:this.kind}}};Yu=Wu([Gu(0,mi)],Yu);var Xu=class{constructor(){this.kind=new X(`html`),this.pasteMimeTypes=[`text/html`],this._yieldTo=[{mimeType:tc.text}]}async provideDocumentPasteEdits(e,t,n,r,i){if(r.triggerKind!==Se.PasteAs&&!r.only?.contains(this.kind))return;let a=await n.get(`text/html`)?.asString();if(!(!a||i.isCancellationRequested))return{dispose(){},edits:[{insertText:a,yieldTo:this._yieldTo,title:S(`pasteHtmlLabel`,`Insert HTML`),kind:this.kind}]}}};async function Zu(e){let t=e.get(tc.uriList);if(!t)return[];let n=await t.asString(),r=[];for(let e of Iu.parse(n))try{r.push({uri:y.parse(e),originalText:e})}catch{}return r}var Qu=class extends _{constructor(e,t){super(),this._register(e.documentDropEditProvider.register(`*`,new qu)),this._register(e.documentDropEditProvider.register(`*`,new Ju)),this._register(e.documentDropEditProvider.register(`*`,new Yu(t)))}};Qu=Wu([Gu(0,V),Gu(1,mi)],Qu);var $u=class extends _{constructor(e,t){super(),this._register(e.documentPasteEditProvider.register(`*`,new qu)),this._register(e.documentPasteEditProvider.register(`*`,new Ju)),this._register(e.documentPasteEditProvider.register(`*`,new Yu(t))),this._register(e.documentPasteEditProvider.register(`*`,new Xu))}};$u=Wu([Gu(0,V),Gu(1,mi)],$u);var ed=class e{constructor(){this.value=``,this.pos=0}static#e=this._table={36:0,58:1,44:2,123:3,125:4,92:5,47:6,124:7,43:11,45:12,63:13};static isDigitCharacter(e){return e>=48&&e<=57}static isVariableCharacter(e){return e===95||e>=97&&e<=122||e>=65&&e<=90}text(e){this.value=e,this.pos=0}tokenText(e){return this.value.substr(e.pos,e.len)}next(){if(this.pos>=this.value.length)return{type:14,pos:this.pos,len:0};let t=this.pos,n=0,r=this.value.charCodeAt(t),i;if(i=e._table[r],typeof i==`number`)return this.pos+=1,{type:i,pos:t,len:1};if(e.isDigitCharacter(r)){i=8;do n+=1,r=this.value.charCodeAt(t+n);while(e.isDigitCharacter(r));return this.pos+=n,{type:i,pos:t,len:n}}if(e.isVariableCharacter(r)){i=9;do r=this.value.charCodeAt(t+ ++n);while(e.isVariableCharacter(r)||e.isDigitCharacter(r));return this.pos+=n,{type:i,pos:t,len:n}}i=10;do n+=1,r=this.value.charCodeAt(t+n);while(!isNaN(r)&&e._table[r]===void 0&&!e.isDigitCharacter(r)&&!e.isVariableCharacter(r));return this.pos+=n,{type:i,pos:t,len:n}}},td=class{constructor(){this._children=[]}appendChild(e){return e instanceof nd&&this._children[this._children.length-1]instanceof nd?this._children[this._children.length-1].value+=e.value:(e.parent=this,this._children.push(e)),this}replace(e,t){let{parent:n}=e,r=n.children.indexOf(e),i=n.children.slice(0);i.splice(r,1,...t),n._children=i,(function e(t,n){for(let r of t)r.parent=n,e(r.children,r)})(t,n)}get children(){return this._children}get rightMostDescendant(){return this._children.length>0?this._children[this._children.length-1].rightMostDescendant:this}get snippet(){let e=this;for(;;){if(!e)return;if(e instanceof ud)return e;e=e.parent}}toString(){return this.children.reduce((e,t)=>e+t.toString(),``)}len(){return 0}},nd=class e extends td{constructor(e){super(),this.value=e}toString(){return this.value}len(){return this.value.length}clone(){return new e(this.value)}},rd=class extends td{},id=class e extends rd{static compareByIndex(e,t){return e.index===t.index?0:e.isFinalTabstop?1:t.isFinalTabstop||e.index<t.index?-1:e.index>t.index?1:0}constructor(e){super(),this.index=e}get isFinalTabstop(){return this.index===0}get choice(){return this._children.length===1&&this._children[0]instanceof ad?this._children[0]:void 0}clone(){let t=new e(this.index);return this.transform&&(t.transform=this.transform.clone()),t._children=this.children.map(e=>e.clone()),t}},ad=class e extends td{constructor(){super(...arguments),this.options=[]}appendChild(e){return e instanceof nd&&(e.parent=this,this.options.push(e)),this}toString(){return this.options[0].value}len(){return this.options[0].len()}clone(){let t=new e;return this.options.forEach(t.appendChild,t),t}},od=class e extends td{constructor(){super(...arguments),this.regexp=RegExp(``)}resolve(e){let t=this,n=!1,r=e.replace(this.regexp,function(){return n=!0,t._replace(Array.prototype.slice.call(arguments,0,-2))});return!n&&this._children.some(e=>e instanceof sd&&!!e.elseValue)&&(r=this._replace([])),r}_replace(e){let t=``;for(let n of this._children)if(n instanceof sd){let r=e[n.index]||``;r=n.resolve(r),t+=r}else t+=n.toString();return t}toString(){return``}clone(){let t=new e;return t.regexp=new RegExp(this.regexp.source,(this.regexp.ignoreCase?`i`:``)+(this.regexp.global?`g`:``)),t._children=this.children.map(e=>e.clone()),t}},sd=class e extends td{constructor(e,t,n,r){super(),this.index=e,this.shorthandName=t,this.ifValue=n,this.elseValue=r}resolve(e){return this.shorthandName===`upcase`?e?e.toLocaleUpperCase():``:this.shorthandName===`downcase`?e?e.toLocaleLowerCase():``:this.shorthandName===`capitalize`?e?e[0].toLocaleUpperCase()+e.substr(1):``:this.shorthandName===`pascalcase`?e?this._toPascalCase(e):``:this.shorthandName===`camelcase`?e?this._toCamelCase(e):``:e&&typeof this.ifValue==`string`?this.ifValue:!e&&typeof this.elseValue==`string`?this.elseValue:e||``}_toPascalCase(e){let t=e.match(/[a-z0-9]+/gi);return t?t.map(e=>e.charAt(0).toUpperCase()+e.substr(1)).join(``):e}_toCamelCase(e){let t=e.match(/[a-z0-9]+/gi);return t?t.map((e,t)=>t===0?e.charAt(0).toLowerCase()+e.substr(1):e.charAt(0).toUpperCase()+e.substr(1)).join(``):e}clone(){return new e(this.index,this.shorthandName,this.ifValue,this.elseValue)}},cd=class e extends rd{constructor(e){super(),this.name=e}resolve(e){let t=e.resolve(this);return this.transform&&(t=this.transform.resolve(t||``)),t===void 0?!1:(this._children=[new nd(t)],!0)}clone(){let t=new e(this.name);return this.transform&&(t.transform=this.transform.clone()),t._children=this.children.map(e=>e.clone()),t}};function ld(e,t){let n=[...e];for(;n.length>0;){let e=n.shift();if(!t(e))break;n.unshift(...e.children)}}var ud=class e extends td{get placeholderInfo(){if(!this._placeholders){let e=[],t;this.walk(function(n){return n instanceof id&&(e.push(n),t=!t||t.index<n.index?n:t),!0}),this._placeholders={all:e,last:t}}return this._placeholders}get placeholders(){let{all:e}=this.placeholderInfo;return e}offset(e){let t=0,n=!1;return this.walk(r=>r===e?(n=!0,!1):(t+=r.len(),!0)),n?t:-1}fullLen(e){let t=0;return ld([e],e=>(t+=e.len(),!0)),t}enclosingPlaceholders(e){let t=[],{parent:n}=e;for(;n;)n instanceof id&&t.push(n),n=n.parent;return t}resolveVariables(e){return this.walk(t=>(t instanceof cd&&t.resolve(e)&&(this._placeholders=void 0),!0)),this}appendChild(e){return this._placeholders=void 0,super.appendChild(e)}replace(e,t){return this._placeholders=void 0,super.replace(e,t)}clone(){let t=new e;return this._children=this.children.map(e=>e.clone()),t}walk(e){ld(this.children,e)}},dd=class{constructor(){this._scanner=new ed,this._token={type:14,pos:0,len:0}}static escape(e){return e.replace(/\$|}|\\/g,`\\$&`)}static guessNeedsClipboard(e){return/\${?CLIPBOARD/.test(e)}parse(e,t,n){let r=new ud;return this.parseFragment(e,r),this.ensureFinalTabstop(r,n??!1,t??!1),r}parseFragment(e,t){let n=t.children.length;for(this._scanner.text(e),this._token=this._scanner.next();this._parse(t););let r=new Map,i=[];t.walk(e=>(e instanceof id&&(e.isFinalTabstop?r.set(0,void 0):!r.has(e.index)&&e.children.length>0?r.set(e.index,e.children):i.push(e)),!0));let a=(e,n)=>{let i=r.get(e.index);if(!i)return;let o=new id(e.index);o.transform=e.transform;for(let e of i){let t=e.clone();o.appendChild(t),t instanceof id&&r.has(t.index)&&!n.has(t.index)&&(n.add(t.index),a(t,n),n.delete(t.index))}t.replace(e,[o])},o=new Set;for(let e of i)a(e,o);return t.children.slice(n)}ensureFinalTabstop(e,t,n){(t||n&&e.placeholders.length>0)&&(e.placeholders.find(e=>e.index===0)||e.appendChild(new id(0)))}_accept(e,t){if(e===void 0||this._token.type===e){let e=t?this._scanner.tokenText(this._token):!0;return this._token=this._scanner.next(),e}return!1}_backTo(e){return this._scanner.pos=e.pos+e.len,this._token=e,!1}_until(e){let t=this._token;for(;this._token.type!==e;){if(this._token.type===14)return!1;if(this._token.type===5){let e=this._scanner.next();if(e.type!==0&&e.type!==4&&e.type!==5)return!1}this._token=this._scanner.next()}let n=this._scanner.value.substring(t.pos,this._token.pos).replace(/\\(\$|}|\\)/g,`$1`);return this._token=this._scanner.next(),n}_parse(e){return this._parseEscaped(e)||this._parseTabstopOrVariableName(e)||this._parseComplexPlaceholder(e)||this._parseComplexVariable(e)||this._parseAnything(e)}_parseEscaped(e){let t;return(t=this._accept(5,!0))?(t=this._accept(0,!0)||this._accept(4,!0)||this._accept(5,!0)||t,e.appendChild(new nd(t)),!0):!1}_parseTabstopOrVariableName(e){let t,n=this._token;return this._accept(0)&&(t=this._accept(9,!0)||this._accept(8,!0))?(e.appendChild(/^\d+$/.test(t)?new id(Number(t)):new cd(t)),!0):this._backTo(n)}_parseComplexPlaceholder(e){let t,n=this._token;if(!(this._accept(0)&&this._accept(3)&&(t=this._accept(8,!0))))return this._backTo(n);let r=new id(Number(t));if(this._accept(1))for(;;){if(this._accept(4))return e.appendChild(r),!0;if(!this._parse(r))return e.appendChild(new nd("${"+t+`:`)),r.children.forEach(e.appendChild,e),!0}else if(r.index>0&&this._accept(7)){let t=new ad;for(;;){if(this._parseChoiceElement(t)){if(this._accept(2))continue;if(this._accept(7)&&(r.appendChild(t),this._accept(4)))return e.appendChild(r),!0}return this._backTo(n),!1}}else if(this._accept(6))return this._parseTransform(r)?(e.appendChild(r),!0):(this._backTo(n),!1);else if(this._accept(4))return e.appendChild(r),!0;else return this._backTo(n)}_parseChoiceElement(e){let t=this._token,n=[];for(;!(this._token.type===2||this._token.type===7);){let e;if(e=(e=this._accept(5,!0))?this._accept(2,!0)||this._accept(7,!0)||this._accept(5,!0)||e:this._accept(void 0,!0),!e)return this._backTo(t),!1;n.push(e)}return n.length===0?(this._backTo(t),!1):(e.appendChild(new nd(n.join(``))),!0)}_parseComplexVariable(e){let t,n=this._token;if(!(this._accept(0)&&this._accept(3)&&(t=this._accept(9,!0))))return this._backTo(n);let r=new cd(t);if(this._accept(1))for(;;){if(this._accept(4))return e.appendChild(r),!0;if(!this._parse(r))return e.appendChild(new nd("${"+t+`:`)),r.children.forEach(e.appendChild,e),!0}else if(this._accept(6))return this._parseTransform(r)?(e.appendChild(r),!0):(this._backTo(n),!1);else if(this._accept(4))return e.appendChild(r),!0;else return this._backTo(n)}_parseTransform(e){let t=new od,n=``,r=``;for(;!this._accept(6);){let e;if(e=this._accept(5,!0)){e=this._accept(6,!0)||e,n+=e;continue}if(this._token.type!==14){n+=this._accept(void 0,!0);continue}return!1}for(;!this._accept(6);){let e;if(e=this._accept(5,!0)){e=this._accept(5,!0)||this._accept(6,!0)||e,t.appendChild(new nd(e));continue}if(!(this._parseFormatString(t)||this._parseAnything(t)))return!1}for(;!this._accept(4);){if(this._token.type!==14){r+=this._accept(void 0,!0);continue}return!1}try{t.regexp=new RegExp(n,r)}catch{return!1}return e.transform=t,!0}_parseFormatString(e){let t=this._token;if(!this._accept(0))return!1;let n=!1;this._accept(3)&&(n=!0);let r=this._accept(8,!0);if(r)if(n){if(this._accept(4))return e.appendChild(new sd(Number(r))),!0;if(!this._accept(1))return this._backTo(t),!1}else return e.appendChild(new sd(Number(r))),!0;else return this._backTo(t),!1;if(this._accept(6)){let n=this._accept(9,!0);return!n||!this._accept(4)?(this._backTo(t),!1):(e.appendChild(new sd(Number(r),n)),!0)}else if(this._accept(11)){let t=this._until(4);if(t)return e.appendChild(new sd(Number(r),void 0,t,void 0)),!0}else if(this._accept(12)){let t=this._until(4);if(t)return e.appendChild(new sd(Number(r),void 0,void 0,t)),!0}else if(this._accept(13)){let t=this._until(1);if(t){let n=this._until(4);if(n)return e.appendChild(new sd(Number(r),void 0,t,n)),!0}}else{let t=this._until(4);if(t)return e.appendChild(new sd(Number(r),void 0,void 0,t)),!0}return this._backTo(t),!1}_parseAnything(e){return this._token.type===14?!1:(e.appendChild(new nd(this._scanner.tokenText(this._token))),this._accept(void 0),!0)}};function fd(e,t,n){return(typeof n.insertText==`string`?n.insertText===``:n.insertText.snippet===``)?{edits:n.additionalEdit?.edits??[]}:{edits:[...t.map(t=>new fa(e,{range:t,text:typeof n.insertText==`string`?dd.escape(n.insertText)+`$0`:n.insertText.snippet,insertAsSnippet:!0})),...n.additionalEdit?.edits??[]]}}function pd(e){function t(e,t){return`mimeType`in e?e.mimeType===t.handledMimeType:!!t.kind&&e.kind.contains(t.kind)}let n=new Map;for(let r of e)for(let i of r.yieldTo??[])for(let a of e)if(a!==r&&t(i,a)){let e=n.get(r);e||(e=[],n.set(r,e)),e.push(a)}if(!n.size)return Array.from(e);let r=new Set,i=[];function a(e){if(!e.length)return[];let t=e[0];if(i.includes(t))return console.warn(`Yield to cycle detected`,t),e;if(r.has(t))return a(e.slice(1));let o=[],s=n.get(t);return s&&(i.push(t),o=a(s),i.pop()),r.add(t),[...o,t,...a(e.slice(1))]}return a(Array.from(e))}var md=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},hd=function(e,t){return function(n,r){t(n,r,e)}},gd=U.register({description:`inline-progress-widget`,stickiness:1,showIfCollapsed:!0,after:{content:`\xA0`,inlineClassName:`inline-editor-progress-decoration`,inlineClassNameAffectsLetterSpacing:!0}}),_d=class e extends _{static#e=this.baseId=`editor.widget.inlineProgressWidget`;constructor(e,t,n,r,i){super(),this.typeId=e,this.editor=t,this.range=n,this.delegate=i,this.allowEditorOverflow=!1,this.suppressMouseDown=!0,this.create(r),this.editor.addContentWidget(this),this.editor.layoutContentWidget(this)}create(e){this.domNode=O(`.inline-progress-widget`),this.domNode.role=`button`,this.domNode.title=e;let t=O(`span.icon`);this.domNode.append(t),t.classList.add(...J.asClassNameArray(i.loading),`codicon-modifier-spin`);let n=()=>{let e=this.editor.getOption(67);this.domNode.style.height=`${e}px`,this.domNode.style.width=`${Math.ceil(.8*e)}px`};n(),this._register(this.editor.onDidChangeConfiguration(e=>{(e.hasChanged(52)||e.hasChanged(67))&&n()})),this._register(D(this.domNode,j.CLICK,e=>{this.delegate.cancel()}))}getId(){return e.baseId+`.`+this.typeId}getDomNode(){return this.domNode}getPosition(){return{position:{lineNumber:this.range.startLineNumber,column:this.range.startColumn},preference:[0]}}dispose(){super.dispose(),this.editor.removeContentWidget(this)}},vd=class extends _{constructor(e,t,n){super(),this.id=e,this._editor=t,this._instantiationService=n,this._showDelay=500,this._showPromise=this._register(new l),this._currentWidget=this._register(new l),this._operationIdPool=0,this._currentDecorations=t.createDecorationsCollection()}dispose(){super.dispose(),this._currentDecorations.clear()}async showWhile(e,t,n,r,i){let a=this._operationIdPool++;this._currentOperation=a,this.clear(),this._showPromise.value=on(()=>{let n=T.fromPositions(e);this._currentDecorations.set([{range:n,options:gd}]).length>0&&(this._currentWidget.value=this._instantiationService.createInstance(_d,this.id,this._editor,n,t,r))},i??this._showDelay);try{return await n}finally{this._currentOperation===a&&(this.clear(),this._currentOperation=void 0)}}clear(){this._showPromise.clear(),this._currentDecorations.clear(),this._currentWidget.clear()}};vd=md([hd(2,Y)],vd);var yd=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},bd=function(e,t){return function(n,r){t(n,r,e)}},xd,Sd=class{static#e=xd=this;static#t=this.ID=`editor.contrib.messageController`;static#n=this.MESSAGE_VISIBLE=new G(`messageVisible`,!1,S(`messageVisible`,`Whether the editor is currently showing an inline message`));static get(e){return e.getContribution(xd.ID)}constructor(e,t,r){this._openerService=r,this._messageWidget=new l,this._messageListeners=new n,this._mouseOverMessage=!1,this._editor=e,this._visible=xd.MESSAGE_VISIBLE.bindTo(t)}dispose(){this._message?.dispose(),this._messageListeners.dispose(),this._messageWidget.dispose(),this._visible.reset()}showMessage(e,t){qa(ys(e)?e.value:e),this._visible.set(!0),this._messageWidget.clear(),this._messageListeners.clear(),this._message=ys(e)?Fo(e,{actionHandler:{callback:t=>{this.closeMessage(),fo(this._openerService,t,ys(e)?e.isTrusted:void 0)},disposables:this._messageListeners}}):void 0,this._messageWidget.value=new Cd(this._editor,t,typeof e==`string`?e:this._message.element),this._messageListeners.add(we.debounce(this._editor.onDidBlurEditorText,(e,t)=>t,0)(()=>{this._mouseOverMessage||this._messageWidget.value&&ln(Je(),this._messageWidget.value.getDomNode())||this.closeMessage()})),this._messageListeners.add(this._editor.onDidChangeCursorPosition(()=>this.closeMessage())),this._messageListeners.add(this._editor.onDidDispose(()=>this.closeMessage())),this._messageListeners.add(this._editor.onDidChangeModel(()=>this.closeMessage())),this._messageListeners.add(D(this._messageWidget.value.getDomNode(),j.MOUSE_ENTER,()=>this._mouseOverMessage=!0,!0)),this._messageListeners.add(D(this._messageWidget.value.getDomNode(),j.MOUSE_LEAVE,()=>this._mouseOverMessage=!1,!0));let n;this._messageListeners.add(this._editor.onMouseMove(e=>{e.target.position&&(n?n.containsPosition(e.target.position)||this.closeMessage():n=new T(t.lineNumber-3,1,e.target.position.lineNumber+3,1))}))}closeMessage(){this._visible.reset(),this._messageListeners.clear(),this._messageWidget.value&&this._messageListeners.add(Cd.fadeOut(this._messageWidget.value))}};Sd=xd=yd([bd(1,W),bd(2,wi)],Sd),P(new(la.bindToContribution(Sd.get))({id:`leaveEditorMessage`,precondition:Sd.MESSAGE_VISIBLE,handler:e=>e.closeMessage(),kbOpts:{weight:130,primary:9}}));var Cd=class{static fadeOut(e){let t=()=>{e.dispose(),clearTimeout(n),e.getDomNode().removeEventListener(`animationend`,t)},n=setTimeout(t,110);return e.getDomNode().addEventListener(`animationend`,t),e.getDomNode().classList.add(`fadeOut`),{dispose:t}}constructor(e,{lineNumber:t,column:n},r){this.allowEditorOverflow=!0,this.suppressMouseDown=!1,this._editor=e,this._editor.revealLinesInCenterIfOutsideViewport(t,t,0),this._position={lineNumber:t,column:n},this._domNode=document.createElement(`div`),this._domNode.classList.add(`monaco-editor-overlaymessage`),this._domNode.style.marginLeft=`-6px`;let i=document.createElement(`div`);i.classList.add(`anchor`,`top`),this._domNode.appendChild(i);let a=document.createElement(`div`);typeof r==`string`?(a.classList.add(`message`),a.textContent=r):(r.classList.add(`message`),a.appendChild(r)),this._domNode.appendChild(a);let o=document.createElement(`div`);o.classList.add(`anchor`,`below`),this._domNode.appendChild(o),this._editor.addContentWidget(this),this._domNode.classList.add(`fadeIn`)}dispose(){this._editor.removeContentWidget(this)}getId(){return`messageoverlay`}getDomNode(){return this._domNode}getPosition(){return{position:this._position,preference:[1,2],positionAffinity:1}}afterRender(e){this._domNode.classList.toggle(`below`,e===2)}};I(Sd.ID,Sd,4);function wd(e,t){return t&&(e.stack||e.stacktrace)?S(`stackTrace.format`,`{0}: {1}`,Ed(e),Td(e.stack)||Td(e.stacktrace)):Ed(e)}function Td(e){return Array.isArray(e)?e.join(`
`):e}function Ed(e){return e.code===`ERR_UNC_HOST_NOT_ALLOWED`?`${e.message}. Please update the 'security.allowedUNCHosts' setting if you want to allow this host.`:typeof e.code==`string`&&typeof e.errno==`number`&&typeof e.syscall==`string`?S(`nodeExceptionMessage`,`A system error occurred ({0})`,e.message):e.message||S(`error.defaultMessage`,`An unknown error occurred. Please consult the log for more details.`)}function Dd(e=null,t=!1){if(!e)return S(`error.defaultMessage`,`An unknown error occurred. Please consult the log for more details.`);if(Array.isArray(e)){let n=bt(e),r=Dd(n[0],t);return n.length>1?S(`error.moreErrors`,`{0} ({1} errors in total)`,r,n.length):r}if(h(e))return e;if(e.detail){let n=e.detail;if(n.error)return wd(n.error,t);if(n.exception)return wd(n.exception,t)}return e.stack?wd(e,t):e.message?e.message:S(`error.defaultMessage`,`An unknown error occurred. Please consult the log for more details.`)}var Od=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},kd=function(e,t){return function(n,r){t(n,r,e)}},Ad,jd=class extends _{static#e=Ad=this;static#t=this.baseId=`editor.widget.postEditWidget`;constructor(e,t,n,r,i,a,o,s,c,l){super(),this.typeId=e,this.editor=t,this.showCommand=r,this.range=i,this.edits=a,this.onSelectNewEdit=o,this._contextMenuService=s,this._keybindingService=l,this.allowEditorOverflow=!0,this.suppressMouseDown=!0,this.create(),this.visibleContext=n.bindTo(c),this.visibleContext.set(!0),this._register(b(()=>this.visibleContext.reset())),this.editor.addContentWidget(this),this.editor.layoutContentWidget(this),this._register(b((()=>this.editor.removeContentWidget(this)))),this._register(this.editor.onDidChangeCursorPosition(e=>{i.containsPosition(e.position)||this.dispose()})),this._register(we.runAndSubscribe(l.onDidUpdateKeybindings,()=>{this._updateButtonTitle()}))}_updateButtonTitle(){let e=this._keybindingService.lookupKeybinding(this.showCommand.id)?.getLabel();this.button.element.title=this.showCommand.label+(e?` (${e})`:``)}create(){this.domNode=O(`.post-edit-widget`),this.button=this._register(new bs(this.domNode,{supportIcons:!0})),this.button.label=`$(insert)`,this._register(D(this.domNode,j.CLICK,()=>this.showSelector()))}getId(){return Ad.baseId+`.`+this.typeId}getDomNode(){return this.domNode}getPosition(){return{position:this.range.getEndPosition(),preference:[2]}}showSelector(){this._contextMenuService.showContextMenu({getAnchor:()=>{let e=gt(this.button.element);return{x:e.left+e.width,y:e.top+e.height}},getActions:()=>this.edits.allEdits.map((e,t)=>gc({id:``,label:e.title,checked:t===this.edits.activeEditIndex,run:()=>{if(t!==this.edits.activeEditIndex)return this.onSelectNewEdit(t)}}))})}};jd=Ad=Od([kd(7,Ga),kd(8,W),kd(9,ua)],jd);var Md=class extends _{constructor(e,t,n,r,i,a,o){super(),this._id=e,this._editor=t,this._visibleContext=n,this._showCommand=r,this._instantiationService=i,this._bulkEditService=a,this._notificationService=o,this._currentWidget=this._register(new l),this._register(we.any(t.onDidChangeModel,t.onDidChangeModelContent)(()=>this.clear()))}async applyEditAndShowIfNeeded(e,t,n,r,i){let a=this._editor.getModel();if(!a||!e.length)return;let o=t.allEdits.at(t.activeEditIndex);if(!o)return;let s=async a=>{let o=this._editor.getModel();o&&(await o.undo(),this.applyEditAndShowIfNeeded(e,{activeEditIndex:a,allEdits:t.allEdits},n,r,i))},c=(r,i)=>{pe(r)||(this._notificationService.error(i),n&&this.show(e[0],t,s))},l;try{l=await r(o,i)}catch(e){return c(e,S(`resolveError`,`Error resolving edit '{0}':
{1}`,o.title,Dd(e)))}if(i.isCancellationRequested)return;let u=fd(a.uri,e,l),d=e[0],f=a.deltaDecorations([],[{range:d,options:{description:`paste-line-suffix`,stickiness:0}}]);this._editor.focus();let p,m;try{p=await this._bulkEditService.apply(u,{editor:this._editor,token:i}),m=a.getDecorationRange(f[0])}catch(e){return c(e,S(`applyError`,`Error applying edit '{0}':
{1}`,o.title,Dd(e)))}finally{a.deltaDecorations(f,[])}i.isCancellationRequested||n&&p.isApplied&&t.allEdits.length>1&&this.show(m??d,t,s)}show(e,t,n){this.clear(),this._editor.hasModel()&&(this._currentWidget.value=this._instantiationService.createInstance(jd,this._id,this._editor,this._visibleContext,this._showCommand,e,t,n))}clear(){this._currentWidget.clear()}tryShowSelector(){this._currentWidget.value?.showSelector()}};Md=Od([kd(4,Y),kd(5,Ji),kd(6,Ro)],Md);var Nd=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Pd=function(e,t){return function(n,r){t(n,r,e)}},Fd;const Id=`editor.changePasteType`,Ld=new G(`pasteWidgetVisible`,!1,S(`pasteWidgetVisible`,`Whether the paste widget is showing`));var Rd=`application/vnd.code.copyMetadata`,zd=class extends _{static#e=Fd=this;static#t=this.ID=`editor.contrib.copyPasteActionController`;static get(e){return e.getContribution(Fd.ID)}constructor(e,t,n,r,i,a,o){super(),this._bulkEditService=n,this._clipboardService=r,this._languageFeaturesService=i,this._quickInputService=a,this._progressService=o,this._editor=e;let s=e.getContainerDomNode();this._register(D(s,`copy`,e=>this.handleCopy(e))),this._register(D(s,`cut`,e=>this.handleCopy(e))),this._register(D(s,`paste`,e=>this.handlePaste(e),!0)),this._pasteProgressManager=this._register(new vd(`pasteIntoEditor`,e,t)),this._postPasteWidgetManager=this._register(t.createInstance(Md,`pasteIntoEditor`,e,Ld,{id:Id,label:S(`postPasteWidgetTitle`,`Show paste options...`)}))}changePasteType(){this._postPasteWidgetManager.tryShowSelector()}pasteAs(e){this._editor.focus();try{this._pasteAsActionContext={preferred:e},Qn().execCommand(`paste`)}finally{this._pasteAsActionContext=void 0}}clearWidgets(){this._postPasteWidgetManager.clear()}isPasteAsEnabled(){return this._editor.getOption(85).enabled}async finishedPaste(){await this._currentPasteOperation}handleCopy(e){if(!this._editor.hasTextFocus()||(this._clipboardService.clearInternalState?.(),!e.clipboardData||!this.isPasteAsEnabled()))return;let t=this._editor.getModel(),n=this._editor.getSelections();if(!t||!n?.length)return;let r=this._editor.getOption(37),i=n,a=n.length===1&&n[0].isEmpty();if(a){if(!r)return;i=[new T(i[0].startLineNumber,1,i[0].startLineNumber,1+t.getLineLength(i[0].startLineNumber))]}let o=this._editor._getViewModel()?.getPlainTextToCopy(n,r,_e),s={multicursorText:Array.isArray(o)?o:null,pasteOnNewLine:a,mode:null},c=this._languageFeaturesService.documentPasteEditProvider.ordered(t).filter(e=>!!e.prepareDocumentPaste);if(!c.length){this.setCopyMetadata(e.clipboardData,{defaultPastePayload:s});return}let l=Bu(e.clipboardData),u=c.flatMap(e=>e.copyMimeTypes??[]),d=ku();this.setCopyMetadata(e.clipboardData,{id:d,providerCopyMimeTypes:u,defaultPastePayload:s});let f=et(async e=>{let n=bt(await Promise.all(c.map(async n=>{try{return await n.prepareDocumentPaste(t,i,l,e)}catch(e){console.error(e);return}})));n.reverse();for(let e of n)for(let[t,n]of e)l.replace(t,n);return l});Fd._currentCopyOperation?.dataTransferPromise.cancel(),Fd._currentCopyOperation={handle:d,dataTransferPromise:f}}async handlePaste(e){if(!e.clipboardData||!this._editor.hasTextFocus())return;Sd.get(this._editor)?.closeMessage(),this._currentPasteOperation?.cancel(),this._currentPasteOperation=void 0;let t=this._editor.getModel(),n=this._editor.getSelections();if(!n?.length||!t||this._editor.getOption(92)||!this.isPasteAsEnabled()&&!this._pasteAsActionContext)return;let r=this.fetchCopyMetadata(e),i=Uu(e.clipboardData);i.delete(Rd);let a=[...e.clipboardData.types,...r?.providerCopyMimeTypes??[],tc.uriList],o=this._languageFeaturesService.documentPasteEditProvider.ordered(t).filter(e=>{let t=this._pasteAsActionContext?.preferred;return t&&e.providedPasteEditKinds&&!this.providerMatchesPreference(e,t)?!1:e.pasteMimeTypes?.some(e=>Pu(e,a))});if(!o.length){this._pasteAsActionContext?.preferred&&this.showPasteAsNoEditMessage(n,this._pasteAsActionContext.preferred);return}e.preventDefault(),e.stopImmediatePropagation(),this._pasteAsActionContext?this.showPasteAsPick(this._pasteAsActionContext.preferred,o,n,i,r):this.doPasteInline(o,n,i,r,e)}showPasteAsNoEditMessage(e,t){Sd.get(this._editor)?.showMessage(S(`pasteAsError`,`No paste edits for '{0}' found`,t instanceof X?t.value:t.providerId),e[0].getStartPosition())}doPasteInline(e,t,r,i,a){let o=this._editor;if(!o.hasModel())return;let s=new fl(o,3,void 0),c=et(async o=>{let l=this._editor;if(!l.hasModel())return;let u=l.getModel(),d=new n,f=d.add(new ie(o));d.add(s.token.onCancellationRequested(()=>f.cancel()));let p=f.token;try{if(await this.mergeInDataFromCopy(r,i,p),p.isCancellationRequested)return;let n=e.filter(e=>this.isSupportedPasteProvider(e,r));if(!n.length||n.length===1&&n[0]instanceof qu)return this.applyDefaultPasteHandler(r,i,p,a);let o={triggerKind:Se.Automatic},s=await this.getPasteEdits(n,r,u,t,o,p);if(d.add(s),p.isCancellationRequested)return;if(s.edits.length===1&&s.edits[0].provider instanceof qu)return this.applyDefaultPasteHandler(r,i,p,a);if(s.edits.length){let e=l.getOption(85).showPasteSelector===`afterPaste`;return this._postPasteWidgetManager.applyEditAndShowIfNeeded(t,{activeEditIndex:0,allEdits:s.edits},e,(e,n)=>new Promise((r,i)=>{(async()=>{try{let a=e.provider.resolveDocumentPasteEdit?.(e,n),o=new Zn,s=a&&await this._pasteProgressManager.showWhile(t[0].getEndPosition(),S(`resolveProcess`,`Resolving paste edit. Click to cancel`),Promise.race([o.p,a]),{cancel:()=>(o.cancel(),i(new ge))},0);return s&&(e.additionalEdit=s.additionalEdit),r(e)}catch(e){return i(e)}})()}),p)}await this.applyDefaultPasteHandler(r,i,p,a)}finally{d.dispose(),this._currentPasteOperation===c&&(this._currentPasteOperation=void 0)}});this._pasteProgressManager.showWhile(t[0].getEndPosition(),S(`pasteIntoEditorProgress`,`Running paste handlers. Click to cancel and do basic paste`),c,{cancel:async()=>{try{if(c.cancel(),s.token.isCancellationRequested)return;await this.applyDefaultPasteHandler(r,i,s.token,a)}finally{s.dispose()}}}).then(()=>{s.dispose()}),this._currentPasteOperation=c}showPasteAsPick(e,t,r,i,a){let o=et(async s=>{let c=this._editor;if(!c.hasModel())return;let l=c.getModel(),u=new n,d=u.add(new fl(c,3,void 0,s));try{if(await this.mergeInDataFromCopy(i,a,d.token),d.token.isCancellationRequested)return;let n=t.filter(t=>this.isSupportedPasteProvider(t,i,e));e&&(n=n.filter(t=>this.providerMatchesPreference(t,e)));let o={triggerKind:Se.PasteAs,only:e&&e instanceof X?e:void 0},s=u.add(await this.getPasteEdits(n,i,l,r,o,d.token));if(d.token.isCancellationRequested)return;if(e&&(s={edits:s.edits.filter(t=>e instanceof X?e.contains(t.kind):e.providerId===t.provider.id),dispose:s.dispose}),!s.edits.length){o.only&&this.showPasteAsNoEditMessage(r,o.only);return}let c;if(c=e?s.edits.at(0):(await this._quickInputService.pick(s.edits.map(e=>({label:e.title,description:e.kind?.value,edit:e})),{placeHolder:S(`pasteAsPickerPlaceholder`,`Select Paste Action`)}))?.edit,!c)return;let f=fd(l.uri,r,c);await this._bulkEditService.apply(f,{editor:this._editor})}finally{u.dispose(),this._currentPasteOperation===o&&(this._currentPasteOperation=void 0)}});this._progressService.withProgress({location:10,title:S(`pasteAsProgress`,`Running paste handlers`)},()=>o)}setCopyMetadata(e,t){e.setData(Rd,JSON.stringify(t))}fetchCopyMetadata(e){if(!e.clipboardData)return;let t=e.clipboardData.getData(Rd);if(t)try{return JSON.parse(t)}catch{return}let[n,r]=Jo.getTextData(e.clipboardData);if(r)return{defaultPastePayload:{mode:r.mode,multicursorText:r.multicursorText??null,pasteOnNewLine:!!r.isFromEmptySelection}}}async mergeInDataFromCopy(e,t,n){if(t?.id&&Fd._currentCopyOperation?.handle===t.id){let t=await Fd._currentCopyOperation.dataTransferPromise;if(n.isCancellationRequested)return;for(let[n,r]of t)e.replace(n,r)}if(!e.has(tc.uriList)){let t=await this._clipboardService.readResources();if(n.isCancellationRequested)return;t.length&&e.append(tc.uriList,Au(Iu.create(t)))}}async getPasteEdits(e,t,r,i,a,o){let s=new n;return{edits:pd(bt(await sn(Promise.all(e.map(async e=>{try{let n=await e.provideDocumentPasteEdits?.(r,i,t,a,o);return n&&s.add(n),n?.edits?.map(t=>({...t,provider:e}))}catch(e){pe(e)||console.error(e);return}})),o)??[]).flat().filter(e=>!a.only||a.only.contains(e.kind))),dispose:()=>s.dispose()}}async applyDefaultPasteHandler(e,t,n,r){let i=await(e.get(tc.text)??e.get(`text`))?.asString()??``;if(n.isCancellationRequested)return;let a={clipboardEvent:r,text:i,pasteOnNewLine:t?.defaultPastePayload.pasteOnNewLine??!1,multicursorText:t?.defaultPastePayload.multicursorText??null,mode:null};this._editor.trigger(`keyboard`,`paste`,a)}isSupportedPasteProvider(e,t,n){return e.pasteMimeTypes?.some(e=>t.matches(e))?!n||this.providerMatchesPreference(e,n):!1}providerMatchesPreference(e,t){return t instanceof X?e.providedPasteEditKinds?e.providedPasteEditKinds.some(e=>t.contains(e)):!0:e.id===t.providerId}};zd=Fd=Nd([Pd(1,Y),Pd(2,Ji),Pd(3,_l),Pd(4,V),Pd(5,xc),Pd(6,Qs)],zd);var Bd=`9_cutcopypaste`,Vd=Ee||document.queryCommandSupported(`cut`),Hd=Ee||document.queryCommandSupported(`copy`),Ud=navigator.clipboard===void 0||fr?document.queryCommandSupported(`paste`):!0;function Wd(e){return e.register(),e}const Gd=Vd?Wd(new Nl({id:`editor.action.clipboardCutAction`,precondition:void 0,kbOpts:Ee?{primary:2102,win:{primary:2102,secondary:[1044]},weight:100}:void 0,menuOpts:[{menuId:R.MenubarEditMenu,group:`2_ccp`,title:S({key:`miCut`,comment:[`&& denotes a mnemonic`]},`Cu&&t`),order:1},{menuId:R.EditorContext,group:Bd,title:S(`actions.clipboard.cutLabel`,`Cut`),when:q.writable,order:1},{menuId:R.CommandPalette,group:``,title:S(`actions.clipboard.cutLabel`,`Cut`),order:1},{menuId:R.SimpleEditorContext,group:Bd,title:S(`actions.clipboard.cutLabel`,`Cut`),when:q.writable,order:1}]})):void 0,Kd=Hd?Wd(new Nl({id:`editor.action.clipboardCopyAction`,precondition:void 0,kbOpts:Ee?{primary:2081,win:{primary:2081,secondary:[2067]},weight:100}:void 0,menuOpts:[{menuId:R.MenubarEditMenu,group:`2_ccp`,title:S({key:`miCopy`,comment:[`&& denotes a mnemonic`]},`&&Copy`),order:2},{menuId:R.EditorContext,group:Bd,title:S(`actions.clipboard.copyLabel`,`Copy`),order:2},{menuId:R.CommandPalette,group:``,title:S(`actions.clipboard.copyLabel`,`Copy`),order:1},{menuId:R.SimpleEditorContext,group:Bd,title:S(`actions.clipboard.copyLabel`,`Copy`),order:2}]})):void 0;qr.appendMenuItem(R.MenubarEditMenu,{submenu:R.MenubarCopy,title:x(`copy as`,`Copy As`),group:`2_ccp`,order:3}),qr.appendMenuItem(R.EditorContext,{submenu:R.EditorContextCopy,title:x(`copy as`,`Copy As`),group:Bd,order:3}),qr.appendMenuItem(R.EditorContext,{submenu:R.EditorContextShare,title:x(`share`,`Share`),group:`11_share`,order:-1,when:z.and(z.notEquals(`resourceScheme`,`output`),q.editorTextFocus)}),qr.appendMenuItem(R.ExplorerContext,{submenu:R.ExplorerContextShare,title:x(`share`,`Share`),group:`11_share`,order:-1});const qd=Ud?Wd(new Nl({id:`editor.action.clipboardPasteAction`,precondition:void 0,kbOpts:Ee?{primary:2100,win:{primary:2100,secondary:[1043]},linux:{primary:2100,secondary:[1043]},weight:100}:void 0,menuOpts:[{menuId:R.MenubarEditMenu,group:`2_ccp`,title:S({key:`miPaste`,comment:[`&& denotes a mnemonic`]},`&&Paste`),order:4},{menuId:R.EditorContext,group:Bd,title:S(`actions.clipboard.pasteLabel`,`Paste`),when:q.writable,order:4},{menuId:R.CommandPalette,group:``,title:S(`actions.clipboard.pasteLabel`,`Paste`),order:1},{menuId:R.SimpleEditorContext,group:Bd,title:S(`actions.clipboard.pasteLabel`,`Paste`),when:q.writable,order:4}]})):void 0;var Jd=class extends N{constructor(){super({id:`editor.action.clipboardCopyWithSyntaxHighlightingAction`,label:S(`actions.clipboard.copyWithSyntaxHighlightingLabel`,`Copy With Syntax Highlighting`),alias:`Copy With Syntax Highlighting`,precondition:void 0,kbOpts:{kbExpr:q.textInputFocus,primary:0,weight:100}})}run(e,t){t.hasModel()&&(!t.getOption(37)&&t.getSelection().isEmpty()||(dl.forceCopyWithSyntaxHighlighting=!0,t.focus(),t.getContainerDomNode().ownerDocument.execCommand(`copy`),dl.forceCopyWithSyntaxHighlighting=!1))}};function Yd(e,t){e&&(e.addImplementation(1e4,`code-editor`,(e,n)=>{let r=e.get(Ko).getFocusedCodeEditor();if(r&&r.hasTextFocus()){let e=r.getOption(37),n=r.getSelection();return n&&n.isEmpty()&&!e||r.getContainerDomNode().ownerDocument.execCommand(t),!0}return!1}),e.addImplementation(0,`generic-dom`,(e,n)=>(Qn().execCommand(t),!0)))}Yd(Gd,`cut`),Yd(Kd,`copy`),qd&&(qd.addImplementation(1e4,`code-editor`,(e,t)=>{let n=e.get(Ko),r=e.get(_l),i=n.getFocusedCodeEditor();return i&&i.hasTextFocus()?i.getContainerDomNode().ownerDocument.execCommand(`paste`)?zd.get(i)?.finishedPaste()??Promise.resolve():he?(async()=>{let e=await r.readText();if(e!==``){let t=jl.INSTANCE.get(e),n=!1,r=null,a=null;t&&(n=i.getOption(37)&&!!t.isFromEmptySelection,r=t.multicursorText===void 0?null:t.multicursorText,a=t.mode),i.trigger(`keyboard`,`paste`,{text:e,pasteOnNewLine:n,multicursorText:r,mode:a})}})():!0:!1}),qd.addImplementation(0,`generic-dom`,(e,t)=>(Qn().execCommand(`paste`),!0))),Hd&&L(Jd);const Z=new class{constructor(){this.QuickFix=new X(`quickfix`),this.Refactor=new X(`refactor`),this.RefactorExtract=this.Refactor.append(`extract`),this.RefactorInline=this.Refactor.append(`inline`),this.RefactorMove=this.Refactor.append(`move`),this.RefactorRewrite=this.Refactor.append(`rewrite`),this.Notebook=new X(`notebook`),this.Source=new X(`source`),this.SourceOrganizeImports=this.Source.append(`organizeImports`),this.SourceFixAll=this.Source.append(`fixAll`),this.SurroundWith=this.Refactor.append(`surround`)}};var Xd;(function(e){e.Refactor=`refactor`,e.RefactorPreview=`refactor preview`,e.Lightbulb=`lightbulb`,e.Default=`other (default)`,e.SourceAction=`source action`,e.QuickFix=`quick fix action`,e.FixAll=`fix all`,e.OrganizeImports=`organize imports`,e.AutoFix=`auto fix`,e.QuickFixHover=`quick fix hover window`,e.OnSave=`save participants`,e.ProblemsView=`problems view`})(Xd||={});function Zd(e,t){return!(e.include&&!e.include.intersects(t)||e.excludes&&e.excludes.some(n=>$d(t,n,e.include))||!e.includeSourceActions&&Z.Source.contains(t))}function Qd(e,t){let n=t.kind?new X(t.kind):void 0;return!(e.include&&(!n||!e.include.contains(n))||e.excludes&&n&&e.excludes.some(t=>$d(n,t,e.include))||!e.includeSourceActions&&n&&Z.Source.contains(n)||e.onlyIncludePreferredActions&&!t.isPreferred)}function $d(e,t,n){return!(!t.contains(e)||n&&t.contains(n))}var ef=class e{static fromUser(t,n){return!t||typeof t!=`object`?new e(n.kind,n.apply,!1):new e(e.getKindFromUser(t,n.kind),e.getApplyFromUser(t,n.apply),e.getPreferredUser(t))}static getApplyFromUser(e,t){switch(typeof e.apply==`string`?e.apply.toLowerCase():``){case`first`:return`first`;case`never`:return`never`;case`ifsingle`:return`ifSingle`;default:return t}}static getKindFromUser(e,t){return typeof e.kind==`string`?new X(e.kind):t}static getPreferredUser(e){return typeof e.preferred==`boolean`?e.preferred:!1}constructor(e,t,n){this.kind=e,this.apply=t,this.preferred=n}},tf=class{constructor(e,t,n){this.action=e,this.provider=t,this.highlightRange=n}async resolve(e){if(this.provider?.resolveCodeAction&&!this.action.edit){let t;try{t=await this.provider.resolveCodeAction(this.action,e)}catch(e){Re(e)}t&&(this.action.edit=t.edit)}return this}};const nf=`editor.action.codeAction`,rf=`editor.action.quickFix`,af=`editor.action.refactor`,of=`editor.action.sourceAction`,sf=`editor.action.organizeImports`,cf=`editor.action.fixAll`;var lf=class e extends _{static codeActionsPreferredComparator(e,t){return e.isPreferred&&!t.isPreferred?-1:!e.isPreferred&&t.isPreferred?1:0}static codeActionsComparator({action:t},{action:n}){return t.isAI&&!n.isAI?1:!t.isAI&&n.isAI?-1:On(t.diagnostics)?On(n.diagnostics)?e.codeActionsPreferredComparator(t,n):-1:On(n.diagnostics)?1:e.codeActionsPreferredComparator(t,n)}constructor(t,n,r){super(),this.documentation=n,this._register(r),this.allActions=[...t].sort(e.codeActionsComparator),this.validActions=this.allActions.filter(({action:e})=>!e.disabled)}get hasAutoFix(){return this.validActions.some(({action:e})=>!!e.kind&&Z.QuickFix.contains(new X(e.kind))&&!!e.isPreferred)}get hasAIFix(){return this.validActions.some(({action:e})=>!!e.isAI)}get allAIFixes(){return this.validActions.every(({action:e})=>!!e.isAI)}},uf={actions:[],documentation:void 0};async function df(e,t,r,i,a,o){let s=i.filter||{},c={...s,excludes:[...s.excludes||[],Z.Notebook]},l={only:s.include?.value,trigger:i.type},u=new no(t,o),d=ff(e,t,i.type===2?c:s),f=new n,p=d.map(async e=>{try{a.report(e);let n=await e.provideCodeActions(t,r,l,u.token);if(n&&f.add(n),u.token.isCancellationRequested)return uf;let i=(n?.actions||[]).filter(e=>e&&Qd(s,e)),o=mf(e,i,s.include);return{actions:i.map(t=>new tf(t,e)),documentation:o}}catch(e){if(pe(e))throw e;return Re(e),uf}}),m=e.onDidChange(()=>{Ut(e.all(t),d)||u.cancel()});try{let n=await Promise.all(p),r=n.map(e=>e.actions).flat();return new lf(r,[...bt(n.map(e=>e.documentation)),...pf(e,t,i,r)],f)}finally{m.dispose(),u.dispose()}}function ff(e,t,n){return e.all(t).filter(e=>e.providedCodeActionKinds?e.providedCodeActionKinds.some(e=>Zd(n,new X(e))):!0)}function*pf(e,t,n,r){if(t&&r.length)for(let i of e.all(t))i._getAdditionalMenuItems&&(yield*i._getAdditionalMenuItems?.({trigger:n.type,only:n.filter?.include?.value},r.map(e=>e.action)))}function mf(e,t,n){if(!e.documentation)return;let r=e.documentation.map(e=>({kind:new X(e.kind),command:e.command}));if(n){let e;for(let t of r)t.kind.contains(n)&&(e?e.kind.contains(t.kind)&&(e=t):e=t);if(e)return e?.command}for(let e of t)if(e.kind){for(let t of r)if(t.kind.contains(new X(e.kind)))return t.command}}var hf;(function(e){e.OnSave=`onSave`,e.FromProblemsView=`fromProblemsView`,e.FromCodeActions=`fromCodeActions`,e.FromAILightbulb=`fromAILightbulb`})(hf||={});async function gf(e,t,n,r,i=w.None){let a=e.get(Ji),o=e.get(lc),s=e.get(Zi),c=e.get(Ro);if(s.publicLog2(`codeAction.applyCodeAction`,{codeActionTitle:t.action.title,codeActionKind:t.action.kind,codeActionIsPreferred:!!t.action.isPreferred,reason:n}),await t.resolve(i),!i.isCancellationRequested&&!(t.action.edit?.edits.length&&!(await a.apply(t.action.edit,{editor:r?.editor,label:t.action.title,quotableLabel:t.action.title,code:`undoredo.codeAction`,respectAutoSaveConfig:n!==hf.OnSave,showPreview:r?.preview})).isApplied)&&t.action.command)try{await o.executeCommand(t.action.command.id,...t.action.command.arguments||[])}catch(e){let t=_f(e);c.error(typeof t==`string`?t:S(`applyCodeActionFailed`,`An unknown error occurred while applying the code action`))}}function _f(e){if(typeof e==`string`)return e;if(e instanceof Error&&typeof e.message==`string`)return e.message}B.registerCommand(`_executeCodeActionProvider`,async function(e,t,n,r,i){if(!(t instanceof y))throw Fe();let{codeActionProvider:a}=e.get(V),o=e.get(Ps).getModel(t);if(!o)throw Fe();let s=v.isISelection(n)?v.liftSelection(n):T.isIRange(n)?o.validateRange(n):void 0;if(!s)throw Fe();let c=typeof r==`string`?new X(r):void 0,l=await df(a,o,s,{type:1,triggerAction:Xd.Default,filter:{includeSourceActions:!0,include:c}},_a.None,w.None),u=[],d=Math.min(l.validActions.length,typeof i==`number`?i:0);for(let e=0;e<d;e++)u.push(l.validActions[e].resolve(w.None));try{return await Promise.all(u),l.validActions.map(e=>e.action)}finally{setTimeout(()=>l.dispose(),100)}});var vf=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},yf=function(e,t){return function(n,r){t(n,r,e)}},bf,xf=class{static#e=bf=this;static#t=this.codeActionCommands=[af,nf,of,sf,cf];constructor(e){this.keybindingService=e}getResolver(){let e=new Qt(()=>this.keybindingService.getKeybindings().filter(e=>bf.codeActionCommands.indexOf(e.command)>=0).filter(e=>e.resolvedKeybinding).map(e=>{let t=e.commandArgs;return e.command===`editor.action.organizeImports`?t={kind:Z.SourceOrganizeImports.value}:e.command===`editor.action.fixAll`&&(t={kind:Z.SourceFixAll.value}),{resolvedKeybinding:e.resolvedKeybinding,...ef.fromUser(t,{kind:X.None,apply:`never`})}}));return t=>{if(t.kind)return this.bestKeybindingForCodeAction(t,e.value)?.resolvedKeybinding}}bestKeybindingForCodeAction(e,t){if(!e.kind)return;let n=new X(e.kind);return t.filter(e=>e.kind.contains(n)).filter(t=>t.preferred?e.isPreferred:!0).reduceRight((e,t)=>e?e.kind.contains(t.kind)?t:e:t,void 0)}};xf=bf=vf([yf(0,ua)],xf),k(`symbolIcon.arrayForeground`,Wr,S(`symbolIcon.arrayForeground`,`The foreground color for array symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),k(`symbolIcon.booleanForeground`,Wr,S(`symbolIcon.booleanForeground`,`The foreground color for boolean symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),k(`symbolIcon.classForeground`,{dark:`#EE9D28`,light:`#D67E00`,hcDark:`#EE9D28`,hcLight:`#D67E00`},S(`symbolIcon.classForeground`,`The foreground color for class symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),k(`symbolIcon.colorForeground`,Wr,S(`symbolIcon.colorForeground`,`The foreground color for color symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),k(`symbolIcon.constantForeground`,Wr,S(`symbolIcon.constantForeground`,`The foreground color for constant symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),k(`symbolIcon.constructorForeground`,{dark:`#B180D7`,light:`#652D90`,hcDark:`#B180D7`,hcLight:`#652D90`},S(`symbolIcon.constructorForeground`,`The foreground color for constructor symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),k(`symbolIcon.enumeratorForeground`,{dark:`#EE9D28`,light:`#D67E00`,hcDark:`#EE9D28`,hcLight:`#D67E00`},S(`symbolIcon.enumeratorForeground`,`The foreground color for enumerator symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),k(`symbolIcon.enumeratorMemberForeground`,{dark:`#75BEFF`,light:`#007ACC`,hcDark:`#75BEFF`,hcLight:`#007ACC`},S(`symbolIcon.enumeratorMemberForeground`,`The foreground color for enumerator member symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),k(`symbolIcon.eventForeground`,{dark:`#EE9D28`,light:`#D67E00`,hcDark:`#EE9D28`,hcLight:`#D67E00`},S(`symbolIcon.eventForeground`,`The foreground color for event symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),k(`symbolIcon.fieldForeground`,{dark:`#75BEFF`,light:`#007ACC`,hcDark:`#75BEFF`,hcLight:`#007ACC`},S(`symbolIcon.fieldForeground`,`The foreground color for field symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),k(`symbolIcon.fileForeground`,Wr,S(`symbolIcon.fileForeground`,`The foreground color for file symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),k(`symbolIcon.folderForeground`,Wr,S(`symbolIcon.folderForeground`,`The foreground color for folder symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),k(`symbolIcon.functionForeground`,{dark:`#B180D7`,light:`#652D90`,hcDark:`#B180D7`,hcLight:`#652D90`},S(`symbolIcon.functionForeground`,`The foreground color for function symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),k(`symbolIcon.interfaceForeground`,{dark:`#75BEFF`,light:`#007ACC`,hcDark:`#75BEFF`,hcLight:`#007ACC`},S(`symbolIcon.interfaceForeground`,`The foreground color for interface symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),k(`symbolIcon.keyForeground`,Wr,S(`symbolIcon.keyForeground`,`The foreground color for key symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),k(`symbolIcon.keywordForeground`,Wr,S(`symbolIcon.keywordForeground`,`The foreground color for keyword symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),k(`symbolIcon.methodForeground`,{dark:`#B180D7`,light:`#652D90`,hcDark:`#B180D7`,hcLight:`#652D90`},S(`symbolIcon.methodForeground`,`The foreground color for method symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),k(`symbolIcon.moduleForeground`,Wr,S(`symbolIcon.moduleForeground`,`The foreground color for module symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),k(`symbolIcon.namespaceForeground`,Wr,S(`symbolIcon.namespaceForeground`,`The foreground color for namespace symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),k(`symbolIcon.nullForeground`,Wr,S(`symbolIcon.nullForeground`,`The foreground color for null symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),k(`symbolIcon.numberForeground`,Wr,S(`symbolIcon.numberForeground`,`The foreground color for number symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),k(`symbolIcon.objectForeground`,Wr,S(`symbolIcon.objectForeground`,`The foreground color for object symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),k(`symbolIcon.operatorForeground`,Wr,S(`symbolIcon.operatorForeground`,`The foreground color for operator symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),k(`symbolIcon.packageForeground`,Wr,S(`symbolIcon.packageForeground`,`The foreground color for package symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),k(`symbolIcon.propertyForeground`,Wr,S(`symbolIcon.propertyForeground`,`The foreground color for property symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),k(`symbolIcon.referenceForeground`,Wr,S(`symbolIcon.referenceForeground`,`The foreground color for reference symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),k(`symbolIcon.snippetForeground`,Wr,S(`symbolIcon.snippetForeground`,`The foreground color for snippet symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),k(`symbolIcon.stringForeground`,Wr,S(`symbolIcon.stringForeground`,`The foreground color for string symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),k(`symbolIcon.structForeground`,Wr,S(`symbolIcon.structForeground`,`The foreground color for struct symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),k(`symbolIcon.textForeground`,Wr,S(`symbolIcon.textForeground`,`The foreground color for text symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),k(`symbolIcon.typeParameterForeground`,Wr,S(`symbolIcon.typeParameterForeground`,`The foreground color for type parameter symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),k(`symbolIcon.unitForeground`,Wr,S(`symbolIcon.unitForeground`,`The foreground color for unit symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`)),k(`symbolIcon.variableForeground`,{dark:`#75BEFF`,light:`#007ACC`,hcDark:`#75BEFF`,hcLight:`#007ACC`},S(`symbolIcon.variableForeground`,`The foreground color for variable symbols. These symbols appear in the outline, breadcrumb, and suggest widget.`));var Sf=Object.freeze({kind:X.Empty,title:S(`codeAction.widget.id.more`,`More Actions...`)}),Cf=Object.freeze([{kind:Z.QuickFix,title:S(`codeAction.widget.id.quickfix`,`Quick Fix`)},{kind:Z.RefactorExtract,title:S(`codeAction.widget.id.extract`,`Extract`),icon:i.wrench},{kind:Z.RefactorInline,title:S(`codeAction.widget.id.inline`,`Inline`),icon:i.wrench},{kind:Z.RefactorRewrite,title:S(`codeAction.widget.id.convert`,`Rewrite`),icon:i.wrench},{kind:Z.RefactorMove,title:S(`codeAction.widget.id.move`,`Move`),icon:i.wrench},{kind:Z.SurroundWith,title:S(`codeAction.widget.id.surround`,`Surround With`),icon:i.surroundWith},{kind:Z.Source,title:S(`codeAction.widget.id.source`,`Source Action`),icon:i.symbolFile},Sf]);function wf(e,t,n){if(!t)return e.map(e=>({kind:`action`,item:e,group:Sf,disabled:!!e.action.disabled,label:e.action.disabled||e.action.title,canPreview:!!e.action.edit?.edits.length}));let r=Cf.map(e=>({group:e,actions:[]}));for(let t of e){let e=t.action.kind?new X(t.action.kind):X.None;for(let n of r)if(n.group.kind.contains(e)){n.actions.push(t);break}}let a=[];for(let e of r)if(e.actions.length){a.push({kind:`header`,group:e.group});for(let t of e.actions){let r=e.group;a.push({kind:`action`,item:t,group:t.action.isAI?{title:r.title,kind:r.kind,icon:i.sparkle}:r,label:t.action.title,disabled:!!t.action.disabled,keybinding:n(t.action)})}}return a}var Tf=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Ef=function(e,t){return function(n,r){t(n,r,e)}},Df,Of=ri(`gutter-lightbulb`,i.lightBulb,S(`gutterLightbulbWidget`,`Icon which spawns code actions menu from the gutter when there is no space in the editor.`)),kf=ri(`gutter-lightbulb-auto-fix`,i.lightbulbAutofix,S(`gutterLightbulbAutoFixWidget`,`Icon which spawns code actions menu from the gutter when there is no space in the editor and a quick fix is available.`)),Af=ri(`gutter-lightbulb-sparkle`,i.lightbulbSparkle,S(`gutterLightbulbAIFixWidget`,`Icon which spawns code actions menu from the gutter when there is no space in the editor and an AI fix is available.`)),jf=ri(`gutter-lightbulb-aifix-auto-fix`,i.lightbulbSparkleAutofix,S(`gutterLightbulbAIFixAutoFixWidget`,`Icon which spawns code actions menu from the gutter when there is no space in the editor and an AI fix and a quick fix is available.`)),Mf=ri(`gutter-lightbulb-sparkle-filled`,i.sparkleFilled,S(`gutterLightbulbSparkleFilledWidget`,`Icon which spawns code actions menu from the gutter when there is no space in the editor and an AI fix and a quick fix is available.`)),Nf;(function(e){e.Hidden={type:0};class t{constructor(e,t,n,r){this.actions=e,this.trigger=t,this.editorPosition=n,this.widgetPosition=r,this.type=1}}e.Showing=t})(Nf||={});var Pf=class extends _{static#e=Df=this;static#t=this.GUTTER_DECORATION=U.register({description:`codicon-gutter-lightbulb-decoration`,glyphMarginClassName:J.asClassName(i.lightBulb),glyphMargin:{position:js.Left},stickiness:1});static#n=this.ID=`editor.contrib.lightbulbWidget`;static#r=this._posPref=[0];constructor(e,t){super(),this._editor=e,this._keybindingService=t,this._onClick=this._register(new g),this.onClick=this._onClick.event,this._state=Nf.Hidden,this._gutterState=Nf.Hidden,this._iconClasses=[],this.lightbulbClasses=[`codicon-`+Of.id,`codicon-`+jf.id,`codicon-`+kf.id,`codicon-`+Af.id,`codicon-`+Mf.id],this.gutterDecoration=Df.GUTTER_DECORATION,this._domNode=O(`div.lightBulbWidget`),this._domNode.role=`listbox`,this._register(Ki.ignoreTarget(this._domNode)),this._editor.addContentWidget(this),this._register(this._editor.onDidChangeModelContent(e=>{let t=this._editor.getModel();(this.state.type!==1||!t||this.state.editorPosition.lineNumber>=t.getLineCount())&&this.hide(),(this.gutterState.type!==1||!t||this.gutterState.editorPosition.lineNumber>=t.getLineCount())&&this.gutterHide()})),this._register(qn(this._domNode,e=>{if(this.state.type!==1)return;this._editor.focus(),e.preventDefault();let{top:t,height:n}=gt(this._domNode),r=this._editor.getOption(67),i=Math.floor(r/3);this.state.widgetPosition.position!==null&&this.state.widgetPosition.position.lineNumber<this.state.editorPosition.lineNumber&&(i+=r),this._onClick.fire({x:e.posx,y:t+n+i,actions:this.state.actions,trigger:this.state.trigger})})),this._register(D(this._domNode,`mouseenter`,e=>{(e.buttons&1)==1&&this.hide()})),this._register(we.runAndSubscribe(this._keybindingService.onDidUpdateKeybindings,()=>{this._preferredKbLabel=this._keybindingService.lookupKeybinding(`editor.action.autoFix`)?.getLabel()??void 0,this._quickFixKbLabel=this._keybindingService.lookupKeybinding(`editor.action.quickFix`)?.getLabel()??void 0,this._updateLightBulbTitleAndIcon()})),this._register(this._editor.onMouseDown(async e=>{if(!e.target.element||!this.lightbulbClasses.some(t=>e.target.element&&e.target.element.classList.contains(t))||this.gutterState.type!==1)return;this._editor.focus();let{top:t,height:n}=gt(e.target.element),r=this._editor.getOption(67),i=Math.floor(r/3);this.gutterState.widgetPosition.position!==null&&this.gutterState.widgetPosition.position.lineNumber<this.gutterState.editorPosition.lineNumber&&(i+=r),this._onClick.fire({x:e.event.posx,y:t+n+i,actions:this.gutterState.actions,trigger:this.gutterState.trigger})}))}dispose(){super.dispose(),this._editor.removeContentWidget(this),this._gutterDecorationID&&this._removeGutterDecoration(this._gutterDecorationID)}getId(){return`LightBulbWidget`}getDomNode(){return this._domNode}getPosition(){return this._state.type===1?this._state.widgetPosition:null}update(e,t,n){if(e.validActions.length<=0||!this._editor.hasTextFocus()||!this._editor.getOptions().get(65).enabled)return this.gutterHide(),this.hide();let r=this._editor.getModel();if(!r)return this.gutterHide(),this.hide();let{lineNumber:i,column:a}=r.validatePosition(n),o=r.getOptions().tabSize,s=this._editor.getOptions().get(50),c=ls(r.getLineContent(i),o),l=s.spaceWidth*c>22,u=e=>e>2&&this._editor.getTopForLineNumber(e)===this._editor.getTopForLineNumber(e-1),d=this._editor.getLineDecorations(i),f=!1;if(d)for(let e of d){let t=e.options.glyphMarginClassName;if(t&&!this.lightbulbClasses.some(e=>t.includes(e))){f=!0;break}}let p=i,m=1;if(!l){let o=e=>{let t=r.getLineContent(e);return/^\s*$|^\s+/.test(t)||t.length<=m};if(i>1&&!u(i-1)){let a=i===r.getLineCount(),s=i>1&&o(i-1),c=!a&&o(i+1),l=o(i),u=!c&&!s;if(!c&&!s&&!f)return this.gutterState=new Nf.Showing(e,t,n,{position:{lineNumber:p,column:m},preference:Df._posPref}),this.renderGutterLightbub(),this.hide();s||a||s&&!l?--p:(c||u&&l)&&(p+=1)}else if(i===1&&(i===r.getLineCount()||!o(i+1)&&!o(i)))if(this.gutterState=new Nf.Showing(e,t,n,{position:{lineNumber:p,column:m},preference:Df._posPref}),f)this.gutterHide();else return this.renderGutterLightbub(),this.hide();else if(i<r.getLineCount()&&!u(i+1))p+=1;else if(a*s.spaceWidth<22)return this.hide();m=/^\S\s*$/.test(r.getLineContent(p))?2:1}this.state=new Nf.Showing(e,t,n,{position:{lineNumber:p,column:m},preference:Df._posPref}),this._gutterDecorationID&&(this._removeGutterDecoration(this._gutterDecorationID),this.gutterHide());let h=e.validActions,g=e.validActions[0].action.kind;if(h.length!==1||!g){this._editor.layoutContentWidget(this);return}this._editor.layoutContentWidget(this)}hide(){this.state!==Nf.Hidden&&(this.state=Nf.Hidden,this._editor.layoutContentWidget(this))}gutterHide(){this.gutterState!==Nf.Hidden&&(this._gutterDecorationID&&this._removeGutterDecoration(this._gutterDecorationID),this.gutterState=Nf.Hidden)}get state(){return this._state}set state(e){this._state=e,this._updateLightBulbTitleAndIcon()}get gutterState(){return this._gutterState}set gutterState(e){this._gutterState=e,this._updateGutterLightBulbTitleAndIcon()}_updateLightBulbTitleAndIcon(){if(this._domNode.classList.remove(...this._iconClasses),this._iconClasses=[],this.state.type!==1)return;let e,t=!1;this.state.actions.allAIFixes?(e=i.sparkleFilled,this.state.actions.validActions.length===1&&(t=!0)):e=this.state.actions.hasAutoFix?this.state.actions.hasAIFix?i.lightbulbSparkleAutofix:i.lightbulbAutofix:this.state.actions.hasAIFix?i.lightbulbSparkle:i.lightBulb,this._updateLightbulbTitle(this.state.actions.hasAutoFix,t),this._iconClasses=J.asClassNameArray(e),this._domNode.classList.add(...this._iconClasses)}_updateGutterLightBulbTitleAndIcon(){if(this.gutterState.type!==1)return;let e,t=!1;this.gutterState.actions.allAIFixes?(e=Mf,this.gutterState.actions.validActions.length===1&&(t=!0)):e=this.gutterState.actions.hasAutoFix?this.gutterState.actions.hasAIFix?jf:kf:this.gutterState.actions.hasAIFix?Af:Of,this._updateLightbulbTitle(this.gutterState.actions.hasAutoFix,t),this.gutterDecoration=U.register({description:`codicon-gutter-lightbulb-decoration`,glyphMarginClassName:J.asClassName(e),glyphMargin:{position:js.Left},stickiness:1})}renderGutterLightbub(){let e=this._editor.getSelection();e&&(this._gutterDecorationID===void 0?this._addGutterDecoration(e.startLineNumber):this._updateGutterDecoration(this._gutterDecorationID,e.startLineNumber))}_addGutterDecoration(e){this._editor.changeDecorations(t=>{this._gutterDecorationID=t.addDecoration(new T(e,0,e,0),this.gutterDecoration)})}_removeGutterDecoration(e){this._editor.changeDecorations(t=>{t.removeDecoration(e),this._gutterDecorationID=void 0})}_updateGutterDecoration(e,t){this._editor.changeDecorations(n=>{n.changeDecoration(e,new T(t,0,t,0)),n.changeDecorationOptions(e,this.gutterDecoration)})}_updateLightbulbTitle(e,t){this.state.type===1&&(t?this.title=S(`codeActionAutoRun`,`Run: {0}`,this.state.actions.validActions[0].action.title):e&&this._preferredKbLabel?this.title=S(`preferredcodeActionWithKb`,`Show Code Actions. Preferred Quick Fix Available ({0})`,this._preferredKbLabel):!e&&this._quickFixKbLabel?this.title=S(`codeActionWithKb`,`Show Code Actions ({0})`,this._quickFixKbLabel):e||(this.title=S(`codeAction`,`Show Code Actions`)))}set title(e){this._domNode.title=e}};Pf=Df=Tf([Ef(1,ua)],Pf);var Ff=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},If=function(e,t){return function(n,r){t(n,r,e)}};const Lf=`acceptSelectedCodeAction`,Rf=`previewSelectedCodeAction`;var zf=class{get templateId(){return`header`}renderTemplate(e){e.classList.add(`group-header`);let t=document.createElement(`span`);return e.append(t),{container:e,text:t}}renderElement(e,t,n){n.text.textContent=e.group?.title??``}disposeTemplate(e){}},Bf=class{get templateId(){return`action`}constructor(e,t){this._supportsPreview=e,this._keybindingService=t}renderTemplate(e){e.classList.add(this.templateId);let n=document.createElement(`div`);n.className=`icon`,e.append(n);let r=document.createElement(`span`);return r.className=`title`,e.append(r),{container:e,icon:n,text:r,keybinding:new va(e,t)}}renderElement(e,t,n){if(e.group?.icon?(n.icon.className=J.asClassName(e.group.icon),e.group.icon.color&&(n.icon.style.color=tn(e.group.icon.color.id))):(n.icon.className=J.asClassName(i.lightBulb),n.icon.style.color=`var(--vscode-editorLightBulb-foreground)`),!e.item||!e.label)return;n.text.textContent=Gf(e.label),n.keybinding.set(e.keybinding),Kn(!!e.keybinding,n.keybinding.element);let r=this._keybindingService.lookupKeybinding(Lf)?.getLabel(),a=this._keybindingService.lookupKeybinding(Rf)?.getLabel();n.container.classList.toggle(`option-disabled`,e.disabled),e.disabled?n.container.title=e.label:r&&a?this._supportsPreview&&e.canPreview?n.container.title=S({key:`label-preview`,comment:[`placeholders are keybindings, e.g "F2 to Apply, Shift+F2 to Preview"`]},`{0} to Apply, {1} to Preview`,r,a):n.container.title=S({key:`label`,comment:[`placeholder is a keybinding, e.g "F2 to Apply"`]},`{0} to Apply`,r):n.container.title=``}disposeTemplate(e){e.keybinding.dispose()}};Bf=Ff([If(1,ua)],Bf);var Vf=class extends UIEvent{constructor(){super(`acceptSelectedAction`)}},Hf=class extends UIEvent{constructor(){super(`previewSelectedAction`)}};function Uf(e){if(e.kind===`action`)return e.label}var Wf=class extends _{constructor(e,t,n,r,i,a){super(),this._delegate=r,this._contextViewService=i,this._keybindingService=a,this._actionLineHeight=24,this._headerLineHeight=26,this.cts=this._register(new ie),this.domNode=document.createElement(`div`),this.domNode.classList.add(`actionList`),this._list=this._register(new Ka(e,this.domNode,{getHeight:e=>e.kind===`header`?this._headerLineHeight:this._actionLineHeight,getTemplateId:e=>e.kind},[new Bf(t,this._keybindingService),new zf],{keyboardSupport:!1,typeNavigationEnabled:!0,keyboardNavigationLabelProvider:{getKeyboardNavigationLabel:Uf},accessibilityProvider:{getAriaLabel:e=>{if(e.kind===`action`){let t=e.label?Gf(e?.label):``;return e.disabled&&(t=S({key:`customQuickFixWidget.labels`,comment:[`Action widget labels for accessibility.`]},`{0}, Disabled Reason: {1}`,t,e.disabled)),t}return null},getWidgetAriaLabel:()=>S({key:`customQuickFixWidget`,comment:[`An action widget option`]},`Action Widget`),getRole:e=>e.kind===`action`?`option`:`separator`,getWidgetRole:()=>`listbox`}})),this._list.style(Zs),this._register(this._list.onMouseClick(e=>this.onListClick(e))),this._register(this._list.onMouseOver(e=>this.onListHover(e))),this._register(this._list.onDidChangeFocus(()=>this.onFocus())),this._register(this._list.onDidChangeSelection(e=>this.onListSelection(e))),this._allMenuItems=n,this._list.splice(0,this._list.length,this._allMenuItems),this._list.length&&this.focusNext()}focusCondition(e){return!e.disabled&&e.kind===`action`}hide(e){this._delegate.onHide(e),this.cts.cancel(),this._contextViewService.hideContextView()}layout(e){let t=this._allMenuItems.filter(e=>e.kind===`header`).length,n=this._allMenuItems.length*this._actionLineHeight+t*this._headerLineHeight-t*this._actionLineHeight;this._list.layout(n);let r=e;if(this._allMenuItems.length>=50)r=380;else{let t=this._allMenuItems.map((e,t)=>{let n=this.domNode.ownerDocument.getElementById(this._list.getElementID(t));if(n){n.style.width=`auto`;let e=n.getBoundingClientRect().width;return n.style.width=``,e}return 0});r=Math.max(...t,e)}let i=Math.min(n,this.domNode.ownerDocument.body.clientHeight*.7);return this._list.layout(i,r),this.domNode.style.height=`${i}px`,this._list.domFocus(),r}focusPrevious(){this._list.focusPrevious(1,!0,void 0,this.focusCondition)}focusNext(){this._list.focusNext(1,!0,void 0,this.focusCondition)}acceptSelected(e){let t=this._list.getFocus();if(t.length===0)return;let n=t[0],r=this._list.element(n);if(!this.focusCondition(r))return;let i=e?new Hf:new Vf;this._list.setSelection([n],i)}onListSelection(e){if(!e.elements.length)return;let t=e.elements[0];t.item&&this.focusCondition(t)?this._delegate.onSelect(t.item,e.browserEvent instanceof Hf):this._list.setSelection([])}onFocus(){let e=this._list.getFocus();if(e.length===0)return;let t=e[0],n=this._list.element(t);this._delegate.onFocus?.(n.item)}async onListHover(e){let t=e.element;if(t&&t.item&&this.focusCondition(t)){if(this._delegate.onHover&&!t.disabled&&t.kind===`action`){let e=await this._delegate.onHover(t.item,this.cts.token);t.canPreview=e?e.canPreview:void 0}e.index&&this._list.splice(e.index,1,[t])}this._list.setFocus(typeof e.index==`number`?[e.index]:[])}onListClick(e){e.element&&this.focusCondition(e.element)&&this._list.setFocus([])}};Wf=Ff([If(4,Pl),If(5,ua)],Wf);function Gf(e){return e.replace(/\r\n|\r|\n/g,` `)}var Kf=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},qf=function(e,t){return function(n,r){t(n,r,e)}};k(`actionBar.toggledBackground`,vn,S(`actionBar.toggledBackground`,`Background color for toggled action items in action bar.`));var Jf={Visible:new G(`codeActionMenuVisible`,!1,S(`codeActionMenuVisible`,`Whether the action widget list is visible`))};const Yf=kl(`actionWidgetService`);var Xf=class extends _{get isVisible(){return Jf.Visible.getValue(this._contextKeyService)||!1}constructor(e,t,n){super(),this._contextViewService=e,this._contextKeyService=t,this._instantiationService=n,this._list=this._register(new l)}show(e,t,n,r,i,a,o){let s=Jf.Visible.bindTo(this._contextKeyService),c=this._instantiationService.createInstance(Wf,e,t,n,r);this._contextViewService.showContextView({getAnchor:()=>i,render:e=>(s.set(!0),this._renderWidget(e,c,o??[])),onHide:e=>{s.reset(),this._onWidgetClosed(e)}},a,!1)}acceptSelected(e){this._list.value?.acceptSelected(e)}focusPrevious(){this._list?.value?.focusPrevious()}focusNext(){this._list?.value?.focusNext()}hide(e){this._list.value?.hide(e),this._list.clear()}_renderWidget(e,t,r){let i=document.createElement(`div`);if(i.classList.add(`action-widget`),e.appendChild(i),this._list.value=t,this._list.value)i.appendChild(this._list.value.domNode);else throw Error(`List has no value`);let a=new n,o=document.createElement(`div`),s=e.appendChild(o);s.classList.add(`context-view-block`),a.add(D(s,j.MOUSE_DOWN,e=>e.stopPropagation()));let c=document.createElement(`div`),l=e.appendChild(c);l.classList.add(`context-view-pointerBlock`),a.add(D(l,j.POINTER_MOVE,()=>l.remove())),a.add(D(l,j.MOUSE_DOWN,()=>l.remove()));let u=0;if(r.length){let e=this._createActionBar(`.action-widget-action-bar`,r);e&&(i.appendChild(e.getContainer().parentElement),a.add(e),u=e.getContainer().offsetWidth)}let d=this._list.value?.layout(u);i.style.width=`${d}px`;let f=a.add(An(e));return a.add(f.onDidBlur(()=>this.hide(!0))),a}_createActionBar(e,t){if(!t.length)return;let n=new hl(O(e));return n.push(t,{icon:!1,label:!0}),n}_onWidgetClosed(e){this._list.value?.hide(e)}};Xf=Kf([qf(0,Pl),qf(1,W),qf(2,Y)],Xf),$r(Yf,Xf,1);var Zf=1100;H(class extends Mo{constructor(){super({id:`hideCodeActionWidget`,title:x(`hideCodeActionWidget.title`,`Hide action widget`),precondition:Jf.Visible,keybinding:{weight:Zf,primary:9,secondary:[1033]}})}run(e){e.get(Yf).hide(!0)}}),H(class extends Mo{constructor(){super({id:`selectPrevCodeAction`,title:x(`selectPrevCodeAction.title`,`Select previous action`),precondition:Jf.Visible,keybinding:{weight:Zf,primary:16,secondary:[2064],mac:{primary:16,secondary:[2064,302]}}})}run(e){let t=e.get(Yf);t instanceof Xf&&t.focusPrevious()}}),H(class extends Mo{constructor(){super({id:`selectNextCodeAction`,title:x(`selectNextCodeAction.title`,`Select next action`),precondition:Jf.Visible,keybinding:{weight:Zf,primary:18,secondary:[2066],mac:{primary:18,secondary:[2066,300]}}})}run(e){let t=e.get(Yf);t instanceof Xf&&t.focusNext()}}),H(class extends Mo{constructor(){super({id:Lf,title:x(`acceptSelected.title`,`Accept selected action`),precondition:Jf.Visible,keybinding:{weight:Zf,primary:3,secondary:[2137]}})}run(e){let t=e.get(Yf);t instanceof Xf&&t.acceptSelected()}}),H(class extends Mo{constructor(){super({id:Rf,title:x(`previewSelected.title`,`Preview selected action`),precondition:Jf.Visible,keybinding:{weight:Zf,primary:2051}})}run(e){let t=e.get(Yf);t instanceof Xf&&t.acceptSelected(!0)}});const Qf=new G(`supportedCodeAction`,``);var $f=class extends _{constructor(e,t,n,r=250){super(),this._editor=e,this._markerService=t,this._signalChange=n,this._delay=r,this._autoTriggerTimer=this._register(new Yt),this._register(this._markerService.onMarkerChanged(e=>this._onMarkerChanges(e))),this._register(this._editor.onDidChangeCursorPosition(()=>this._tryAutoTrigger()))}trigger(e){let t=this._getRangeOfSelectionUnlessWhitespaceEnclosed(e);this._signalChange(t?{trigger:e,selection:t}:void 0)}_onMarkerChanges(e){let t=this._editor.getModel();t&&e.some(e=>qc(e,t.uri))&&this._tryAutoTrigger()}_tryAutoTrigger(){this._autoTriggerTimer.cancelAndSet(()=>{this.trigger({type:2,triggerAction:Xd.Default})},this._delay)}_getRangeOfSelectionUnlessWhitespaceEnclosed(e){if(!this._editor.hasModel())return;let t=this._editor.getSelection();if(e.type===1)return t;let n=this._editor.getOption(65).enabled;if(n!==Rr.Off){if(n===Rr.On)return t;if(n===Rr.OnCode){if(!t.isEmpty())return t;let e=this._editor.getModel(),{lineNumber:n,column:r}=t.getPosition(),i=e.getLineContent(n);if(i.length===0)return;if(r===1){if(/\s/.test(i[0]))return}else if(r===e.getLineMaxColumn(n)){if(/\s/.test(i[i.length-1]))return}else if(/\s/.test(i[r-2])&&/\s/.test(i[r-1]))return}return t}}},ep;(function(e){e.Empty={type:0};class t{constructor(e,t,n){this.trigger=e,this.position=t,this._cancellablePromise=n,this.type=1,this.actions=n.catch(e=>{if(pe(e))return tp;throw e})}cancel(){this._cancellablePromise.cancel()}}e.Triggered=t})(ep||={});var tp=Object.freeze({allActions:[],validActions:[],dispose:()=>{},documentation:[],hasAutoFix:!1,hasAIFix:!1,allAIFixes:!1}),np=class extends _{constructor(e,t,n,r,i,a,o){super(),this._editor=e,this._registry=t,this._markerService=n,this._progressService=i,this._configurationService=a,this._telemetryService=o,this._codeActionOracle=this._register(new l),this._state=ep.Empty,this._onDidChangeState=this._register(new g),this.onDidChangeState=this._onDidChangeState.event,this._disposed=!1,this._supportedCodeActions=Qf.bindTo(r),this._register(this._editor.onDidChangeModel(()=>this._update())),this._register(this._editor.onDidChangeModelLanguage(()=>this._update())),this._register(this._registry.onDidChange(()=>this._update())),this._register(this._editor.onDidChangeConfiguration(e=>{e.hasChanged(65)&&this._update()})),this._update()}dispose(){this._disposed||(this._disposed=!0,super.dispose(),this.setState(ep.Empty,!0))}_settingEnabledNearbyQuickfixes(){let e=this._editor?.getModel();return this._configurationService?this._configurationService.getValue(`editor.codeActionWidget.includeNearbyQuickFixes`,{resource:e?.uri}):!1}_update(){if(this._disposed)return;this._codeActionOracle.value=void 0,this.setState(ep.Empty);let e=this._editor.getModel();if(e&&this._registry.has(e)&&!this._editor.getOption(92)){let t=this._registry.all(e).flatMap(e=>e.providedCodeActionKinds??[]);this._supportedCodeActions.set(t.join(` `)),this._codeActionOracle.value=new $f(this._editor,this._markerService,t=>{if(!t){this.setState(ep.Empty);return}let n=t.selection.getStartPosition(),i=et(async n=>{if(this._settingEnabledNearbyQuickfixes()&&t.trigger.type===1&&(t.trigger.triggerAction===Xd.QuickFix||t.trigger.filter?.include?.contains(Z.QuickFix))){let i=await df(this._registry,e,t.selection,t.trigger,_a.None,n),a=[...i.allActions];if(n.isCancellationRequested)return tp;let o=i.validActions?.some(e=>e.action.kind?Z.QuickFix.contains(new X(e.action.kind)):!1),s=this._markerService.read({resource:e.uri});if(o){for(let e of i.validActions)e.action.command?.arguments?.some(e=>typeof e==`string`&&e.includes(`_typescript.applyFixAllCodeAction`))&&(e.action.diagnostics=[...s.filter(e=>e.relatedInformation)]);return{validActions:i.validActions,allActions:a,documentation:i.documentation,hasAutoFix:i.hasAutoFix,hasAIFix:i.hasAIFix,allAIFixes:i.allAIFixes,dispose:()=>{i.dispose()}}}else if(!o&&s.length>0){let o=t.selection.getPosition(),c=o,l=Number.MAX_VALUE,u=[...i.validActions];for(let d of s){let f=d.endColumn,p=d.endLineNumber,m=d.startLineNumber;if(p===o.lineNumber||m===o.lineNumber){c=new r(p,f);let d={type:t.trigger.type,triggerAction:t.trigger.triggerAction,filter:{include:t.trigger.filter?.include?t.trigger.filter?.include:Z.QuickFix},autoApply:t.trigger.autoApply,context:{notAvailableMessage:t.trigger.context?.notAvailableMessage||``,position:c}},m=new v(c.lineNumber,c.column,c.lineNumber,c.column),h=await df(this._registry,e,m,d,_a.None,n);if(h.validActions.length!==0){for(let e of h.validActions)e.action.command?.arguments?.some(e=>typeof e==`string`&&e.includes(`_typescript.applyFixAllCodeAction`))&&(e.action.diagnostics=[...s.filter(e=>e.relatedInformation)]);i.allActions.length===0&&a.push(...h.allActions),Math.abs(o.column-f)<l?u.unshift(...h.validActions):u.push(...h.validActions)}l=Math.abs(o.column-f)}}let d=u.filter((e,t,n)=>n.findIndex(t=>t.action.title===e.action.title)===t);return d.sort((e,t)=>e.action.isPreferred&&!t.action.isPreferred?-1:!e.action.isPreferred&&t.action.isPreferred||e.action.isAI&&!t.action.isAI?1:!e.action.isAI&&t.action.isAI?-1:0),{validActions:d,allActions:a,documentation:i.documentation,hasAutoFix:i.hasAutoFix,hasAIFix:i.hasAIFix,allAIFixes:i.allAIFixes,dispose:()=>{i.dispose()}}}}if(t.trigger.type===1){let r=new u,i=await df(this._registry,e,t.selection,t.trigger,_a.None,n);return this._telemetryService&&this._telemetryService.publicLog2(`codeAction.invokedDurations`,{codeActions:i.validActions.length,duration:r.elapsed()}),i}return df(this._registry,e,t.selection,t.trigger,_a.None,n)});t.trigger.type===1&&this._progressService?.showWhile(i,250);let a=new ep.Triggered(t.trigger,n,i),o=!1;this._state.type===1&&(o=this._state.trigger.type===1&&a.type===1&&a.trigger.type===2&&this._state.position!==a.position),o?setTimeout(()=>{this.setState(a)},500):this.setState(a)},void 0),this._codeActionOracle.value.trigger({type:2,triggerAction:Xd.Default})}else this._supportedCodeActions.reset()}trigger(e){this._codeActionOracle.value?.trigger(e)}setState(e,t){e!==this._state&&(this._state.type===1&&this._state.cancel(),this._state=e,!t&&!this._disposed&&this._onDidChangeState.fire(e))}},rp=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},ip=function(e,t){return function(n,r){t(n,r,e)}},ap,op=`quickfix-edit-highlight`,sp=class extends _{static#e=ap=this;static#t=this.ID=`editor.contrib.codeActionController`;static get(e){return e.getContribution(ap.ID)}constructor(e,t,n,r,i,a,o,s,c,u,d){super(),this._commandService=o,this._configurationService=s,this._actionWidgetService=c,this._instantiationService=u,this._telemetryService=d,this._activeCodeActions=this._register(new l),this._showDisabled=!1,this._disposed=!1,this._editor=e,this._model=this._register(new np(this._editor,i.codeActionProvider,t,n,a,s,this._telemetryService)),this._register(this._model.onDidChangeState(e=>this.update(e))),this._lightBulbWidget=new Qt(()=>{let e=this._editor.getContribution(Pf.ID);return e&&this._register(e.onClick(e=>this.showCodeActionsFromLightbulb(e.actions,e))),e}),this._resolver=r.createInstance(xf),this._register(this._editor.onDidLayoutChange(()=>this._actionWidgetService.hide()))}dispose(){this._disposed=!0,super.dispose()}async showCodeActionsFromLightbulb(e,t){if(e.allAIFixes&&e.validActions.length===1){let t=e.validActions[0],n=t.action.command;n&&n.id===`inlineChat.start`&&n.arguments&&n.arguments.length>=1&&(n.arguments[0]={...n.arguments[0],autoSend:!1}),await this._applyCodeAction(t,!1,!1,hf.FromAILightbulb);return}await this.showCodeActionList(e,t,{includeDisabledActions:!1,fromLightbulb:!0})}showCodeActions(e,t,n){return this.showCodeActionList(t,n,{includeDisabledActions:!1,fromLightbulb:!1})}manualTriggerAtCurrentPosition(e,t,n,r){if(!this._editor.hasModel())return;Sd.get(this._editor)?.closeMessage();let i=this._editor.getPosition();this._trigger({type:1,triggerAction:t,filter:n,autoApply:r,context:{notAvailableMessage:e,position:i}})}_trigger(e){return this._model.trigger(e)}async _applyCodeAction(e,t,n,r){try{await this._instantiationService.invokeFunction(gf,e,r,{preview:n,editor:this._editor})}finally{t&&this._trigger({type:2,triggerAction:Xd.QuickFix,filter:{}})}}hideLightBulbWidget(){this._lightBulbWidget.rawValue?.hide(),this._lightBulbWidget.rawValue?.gutterHide()}async update(e){if(e.type!==1){this.hideLightBulbWidget();return}let t;try{t=await e.actions}catch(e){C(e);return}if(!this._disposed&&this._editor.getSelection()?.startLineNumber===e.position.lineNumber)if(this._lightBulbWidget.value?.update(t,e.trigger,e.position),e.trigger.type===1){if(e.trigger.filter?.include){let n=this.tryGetValidActionToApply(e.trigger,t);if(n){try{this.hideLightBulbWidget(),await this._applyCodeAction(n,!1,!1,hf.FromCodeActions)}finally{t.dispose()}return}if(e.trigger.context){let n=this.getInvalidActionThatWouldHaveBeenApplied(e.trigger,t);if(n&&n.action.disabled){Sd.get(this._editor)?.showMessage(n.action.disabled,e.trigger.context.position),t.dispose();return}}}let n=!!e.trigger.filter?.include;if(e.trigger.context&&(!t.allActions.length||!n&&!t.validActions.length)){Sd.get(this._editor)?.showMessage(e.trigger.context.notAvailableMessage,e.trigger.context.position),this._activeCodeActions.value=t,t.dispose();return}this._activeCodeActions.value=t,this.showCodeActionList(t,this.toCoords(e.position),{includeDisabledActions:n,fromLightbulb:!1})}else this._actionWidgetService.isVisible?t.dispose():this._activeCodeActions.value=t}getInvalidActionThatWouldHaveBeenApplied(e,t){if(t.allActions.length&&(e.autoApply===`first`&&t.validActions.length===0||e.autoApply===`ifSingle`&&t.allActions.length===1))return t.allActions.find(({action:e})=>e.disabled)}tryGetValidActionToApply(e,t){if(t.validActions.length&&(e.autoApply===`first`&&t.validActions.length>0||e.autoApply===`ifSingle`&&t.validActions.length===1))return t.validActions[0]}static#n=this.DECORATION=U.register({description:`quickfix-highlight`,className:op});async showCodeActionList(e,t,n){let i=this._editor.createDecorationsCollection(),a=this._editor.getDomNode();if(!a)return;let o=n.includeDisabledActions&&(this._showDisabled||e.validActions.length===0)?e.allActions:e.validActions;if(!o.length)return;let s=r.isIPosition(t)?this.toCoords(t):t;this._actionWidgetService.show(`codeActionWidget`,!0,wf(o,this._shouldShowHeaders(),this._resolver.getResolver()),{onSelect:async(e,t)=>{this._applyCodeAction(e,!0,!!t,n.fromLightbulb?hf.FromAILightbulb:hf.FromCodeActions),this._actionWidgetService.hide(!1),i.clear()},onHide:e=>{this._editor?.focus(),i.clear()},onHover:async(e,t)=>{if(t.isCancellationRequested)return;let n=!1,r=e.action.kind;if(r){let e=new X(r);n=[Z.RefactorExtract,Z.RefactorInline,Z.RefactorRewrite,Z.RefactorMove,Z.Source].some(t=>t.contains(e))}return{canPreview:n||!!e.action.edit?.edits.length}},onFocus:e=>{if(e&&e.action){let t=e.action.ranges,n=e.action.diagnostics;if(i.clear(),t&&t.length>0){let e=n&&n?.length>1?n.map(e=>({range:e,options:ap.DECORATION})):t.map(e=>({range:e,options:ap.DECORATION}));i.set(e)}else if(n&&n.length>0){let e=n.map(e=>({range:e,options:ap.DECORATION}));i.set(e);let t=n[0];if(t.startLineNumber&&t.startColumn){let e=this._editor.getModel()?.getWordAtPosition({lineNumber:t.startLineNumber,column:t.startColumn})?.word;Il(S(`editingNewSelection`,`Context: {0} at line {1} and column {2}.`,e,t.startLineNumber,t.startColumn))}}}else i.clear()}},s,a,this._getActionBarActions(e,t,n))}toCoords(e){if(!this._editor.hasModel())return{x:0,y:0};this._editor.revealPosition(e,1),this._editor.render();let t=this._editor.getScrolledVisiblePosition(e),n=gt(this._editor.getDomNode());return{x:n.left+t.left,y:n.top+t.top+t.height}}_shouldShowHeaders(){let e=this._editor?.getModel();return this._configurationService.getValue(`editor.codeActionWidget.showHeaders`,{resource:e?.uri})}_getActionBarActions(e,t,n){if(n.fromLightbulb)return[];let r=e.documentation.map(e=>({id:e.id,label:e.title,tooltip:e.tooltip??``,class:void 0,enabled:!0,run:()=>this._commandService.executeCommand(e.id,...e.arguments??[])}));return n.includeDisabledActions&&e.validActions.length>0&&e.allActions.length!==e.validActions.length&&r.push(this._showDisabled?{id:`hideMoreActions`,label:S(`hideMoreActions`,`Hide Disabled`),enabled:!0,tooltip:``,class:void 0,run:()=>(this._showDisabled=!1,this.showCodeActionList(e,t,n))}:{id:`showMoreActions`,label:S(`showMoreActions`,`Show Disabled`),enabled:!0,tooltip:``,class:void 0,run:()=>(this._showDisabled=!0,this.showCodeActionList(e,t,n))}),r}};sp=ap=rp([ip(1,xl),ip(2,W),ip(3,Y),ip(4,V),ip(5,ni),ip(6,lc),ip(7,F),ip(8,Yf),ip(9,Y),ip(10,Zi)],sp),yc((e,t)=>{((e,n)=>{n&&t.addRule(`.monaco-editor ${e} { background-color: ${n}; }`)})(`.quickfix-edit-highlight`,e.getColor(fn));let n=e.getColor(yn);n&&t.addRule(`.monaco-editor .quickfix-edit-highlight { border: 1px ${Mn(e.type)?`dotted`:`solid`} ${n}; box-sizing: border-box; }`)});function cp(e){return z.regex(Qf.keys()[0],RegExp(`(\\s|^)`+St(e.value)+`\\b`))}var lp={type:`object`,defaultSnippets:[{body:{kind:``}}],properties:{kind:{type:`string`,description:S(`args.schema.kind`,`Kind of the code action to run.`)},apply:{type:`string`,description:S(`args.schema.apply`,`Controls when the returned actions are applied.`),default:`ifSingle`,enum:[`first`,`ifSingle`,`never`],enumDescriptions:[S(`args.schema.apply.first`,`Always apply the first returned code action.`),S(`args.schema.apply.ifSingle`,`Apply the first returned code action if it is the only one.`),S(`args.schema.apply.never`,`Do not apply the returned code actions.`)]},preferred:{type:`boolean`,default:!1,description:S(`args.schema.preferred`,`Controls if only preferred code actions should be returned.`)}}};function up(e,t,n,r,i=Xd.Default){e.hasModel()&&sp.get(e)?.manualTriggerAtCurrentPosition(t,i,n,r)}var dp=class extends N{constructor(){super({id:rf,label:S(`quickfix.trigger.label`,`Quick Fix...`),alias:`Quick Fix...`,precondition:z.and(q.writable,q.hasCodeActionsProvider),kbOpts:{kbExpr:q.textInputFocus,primary:2137,weight:100}})}run(e,t){return up(t,S(`editor.action.quickFix.noneMessage`,`No code actions available`),void 0,void 0,Xd.QuickFix)}},fp=class extends la{constructor(){super({id:nf,precondition:z.and(q.writable,q.hasCodeActionsProvider),metadata:{description:`Trigger a code action`,args:[{name:`args`,schema:lp}]}})}runEditorCommand(e,t,n){let r=ef.fromUser(n,{kind:X.Empty,apply:`ifSingle`});return up(t,typeof n?.kind==`string`?r.preferred?S(`editor.action.codeAction.noneMessage.preferred.kind`,`No preferred code actions for '{0}' available`,n.kind):S(`editor.action.codeAction.noneMessage.kind`,`No code actions for '{0}' available`,n.kind):r.preferred?S(`editor.action.codeAction.noneMessage.preferred`,`No preferred code actions available`):S(`editor.action.codeAction.noneMessage`,`No code actions available`),{include:r.kind,includeSourceActions:!0,onlyIncludePreferredActions:r.preferred},r.apply)}},pp=class extends N{constructor(){super({id:af,label:S(`refactor.label`,`Refactor...`),alias:`Refactor...`,precondition:z.and(q.writable,q.hasCodeActionsProvider),kbOpts:{kbExpr:q.textInputFocus,primary:3120,mac:{primary:1328},weight:100},contextMenuOpts:{group:`1_modification`,order:2,when:z.and(q.writable,cp(Z.Refactor))},metadata:{description:`Refactor...`,args:[{name:`args`,schema:lp}]}})}run(e,t,n){let r=ef.fromUser(n,{kind:Z.Refactor,apply:`never`});return up(t,typeof n?.kind==`string`?r.preferred?S(`editor.action.refactor.noneMessage.preferred.kind`,`No preferred refactorings for '{0}' available`,n.kind):S(`editor.action.refactor.noneMessage.kind`,`No refactorings for '{0}' available`,n.kind):r.preferred?S(`editor.action.refactor.noneMessage.preferred`,`No preferred refactorings available`):S(`editor.action.refactor.noneMessage`,`No refactorings available`),{include:Z.Refactor.contains(r.kind)?r.kind:X.None,onlyIncludePreferredActions:r.preferred},r.apply,Xd.Refactor)}},mp=class extends N{constructor(){super({id:of,label:S(`source.label`,`Source Action...`),alias:`Source Action...`,precondition:z.and(q.writable,q.hasCodeActionsProvider),contextMenuOpts:{group:`1_modification`,order:2.1,when:z.and(q.writable,cp(Z.Source))},metadata:{description:`Source Action...`,args:[{name:`args`,schema:lp}]}})}run(e,t,n){let r=ef.fromUser(n,{kind:Z.Source,apply:`never`});return up(t,typeof n?.kind==`string`?r.preferred?S(`editor.action.source.noneMessage.preferred.kind`,`No preferred source actions for '{0}' available`,n.kind):S(`editor.action.source.noneMessage.kind`,`No source actions for '{0}' available`,n.kind):r.preferred?S(`editor.action.source.noneMessage.preferred`,`No preferred source actions available`):S(`editor.action.source.noneMessage`,`No source actions available`),{include:Z.Source.contains(r.kind)?r.kind:X.None,includeSourceActions:!0,onlyIncludePreferredActions:r.preferred},r.apply,Xd.SourceAction)}},hp=class extends N{constructor(){super({id:sf,label:S(`organizeImports.label`,`Organize Imports`),alias:`Organize Imports`,precondition:z.and(q.writable,cp(Z.SourceOrganizeImports)),kbOpts:{kbExpr:q.textInputFocus,primary:1581,weight:100}})}run(e,t){return up(t,S(`editor.action.organize.noneMessage`,`No organize imports action available`),{include:Z.SourceOrganizeImports,includeSourceActions:!0},`ifSingle`,Xd.OrganizeImports)}},gp=class extends N{constructor(){super({id:cf,label:S(`fixAll.label`,`Fix All`),alias:`Fix All`,precondition:z.and(q.writable,cp(Z.SourceFixAll))})}run(e,t){return up(t,S(`fixAll.noneMessage`,`No fix all action available`),{include:Z.SourceFixAll,includeSourceActions:!0},`ifSingle`,Xd.FixAll)}},_p=class extends N{constructor(){super({id:`editor.action.autoFix`,label:S(`autoFix.label`,`Auto Fix...`),alias:`Auto Fix...`,precondition:z.and(q.writable,cp(Z.QuickFix)),kbOpts:{kbExpr:q.textInputFocus,primary:1625,mac:{primary:2649},weight:100}})}run(e,t){return up(t,S(`editor.action.autoFix.noneMessage`,`No auto fixes available`),{include:Z.QuickFix,onlyIncludePreferredActions:!0},`ifSingle`,Xd.AutoFix)}};I(sp.ID,sp,3),I(Pf.ID,Pf,4),L(dp),L(pp),L(mp),L(hp),L(_p),L(gp),P(new fp),un.as(Ea.Configuration).registerConfiguration({...ji,properties:{"editor.codeActionWidget.showHeaders":{type:`boolean`,scope:5,description:S(`showCodeActionHeaders`,`Enable/disable showing group headers in the Code Action menu.`),default:!0}}}),un.as(Ea.Configuration).registerConfiguration({...ji,properties:{"editor.codeActionWidget.includeNearbyQuickFixes":{type:`boolean`,scope:5,description:S(`includeNearbyQuickFixes`,`Enable/disable showing nearest Quick Fix within a line when not currently on a diagnostic.`),default:!0}}}),un.as(Ea.Configuration).registerConfiguration({...ji,properties:{"editor.codeActions.triggerOnFocusChange":{type:`boolean`,scope:5,markdownDescription:S(`triggerOnFocusChange`,`Enable triggering {0} when {1} is set to {2}. Code Actions must be set to {3} to be triggered for window and focus changes.`,"`#editor.codeActionsOnSave#`","`#files.autoSave#`","`afterDelay`","`always`"),default:!1}}});var vp=class{constructor(){this.lenses=[],this._disposables=new n}dispose(){this._disposables.dispose()}get isDisposed(){return this._disposables.isDisposed}add(e,t){this._disposables.add(e);for(let n of e.lenses)this.lenses.push({symbol:n,provider:t})}};async function yp(e,t,n){let r=e.ordered(t),i=new Map,a=new vp,o=r.map(async(e,r)=>{i.set(e,r);try{let r=await Promise.resolve(e.provideCodeLenses(t,n));r&&a.add(r,e)}catch(e){Re(e)}});return await Promise.all(o),a.lenses=a.lenses.sort((e,t)=>e.symbol.range.startLineNumber<t.symbol.range.startLineNumber?-1:e.symbol.range.startLineNumber>t.symbol.range.startLineNumber?1:i.get(e.provider)<i.get(t.provider)?-1:i.get(e.provider)>i.get(t.provider)?1:e.symbol.range.startColumn<t.symbol.range.startColumn?-1:e.symbol.range.startColumn>t.symbol.range.startColumn?1:0),a}B.registerCommand(`_executeCodeLensProvider`,function(e,...t){let[r,i]=t;o(y.isUri(r)),o(typeof i==`number`||!i);let{codeLensProvider:a}=e.get(V),s=e.get(Ps).getModel(r);if(!s)throw Fe();let c=[],l=new n;return yp(a,s,w.None).then(e=>{l.add(e);let t=[];for(let n of e.lenses)i==null||n.symbol.command?c.push(n.symbol):i-- >0&&n.provider.resolveCodeLens&&t.push(Promise.resolve(n.provider.resolveCodeLens(s,n.symbol,w.None)).then(e=>c.push(e||n.symbol)));return Promise.all(t)}).then(()=>c).finally(()=>{setTimeout(()=>l.dispose(),100)})});var bp=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},xp=function(e,t){return function(n,r){t(n,r,e)}};const Sp=kl(`ICodeLensCache`);var Cp=class{constructor(e,t){this.lineCount=e,this.data=t}},wp=class{constructor(e){this._fakeProvider=new class{provideCodeLenses(){throw Error(`not supported`)}},this._cache=new yl(20,.75),_r(Or,()=>e.remove(`codelens/cache`,1));let t=`codelens/cache2`,n=e.get(t,1,`{}`);this._deserialize(n);let r=we.filter(e.onWillSaveState,e=>e.reason===Ai.SHUTDOWN);we.once(r)(n=>{e.store(t,this._serialize(),1,1)})}put(e,t){let n=t.lenses.map(e=>({range:e.symbol.range,command:e.symbol.command&&{id:``,title:e.symbol.command?.title}})),r=new vp;r.add({lenses:n,dispose:()=>{}},this._fakeProvider);let i=new Cp(e.getLineCount(),r);this._cache.set(e.uri.toString(),i)}get(e){let t=this._cache.get(e.uri.toString());return t&&t.lineCount===e.getLineCount()?t.data:void 0}delete(e){this._cache.delete(e.uri.toString())}_serialize(){let e=Object.create(null);for(let[t,n]of this._cache){let r=new Set;for(let e of n.data.lenses)r.add(e.symbol.range.startLineNumber);e[t]={lineCount:n.lineCount,lines:[...r.values()]}}return JSON.stringify(e)}_deserialize(e){try{let t=JSON.parse(e);for(let e in t){let n=t[e],r=[];for(let e of n.lines)r.push({range:new T(e,1,e,11)});let i=new vp;i.add({lenses:r,dispose(){}},this._fakeProvider),this._cache.set(e,new Cp(n.lineCount,i))}}catch{}}};wp=bp([xp(0,Pa)],wp),$r(Sp,wp,1);var Tp=class{constructor(e,t,n){this.afterColumn=1073741824,this.afterLineNumber=e,this.heightInPx=t,this._onHeight=n,this.suppressMouseDown=!0,this.domNode=document.createElement(`div`)}onComputedHeight(e){this._lastHeight===void 0?this._lastHeight=e:this._lastHeight!==e&&(this._lastHeight=e,this._onHeight())}isVisible(){return this._lastHeight!==0&&this.domNode.hasAttribute(`monaco-visible-view-zone`)}},Ep=class e{static#e=this._idPool=0;constructor(t,n){this.allowEditorOverflow=!1,this.suppressMouseDown=!0,this._commands=new Map,this._isEmpty=!0,this._editor=t,this._id=`codelens.widget-${e._idPool++}`,this.updatePosition(n),this._domNode=document.createElement(`span`),this._domNode.className=`codelens-decoration`}withCommands(t,n){this._commands.clear();let r=[],i=!1;for(let n=0;n<t.length;n++){let a=t[n];if(a&&(i=!0,a.command)){let i=ml(a.command.title.trim());if(a.command.id){let t=`c${e._idPool++}`;r.push(O(`a`,{id:t,title:a.command.tooltip,role:`button`},...i)),this._commands.set(t,a.command)}else r.push(O(`span`,{title:a.command.tooltip},...i));n+1<t.length&&r.push(O(`span`,void 0,`\xA0|\xA0`))}}i?(Ar(this._domNode,...r),this._isEmpty&&n&&this._domNode.classList.add(`fadein`),this._isEmpty=!1):Ar(this._domNode,O(`span`,void 0,`no commands`))}getCommand(e){return e.parentElement===this._domNode?this._commands.get(e.id):void 0}getId(){return this._id}getDomNode(){return this._domNode}updatePosition(e){this._widgetPosition={position:{lineNumber:e,column:this._editor.getModel().getLineFirstNonWhitespaceColumn(e)},preference:[1]}}getPosition(){return this._widgetPosition||null}},Dp=class{constructor(){this._removeDecorations=[],this._addDecorations=[],this._addDecorationsCallbacks=[]}addDecoration(e,t){this._addDecorations.push(e),this._addDecorationsCallbacks.push(t)}removeDecoration(e){this._removeDecorations.push(e)}commit(e){let t=e.deltaDecorations(this._removeDecorations,this._addDecorations);for(let e=0,n=t.length;e<n;e++)this._addDecorationsCallbacks[e](t[e])}},Op=U.register({collapseOnReplaceEdit:!0,description:`codelens`}),kp=class{constructor(e,t,n,r,i,a){this._isDisposed=!1,this._editor=t,this._data=e,this._decorationIds=[];let o,s=[];this._data.forEach((e,t)=>{e.symbol.command&&s.push(e.symbol),n.addDecoration({range:e.symbol.range,options:Op},e=>this._decorationIds[t]=e),o=o?T.plusRange(o,e.symbol.range):T.lift(e.symbol.range)}),this._viewZone=new Tp(o.startLineNumber-1,i,a),this._viewZoneId=r.addZone(this._viewZone),s.length>0&&(this._createContentWidgetIfNecessary(),this._contentWidget.withCommands(s,!1))}_createContentWidgetIfNecessary(){this._contentWidget?this._editor.layoutContentWidget(this._contentWidget):(this._contentWidget=new Ep(this._editor,this._viewZone.afterLineNumber+1),this._editor.addContentWidget(this._contentWidget))}dispose(e,t){this._decorationIds.forEach(e.removeDecoration,e),this._decorationIds=[],t?.removeZone(this._viewZoneId),this._contentWidget&&=(this._editor.removeContentWidget(this._contentWidget),void 0),this._isDisposed=!0}isDisposed(){return this._isDisposed}isValid(){return this._decorationIds.some((e,t)=>{let n=this._editor.getModel().getDecorationRange(e),r=this._data[t].symbol;return!!(n&&T.isEmpty(r.range)===n.isEmpty())})}updateCodeLensSymbols(e,t){this._decorationIds.forEach(t.removeDecoration,t),this._decorationIds=[],this._data=e,this._data.forEach((e,n)=>{t.addDecoration({range:e.symbol.range,options:Op},e=>this._decorationIds[n]=e)})}updateHeight(e,t){this._viewZone.heightInPx=e,t.layoutZone(this._viewZoneId),this._contentWidget&&this._editor.layoutContentWidget(this._contentWidget)}computeIfNecessary(e){if(!this._viewZone.isVisible())return null;for(let t=0;t<this._decorationIds.length;t++){let n=e.getDecorationRange(this._decorationIds[t]);n&&(this._data[t].symbol.range=n)}return this._data}updateCommands(e){this._createContentWidgetIfNecessary(),this._contentWidget.withCommands(e,!0);for(let t=0;t<this._data.length;t++){let n=e[t];if(n){let{symbol:e}=this._data[t];e.command=n.command||e.command}}}getCommand(e){return this._contentWidget?.getCommand(e)}getLineNumber(){let e=this._editor.getModel().getDecorationRange(this._decorationIds[0]);return e?e.startLineNumber:-1}update(e){if(this.isValid()){let t=this._editor.getModel().getDecorationRange(this._decorationIds[0]);t&&(this._viewZone.afterLineNumber=t.startLineNumber-1,e.layoutZone(this._viewZoneId),this._contentWidget&&(this._contentWidget.updatePosition(t.startLineNumber),this._editor.layoutContentWidget(this._contentWidget)))}}},Ap=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},jp=function(e,t){return function(n,r){t(n,r,e)}},Mp=class{static#e=this.ID=`css.editor.codeLens`;constructor(e,t,r,i,a,o){this._editor=e,this._languageFeaturesService=t,this._commandService=i,this._notificationService=a,this._codeLensCache=o,this._disposables=new n,this._localToDispose=new n,this._lenses=[],this._oldCodeLensModels=new n,this._provideCodeLensDebounce=r.for(t.codeLensProvider,`CodeLensProvide`,{min:250}),this._resolveCodeLensesDebounce=r.for(t.codeLensProvider,`CodeLensResolve`,{min:250,salt:`resolve`}),this._resolveCodeLensesScheduler=new yt(()=>this._resolveCodeLensesInViewport(),this._resolveCodeLensesDebounce.default()),this._disposables.add(this._editor.onDidChangeModel(()=>this._onModelChange())),this._disposables.add(this._editor.onDidChangeModelLanguage(()=>this._onModelChange())),this._disposables.add(this._editor.onDidChangeConfiguration(e=>{(e.hasChanged(50)||e.hasChanged(19)||e.hasChanged(18))&&this._updateLensStyle(),e.hasChanged(17)&&this._onModelChange()})),this._disposables.add(t.codeLensProvider.onDidChange(this._onModelChange,this)),this._onModelChange(),this._updateLensStyle()}dispose(){this._localDispose(),this._disposables.dispose(),this._oldCodeLensModels.dispose(),this._currentCodeLensModel?.dispose()}_getLayoutInfo(){let e=Math.max(1.3,this._editor.getOption(67)/this._editor.getOption(52)),t=this._editor.getOption(19);return(!t||t<5)&&(t=this._editor.getOption(52)*.9|0),{fontSize:t,codeLensHeight:t*e|0}}_updateLensStyle(){let{codeLensHeight:e,fontSize:t}=this._getLayoutInfo(),n=this._editor.getOption(18),r=this._editor.getOption(50),{style:i}=this._editor.getContainerDomNode();i.setProperty(`--vscode-editorCodeLens-lineHeight`,`${e}px`),i.setProperty(`--vscode-editorCodeLens-fontSize`,`${t}px`),i.setProperty(`--vscode-editorCodeLens-fontFeatureSettings`,r.fontFeatureSettings),n&&(i.setProperty(`--vscode-editorCodeLens-fontFamily`,n),i.setProperty(`--vscode-editorCodeLens-fontFamilyDefault`,hr.fontFamily)),this._editor.changeViewZones(t=>{for(let n of this._lenses)n.updateHeight(e,t)})}_localDispose(){this._getCodeLensModelPromise?.cancel(),this._getCodeLensModelPromise=void 0,this._resolveCodeLensesPromise?.cancel(),this._resolveCodeLensesPromise=void 0,this._localToDispose.clear(),this._oldCodeLensModels.clear(),this._currentCodeLensModel?.dispose()}_onModelChange(){this._localDispose();let e=this._editor.getModel();if(!e||!this._editor.getOption(17)||e.isTooLargeForTokenization())return;let t=this._codeLensCache.get(e);if(t&&this._renderCodeLensSymbols(t),!this._languageFeaturesService.codeLensProvider.has(e)){t&&on(()=>{t===this._codeLensCache.get(e)&&(this._codeLensCache.delete(e),this._onModelChange())},30*1e3,this._localToDispose);return}for(let t of this._languageFeaturesService.codeLensProvider.all(e))if(typeof t.onDidChange==`function`){let e=t.onDidChange(()=>n.schedule());this._localToDispose.add(e)}let n=new yt(()=>{let t=Date.now();this._getCodeLensModelPromise?.cancel(),this._getCodeLensModelPromise=et(t=>yp(this._languageFeaturesService.codeLensProvider,e,t)),this._getCodeLensModelPromise.then(r=>{this._currentCodeLensModel&&this._oldCodeLensModels.add(this._currentCodeLensModel),this._currentCodeLensModel=r,this._codeLensCache.put(e,r),n.delay=this._provideCodeLensDebounce.update(e,Date.now()-t),this._renderCodeLensSymbols(r),this._resolveCodeLensesInViewportSoon()},C)},this._provideCodeLensDebounce.get(e));this._localToDispose.add(n),this._localToDispose.add(b(()=>this._resolveCodeLensesScheduler.cancel())),this._localToDispose.add(this._editor.onDidChangeModelContent(()=>{this._editor.changeDecorations(e=>{this._editor.changeViewZones(t=>{let n=[],r=-1;this._lenses.forEach(e=>{!e.isValid()||r===e.getLineNumber()?n.push(e):(e.update(t),r=e.getLineNumber())});let i=new Dp;n.forEach(e=>{e.dispose(i,t),this._lenses.splice(this._lenses.indexOf(e),1)}),i.commit(e)})}),n.schedule(),this._resolveCodeLensesScheduler.cancel(),this._resolveCodeLensesPromise?.cancel(),this._resolveCodeLensesPromise=void 0})),this._localToDispose.add(this._editor.onDidFocusEditorText(()=>{n.schedule()})),this._localToDispose.add(this._editor.onDidBlurEditorText(()=>{n.cancel()})),this._localToDispose.add(this._editor.onDidScrollChange(e=>{e.scrollTopChanged&&this._lenses.length>0&&this._resolveCodeLensesInViewportSoon()})),this._localToDispose.add(this._editor.onDidLayoutChange(()=>{this._resolveCodeLensesInViewportSoon()})),this._localToDispose.add(b(()=>{if(this._editor.getModel()){let e=Xi.capture(this._editor);this._editor.changeDecorations(e=>{this._editor.changeViewZones(t=>{this._disposeAllLenses(e,t)})}),e.restore(this._editor)}else this._disposeAllLenses(void 0,void 0)})),this._localToDispose.add(this._editor.onMouseDown(e=>{if(e.target.type!==9)return;let t=e.target.element;if(t?.tagName===`SPAN`&&(t=t.parentElement),t?.tagName===`A`)for(let e of this._lenses){let n=e.getCommand(t);if(n){this._commandService.executeCommand(n.id,...n.arguments||[]).catch(e=>this._notificationService.error(e));break}}})),n.schedule()}_disposeAllLenses(e,t){let n=new Dp;for(let e of this._lenses)e.dispose(n,t);e&&n.commit(e),this._lenses.length=0}_renderCodeLensSymbols(e){if(!this._editor.hasModel())return;let t=this._editor.getModel().getLineCount(),n=[],r;for(let i of e.lenses){let e=i.symbol.range.startLineNumber;e<1||e>t||(r&&r[r.length-1].symbol.range.startLineNumber===e?r.push(i):(r=[i],n.push(r)))}if(!n.length&&!this._lenses.length)return;let i=Xi.capture(this._editor),a=this._getLayoutInfo();this._editor.changeDecorations(e=>{this._editor.changeViewZones(t=>{let r=new Dp,i=0,o=0;for(;o<n.length&&i<this._lenses.length;){let e=n[o][0].symbol.range.startLineNumber,s=this._lenses[i].getLineNumber();s<e?(this._lenses[i].dispose(r,t),this._lenses.splice(i,1)):s===e?(this._lenses[i].updateCodeLensSymbols(n[o],r),o++,i++):(this._lenses.splice(i,0,new kp(n[o],this._editor,r,t,a.codeLensHeight,()=>this._resolveCodeLensesInViewportSoon())),i++,o++)}for(;i<this._lenses.length;)this._lenses[i].dispose(r,t),this._lenses.splice(i,1);for(;o<n.length;)this._lenses.push(new kp(n[o],this._editor,r,t,a.codeLensHeight,()=>this._resolveCodeLensesInViewportSoon())),o++;r.commit(e)})}),i.restore(this._editor)}_resolveCodeLensesInViewportSoon(){this._editor.getModel()&&this._resolveCodeLensesScheduler.schedule()}_resolveCodeLensesInViewport(){this._resolveCodeLensesPromise?.cancel(),this._resolveCodeLensesPromise=void 0;let e=this._editor.getModel();if(!e)return;let t=[],n=[];if(this._lenses.forEach(r=>{let i=r.computeIfNecessary(e);i&&(t.push(i),n.push(r))}),t.length===0)return;let r=Date.now(),i=et(r=>{let i=t.map((t,i)=>{let a=Array(t.length),o=t.map((t,n)=>!t.symbol.command&&typeof t.provider.resolveCodeLens==`function`?Promise.resolve(t.provider.resolveCodeLens(e,t.symbol,r)).then(e=>{a[n]=e},Re):(a[n]=t.symbol,Promise.resolve(void 0)));return Promise.all(o).then(()=>{!r.isCancellationRequested&&!n[i].isDisposed()&&n[i].updateCommands(a)})});return Promise.all(i)});this._resolveCodeLensesPromise=i,this._resolveCodeLensesPromise.then(()=>{let t=this._resolveCodeLensesDebounce.update(e,Date.now()-r);this._resolveCodeLensesScheduler.delay=t,this._currentCodeLensModel&&this._codeLensCache.put(e,this._currentCodeLensModel),this._oldCodeLensModels.clear(),i===this._resolveCodeLensesPromise&&(this._resolveCodeLensesPromise=void 0)},e=>{C(e),i===this._resolveCodeLensesPromise&&(this._resolveCodeLensesPromise=void 0)})}async getModel(){return await this._getCodeLensModelPromise,await this._resolveCodeLensesPromise,this._currentCodeLensModel?.isDisposed?void 0:this._currentCodeLensModel}};Mp=Ap([jp(1,V),jp(2,Qi),jp(3,lc),jp(4,Ro),jp(5,Sp)],Mp),I(Mp.ID,Mp,1),L(class extends N{constructor(){super({id:`codelens.showLensesInCurrentLine`,precondition:q.hasCodeLensProvider,label:S(`showLensOnLine`,`Show CodeLens Commands For Current Line`),alias:`Show CodeLens Commands For Current Line`})}async run(e,t){if(!t.hasModel())return;let n=e.get(xc),r=e.get(lc),i=e.get(Ro),a=t.getSelection().positionLineNumber,o=t.getContribution(Mp.ID);if(!o)return;let s=await o.getModel();if(!s)return;let c=[];for(let e of s.lenses)e.symbol.command&&e.symbol.range.startLineNumber===a&&c.push({label:e.symbol.command.title,command:e.symbol.command});if(c.length===0)return;let l=await n.pick(c,{canPickMany:!1,placeHolder:S(`placeHolder`,`Select a command`)});if(!l)return;let u=l.command;if(s.isDisposed){let e=(await o.getModel())?.lenses.find(e=>e.symbol.range.startLineNumber===a&&e.symbol.command?.title===u.title);if(!e||!e.symbol.command)return;u=e.symbol.command}try{await r.executeCommand(u.id,...u.arguments||[])}catch(e){i.error(e)}}});var Np=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Pp=function(e,t){return function(n,r){t(n,r,e)}},Fp=class{constructor(e){this._editorWorkerService=e}async provideDocumentColors(e,t){return this._editorWorkerService.computeDefaultDocumentColors(e.uri)}provideColorPresentations(e,t,n){let r=t.range,i=t.color,a=i.alpha,o=new E(new Rn(Math.round(255*i.red),Math.round(255*i.green),Math.round(255*i.blue),a)),s=a?E.Format.CSS.formatRGB(o):E.Format.CSS.formatRGBA(o),c=a?E.Format.CSS.formatHSL(o):E.Format.CSS.formatHSLA(o),l=a?E.Format.CSS.formatHex(o):E.Format.CSS.formatHexA(o),u=[];return u.push({label:s,textEdit:{range:r,text:s}}),u.push({label:c,textEdit:{range:r,text:c}}),u.push({label:l,textEdit:{range:r,text:l}}),u}};Fp=Np([Pp(0,pi)],Fp);var Ip=class extends _{constructor(e,t){super(),this._register(e.colorProvider.register(`*`,new Fp(t)))}};Ip=Np([Pp(0,V),Pp(1,pi)],Ip),wl(Ip);async function Lp(e,t,n,r=!0){return Hp(new zp,e,t,n,r)}function Rp(e,t,n,r){return Promise.resolve(n.provideColorPresentations(e,t,r))}var zp=class{constructor(){}async compute(e,t,n,r){let i=await e.provideDocumentColors(t,n);if(Array.isArray(i))for(let t of i)r.push({colorInfo:t,provider:e});return Array.isArray(i)}},Bp=class{constructor(){}async compute(e,t,n,r){let i=await e.provideDocumentColors(t,n);if(Array.isArray(i))for(let e of i)r.push({range:e.range,color:[e.color.red,e.color.green,e.color.blue,e.color.alpha]});return Array.isArray(i)}},Vp=class{constructor(e){this.colorInfo=e}async compute(e,t,n,r){let i=await e.provideColorPresentations(t,this.colorInfo,w.None);return Array.isArray(i)&&r.push(...i),Array.isArray(i)}};async function Hp(e,t,n,r,i){let a=!1,o,s=[],c=t.ordered(n);for(let t=c.length-1;t>=0;t--){let i=c[t];if(i instanceof Fp)o=i;else try{await e.compute(i,n,r,s)&&(a=!0)}catch(e){Re(e)}}return a?s:o&&i?(await e.compute(o,n,r,s),s):[]}function Up(e,t){let{colorProvider:n}=e.get(V),r=e.get(Ps).getModel(t);if(!r)throw Fe();return{model:r,colorProviderRegistry:n,isDefaultColorDecoratorsEnabled:e.get(F).getValue(`editor.defaultColorDecorators`,{resource:t})}}B.registerCommand(`_executeDocumentColorProvider`,function(e,...t){let[n]=t;if(!(n instanceof y))throw Fe();let{model:r,colorProviderRegistry:i,isDefaultColorDecoratorsEnabled:a}=Up(e,n);return Hp(new Bp,i,r,w.None,a)}),B.registerCommand(`_executeColorPresentationProvider`,function(e,...t){let[n,r]=t,{uri:i,range:a}=r;if(!(i instanceof y)||!Array.isArray(n)||n.length!==4||!T.isIRange(a))throw Fe();let{model:o,colorProviderRegistry:s,isDefaultColorDecoratorsEnabled:c}=Up(e,i),[l,u,d,f]=n;return Hp(new Vp({range:a,color:{red:l,green:u,blue:d,alpha:f}}),s,o,w.None,c)});var Wp=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Gp=function(e,t){return function(n,r){t(n,r,e)}},Kp;const qp=Object.create({});var Jp=class extends _{static#e=Kp=this;static#t=this.ID=`editor.contrib.colorDetector`;static#n=this.RECOMPUTE_TIME=1e3;constructor(e,t,r,i){super(),this._editor=e,this._configurationService=t,this._languageFeaturesService=r,this._localToDispose=this._register(new n),this._decorationsIds=[],this._colorDatas=new Map,this._colorDecoratorIds=this._editor.createDecorationsCollection(),this._ruleFactory=new ft(this._editor),this._decoratorLimitReporter=new Yp,this._colorDecorationClassRefs=this._register(new n),this._debounceInformation=i.for(r.colorProvider,`Document Colors`,{min:Kp.RECOMPUTE_TIME}),this._register(e.onDidChangeModel(()=>{this._isColorDecoratorsEnabled=this.isEnabled(),this.updateColors()})),this._register(e.onDidChangeModelLanguage(()=>this.updateColors())),this._register(r.colorProvider.onDidChange(()=>this.updateColors())),this._register(e.onDidChangeConfiguration(e=>{let t=this._isColorDecoratorsEnabled;this._isColorDecoratorsEnabled=this.isEnabled(),this._isDefaultColorDecoratorsEnabled=this._editor.getOption(148);let n=t!==this._isColorDecoratorsEnabled||e.hasChanged(21),r=e.hasChanged(148);(n||r)&&(this._isColorDecoratorsEnabled?this.updateColors():this.removeAllDecorations())})),this._timeoutTimer=null,this._computePromise=null,this._isColorDecoratorsEnabled=this.isEnabled(),this._isDefaultColorDecoratorsEnabled=this._editor.getOption(148),this.updateColors()}isEnabled(){let e=this._editor.getModel();if(!e)return!1;let t=e.getLanguageId(),n=this._configurationService.getValue(t);if(n&&typeof n==`object`){let e=n.colorDecorators;if(e&&e.enable!==void 0&&!e.enable)return e.enable}return this._editor.getOption(20)}static get(e){return e.getContribution(this.ID)}dispose(){this.stop(),this.removeAllDecorations(),super.dispose()}updateColors(){if(this.stop(),!this._isColorDecoratorsEnabled)return;let e=this._editor.getModel();!e||!this._languageFeaturesService.colorProvider.has(e)||(this._localToDispose.add(this._editor.onDidChangeModelContent(()=>{this._timeoutTimer||(this._timeoutTimer=new Yt,this._timeoutTimer.cancelAndSet(()=>{this._timeoutTimer=null,this.beginCompute()},this._debounceInformation.get(e)))})),this.beginCompute())}async beginCompute(){this._computePromise=et(async e=>{let t=this._editor.getModel();if(!t)return[];let n=new u(!1),r=await Lp(this._languageFeaturesService.colorProvider,t,e,this._isDefaultColorDecoratorsEnabled);return this._debounceInformation.update(t,n.elapsed()),r});try{let e=await this._computePromise;this.updateDecorations(e),this.updateColorDecorators(e),this._computePromise=null}catch(e){C(e)}}stop(){this._timeoutTimer&&=(this._timeoutTimer.cancel(),null),this._computePromise&&=(this._computePromise.cancel(),null),this._localToDispose.clear()}updateDecorations(e){let t=e.map(e=>({range:{startLineNumber:e.colorInfo.range.startLineNumber,startColumn:e.colorInfo.range.startColumn,endLineNumber:e.colorInfo.range.endLineNumber,endColumn:e.colorInfo.range.endColumn},options:U.EMPTY}));this._editor.changeDecorations(n=>{this._decorationsIds=n.deltaDecorations(this._decorationsIds,t),this._colorDatas=new Map,this._decorationsIds.forEach((t,n)=>this._colorDatas.set(t,e[n]))})}updateColorDecorators(e){this._colorDecorationClassRefs.clear();let t=[],n=this._editor.getOption(21);for(let r=0;r<e.length&&t.length<n;r++){let{red:n,green:i,blue:a,alpha:o}=e[r].colorInfo.color,s=new Rn(Math.round(n*255),Math.round(i*255),Math.round(a*255),o),c=`rgba(${s.r}, ${s.g}, ${s.b}, ${s.a})`,l=this._colorDecorationClassRefs.add(this._ruleFactory.createClassNameRef({backgroundColor:c}));t.push({range:{startLineNumber:e[r].colorInfo.range.startLineNumber,startColumn:e[r].colorInfo.range.startColumn,endLineNumber:e[r].colorInfo.range.endLineNumber,endColumn:e[r].colorInfo.range.endColumn},options:{description:`colorDetector`,before:{content:`\xA0`,inlineClassName:`${l.className} colorpicker-color-decoration`,inlineClassNameAffectsLetterSpacing:!0,attachedData:qp}}})}let r=n<e.length?n:!1;this._decoratorLimitReporter.update(e.length,r),this._colorDecoratorIds.set(t)}removeAllDecorations(){this._editor.removeDecorations(this._decorationsIds),this._decorationsIds=[],this._colorDecoratorIds.clear(),this._colorDecorationClassRefs.clear()}getColorData(e){let t=this._editor.getModel();if(!t)return null;let n=t.getDecorationsInRange(T.fromPositions(e,e)).filter(e=>this._colorDatas.has(e.id));return n.length===0?null:this._colorDatas.get(n[0].id)}isColorDecoration(e){return this._colorDecoratorIds.has(e)}};Jp=Kp=Wp([Gp(1,F),Gp(2,V),Gp(3,Qi)],Jp);var Yp=class{constructor(){this._onDidChange=new g,this._computed=0,this._limited=!1}update(e,t){(e!==this._computed||t!==this._limited)&&(this._computed=e,this._limited=t,this._onDidChange.fire())}};I(Jp.ID,Jp,1);var Xp=class{get color(){return this._color}set color(e){this._color.equals(e)||(this._color=e,this._onDidChangeColor.fire(e))}get presentation(){return this.colorPresentations[this.presentationIndex]}get colorPresentations(){return this._colorPresentations}set colorPresentations(e){this._colorPresentations=e,this.presentationIndex>e.length-1&&(this.presentationIndex=0),this._onDidChangePresentation.fire(this.presentation)}constructor(e,t,n){this.presentationIndex=n,this._onColorFlushed=new g,this.onColorFlushed=this._onColorFlushed.event,this._onDidChangeColor=new g,this.onDidChangeColor=this._onDidChangeColor.event,this._onDidChangePresentation=new g,this.onDidChangePresentation=this._onDidChangePresentation.event,this.originalColor=e,this._color=e,this._colorPresentations=t}selectNextColorPresentation(){this.presentationIndex=(this.presentationIndex+1)%this.colorPresentations.length,this.flushColor(),this._onDidChangePresentation.fire(this.presentation)}guessColorPresentation(e,t){let n=-1;for(let e=0;e<this.colorPresentations.length;e++)if(t.toLowerCase()===this.colorPresentations[e].label){n=e;break}if(n===-1){let e=t.split(`(`)[0].toLowerCase();for(let t=0;t<this.colorPresentations.length;t++)if(this.colorPresentations[t].label.toLowerCase().startsWith(e)){n=t;break}}n!==-1&&n!==this.presentationIndex&&(this.presentationIndex=n,this._onDidChangePresentation.fire(this.presentation))}flushColor(){this._onColorFlushed.fire(this._color)}},Zp=O,Qp=class extends _{constructor(e,t,n,r=!1){super(),this.model=t,this.showingStandaloneColorPicker=r,this._closeButton=null,this._domNode=Zp(`.colorpicker-header`),M(e,this._domNode),this._pickedColorNode=M(this._domNode,Zp(`.picked-color`)),M(this._pickedColorNode,Zp(`span.codicon.codicon-color-mode`)),this._pickedColorPresentation=M(this._pickedColorNode,document.createElement(`span`)),this._pickedColorPresentation.classList.add(`picked-color-presentation`);let i=S(`clickToToggleColorOptions`,`Click to toggle color options (rgb/hsl/hex)`);this._pickedColorNode.setAttribute(`title`,i),this._originalColorNode=M(this._domNode,Zp(`.original-color`)),this._originalColorNode.style.backgroundColor=E.Format.CSS.format(this.model.originalColor)||``,this.backgroundColor=n.getColorTheme().getColor(lr)||E.white,this._register(n.onDidColorThemeChange(e=>{this.backgroundColor=e.getColor(lr)||E.white})),this._register(D(this._pickedColorNode,j.CLICK,()=>this.model.selectNextColorPresentation())),this._register(D(this._originalColorNode,j.CLICK,()=>{this.model.color=this.model.originalColor,this.model.flushColor()})),this._register(t.onDidChangeColor(this.onDidChangeColor,this)),this._register(t.onDidChangePresentation(this.onDidChangePresentation,this)),this._pickedColorNode.style.backgroundColor=E.Format.CSS.format(t.color)||``,this._pickedColorNode.classList.toggle(`light`,t.color.rgba.a<.5?this.backgroundColor.isLighter():t.color.isLighter()),this.onDidChangeColor(this.model.color),this.showingStandaloneColorPicker&&(this._domNode.classList.add(`standalone-colorpicker`),this._closeButton=this._register(new $p(this._domNode)))}get closeButton(){return this._closeButton}get pickedColorNode(){return this._pickedColorNode}get originalColorNode(){return this._originalColorNode}onDidChangeColor(e){this._pickedColorNode.style.backgroundColor=E.Format.CSS.format(e)||``,this._pickedColorNode.classList.toggle(`light`,e.rgba.a<.5?this.backgroundColor.isLighter():e.isLighter()),this.onDidChangePresentation()}onDidChangePresentation(){this._pickedColorPresentation.textContent=this.model.presentation?this.model.presentation.label:``}},$p=class extends _{constructor(e){super(),this._onClicked=this._register(new g),this.onClicked=this._onClicked.event,this._button=document.createElement(`div`),this._button.classList.add(`close-button`),M(e,this._button);let t=document.createElement(`div`);t.classList.add(`close-button-inner-div`),M(this._button,t),M(t,Zp(`.button`+J.asCSSSelector(ri(`color-picker-close`,i.close,S(`closeIcon`,`Icon to close the color picker`))))).classList.add(`close-icon`),this._register(D(this._button,j.CLICK,()=>{this._onClicked.fire()}))}},em=class extends _{constructor(e,t,n,r=!1){super(),this.model=t,this.pixelRatio=n,this._insertButton=null,this._domNode=Zp(`.colorpicker-body`),M(e,this._domNode),this._saturationBox=new tm(this._domNode,this.model,this.pixelRatio),this._register(this._saturationBox),this._register(this._saturationBox.onDidChange(this.onDidSaturationValueChange,this)),this._register(this._saturationBox.onColorFlushed(this.flushColor,this)),this._opacityStrip=new rm(this._domNode,this.model,r),this._register(this._opacityStrip),this._register(this._opacityStrip.onDidChange(this.onDidOpacityChange,this)),this._register(this._opacityStrip.onColorFlushed(this.flushColor,this)),this._hueStrip=new im(this._domNode,this.model,r),this._register(this._hueStrip),this._register(this._hueStrip.onDidChange(this.onDidHueChange,this)),this._register(this._hueStrip.onColorFlushed(this.flushColor,this)),r&&(this._insertButton=this._register(new am(this._domNode)),this._domNode.classList.add(`standalone-colorpicker`))}flushColor(){this.model.flushColor()}onDidSaturationValueChange({s:e,v:t}){let n=this.model.color.hsva;this.model.color=new E(new We(n.h,e,t,n.a))}onDidOpacityChange(e){let t=this.model.color.hsva;this.model.color=new E(new We(t.h,t.s,t.v,e))}onDidHueChange(e){let t=this.model.color.hsva,n=(1-e)*360;this.model.color=new E(new We(n===360?0:n,t.s,t.v,t.a))}get domNode(){return this._domNode}get saturationBox(){return this._saturationBox}get enterButton(){return this._insertButton}layout(){this._saturationBox.layout(),this._opacityStrip.layout(),this._hueStrip.layout()}},tm=class extends _{constructor(e,t,n){super(),this.model=t,this.pixelRatio=n,this._onDidChange=new g,this.onDidChange=this._onDidChange.event,this._onColorFlushed=new g,this.onColorFlushed=this._onColorFlushed.event,this._domNode=Zp(`.saturation-wrap`),M(e,this._domNode),this._canvas=document.createElement(`canvas`),this._canvas.className=`saturation-box`,M(this._domNode,this._canvas),this.selection=Zp(`.saturation-selection`),M(this._domNode,this.selection),this.layout(),this._register(D(this._domNode,j.POINTER_DOWN,e=>this.onPointerDown(e))),this._register(this.model.onDidChangeColor(this.onDidChangeColor,this)),this.monitor=null}get domNode(){return this._domNode}onPointerDown(e){if(!e.target||!(e.target instanceof Element))return;this.monitor=this._register(new wn);let t=gt(this._domNode);e.target!==this.selection&&this.onDidChangePosition(e.offsetX,e.offsetY),this.monitor.startMonitoring(e.target,e.pointerId,e.buttons,e=>this.onDidChangePosition(e.pageX-t.left,e.pageY-t.top),()=>null);let n=D(e.target.ownerDocument,j.POINTER_UP,()=>{this._onColorFlushed.fire(),n.dispose(),this.monitor&&=(this.monitor.stopMonitoring(!0),null)},!0)}onDidChangePosition(e,t){let n=Math.max(0,Math.min(1,e/this.width)),r=Math.max(0,Math.min(1,1-t/this.height));this.paintSelection(n,r),this._onDidChange.fire({s:n,v:r})}layout(){this.width=this._domNode.offsetWidth,this.height=this._domNode.offsetHeight,this._canvas.width=this.width*this.pixelRatio,this._canvas.height=this.height*this.pixelRatio,this.paint();let e=this.model.color.hsva;this.paintSelection(e.s,e.v)}paint(){let e=this.model.color.hsva,t=new E(new We(e.h,1,1,1)),n=this._canvas.getContext(`2d`),r=n.createLinearGradient(0,0,this._canvas.width,0);r.addColorStop(0,`rgba(255, 255, 255, 1)`),r.addColorStop(.5,`rgba(255, 255, 255, 0.5)`),r.addColorStop(1,`rgba(255, 255, 255, 0)`);let i=n.createLinearGradient(0,0,0,this._canvas.height);i.addColorStop(0,`rgba(0, 0, 0, 0)`),i.addColorStop(1,`rgba(0, 0, 0, 1)`),n.rect(0,0,this._canvas.width,this._canvas.height),n.fillStyle=E.Format.CSS.format(t),n.fill(),n.fillStyle=r,n.fill(),n.fillStyle=i,n.fill()}paintSelection(e,t){this.selection.style.left=`${e*this.width}px`,this.selection.style.top=`${this.height-t*this.height}px`}onDidChangeColor(e){if(this.monitor&&this.monitor.isMonitoring())return;this.paint();let t=e.hsva;this.paintSelection(t.s,t.v)}},nm=class extends _{constructor(e,t,n=!1){super(),this.model=t,this._onDidChange=new g,this.onDidChange=this._onDidChange.event,this._onColorFlushed=new g,this.onColorFlushed=this._onColorFlushed.event,n?(this.domNode=M(e,Zp(`.standalone-strip`)),this.overlay=M(this.domNode,Zp(`.standalone-overlay`))):(this.domNode=M(e,Zp(`.strip`)),this.overlay=M(this.domNode,Zp(`.overlay`))),this.slider=M(this.domNode,Zp(`.slider`)),this.slider.style.top=`0px`,this._register(D(this.domNode,j.POINTER_DOWN,e=>this.onPointerDown(e))),this._register(t.onDidChangeColor(this.onDidChangeColor,this)),this.layout()}layout(){this.height=this.domNode.offsetHeight-this.slider.offsetHeight;let e=this.getValue(this.model.color);this.updateSliderPosition(e)}onDidChangeColor(e){let t=this.getValue(e);this.updateSliderPosition(t)}onPointerDown(e){if(!e.target||!(e.target instanceof Element))return;let t=this._register(new wn),n=gt(this.domNode);this.domNode.classList.add(`grabbing`),e.target!==this.slider&&this.onDidChangeTop(e.offsetY),t.startMonitoring(e.target,e.pointerId,e.buttons,e=>this.onDidChangeTop(e.pageY-n.top),()=>null);let r=D(e.target.ownerDocument,j.POINTER_UP,()=>{this._onColorFlushed.fire(),r.dispose(),t.stopMonitoring(!0),this.domNode.classList.remove(`grabbing`)},!0)}onDidChangeTop(e){let t=Math.max(0,Math.min(1,1-e/this.height));this.updateSliderPosition(t),this._onDidChange.fire(t)}updateSliderPosition(e){this.slider.style.top=`${(1-e)*this.height}px`}},rm=class extends nm{constructor(e,t,n=!1){super(e,t,n),this.domNode.classList.add(`opacity-strip`),this.onDidChangeColor(this.model.color)}onDidChangeColor(e){super.onDidChangeColor(e);let{r:t,g:n,b:r}=e.rgba,i=new E(new Rn(t,n,r,1)),a=new E(new Rn(t,n,r,0));this.overlay.style.background=`linear-gradient(to bottom, ${i} 0%, ${a} 100%)`}getValue(e){return e.hsva.a}},im=class extends nm{constructor(e,t,n=!1){super(e,t,n),this.domNode.classList.add(`hue-strip`)}getValue(e){return 1-e.hsva.h/360}},am=class extends _{constructor(e){super(),this._onClicked=this._register(new g),this.onClicked=this._onClicked.event,this._button=M(e,document.createElement(`button`)),this._button.classList.add(`insert-button`),this._button.textContent=`Insert`,this._register(D(this._button,j.CLICK,()=>{this._onClicked.fire()}))}get button(){return this._button}},om=class extends Na{constructor(e,t,n,r,i=!1){super(),this.model=t,this.pixelRatio=n,this._register($a.getInstance(pt(e)).onDidChange(()=>this.layout())),this._domNode=Zp(`.colorpicker-widget`),e.appendChild(this._domNode),this.header=this._register(new Qp(this._domNode,this.model,r,i)),this.body=this._register(new em(this._domNode,this.model,this.pixelRatio,i))}layout(){this.body.layout()}get domNode(){return this._domNode}},sm=class{constructor(e,t,n,r){this.priority=e,this.range=t,this.initialMousePosX=n,this.initialMousePosY=r,this.type=1}equals(e){return e.type===1&&this.range.equalsRange(e.range)}canAdoptVisibleHover(e,t){return e.type===1&&t.lineNumber===this.range.startLineNumber}},cm=class{constructor(e,t,n,r,i,a){this.priority=e,this.owner=t,this.range=n,this.initialMousePosX=r,this.initialMousePosY=i,this.supportsMarkerHover=a,this.type=2}equals(e){return e.type===2&&this.owner===e.owner}canAdoptVisibleHover(e,t){return e.type===2&&this.owner===e.owner}},lm=class{constructor(e){this.renderedHoverParts=e}dispose(){for(let e of this.renderedHoverParts)e.dispose()}};const um=new class{constructor(){this._participants=[]}register(e){this._participants.push(e)}getAll(){return this._participants}};var dm=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},fm=function(e,t){return function(n,r){t(n,r,e)}},pm=class{constructor(e,t,n,r){this.owner=e,this.range=t,this.model=n,this.provider=r,this.forceShowAtRange=!0}isValidForHoverAnchor(e){return e.type===1&&this.range.startColumn<=e.range.startColumn&&this.range.endColumn>=e.range.endColumn}},mm=class{constructor(e,t){this._editor=e,this._themeService=t,this.hoverOrdinal=2}computeSync(e,t){return[]}computeAsync(e,t,n){return Xe.fromPromise(this._computeAsync(e,t,n))}async _computeAsync(e,t,n){if(!this._editor.hasModel())return[];let r=Jp.get(this._editor);if(!r)return[];for(let e of t){if(!r.isColorDecoration(e))continue;let t=r.getColorData(e.range.getStartPosition());if(t)return[await _m(this,this._editor.getModel(),t.colorInfo,t.provider)]}return[]}renderHoverParts(e,t){let n=vm(this,this._editor,this._themeService,t,e);return n?(this._colorPicker=n.colorPicker,new lm([{hoverPart:n.hoverPart,hoverElement:this._colorPicker.domNode,dispose(){n.disposables.dispose()}}])):new lm([])}handleResize(){this._colorPicker?.layout()}isColorPickerVisible(){return!!this._colorPicker}};mm=dm([fm(1,Zc)],mm);var hm=class{constructor(e,t,n,r){this.owner=e,this.range=t,this.model=n,this.provider=r}},gm=class{constructor(e,t){this._editor=e,this._themeService=t,this._color=null}async createColorHover(e,t,n){if(!this._editor.hasModel()||!Jp.get(this._editor))return null;let r=await Lp(n,this._editor.getModel(),w.None),i=null,a=null;for(let t of r){let n=t.colorInfo;T.containsRange(n.range,e.range)&&(i=n,a=t.provider)}let o=i??e,s=a??t,c=!!i;return{colorHover:await _m(this,this._editor.getModel(),o,s),foundInEditor:c}}async updateEditorModel(e){if(!this._editor.hasModel())return;let t=e.model,n=new T(e.range.startLineNumber,e.range.startColumn,e.range.endLineNumber,e.range.endColumn);this._color&&(await bm(this._editor.getModel(),t,this._color,n,e),n=ym(this._editor,n,t))}renderHoverParts(e,t){return vm(this,this._editor,this._themeService,t,e)}set color(e){this._color=e}get color(){return this._color}};gm=dm([fm(1,Zc)],gm);async function _m(e,t,n,r){let i=t.getValueInRange(n.range),{red:a,green:o,blue:s,alpha:c}=n.color,l=new E(new Rn(Math.round(a*255),Math.round(o*255),Math.round(s*255),c)),u=await Rp(t,n,r,w.None),d=new Xp(l,[],0);return d.colorPresentations=u||[],d.guessColorPresentation(l,i),e instanceof mm?new pm(e,T.lift(n.range),d,r):new hm(e,T.lift(n.range),d,r)}function vm(e,t,r,i,a){if(i.length===0||!t.hasModel())return;if(a.setMinimumDimensions){let e=t.getOption(67)+8;a.setMinimumDimensions(new A(302,e))}let o=new n,s=i[0],c=t.getModel(),l=s.model,u=o.add(new om(a.fragment,l,t.getOption(144),r,e instanceof gm)),d=!1,f=new T(s.range.startLineNumber,s.range.startColumn,s.range.endLineNumber,s.range.endColumn);if(e instanceof gm){let t=s.model.color;e.color=t,bm(c,l,t,f,s),o.add(l.onColorFlushed(t=>{e.color=t}))}else o.add(l.onColorFlushed(async e=>{await bm(c,l,e,f,s),d=!0,f=ym(t,f,l)}));return o.add(l.onDidChangeColor(e=>{bm(c,l,e,f,s)})),o.add(t.onDidChangeModelContent(e=>{d?d=!1:(a.hide(),t.focus())})),{hoverPart:s,colorPicker:u,disposables:o}}function ym(e,t,n){let r=[],i=n.presentation.textEdit??{range:t,text:n.presentation.label,forceMoveMarkers:!1};r.push(i),n.presentation.additionalTextEdits&&r.push(...n.presentation.additionalTextEdits);let a=T.lift(i.range),o=e.getModel()._setTrackedRange(null,a,3);return e.executeEdits(`colorpicker`,r),e.pushUndoStop(),e.getModel()._getTrackedRange(o)??a}async function bm(e,t,n,r,i){t.colorPresentations=await Rp(e,{range:r,color:{red:n.rgba.r/255,green:n.rgba.g/255,blue:n.rgba.b/255,alpha:n.rgba.a}},i.provider,w.None)||[]}const xm=`editor.action.increaseHoverVerbosityLevel`,Sm=S({key:`increaseHoverVerbosityLevel`,comment:[`Label for action that will increase the hover verbosity level.`]},`Increase Hover Verbosity Level`),Cm=`editor.action.decreaseHoverVerbosityLevel`,wm=S({key:`decreaseHoverVerbosityLevel`,comment:[`Label for action that will decrease the hover verbosity level.`]},`Decrease Hover Verbosity Level`),Tm=`editor.action.inlineSuggest.showPrevious`,Em=`editor.action.inlineSuggest.showNext`;var Dm=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Om=function(e,t){return function(n,r){t(n,r,e)}},km,Am=class extends _{constructor(e,t,n){super(),this.editor=e,this.model=t,this.instantiationService=n,this.alwaysShowToolbar=$i(this,this.editor.onDidChangeConfiguration,()=>this.editor.getOption(62).showToolbar===`always`),this.sessionPosition=void 0,this.position=K(this,e=>{let t=this.model.read(e)?.primaryGhostText.read(e);if(!this.alwaysShowToolbar.read(e)||!t||t.parts.length===0)return this.sessionPosition=void 0,null;let n=t.parts[0].column;this.sessionPosition&&this.sessionPosition.lineNumber!==t.lineNumber&&(this.sessionPosition=void 0);let i=new r(t.lineNumber,Math.min(n,this.sessionPosition?.column??2**53-1));return this.sessionPosition=i,i}),this._register(Ss((t,n)=>{let r=this.model.read(t);if(!r||!this.alwaysShowToolbar.read(t))return;let i=Ec((t,n)=>{let i=n.add(this.instantiationService.createInstance(Nm,this.editor,!0,this.position,r.selectedInlineCompletionIndex,r.inlineCompletionsCount,r.activeCommands));return e.addContentWidget(i),n.add(b(()=>e.removeContentWidget(i))),n.add(Ba(e=>{this.position.read(e)&&r.lastTriggerKind.read(e)!==Oe.Explicit&&r.triggerExplicitly()})),i}),a=aa(this,(e,t)=>!!this.position.read(e)||!!t);n.add(Ba(e=>{a.read(e)&&i.read(e)}))}))}};Am=Dm([Om(2,Y)],Am);var jm=ri(`inline-suggestion-hints-next`,i.chevronRight,S(`parameterHintsNextIcon`,`Icon for show next parameter hint.`)),Mm=ri(`inline-suggestion-hints-previous`,i.chevronLeft,S(`parameterHintsPreviousIcon`,`Icon for show previous parameter hint.`)),Nm=class extends _{static#e=km=this;static#t=this._dropDownVisible=!1;static get dropDownVisible(){return this._dropDownVisible}static#n=this.id=0;createCommandAction(e,t,n){let r=new hs(e,t,n,!0,()=>this._commandService.executeCommand(e)),i=this.keybindingService.lookupKeybinding(e,this._contextKeyService),a=t;return i&&(a=S({key:`content`,comment:[`A label`,`A keybinding`]},`{0} ({1})`,t,i.getLabel())),r.tooltip=a,r}constructor(e,t,n,r,i,a,o,s,c,l,u){super(),this.editor=e,this.withBorder=t,this._position=n,this._currentSuggestionIdx=r,this._suggestionCount=i,this._extraCommands=a,this._commandService=o,this.keybindingService=c,this._contextKeyService=l,this._menuService=u,this.id=`InlineSuggestionHintsContentWidget${km.id++}`,this.allowEditorOverflow=!0,this.suppressMouseDown=!1,this.nodes=ut(`div.inlineSuggestionsHints`,{className:this.withBorder?`.withBorder`:``},[ut(`div@toolBar`)]),this.previousAction=this.createCommandAction(Tm,S(`previous`,`Previous`),J.asClassName(Mm)),this.availableSuggestionCountAction=new hs(`inlineSuggestionHints.availableSuggestionCount`,``,void 0,!1),this.nextAction=this.createCommandAction(Em,S(`next`,`Next`),J.asClassName(jm)),this.inlineCompletionsActionsMenus=this._register(this._menuService.createMenu(R.InlineCompletionsActions,this._contextKeyService)),this.clearAvailableSuggestionCountLabelDebounced=this._register(new yt(()=>{this.availableSuggestionCountAction.label=``},100)),this.disableButtonsDebounced=this._register(new yt(()=>{this.previousAction.enabled=this.nextAction.enabled=!1},100)),this.toolBar=this._register(s.createInstance(Im,this.nodes.toolBar,R.InlineSuggestionToolbar,{menuOptions:{renderShortTitle:!0},toolbarOptions:{primaryGroup:e=>e.startsWith(`primary`)},actionViewItemProvider:(e,t)=>{if(e instanceof Ra)return s.createInstance(Fm,e,void 0);if(e===this.availableSuggestionCountAction){let t=new Pm(void 0,e,{label:!0,icon:!1});return t.setClass(`availableSuggestionCount`),t}},telemetrySource:`InlineSuggestionToolbar`})),this.toolBar.setPrependedPrimaryActions([this.previousAction,this.availableSuggestionCountAction,this.nextAction]),this._register(this.toolBar.onDidChangeDropdownVisibility(e=>{km._dropDownVisible=e})),this._register(Ba(e=>{this._position.read(e),this.editor.layoutContentWidget(this)})),this._register(Ba(e=>{let t=this._suggestionCount.read(e),n=this._currentSuggestionIdx.read(e);t===void 0?this.clearAvailableSuggestionCountLabelDebounced.schedule():(this.clearAvailableSuggestionCountLabelDebounced.cancel(),this.availableSuggestionCountAction.label=`${n+1}/${t}`),t!==void 0&&t>1?(this.disableButtonsDebounced.cancel(),this.previousAction.enabled=this.nextAction.enabled=!0):this.disableButtonsDebounced.schedule()})),this._register(Ba(e=>{let t=this._extraCommands.read(e).map(e=>({class:void 0,id:e.id,enabled:!0,tooltip:e.tooltip||``,label:e.title,run:t=>this._commandService.executeCommand(e.id)}));for(let[e,n]of this.inlineCompletionsActionsMenus.getActions())for(let e of n)e instanceof Ra&&t.push(e);t.length>0&&t.unshift(new Ds),this.toolBar.setAdditionalSecondaryActions(t)}))}getId(){return this.id}getDomNode(){return this.nodes.root}getPosition(){return{position:this._position.get(),preference:[1,2],positionAffinity:3}}};Nm=km=Dm([Om(6,lc),Om(7,Y),Om(8,ua),Om(9,W),Om(10,Eo)],Nm);var Pm=class extends da{constructor(){super(...arguments),this._className=void 0}setClass(e){this._className=e}render(e){super.render(e),this._className&&e.classList.add(this._className)}updateTooltip(){}},Fm=class extends ao{updateLabel(){let e=this._keybindingService.lookupKeybinding(this._action.id,this._contextKeyService);if(!e)return super.updateLabel();if(this.label){let n=ut(`div.keybinding`).root;this._register(new va(n,t,{disableTitle:!0,...wa})).set(e),this.label.textContent=this._action.label,this.label.appendChild(n),this.label.classList.add(`inlineSuggestionStatusBarItemLabel`)}}updateTooltip(){}},Im=class extends ya{constructor(e,t,n,r,i,a,o,s,c){super(e,{resetMenu:t,...n},r,i,a,o,s,c),this.menuId=t,this.options2=n,this.menuService=r,this.contextKeyService=i,this.menu=this._store.add(this.menuService.createMenu(this.menuId,this.contextKeyService,{emitEventsForSubmenuChanges:!0})),this.additionalActions=[],this.prependedPrimaryActions=[],this._store.add(this.menu.onDidChange(()=>this.updateToolbar())),this.updateToolbar()}updateToolbar(){let e=[],t=[];Oa(this.menu,this.options2?.menuOptions,{primary:e,secondary:t},this.options2?.toolbarOptions?.primaryGroup,this.options2?.toolbarOptions?.shouldInlineSubmenu,this.options2?.toolbarOptions?.useSeparatorsInPrimaryActions),t.push(...this.additionalActions),e.unshift(...this.prependedPrimaryActions),this.setActions(e,t)}setPrependedPrimaryActions(e){Ut(this.prependedPrimaryActions,e,(e,t)=>e===t)||(this.prependedPrimaryActions=e,this.updateToolbar())}setAdditionalSecondaryActions(e){Ut(this.additionalActions,e,(e,t)=>e===t)||(this.additionalActions=e,this.updateToolbar())}};Im=Dm([Om(3,Eo),Om(4,W),Om(5,Ga),Om(6,ua),Om(7,lc),Om(8,Zi)],Im);function Lm(e,t,n){let r=gt(e);return!(t<r.left||t>r.left+r.width||n<r.top||n>r.top+r.height)}var Rm=class{constructor(e,t,n){this.value=e,this.isComplete=t,this.hasLoadingMessage=n}},zm=class extends _{constructor(e,t){super(),this._editor=e,this._computer=t,this._onResult=this._register(new g),this.onResult=this._onResult.event,this._firstWaitScheduler=this._register(new yt(()=>this._triggerAsyncComputation(),0)),this._secondWaitScheduler=this._register(new yt(()=>this._triggerSyncComputation(),0)),this._loadingMessageScheduler=this._register(new yt(()=>this._triggerLoadingMessage(),0)),this._state=0,this._asyncIterable=null,this._asyncIterableDone=!1,this._result=[]}dispose(){this._asyncIterable&&=(this._asyncIterable.cancel(),null),super.dispose()}get _hoverTime(){return this._editor.getOption(60).delay}get _firstWaitTime(){return this._hoverTime/2}get _secondWaitTime(){return this._hoverTime-this._firstWaitTime}get _loadingMessageTime(){return 3*this._hoverTime}_setState(e,t=!0){this._state=e,t&&this._fireResult()}_triggerAsyncComputation(){this._setState(2),this._secondWaitScheduler.schedule(this._secondWaitTime),this._computer.computeAsync?(this._asyncIterableDone=!1,this._asyncIterable=Gr(e=>this._computer.computeAsync(e)),(async()=>{try{for await(let e of this._asyncIterable)e&&(this._result.push(e),this._fireResult());this._asyncIterableDone=!0,(this._state===3||this._state===4)&&this._setState(0)}catch(e){C(e)}})()):this._asyncIterableDone=!0}_triggerSyncComputation(){this._computer.computeSync&&(this._result=this._result.concat(this._computer.computeSync())),this._setState(this._asyncIterableDone?0:3)}_triggerLoadingMessage(){this._state===3&&this._setState(4)}_fireResult(){if(this._state===1||this._state===2)return;let e=this._state===0,t=this._state===4;this._onResult.fire(new Rm(this._result.slice(0),e,t))}start(e){if(e===0)this._state===0&&(this._setState(1),this._firstWaitScheduler.schedule(this._firstWaitTime),this._loadingMessageScheduler.schedule(this._loadingMessageTime));else switch(this._state){case 0:this._triggerAsyncComputation(),this._secondWaitScheduler.cancel(),this._triggerSyncComputation();break;case 2:this._secondWaitScheduler.cancel(),this._triggerSyncComputation();break}}cancel(){this._firstWaitScheduler.cancel(),this._secondWaitScheduler.cancel(),this._loadingMessageScheduler.cancel(),this._asyncIterable&&=(this._asyncIterable.cancel(),null),this._result=[],this._setState(0,!1)}},Bm=class{constructor(){this._onDidWillResize=new g,this.onDidWillResize=this._onDidWillResize.event,this._onDidResize=new g,this.onDidResize=this._onDidResize.event,this._sashListener=new n,this._size=new A(0,0),this._minSize=new A(0,0),this._maxSize=new A(2**53-1,2**53-1),this.domNode=document.createElement(`div`),this._eastSash=new zc(this.domNode,{getVerticalSashLeft:()=>this._size.width},{orientation:0}),this._westSash=new zc(this.domNode,{getVerticalSashLeft:()=>0},{orientation:0}),this._northSash=new zc(this.domNode,{getHorizontalSashTop:()=>0},{orientation:1,orthogonalEdge:sa.North}),this._southSash=new zc(this.domNode,{getHorizontalSashTop:()=>this._size.height},{orientation:1,orthogonalEdge:sa.South}),this._northSash.orthogonalStartSash=this._westSash,this._northSash.orthogonalEndSash=this._eastSash,this._southSash.orthogonalStartSash=this._westSash,this._southSash.orthogonalEndSash=this._eastSash;let e,t=0,r=0;this._sashListener.add(we.any(this._northSash.onDidStart,this._eastSash.onDidStart,this._southSash.onDidStart,this._westSash.onDidStart)(()=>{e===void 0&&(this._onDidWillResize.fire(),e=this._size,t=0,r=0)})),this._sashListener.add(we.any(this._northSash.onDidEnd,this._eastSash.onDidEnd,this._southSash.onDidEnd,this._westSash.onDidEnd)(()=>{e!==void 0&&(e=void 0,t=0,r=0,this._onDidResize.fire({dimension:this._size,done:!0}))})),this._sashListener.add(this._eastSash.onDidChange(n=>{e&&(r=n.currentX-n.startX,this.layout(e.height+t,e.width+r),this._onDidResize.fire({dimension:this._size,done:!1,east:!0}))})),this._sashListener.add(this._westSash.onDidChange(n=>{e&&(r=-(n.currentX-n.startX),this.layout(e.height+t,e.width+r),this._onDidResize.fire({dimension:this._size,done:!1,west:!0}))})),this._sashListener.add(this._northSash.onDidChange(n=>{e&&(t=-(n.currentY-n.startY),this.layout(e.height+t,e.width+r),this._onDidResize.fire({dimension:this._size,done:!1,north:!0}))})),this._sashListener.add(this._southSash.onDidChange(n=>{e&&(t=n.currentY-n.startY,this.layout(e.height+t,e.width+r),this._onDidResize.fire({dimension:this._size,done:!1,south:!0}))})),this._sashListener.add(we.any(this._eastSash.onDidReset,this._westSash.onDidReset)(e=>{this._preferredSize&&(this.layout(this._size.height,this._preferredSize.width),this._onDidResize.fire({dimension:this._size,done:!0}))})),this._sashListener.add(we.any(this._northSash.onDidReset,this._southSash.onDidReset)(e=>{this._preferredSize&&(this.layout(this._preferredSize.height,this._size.width),this._onDidResize.fire({dimension:this._size,done:!0}))}))}dispose(){this._northSash.dispose(),this._southSash.dispose(),this._eastSash.dispose(),this._westSash.dispose(),this._sashListener.dispose(),this._onDidResize.dispose(),this._onDidWillResize.dispose(),this.domNode.remove()}enableSashes(e,t,n,r){this._northSash.state=e?3:0,this._eastSash.state=t?3:0,this._southSash.state=n?3:0,this._westSash.state=r?3:0}layout(e=this.size.height,t=this.size.width){let{height:n,width:r}=this._minSize,{height:i,width:a}=this._maxSize;e=Math.max(n,Math.min(i,e)),t=Math.max(r,Math.min(a,t));let o=new A(t,e);A.equals(o,this._size)||(this.domNode.style.height=e+`px`,this.domNode.style.width=t+`px`,this._size=o,this._northSash.layout(),this._eastSash.layout(),this._southSash.layout(),this._westSash.layout())}clearSashHoverState(){this._eastSash.clearSashHoverState(),this._westSash.clearSashHoverState(),this._northSash.clearSashHoverState(),this._southSash.clearSashHoverState()}get size(){return this._size}set maxSize(e){this._maxSize=e}get maxSize(){return this._maxSize}set minSize(e){this._minSize=e}get minSize(){return this._minSize}set preferredSize(e){this._preferredSize=e}get preferredSize(){return this._preferredSize}},Vm=30,Hm=24,Um=class extends _{constructor(e,t=new A(10,10)){super(),this._editor=e,this.allowEditorOverflow=!0,this.suppressMouseDown=!1,this._resizableNode=this._register(new Bm),this._contentPosition=null,this._isResizing=!1,this._resizableNode.domNode.style.position=`absolute`,this._resizableNode.minSize=A.lift(t),this._resizableNode.layout(t.height,t.width),this._resizableNode.enableSashes(!0,!0,!0,!0),this._register(this._resizableNode.onDidResize(e=>{this._resize(new A(e.dimension.width,e.dimension.height)),e.done&&(this._isResizing=!1)})),this._register(this._resizableNode.onDidWillResize(()=>{this._isResizing=!0}))}get isResizing(){return this._isResizing}getDomNode(){return this._resizableNode.domNode}getPosition(){return this._contentPosition}get position(){return this._contentPosition?.position?r.lift(this._contentPosition.position):void 0}_availableVerticalSpaceAbove(e){let t=this._editor.getDomNode(),n=this._editor.getScrolledVisiblePosition(e);if(!(!t||!n))return gt(t).top+n.top-Vm}_availableVerticalSpaceBelow(e){let t=this._editor.getDomNode(),n=this._editor.getScrolledVisiblePosition(e);if(!t||!n)return;let r=gt(t),i=jt(t.ownerDocument.body),a=r.top+n.top+n.height;return i.height-a-Hm}_findPositionPreference(e,t){let n=Math.min(this._availableVerticalSpaceBelow(t)??1/0,e),r=Math.min(this._availableVerticalSpaceAbove(t)??1/0,e),i=Math.min(Math.max(r,n),e),a=Math.min(e,i),o;return o=this._editor.getOption(60).above?a<=r?1:2:a<=n?2:1,o===1?this._resizableNode.enableSashes(!0,!0,!1,!1):this._resizableNode.enableSashes(!1,!0,!0,!1),o}_resize(e){this._resizableNode.layout(e.height,e.width)}},Wm=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Gm=function(e,t){return function(n,r){t(n,r,e)}},Km,qm=30,Jm=6,Ym=class extends Um{static#e=Km=this;static#t=this.ID=`editor.contrib.resizableContentHoverWidget`;static#n=this._lastDimensions=new A(0,0);get isVisibleFromKeyboard(){return this._renderedHover?.source===1}get isVisible(){return this._hoverVisibleKey.get()??!1}get isFocused(){return this._hoverFocusedKey.get()??!1}constructor(e,t,n,r,i){let a=new A(150,e.getOption(67)+8);super(e,a),this._configurationService=n,this._accessibilityService=r,this._keybindingService=i,this._hover=this._register(new nc),this._onDidResize=this._register(new g),this.onDidResize=this._onDidResize.event,this._minimumSize=a,this._hoverVisibleKey=q.hoverVisible.bindTo(t),this._hoverFocusedKey=q.hoverFocused.bindTo(t),M(this._resizableNode.domNode,this._hover.containerDomNode),this._resizableNode.domNode.style.zIndex=`50`,this._register(this._editor.onDidLayoutChange(()=>{this.isVisible&&this._updateMaxDimensions()})),this._register(this._editor.onDidChangeConfiguration(e=>{e.hasChanged(50)&&this._updateFont()}));let o=this._register(An(this._resizableNode.domNode));this._register(o.onDidFocus(()=>{this._hoverFocusedKey.set(!0)})),this._register(o.onDidBlur(()=>{this._hoverFocusedKey.set(!1)})),this._setRenderedHover(void 0),this._editor.addContentWidget(this)}dispose(){super.dispose(),this._renderedHover?.dispose(),this._editor.removeContentWidget(this)}getId(){return Km.ID}static _applyDimensions(e,t,n){let r=typeof t==`number`?`${t}px`:t,i=typeof n==`number`?`${n}px`:n;e.style.width=r,e.style.height=i}_setContentsDomNodeDimensions(e,t){let n=this._hover.contentsDomNode;return Km._applyDimensions(n,e,t)}_setContainerDomNodeDimensions(e,t){let n=this._hover.containerDomNode;return Km._applyDimensions(n,e,t)}_setHoverWidgetDimensions(e,t){this._setContentsDomNodeDimensions(e,t),this._setContainerDomNodeDimensions(e,t),this._layoutContentWidget()}static _applyMaxDimensions(e,t,n){let r=typeof t==`number`?`${t}px`:t,i=typeof n==`number`?`${n}px`:n;e.style.maxWidth=r,e.style.maxHeight=i}_setHoverWidgetMaxDimensions(e,t){Km._applyMaxDimensions(this._hover.contentsDomNode,e,t),Km._applyMaxDimensions(this._hover.containerDomNode,e,t),this._hover.containerDomNode.style.setProperty(`--vscode-hover-maxWidth`,typeof e==`number`?`${e}px`:e),this._layoutContentWidget()}_setAdjustedHoverWidgetDimensions(e){this._setHoverWidgetMaxDimensions(`none`,`none`);let t=e.width,n=e.height;this._setHoverWidgetDimensions(t,n)}_updateResizableNodeMaxDimensions(){let e=this._findMaximumRenderingWidth()??1/0,t=this._findMaximumRenderingHeight()??1/0;this._resizableNode.maxSize=new A(e,t),this._setHoverWidgetMaxDimensions(e,t)}_resize(e){Km._lastDimensions=new A(e.width,e.height),this._setAdjustedHoverWidgetDimensions(e),this._resizableNode.layout(e.height,e.width),this._updateResizableNodeMaxDimensions(),this._hover.scrollbar.scanDomNode(),this._editor.layoutContentWidget(this),this._onDidResize.fire()}_findAvailableSpaceVertically(){let e=this._renderedHover?.showAtPosition;if(e)return this._positionPreference===1?this._availableVerticalSpaceAbove(e):this._availableVerticalSpaceBelow(e)}_findMaximumRenderingHeight(){let e=this._findAvailableSpaceVertically();if(!e)return;let t=Jm;return Array.from(this._hover.contentsDomNode.children).forEach(e=>{t+=e.clientHeight}),Math.min(e,t)}_isHoverTextOverflowing(){this._hover.containerDomNode.style.setProperty(`--vscode-hover-whiteSpace`,`nowrap`),this._hover.containerDomNode.style.setProperty(`--vscode-hover-sourceWhiteSpace`,`nowrap`);let e=Array.from(this._hover.contentsDomNode.children).some(e=>e.scrollWidth>e.clientWidth);return this._hover.containerDomNode.style.removeProperty(`--vscode-hover-whiteSpace`),this._hover.containerDomNode.style.removeProperty(`--vscode-hover-sourceWhiteSpace`),e}_findMaximumRenderingWidth(){if(!this._editor||!this._editor.hasModel())return;let e=this._isHoverTextOverflowing(),t=this._contentWidth===void 0?0:this._contentWidth-2;return e||this._hover.containerDomNode.clientWidth<t?jt(this._hover.containerDomNode.ownerDocument.body).width-14:this._hover.containerDomNode.clientWidth+2}isMouseGettingCloser(e,t){if(!this._renderedHover)return!1;if(this._renderedHover.initialMousePosX===void 0||this._renderedHover.initialMousePosY===void 0)return this._renderedHover.initialMousePosX=e,this._renderedHover.initialMousePosY=t,!1;let n=gt(this.getDomNode());this._renderedHover.closestMouseDistance===void 0&&(this._renderedHover.closestMouseDistance=Xm(this._renderedHover.initialMousePosX,this._renderedHover.initialMousePosY,n.left,n.top,n.width,n.height));let r=Xm(e,t,n.left,n.top,n.width,n.height);return r>this._renderedHover.closestMouseDistance+4?!1:(this._renderedHover.closestMouseDistance=Math.min(this._renderedHover.closestMouseDistance,r),!0)}_setRenderedHover(e){this._renderedHover?.dispose(),this._renderedHover=e,this._hoverVisibleKey.set(!!e),this._hover.containerDomNode.classList.toggle(`hidden`,!e)}_updateFont(){let{fontSize:e,lineHeight:t}=this._editor.getOption(50),n=this._hover.contentsDomNode;n.style.fontSize=`${e}px`,n.style.lineHeight=`${t/e}`,Array.prototype.slice.call(this._hover.contentsDomNode.getElementsByClassName(`code`)).forEach(e=>this._editor.applyFontInfo(e))}_updateContent(e){let t=this._hover.contentsDomNode;t.style.paddingBottom=``,t.textContent=``,t.appendChild(e)}_layoutContentWidget(){this._editor.layoutContentWidget(this),this._hover.onContentsChanged()}_updateMaxDimensions(){let e=Math.max(this._editor.getLayoutInfo().height/4,250,Km._lastDimensions.height),t=Math.max(this._editor.getLayoutInfo().width*.66,500,Km._lastDimensions.width);this._setHoverWidgetMaxDimensions(t,e)}_render(e){this._setRenderedHover(e),this._updateFont(),this._updateContent(e.domNode),this._updateMaxDimensions(),this.onContentsChanged(),this._editor.render()}getPosition(){return this._renderedHover?{position:this._renderedHover.showAtPosition,secondaryPosition:this._renderedHover.showAtSecondaryPosition,positionAffinity:this._renderedHover.shouldAppearBeforeContent?3:void 0,preference:[this._positionPreference??1]}:null}show(e){if(!this._editor||!this._editor.hasModel())return;this._render(e);let t=Qe(this._hover.containerDomNode),n=e.showAtPosition;this._positionPreference=this._findPositionPreference(t,n)??1,this.onContentsChanged(),e.shouldFocus&&this._hover.containerDomNode.focus(),this._onDidResize.fire();let r=this._hover.containerDomNode.ownerDocument.activeElement===this._hover.containerDomNode&&Xs(this._configurationService.getValue(`accessibility.verbosity.hover`)===!0&&this._accessibilityService.isScreenReaderOptimized(),this._keybindingService.lookupKeybinding(`editor.action.accessibleView`)?.getAriaLabel()??``);r&&(this._hover.contentsDomNode.ariaLabel=this._hover.contentsDomNode.textContent+`, `+r)}hide(){if(!this._renderedHover)return;let e=this._renderedHover.shouldFocus||this._hoverFocusedKey.get();this._setRenderedHover(void 0),this._resizableNode.maxSize=new A(1/0,1/0),this._resizableNode.clearSashHoverState(),this._hoverFocusedKey.set(!1),this._editor.layoutContentWidget(this),e&&this._editor.focus()}_removeConstraintsRenderNormally(){let e=this._editor.getLayoutInfo();this._resizableNode.layout(e.height,e.width),this._setHoverWidgetDimensions(`auto`,`auto`)}setMinimumDimensions(e){this._minimumSize=new A(Math.max(this._minimumSize.width,e.width),Math.max(this._minimumSize.height,e.height)),this._updateMinimumWidth()}_updateMinimumWidth(){let e=this._contentWidth===void 0?this._minimumSize.width:Math.min(this._contentWidth,this._minimumSize.width);this._resizableNode.minSize=new A(e,this._minimumSize.height)}onContentsChanged(){this._removeConstraintsRenderNormally();let e=this._hover.containerDomNode,t=Qe(e),n=rn(e);if(this._resizableNode.layout(t,n),this._setHoverWidgetDimensions(n,t),t=Qe(e),n=rn(e),this._contentWidth=n,this._updateMinimumWidth(),this._resizableNode.layout(t,n),this._renderedHover?.showAtPosition){let e=Qe(this._hover.containerDomNode);this._positionPreference=this._findPositionPreference(e,this._renderedHover.showAtPosition)}this._layoutContentWidget()}focus(){this._hover.containerDomNode.focus()}scrollUp(){let e=this._hover.scrollbar.getScrollPosition().scrollTop,t=this._editor.getOption(50);this._hover.scrollbar.setScrollPosition({scrollTop:e-t.lineHeight})}scrollDown(){let e=this._hover.scrollbar.getScrollPosition().scrollTop,t=this._editor.getOption(50);this._hover.scrollbar.setScrollPosition({scrollTop:e+t.lineHeight})}scrollLeft(){let e=this._hover.scrollbar.getScrollPosition().scrollLeft;this._hover.scrollbar.setScrollPosition({scrollLeft:e-qm})}scrollRight(){let e=this._hover.scrollbar.getScrollPosition().scrollLeft;this._hover.scrollbar.setScrollPosition({scrollLeft:e+qm})}pageUp(){let e=this._hover.scrollbar.getScrollPosition().scrollTop,t=this._hover.scrollbar.getScrollDimensions().height;this._hover.scrollbar.setScrollPosition({scrollTop:e-t})}pageDown(){let e=this._hover.scrollbar.getScrollPosition().scrollTop,t=this._hover.scrollbar.getScrollDimensions().height;this._hover.scrollbar.setScrollPosition({scrollTop:e+t})}goToTop(){this._hover.scrollbar.setScrollPosition({scrollTop:0})}goToBottom(){this._hover.scrollbar.setScrollPosition({scrollTop:this._hover.scrollbar.getScrollDimensions().scrollHeight})}};Ym=Km=Wm([Gm(1,W),Gm(2,F),Gm(3,_o),Gm(4,ua)],Ym);function Xm(e,t,n,r,i,a){let o=n+i/2,s=r+a/2,c=Math.max(Math.abs(e-o)-i/2,0),l=Math.max(Math.abs(t-s)-a/2,0);return Math.sqrt(c*c+l*l)}var Zm=class e{get anchor(){return this._anchor}set anchor(e){this._anchor=e}get shouldFocus(){return this._shouldFocus}set shouldFocus(e){this._shouldFocus=e}get source(){return this._source}set source(e){this._source=e}get insistOnKeepingHoverVisible(){return this._insistOnKeepingHoverVisible}set insistOnKeepingHoverVisible(e){this._insistOnKeepingHoverVisible=e}constructor(e,t){this._editor=e,this._participants=t,this._anchor=null,this._shouldFocus=!1,this._source=0,this._insistOnKeepingHoverVisible=!1}static _getLineDecorations(e,t){if(t.type!==1&&!t.supportsMarkerHover)return[];let n=e.getModel(),r=t.range.startLineNumber;if(r>n.getLineCount())return[];let i=n.getLineMaxColumn(r);return e.getLineDecorations(r).filter(e=>{if(e.options.isWholeLine)return!0;let n=e.range.startLineNumber===r?e.range.startColumn:1,a=e.range.endLineNumber===r?e.range.endColumn:i;if(e.options.showIfCollapsed){if(n>t.range.startColumn+1||t.range.endColumn-1>a)return!1}else if(n>t.range.startColumn||t.range.endColumn>a)return!1;return!0})}computeAsync(t){let n=this._anchor;if(!this._editor.hasModel()||!n)return Xe.EMPTY;let r=e._getLineDecorations(this._editor,n);return Xe.merge(this._participants.map(e=>e.computeAsync?e.computeAsync(n,r,t):Xe.EMPTY))}computeSync(){if(!this._editor.hasModel()||!this._anchor)return[];let t=e._getLineDecorations(this._editor,this._anchor),n=[];for(let e of this._participants)n=n.concat(e.computeSync(this._anchor,t));return bt(n)}},Qm=class{constructor(e,t,n){this.anchor=e,this.hoverParts=t,this.isComplete=n}filter(e){let t=this.hoverParts.filter(t=>t.isValidForHoverAnchor(e));return t.length===this.hoverParts.length?this:new $m(this,this.anchor,t,this.isComplete)}},$m=class extends Qm{constructor(e,t,n,r){super(t,n,r),this.original=e}filter(e){return this.original.filter(e)}},eh=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},th=function(e,t){return function(n,r){t(n,r,e)}},nh=O,rh=class extends _{get hasContent(){return this._hasContent}constructor(e){super(),this._keybindingService=e,this.actions=[],this._hasContent=!1,this.hoverElement=nh(`div.hover-row.status-bar`),this.hoverElement.tabIndex=0,this.actionsElement=M(this.hoverElement,nh(`div.actions`))}addAction(e){let t=this._keybindingService.lookupKeybinding(e.commandId),n=t?t.getLabel():null;this._hasContent=!0;let r=this._register(Da.render(this.actionsElement,e,n));return this.actions.push(r),r}append(e){let t=M(this.actionsElement,e);return this._hasContent=!0,t}};rh=eh([th(0,ua)],rh);var ih=class{constructor(e,t,n){this.provider=e,this.hover=t,this.ordinal=n}};async function ah(e,t,n,r,i){let a=await Promise.resolve(e.provideHover(n,r,i)).catch(Re);if(!(!a||!ch(a)))return new ih(e,a,t)}function oh(e,t,n,r,i=!1){let a=e.ordered(t,i).map((e,i)=>ah(e,i,t,n,r));return Xe.fromPromises(a).coalesce()}function sh(e,t,n,r,i=!1){return oh(e,t,n,r,i).map(e=>e.hover).toPromise()}Pi(`_executeHoverProvider`,(e,t,n)=>sh(e.get(V).hoverProvider,t,n,w.None)),Pi(`_executeHoverProvider_recursive`,(e,t,n)=>sh(e.get(V).hoverProvider,t,n,w.None,!0));function ch(e){let t=e.range!==void 0,n=e.contents!==void 0&&e.contents&&e.contents.length>0;return t&&n}var lh=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},uh=function(e,t){return function(n,r){t(n,r,e)}},dh=O,fh=ri(`hover-increase-verbosity`,i.add,S(`increaseHoverVerbosity`,`Icon for increaseing hover verbosity.`)),ph=ri(`hover-decrease-verbosity`,i.remove,S(`decreaseHoverVerbosity`,`Icon for decreasing hover verbosity.`)),mh=class{constructor(e,t,n,r,i,a=void 0){this.owner=e,this.range=t,this.contents=n,this.isBeforeContent=r,this.ordinal=i,this.source=a}isValidForHoverAnchor(e){return e.type===1&&this.range.startColumn<=e.range.startColumn&&this.range.endColumn>=e.range.endColumn}},hh=class{constructor(e,t,n){this.hover=e,this.hoverProvider=t,this.hoverPosition=n}supportsVerbosityAction(e){switch(e){case ze.Increase:return this.hover.canIncreaseVerbosity??!1;case ze.Decrease:return this.hover.canDecreaseVerbosity??!1}}},gh=class{constructor(e,t,n,r,i,a,o,s){this._editor=e,this._languageService=t,this._openerService=n,this._configurationService=r,this._languageFeaturesService=i,this._keybindingService=a,this._hoverService=o,this._commandService=s,this.hoverOrdinal=3}createLoadingMessage(e){return new mh(this,e.range,[new Va().appendText(S(`modesContentHover.loading`,`Loading...`))],!1,2e3)}computeSync(e,t){if(!this._editor.hasModel()||e.type!==1)return[];let n=this._editor.getModel(),r=e.range.startLineNumber,i=n.getLineMaxColumn(r),a=[],o=1e3,s=n.getLineLength(r),c=n.getLanguageIdAtPosition(e.range.startLineNumber,e.range.startColumn),l=this._editor.getOption(118),u=this._configurationService.getValue(`editor.maxTokenizationLineLength`,{overrideIdentifier:c}),d=!1;l>=0&&s>l&&e.range.startColumn>=l&&(d=!0,a.push(new mh(this,e.range,[{value:S(`stopped rendering`,"Rendering paused for long line for performance reasons. This can be configured via `editor.stopRenderingLineAfter`.")}],!1,o++))),!d&&typeof u==`number`&&s>=u&&a.push(new mh(this,e.range,[{value:S(`too many characters`,"Tokenization is skipped for long lines for performance reasons. This can be configured via `editor.maxTokenizationLineLength`.")}],!1,o++));let f=!1;for(let n of t){let t=n.range.startLineNumber===r?n.range.startColumn:1,s=n.range.endLineNumber===r?n.range.endColumn:i,c=n.options.hoverMessage;if(!c||Xr(c))continue;n.options.beforeContentClassName&&(f=!0);let l=new T(e.range.startLineNumber,t,e.range.startLineNumber,s);a.push(new mh(this,l,lt(c),f,o++))}return a}computeAsync(e,t,n){if(!this._editor.hasModel()||e.type!==1)return Xe.EMPTY;let r=this._editor.getModel(),i=this._languageFeaturesService.hoverProvider;return i.has(r)?this._getMarkdownHovers(i,r,e,n):Xe.EMPTY}_getMarkdownHovers(e,t,n,r){let i=n.range.getStartPosition();return oh(e,t,i,r).filter(e=>!Xr(e.hover.contents)).map(e=>{let t=e.hover.range?T.lift(e.hover.range):n.range,r=new hh(e.hover,e.provider,i);return new mh(this,t,e.hover.contents,!1,e.ordinal,r)})}renderHoverParts(e,t){return this._renderedHoverParts=new vh(t,e.fragment,this,this._editor,this._languageService,this._openerService,this._commandService,this._keybindingService,this._hoverService,this._configurationService,e.onContentsChanged),this._renderedHoverParts}updateMarkdownHoverVerbosityLevel(e,t,n){return Promise.resolve(this._renderedHoverParts?.updateMarkdownHoverPartVerbosityLevel(e,t,n))}};gh=lh([uh(1,Ys),uh(2,wi),uh(3,F),uh(4,V),uh(5,ua),uh(6,oi),uh(7,lc)],gh);var _h=class{constructor(e,t,n){this.hoverPart=e,this.hoverElement=t,this.disposables=n}dispose(){this.disposables.dispose()}},vh=class{constructor(e,t,r,i,a,o,s,c,l,u,d){this._hoverParticipant=r,this._editor=i,this._languageService=a,this._openerService=o,this._commandService=s,this._keybindingService=c,this._hoverService=l,this._configurationService=u,this._onFinishedRendering=d,this._ongoingHoverOperations=new Map,this._disposables=new n,this.renderedHoverParts=this._renderHoverParts(e,t,this._onFinishedRendering),this._disposables.add(b(()=>{this.renderedHoverParts.forEach(e=>{e.dispose()}),this._ongoingHoverOperations.forEach(e=>{e.tokenSource.dispose(!0)})}))}_renderHoverParts(e,t,n){return e.sort(cn(e=>e.ordinal,mr)),e.map(e=>{let r=this._renderHoverPart(e,n);return t.appendChild(r.hoverElement),r})}_renderHoverPart(e,t){let r=this._renderMarkdownHover(e,t),i=r.hoverElement,a=e.source,o=new n;if(o.add(r),!a)return new _h(e,i,o);let s=a.supportsVerbosityAction(ze.Increase),c=a.supportsVerbosityAction(ze.Decrease);if(!s&&!c)return new _h(e,i,o);let l=dh(`div.verbosity-actions`);return i.prepend(l),o.add(this._renderHoverExpansionAction(l,ze.Increase,s)),o.add(this._renderHoverExpansionAction(l,ze.Decrease,c)),new _h(e,i,o)}_renderMarkdownHover(e,t){return bh(this._editor,e,this._languageService,this._openerService,t)}_renderHoverExpansionAction(e,t,r){let i=new n,a=t===ze.Increase,o=M(e,dh(J.asCSSSelector(a?fh:ph)));o.tabIndex=0;let s=new ho(`mouse`,!1,{target:e,position:{hoverPosition:0}},this._configurationService,this._hoverService);if(i.add(this._hoverService.setupManagedHover(s,o,xh(this._keybindingService,t))),!r)return o.classList.add(`disabled`),i;o.classList.add(`enabled`);let c=()=>this._commandService.executeCommand(t===ze.Increase?xm:Cm);return i.add(new vi(o,c)),i.add(new ei(o,c,[3,10])),i}async updateMarkdownHoverPartVerbosityLevel(e,t,n=!0){let r=this._editor.getModel();if(!r)return;let i=this._getRenderedHoverPartAtIndex(t),a=i?.hoverPart.source;if(!i||!a?.supportsVerbosityAction(e))return;let o=await this._fetchHover(a,r,e);if(!o)return;let s=new hh(o,a.hoverProvider,a.hoverPosition),c=i.hoverPart,l=new mh(this._hoverParticipant,c.range,o.contents,c.isBeforeContent,c.ordinal,s),u=this._renderHoverPart(l,this._onFinishedRendering);return this._replaceRenderedHoverPartAtIndex(t,u,l),n&&this._focusOnHoverPartWithIndex(t),{hoverPart:l,hoverElement:u.hoverElement}}async _fetchHover(e,t,n){let r=n===ze.Increase?1:-1,i=e.hoverProvider,a=this._ongoingHoverOperations.get(i);a&&(a.tokenSource.cancel(),r+=a.verbosityDelta);let o=new ie;this._ongoingHoverOperations.set(i,{verbosityDelta:r,tokenSource:o});let s={verbosityRequest:{verbosityDelta:r,previousHover:e.hover}},c;try{c=await Promise.resolve(i.provideHover(t,e.hoverPosition,o.token,s))}catch(e){Re(e)}return o.dispose(),this._ongoingHoverOperations.delete(i),c}_replaceRenderedHoverPartAtIndex(e,t,n){if(e>=this.renderedHoverParts.length||e<0)return;let r=this.renderedHoverParts[e],i=r.hoverElement,a=t.hoverElement,o=Array.from(a.children);i.replaceChildren(...o);let s=new _h(n,i,t.disposables);i.focus(),r.dispose(),this.renderedHoverParts[e]=s}_focusOnHoverPartWithIndex(e){this.renderedHoverParts[e].hoverElement.focus()}_getRenderedHoverPartAtIndex(e){return this.renderedHoverParts[e]}dispose(){this._disposables.dispose()}};function yh(e,t,n,r,i){t.sort(cn(e=>e.ordinal,mr));let a=[];for(let o of t)a.push(bh(n,o,r,i,e.onContentsChanged));return new lm(a)}function bh(e,t,r,i,a){let o=new n,s=dh(`div.hover-row`),c=dh(`div.hover-row-contents`);s.appendChild(c);let l=t.contents;for(let t of l){if(Xr(t))continue;let n=dh(`div.markdown-hover`),s=M(n,dh(`div.hover-contents`)),l=o.add(new Hi({editor:e},r,i));o.add(l.onDidRenderAsync(()=>{s.className=`hover-contents code-hover-contents`,a()}));let u=o.add(l.render(t));s.appendChild(u.element),c.appendChild(n)}return{hoverPart:t,hoverElement:s,dispose(){o.dispose()}}}function xh(e,t){switch(t){case ze.Increase:{let t=e.lookupKeybinding(xm);return t?S(`increaseVerbosityWithKb`,`Increase Hover Verbosity ({0})`,t.getLabel()):S(`increaseVerbosity`,`Increase Hover Verbosity`)}case ze.Decrease:{let t=e.lookupKeybinding(Cm);return t?S(`decreaseVerbosityWithKb`,`Decrease Hover Verbosity ({0})`,t.getLabel()):S(`decreaseVerbosity`,`Decrease Hover Verbosity`)}}}function Sh(e,t){return!!e[t]}var Ch=class{constructor(e,t){this.target=e.target,this.isLeftClick=e.event.leftButton,this.isMiddleClick=e.event.middleButton,this.isRightClick=e.event.rightButton,this.hasTriggerModifier=Sh(e.event,t.triggerModifier),this.hasSideBySideModifier=Sh(e.event,t.triggerSideBySideModifier),this.isNoneOrSingleMouseDown=e.event.detail<=1}},wh=class{constructor(e,t){this.keyCodeIsTriggerKey=e.keyCode===t.triggerKey,this.keyCodeIsSideBySideKey=e.keyCode===t.triggerSideBySideKey,this.hasTriggerModifier=Sh(e,t.triggerModifier)}},Th=class{constructor(e,t,n,r){this.triggerKey=e,this.triggerModifier=t,this.triggerSideBySideKey=n,this.triggerSideBySideModifier=r}equals(e){return this.triggerKey===e.triggerKey&&this.triggerModifier===e.triggerModifier&&this.triggerSideBySideKey===e.triggerSideBySideKey&&this.triggerSideBySideModifier===e.triggerSideBySideModifier}};function Eh(e){return e===`altKey`?Le?new Th(57,`metaKey`,6,`altKey`):new Th(5,`ctrlKey`,6,`altKey`):Le?new Th(6,`altKey`,57,`metaKey`):new Th(6,`altKey`,5,`ctrlKey`)}var Dh=class extends _{constructor(e,t){super(),this._onMouseMoveOrRelevantKeyDown=this._register(new g),this.onMouseMoveOrRelevantKeyDown=this._onMouseMoveOrRelevantKeyDown.event,this._onExecute=this._register(new g),this.onExecute=this._onExecute.event,this._onCancel=this._register(new g),this.onCancel=this._onCancel.event,this._editor=e,this._extractLineNumberFromMouseEvent=t?.extractLineNumberFromMouseEvent??(e=>e.target.position?e.target.position.lineNumber:0),this._opts=Eh(this._editor.getOption(78)),this._lastMouseMoveEvent=null,this._hasTriggerKeyOnMouseDown=!1,this._lineNumberOnMouseDown=0,this._register(this._editor.onDidChangeConfiguration(e=>{if(e.hasChanged(78)){let e=Eh(this._editor.getOption(78));if(this._opts.equals(e))return;this._opts=e,this._lastMouseMoveEvent=null,this._hasTriggerKeyOnMouseDown=!1,this._lineNumberOnMouseDown=0,this._onCancel.fire()}})),this._register(this._editor.onMouseMove(e=>this._onEditorMouseMove(new Ch(e,this._opts)))),this._register(this._editor.onMouseDown(e=>this._onEditorMouseDown(new Ch(e,this._opts)))),this._register(this._editor.onMouseUp(e=>this._onEditorMouseUp(new Ch(e,this._opts)))),this._register(this._editor.onKeyDown(e=>this._onEditorKeyDown(new wh(e,this._opts)))),this._register(this._editor.onKeyUp(e=>this._onEditorKeyUp(new wh(e,this._opts)))),this._register(this._editor.onMouseDrag(()=>this._resetHandler())),this._register(this._editor.onDidChangeCursorSelection(e=>this._onDidChangeCursorSelection(e))),this._register(this._editor.onDidChangeModel(e=>this._resetHandler())),this._register(this._editor.onDidChangeModelContent(()=>this._resetHandler())),this._register(this._editor.onDidScrollChange(e=>{(e.scrollTopChanged||e.scrollLeftChanged)&&this._resetHandler()}))}_onDidChangeCursorSelection(e){e.selection&&e.selection.startColumn!==e.selection.endColumn&&this._resetHandler()}_onEditorMouseMove(e){this._lastMouseMoveEvent=e,this._onMouseMoveOrRelevantKeyDown.fire([e,null])}_onEditorMouseDown(e){this._hasTriggerKeyOnMouseDown=e.hasTriggerModifier,this._lineNumberOnMouseDown=this._extractLineNumberFromMouseEvent(e)}_onEditorMouseUp(e){let t=this._extractLineNumberFromMouseEvent(e);this._hasTriggerKeyOnMouseDown&&this._lineNumberOnMouseDown&&this._lineNumberOnMouseDown===t&&this._onExecute.fire(e)}_onEditorKeyDown(e){this._lastMouseMoveEvent&&(e.keyCodeIsTriggerKey||e.keyCodeIsSideBySideKey&&e.hasTriggerModifier)?this._onMouseMoveOrRelevantKeyDown.fire([this._lastMouseMoveEvent,e]):e.hasTriggerModifier&&this._onCancel.fire()}_onEditorKeyUp(e){e.keyCodeIsTriggerKey&&this._onCancel.fire()}_resetHandler(){this._lastMouseMoveEvent=null,this._hasTriggerKeyOnMouseDown=!1,this._onCancel.fire()}},Oh=class{constructor(e,t){this.range=e,this.direction=t}},kh=class e{constructor(e,t,n){this.hint=e,this.anchor=t,this.provider=n,this._isResolved=!1}with(t){let n=new e(this.hint,t.anchor,this.provider);return n._isResolved=this._isResolved,n._currentResolve=this._currentResolve,n}async resolve(e){if(typeof this.provider.resolveInlayHint==`function`){if(this._currentResolve)return await this._currentResolve,e.isCancellationRequested?void 0:this.resolve(e);this._isResolved||(this._currentResolve=this._doResolve(e).finally(()=>this._currentResolve=void 0)),await this._currentResolve}}async _doResolve(e){try{let t=await Promise.resolve(this.provider.resolveInlayHint(this.hint,e));this.hint.tooltip=t?.tooltip??this.hint.tooltip,this.hint.label=t?.label??this.hint.label,this.hint.textEdits=t?.textEdits??this.hint.textEdits,this._isResolved=!0}catch(e){Re(e),this._isResolved=!1}}},Ah=class e{static#e=this._emptyInlayHintList=Object.freeze({dispose(){},hints:[]});static async create(t,n,r,i){let a=[],o=t.ordered(n).reverse().map(t=>r.map(async r=>{try{let o=await t.provideInlayHints(n,r,i);(o?.hints.length||t.onDidChangeInlayHints)&&a.push([o??e._emptyInlayHintList,t])}catch(e){Re(e)}}));if(await Promise.all(o.flat()),i.isCancellationRequested||n.isDisposed())throw new ge;return new e(r,a,n)}constructor(t,i,a){this._disposables=new n,this.ranges=t,this.provider=new Set;let o=[];for(let[t,n]of i){this._disposables.add(t),this.provider.add(n);for(let r of t.hints){let t=a.validatePosition(r.position),i=`before`,s=e._getRangeAtPosition(a,t),c;s.getStartPosition().isBefore(t)?(c=T.fromPositions(s.getStartPosition(),t),i=`after`):(c=T.fromPositions(t,s.getEndPosition()),i=`before`),o.push(new kh(r,new Oh(c,i),n))}}this.items=o.sort((e,t)=>r.compare(e.hint.position,t.hint.position))}dispose(){this._disposables.dispose()}static _getRangeAtPosition(e,t){let n=t.lineNumber,r=e.getWordAtPosition(t);if(r)return new T(n,r.startColumn,n,r.endColumn);e.tokenization.tokenizeIfCheap(n);let i=e.tokenization.getLineTokens(n),a=t.column-1,o=i.findTokenIndexAtOffset(a),s=i.getStartOffset(o),c=i.getEndOffset(o);return c-s===1&&(s===a&&o>1?(s=i.getStartOffset(o-1),c=i.getEndOffset(o-1)):c===a&&o<i.getCount()-1&&(s=i.getStartOffset(o+1),c=i.getEndOffset(o+1))),new T(n,s+1,n,c+1)}};function jh(e){return y.from({scheme:Bt.command,path:e.id,query:e.arguments&&encodeURIComponent(JSON.stringify(e.arguments))}).toString()}var Mh=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Nh=function(e,t){return function(n,r){t(n,r,e)}},Ph=class extends jo{constructor(e,t,n,r,i,a,o,s,c,l,u,d,f){super(e,{...r.getRawOptions(),overflowWidgetsDomNode:r.getOverflowWidgetsDomNode()},n,i,a,o,s,c,l,u,d,f),this._parentEditor=r,this._overwriteOptions=t,super.updateOptions(this._overwriteOptions),this._register(r.onDidChangeConfiguration(e=>this._onParentConfigurationChanged(e)))}getParentEditor(){return this._parentEditor}_onParentConfigurationChanged(e){super.updateOptions(this._parentEditor.getRawOptions()),super.updateOptions(this._overwriteOptions)}updateOptions(e){Ze(this._overwriteOptions,e,!0),super.updateOptions(this._overwriteOptions)}};Ph=Mh([Nh(4,Y),Nh(5,Ko),Nh(6,lc),Nh(7,W),Nh(8,Zc),Nh(9,Ro),Nh(10,_o),Nh(11,Ci),Nh(12,V)],Ph);var Fh=new E(new Rn(0,122,204)),Ih={showArrow:!0,showFrame:!0,className:``,frameColor:Fh,arrowColor:Fh,keepEditorSelection:!1},Lh=`vs.editor.contrib.zoneWidget`,Rh=class{constructor(e,t,n,r,i,a,o,s){this.id=``,this.domNode=e,this.afterLineNumber=t,this.afterColumn=n,this.heightInLines=r,this.showInHiddenAreas=o,this.ordinal=s,this._onDomNodeTop=i,this._onComputedHeight=a}onDomNodeTop(e){this._onDomNodeTop(e)}onComputedHeight(e){this._onComputedHeight(e)}},zh=class{constructor(e,t){this._id=e,this._domNode=t}getId(){return this._id}getDomNode(){return this._domNode}getPosition(){return null}},Bh=class e{static#e=this._IdGenerator=new ko(`.arrow-decoration-`);constructor(t){this._editor=t,this._ruleName=e._IdGenerator.nextId(),this._decorations=this._editor.createDecorationsCollection(),this._color=null,this._height=-1}dispose(){this.hide(),ir(this._ruleName)}set color(e){this._color!==e&&(this._color=e,this._updateStyle())}set height(e){this._height!==e&&(this._height=e,this._updateStyle())}_updateStyle(){ir(this._ruleName),ot(`.monaco-editor ${this._ruleName}`,`border-style: solid; border-color: transparent; border-bottom-color: ${this._color}; border-width: ${this._height}px; bottom: -${this._height}px !important; margin-left: -${this._height}px; `)}show(e){e.column===1&&(e={lineNumber:e.lineNumber,column:2}),this._decorations.set([{range:T.fromPositions(e),options:{description:`zone-widget-arrow`,className:this._ruleName,stickiness:1}}])}hide(){this._decorations.clear()}},Vh=class{constructor(e,t={}){this._arrow=null,this._overlayWidget=null,this._resizeSash=null,this._viewZone=null,this._disposables=new n,this.container=null,this._isShowing=!1,this.editor=e,this._positionMarkerId=this.editor.createDecorationsCollection(),this.options=ht(t),Ze(this.options,Ih,!1),this.domNode=document.createElement(`div`),this.options.isAccessible||(this.domNode.setAttribute(`aria-hidden`,`true`),this.domNode.setAttribute(`role`,`presentation`)),this._disposables.add(this.editor.onDidLayoutChange(e=>{let t=this._getWidth(e);this.domNode.style.width=t+`px`,this.domNode.style.left=this._getLeft(e)+`px`,this._onWidth(t)}))}dispose(){this._overlayWidget&&=(this.editor.removeOverlayWidget(this._overlayWidget),null),this._viewZone&&this.editor.changeViewZones(e=>{this._viewZone&&e.removeZone(this._viewZone.id),this._viewZone=null}),this._positionMarkerId.clear(),this._disposables.dispose()}create(){this.domNode.classList.add(`zone-widget`),this.options.className&&this.domNode.classList.add(this.options.className),this.container=document.createElement(`div`),this.container.classList.add(`zone-widget-container`),this.domNode.appendChild(this.container),this.options.showArrow&&(this._arrow=new Bh(this.editor),this._disposables.add(this._arrow)),this._fillContainer(this.container),this._initSash(),this._applyStyles()}style(e){e.frameColor&&(this.options.frameColor=e.frameColor),e.arrowColor&&(this.options.arrowColor=e.arrowColor),this._applyStyles()}_applyStyles(){if(this.container&&this.options.frameColor){let e=this.options.frameColor.toString();this.container.style.borderTopColor=e,this.container.style.borderBottomColor=e}if(this._arrow&&this.options.arrowColor){let e=this.options.arrowColor.toString();this._arrow.color=e}}_getWidth(e){return e.width-e.minimap.minimapWidth-e.verticalScrollbarWidth}_getLeft(e){return e.minimap.minimapWidth>0&&e.minimap.minimapLeft===0?e.minimap.minimapWidth:0}_onViewZoneTop(e){this.domNode.style.top=e+`px`}_onViewZoneHeight(e){if(this.domNode.style.height=`${e}px`,this.container){let t=e-this._decoratingElementsHeight();this.container.style.height=`${t}px`;let n=this.editor.getLayoutInfo();this._doLayout(t,this._getWidth(n))}this._resizeSash?.layout()}get position(){let e=this._positionMarkerId.getRange(0);if(e)return e.getStartPosition()}show(e,t){let n=T.isIRange(e)?T.lift(e):T.fromPositions(e);this._isShowing=!0,this._showImpl(n,t),this._isShowing=!1,this._positionMarkerId.set([{range:n,options:U.EMPTY}])}hide(){this._viewZone&&=(this.editor.changeViewZones(e=>{this._viewZone&&e.removeZone(this._viewZone.id)}),null),this._overlayWidget&&=(this.editor.removeOverlayWidget(this._overlayWidget),null),this._arrow?.hide(),this._positionMarkerId.clear()}_decoratingElementsHeight(){let e=this.editor.getOption(67),t=0;if(this.options.showArrow){let n=Math.round(e/3);t+=2*n}if(this.options.showFrame){let n=Math.round(e/9);t+=2*n}return t}_showImpl(e,t){let n=e.getStartPosition(),r=this.editor.getLayoutInfo(),i=this._getWidth(r);this.domNode.style.width=`${i}px`,this.domNode.style.left=this._getLeft(r)+`px`;let a=document.createElement(`div`);a.style.overflow=`hidden`;let o=this.editor.getOption(67);if(!this.options.allowUnlimitedHeight){let e=Math.max(12,this.editor.getLayoutInfo().height/o*.8);t=Math.min(t,e)}let s=0,c=0;if(this._arrow&&this.options.showArrow&&(s=Math.round(o/3),this._arrow.height=s,this._arrow.show(n)),this.options.showFrame&&(c=Math.round(o/9)),this.editor.changeViewZones(e=>{this._viewZone&&e.removeZone(this._viewZone.id),this._overlayWidget&&=(this.editor.removeOverlayWidget(this._overlayWidget),null),this.domNode.style.top=`-1000px`,this._viewZone=new Rh(a,n.lineNumber,n.column,t,e=>this._onViewZoneTop(e),e=>this._onViewZoneHeight(e),this.options.showInHiddenAreas,this.options.ordinal),this._viewZone.id=e.addZone(this._viewZone),this._overlayWidget=new zh(Lh+this._viewZone.id,this.domNode),this.editor.addOverlayWidget(this._overlayWidget)}),this.container&&this.options.showFrame){let e=this.options.frameWidth?this.options.frameWidth:c;this.container.style.borderTopWidth=e+`px`,this.container.style.borderBottomWidth=e+`px`}let l=t*o-this._decoratingElementsHeight();this.container&&(this.container.style.top=s+`px`,this.container.style.height=l+`px`,this.container.style.overflow=`hidden`),this._doLayout(l,i),this.options.keepEditorSelection||this.editor.setSelection(e);let u=this.editor.getModel();if(u){let t=u.validateRange(new T(e.startLineNumber,1,e.endLineNumber+1,1));this.revealRange(t,t.startLineNumber===u.getLineCount())}}revealRange(e,t){t?this.editor.revealLineNearTop(e.endLineNumber,0):this.editor.revealRange(e,0)}setCssClass(e,t){this.container&&(t&&this.container.classList.remove(t),this.container.classList.add(e))}_onWidth(e){}_doLayout(e,t){}_relayout(e){this._viewZone&&this._viewZone.heightInLines!==e&&this.editor.changeViewZones(t=>{this._viewZone&&(this._viewZone.heightInLines=e,t.layoutZone(this._viewZone.id))})}_initSash(){if(this._resizeSash)return;this._resizeSash=this._disposables.add(new zc(this.domNode,this,{orientation:1})),this.options.isResizeable||(this._resizeSash.state=0);let e;this._disposables.add(this._resizeSash.onDidStart(t=>{this._viewZone&&(e={startY:t.startY,heightInLines:this._viewZone.heightInLines})})),this._disposables.add(this._resizeSash.onDidEnd(()=>{e=void 0})),this._disposables.add(this._resizeSash.onDidChange(t=>{if(e){let n=(t.currentY-e.startY)/this.editor.getOption(67),r=n<0?Math.ceil(n):Math.floor(n),i=e.heightInLines+r;i>5&&i<35&&this._relayout(i)}}))}getHorizontalSashLeft(){return 0}getHorizontalSashTop(){return(this.domNode.style.height===null?0:parseInt(this.domNode.style.height))-this._decoratingElementsHeight()/2}getHorizontalSashWidth(){let e=this.editor.getLayoutInfo();return e.width-e.minimap.minimapWidth}},Hh=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Uh=function(e,t){return function(n,r){t(n,r,e)}};const Wh=kl(`IPeekViewService`);$r(Wh,class{constructor(){this._widgets=new Map}addExclusiveWidget(e,t){let n=this._widgets.get(e);n&&(n.listener.dispose(),n.widget.dispose()),this._widgets.set(e,{widget:t,listener:t.onDidClose(()=>{let n=this._widgets.get(e);n&&n.widget===t&&(n.listener.dispose(),this._widgets.delete(e))})})}},1);var Gh;(function(e){e.inPeekEditor=new G(`inReferenceSearchEditor`,!0,S(`inReferenceSearchEditor`,`Whether the current code editor is embedded inside peek`)),e.notInPeekEditor=e.inPeekEditor.toNegated()})(Gh||={});var Kh=class{static#e=this.ID=`editor.contrib.referenceController`;constructor(e,t){e instanceof Ph&&Gh.inPeekEditor.bindTo(t)}dispose(){}};Kh=Hh([Uh(1,W)],Kh),I(Kh.ID,Kh,0);function qh(e){let t=e.get(Ko).getFocusedCodeEditor();return t instanceof Ph?t.getParentEditor():t}var Jh={headerBackgroundColor:E.white,primaryHeadingColor:E.fromHex(`#333333`),secondaryHeadingColor:E.fromHex(`#6c6c6cb3`)},Yh=class extends Vh{constructor(e,t,n){super(e,t),this.instantiationService=n,this._onDidClose=new g,this.onDidClose=this._onDidClose.event,Ze(this.options,Jh,!1)}dispose(){this.disposed||(this.disposed=!0,super.dispose(),this._onDidClose.fire(this))}style(e){let t=this.options;e.headerBackgroundColor&&(t.headerBackgroundColor=e.headerBackgroundColor),e.primaryHeadingColor&&(t.primaryHeadingColor=e.primaryHeadingColor),e.secondaryHeadingColor&&(t.secondaryHeadingColor=e.secondaryHeadingColor),super.style(e)}_applyStyles(){super._applyStyles();let e=this.options;this._headElement&&e.headerBackgroundColor&&(this._headElement.style.backgroundColor=e.headerBackgroundColor.toString()),this._primaryHeading&&e.primaryHeadingColor&&(this._primaryHeading.style.color=e.primaryHeadingColor.toString()),this._secondaryHeading&&e.secondaryHeadingColor&&(this._secondaryHeading.style.color=e.secondaryHeadingColor.toString()),this._bodyElement&&e.frameColor&&(this._bodyElement.style.borderColor=e.frameColor.toString())}_fillContainer(e){this.setCssClass(`peekview-widget`),this._headElement=O(`.head`),this._bodyElement=O(`.body`),this._fillHead(this._headElement),this._fillBody(this._bodyElement),e.appendChild(this._headElement),e.appendChild(this._bodyElement)}_fillHead(e,t){this._titleElement=O(`.peekview-title`),this.options.supportOnTitleClick&&(this._titleElement.classList.add(`clickable`),Gn(this._titleElement,`click`,e=>this._onTitleClick(e))),M(this._headElement,this._titleElement),this._fillTitleIcon(this._titleElement),this._primaryHeading=O(`span.filename`),this._secondaryHeading=O(`span.dirname`),this._metaHeading=O(`span.meta`),M(this._titleElement,this._primaryHeading,this._secondaryHeading,this._metaHeading);let n=O(`.peekview-actions`);M(this._headElement,n),this._actionbarWidget=new hl(n,this._getActionBarOptions()),this._disposables.add(this._actionbarWidget),t||this._actionbarWidget.push(new hs(`peekview.close`,S(`label.close`,`Close`),J.asClassName(i.close),!0,()=>(this.dispose(),Promise.resolve())),{label:!1,icon:!0})}_fillTitleIcon(e){}_getActionBarOptions(){return{actionViewItemProvider:yi.bind(void 0,this.instantiationService),orientation:0}}_onTitleClick(e){}setTitle(e,t){this._primaryHeading&&this._secondaryHeading&&(this._primaryHeading.innerText=e,this._primaryHeading.setAttribute(`title`,e),t?this._secondaryHeading.innerText=t:Fr(this._secondaryHeading))}setMetaTitle(e){this._metaHeading&&(e?(this._metaHeading.innerText=e,Cn(this._metaHeading)):yr(this._metaHeading))}_doLayout(e,t){if(!this._isShowing&&e<0){this.dispose();return}let n=Math.ceil(this.editor.getOption(67)*1.2),r=Math.round(e-(n+2));this._doLayoutHead(n,t),this._doLayoutBody(r,t)}_doLayoutHead(e,t){this._headElement&&(this._headElement.style.height=`${e}px`,this._headElement.style.lineHeight=this._headElement.style.height)}_doLayoutBody(e,t){this._bodyElement&&(this._bodyElement.style.height=`${e}px`)}};Yh=Hh([Uh(2,Y)],Yh);const Xh=k(`peekViewTitle.background`,{dark:`#252526`,light:`#F3F3F3`,hcDark:E.black,hcLight:E.white},S(`peekViewTitleBackground`,`Background color of the peek view title area.`)),Zh=k(`peekViewTitleLabel.foreground`,{dark:E.white,light:E.black,hcDark:E.white,hcLight:zn},S(`peekViewTitleForeground`,`Color of the peek view title.`)),Qh=k(`peekViewTitleDescription.foreground`,{dark:`#ccccccb3`,light:`#616161`,hcDark:`#FFFFFF99`,hcLight:`#292929`},S(`peekViewTitleInfoForeground`,`Color of the peek view title info.`)),$h=k(`peekView.border`,{dark:pr,light:pr,hcDark:kt,hcLight:kt},S(`peekViewBorder`,`Color of the peek view borders and arrow.`)),eg=k(`peekViewResult.background`,{dark:`#252526`,light:`#F3F3F3`,hcDark:E.black,hcLight:E.white},S(`peekViewResultsBackground`,`Background color of the peek view result list.`));k(`peekViewResult.lineForeground`,{dark:`#bbbbbb`,light:`#646465`,hcDark:E.white,hcLight:zn},S(`peekViewResultsMatchForeground`,`Foreground color for line nodes in the peek view result list.`)),k(`peekViewResult.fileForeground`,{dark:E.white,light:`#1E1E1E`,hcDark:E.white,hcLight:zn},S(`peekViewResultsFileForeground`,`Foreground color for file nodes in the peek view result list.`)),k(`peekViewResult.selectionBackground`,{dark:`#3399ff33`,light:`#3399ff33`,hcDark:null,hcLight:null},S(`peekViewResultsSelectionBackground`,`Background color of the selected entry in the peek view result list.`)),k(`peekViewResult.selectionForeground`,{dark:E.white,light:`#6C6C6C`,hcDark:E.white,hcLight:zn},S(`peekViewResultsSelectionForeground`,`Foreground color of the selected entry in the peek view result list.`));const tg=k(`peekViewEditor.background`,{dark:`#001F33`,light:`#F2F8FC`,hcDark:E.black,hcLight:E.white},S(`peekViewEditorBackground`,`Background color of the peek view editor.`));k(`peekViewEditorGutter.background`,tg,S(`peekViewEditorGutterBackground`,`Background color of the gutter in the peek view editor.`)),k(`peekViewEditorStickyScroll.background`,tg,S(`peekViewEditorStickScrollBackground`,`Background color of sticky scroll in the peek view editor.`)),k(`peekViewResult.matchHighlightBackground`,{dark:`#ea5c004d`,light:`#ea5c004d`,hcDark:null,hcLight:null},S(`peekViewResultsMatchHighlight`,`Match highlight color in the peek view result list.`)),k(`peekViewEditor.matchHighlightBackground`,{dark:`#ff8f0099`,light:`#f5d802de`,hcDark:null,hcLight:null},S(`peekViewEditorMatchHighlight`,`Match highlight color in the peek view editor.`)),k(`peekViewEditor.matchHighlightBorder`,{dark:null,light:null,hcDark:_t,hcLight:_t},S(`peekViewEditorMatchHighlightBorder`,`Match highlight border in the peek view editor.`));var ng=class{constructor(e,t,n,r){this.isProviderFirst=e,this.parent=t,this.link=n,this._rangeCallback=r,this.id=Bo.nextId()}get uri(){return this.link.uri}get range(){return this._range??this.link.targetSelectionRange??this.link.range}set range(e){this._range=e,this._rangeCallback(this)}get ariaMessage(){let e=this.parent.getPreview(this)?.preview(this.range);return e?S({key:`aria.oneReference.preview`,comment:[`Placeholders are: 0: filename, 1:line number, 2: column number, 3: preview snippet of source code`]},`{0} in {1} on line {2} at column {3}`,e.value,bc(this.uri),this.range.startLineNumber,this.range.startColumn):S(`aria.oneReference`,`in {0} on line {1} at column {2}`,bc(this.uri),this.range.startLineNumber,this.range.startColumn)}},rg=class{constructor(e){this._modelReference=e}dispose(){this._modelReference.dispose()}preview(e,t=8){let n=this._modelReference.object.textEditorModel;if(!n)return;let{startLineNumber:r,startColumn:i,endLineNumber:a,endColumn:o}=e,s=new T(r,n.getWordUntilPosition({lineNumber:r,column:i-t}).startColumn,r,i),c=new T(a,o,a,1073741824),l=n.getValueInRange(s).replace(/^\s+/,``),u=n.getValueInRange(e),d=n.getValueInRange(c).replace(/\s+$/,``);return{value:l+u+d,highlight:{start:l.length,end:l.length+u.length}}}},ig=class{constructor(e,t){this.parent=e,this.uri=t,this.children=[],this._previews=new Xa}dispose(){c(this._previews.values()),this._previews.clear()}getPreview(e){return this._previews.get(e.uri)}get ariaMessage(){let e=this.children.length;return e===1?S(`aria.fileReferences.1`,`1 symbol in {0}, full path {1}`,bc(this.uri),this.uri.fsPath):S(`aria.fileReferences.N`,`{0} symbols in {1}, full path {2}`,e,bc(this.uri),this.uri.fsPath)}async resolve(e){if(this._previews.size!==0)return this;for(let t of this.children)if(!this._previews.has(t.uri))try{let n=await e.createModelReference(t.uri);this._previews.set(t.uri,new rg(n))}catch(e){C(e)}return this}},ag=class e{constructor(t,n){this.groups=[],this.references=[],this._onDidChangeReferenceRange=new g,this.onDidChangeReferenceRange=this._onDidChangeReferenceRange.event,this._links=t,this._title=n;let[r]=t;t.sort(e._compareReferences);let i;for(let n of t)if((!i||!Xo.isEqual(i.uri,n.uri,!0))&&(i=new ig(this,n.uri),this.groups.push(i)),i.children.length===0||e._compareReferences(n,i.children[i.children.length-1])!==0){let e=new ng(r===n,i,n,e=>this._onDidChangeReferenceRange.fire(e));this.references.push(e),i.children.push(e)}}dispose(){c(this.groups),this._onDidChangeReferenceRange.dispose(),this.groups.length=0}clone(){return new e(this._links,this._title)}get title(){return this._title}get isEmpty(){return this.groups.length===0}get ariaMessage(){return this.isEmpty?S(`aria.result.0`,`No results found`):this.references.length===1?S(`aria.result.1`,`Found 1 symbol in {0}`,this.references[0].uri.fsPath):this.groups.length===1?S(`aria.result.n1`,`Found {0} symbols in {1}`,this.references.length,this.groups[0].uri.fsPath):S(`aria.result.nm`,`Found {0} symbols in {1} files`,this.references.length,this.groups.length)}nextOrPreviousReference(e,t){let{parent:n}=e,r=n.children.indexOf(e),i=n.children.length,a=n.parent.groups.length;return a===1||t&&r+1<i||!t&&r>0?(r=t?(r+1)%i:(r+i-1)%i,n.children[r]):(r=n.parent.groups.indexOf(n),t?(r=(r+1)%a,n.parent.groups[r].children[0]):(r=(r+a-1)%a,n.parent.groups[r].children[n.parent.groups[r].children.length-1]))}nearestReference(e,t){let n=this.references.map((n,r)=>({idx:r,prefixLen:ct(n.uri.toString(),e.toString()),offsetDist:Math.abs(n.range.startLineNumber-t.lineNumber)*100+Math.abs(n.range.startColumn-t.column)})).sort((e,t)=>e.prefixLen>t.prefixLen?-1:e.prefixLen<t.prefixLen?1:e.offsetDist<t.offsetDist?-1:e.offsetDist>t.offsetDist?1:0)[0];if(n)return this.references[n.idx]}referenceAt(e,t){for(let n of this.references)if(n.uri.toString()===e.toString()&&T.containsPosition(n.range,t))return n}firstReference(){for(let e of this.references)if(e.isProviderFirst)return e;return this.references[0]}static _compareReferences(e,t){return Xo.compare(e.uri,t.uri)||T.compareRangesUsingStarts(e.range,t.range)}},og=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},sg=function(e,t){return function(n,r){t(n,r,e)}},cg,lg=class{constructor(e){this._resolverService=e}hasChildren(e){return e instanceof ag||e instanceof ig}getChildren(e){if(e instanceof ag)return e.groups;if(e instanceof ig)return e.resolve(this._resolverService).then(e=>e.children);throw Error(`bad tree`)}};lg=og([sg(0,Bs)],lg);var ug=class{getHeight(){return 23}getTemplateId(e){return e instanceof ig?mg.id:gg.id}},dg=class{constructor(e){this._keybindingService=e}getKeyboardNavigationLabel(e){if(e instanceof ng){let t=e.parent.getPreview(e)?.preview(e.range);if(t)return t.value}return bc(e.uri)}};dg=og([sg(0,ua)],dg);var fg=class{getId(e){return e instanceof ng?e.id:e.uri}},pg=class extends _{constructor(e,t){super(),this._labelService=t;let n=document.createElement(`div`);n.classList.add(`reference-file`),this.file=this._register(new Ia(n,{supportHighlights:!0})),this.badge=new Zr(M(n,O(`.count`)),{},rc),e.appendChild(n)}set(e,t){let n=Us(e.uri);this.file.setLabel(this._labelService.getUriBasenameLabel(e.uri),this._labelService.getUriLabel(n,{relative:!0}),{title:this._labelService.getUriLabel(e.uri),matches:t});let r=e.children.length;this.badge.setCount(r),r>1?this.badge.setTitleFormat(S(`referencesCount`,`{0} references`,r)):this.badge.setTitleFormat(S(`referenceCount`,`{0} reference`,r))}};pg=og([sg(1,Ca)],pg);var mg=class{static#e=cg=this;static#t=this.id=`FileReferencesRenderer`;constructor(e){this._instantiationService=e,this.templateId=cg.id}renderTemplate(e){return this._instantiationService.createInstance(pg,e)}renderElement(e,t,n){n.set(e.element,Rs(e.filterData))}disposeTemplate(e){e.dispose()}};mg=cg=og([sg(0,Y)],mg);var hg=class extends _{constructor(e){super(),this.label=this._register(new Mi(e))}set(e,t){let n=e.parent.getPreview(e)?.preview(e.range);if(!n||!n.value)this.label.set(`${bc(e.uri)}:${e.range.startLineNumber+1}:${e.range.startColumn+1}`);else{let{value:e,highlight:r}=n;t&&!Ts.isDefault(t)?(this.label.element.classList.toggle(`referenceMatch`,!1),this.label.set(e,Rs(t))):(this.label.element.classList.toggle(`referenceMatch`,!0),this.label.set(e,[r]))}}},gg=class e{constructor(){this.templateId=e.id}static#e=this.id=`OneReferenceRenderer`;renderTemplate(e){return new hg(e)}renderElement(e,t,n){n.set(e.element,e.filterData)}disposeTemplate(e){e.dispose()}},_g=class{getWidgetAriaLabel(){return S(`treeAriaLabel`,`References`)}getAriaLabel(e){return e.ariaMessage}},vg=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},yg=function(e,t){return function(n,r){t(n,r,e)}},bg=class e{static#e=this.DecorationOptions=U.register({description:`reference-decoration`,stickiness:1,className:`reference-decoration`});constructor(e,t){this._editor=e,this._model=t,this._decorations=new Map,this._decorationIgnoreSet=new Set,this._callOnDispose=new n,this._callOnModelChange=new n,this._callOnDispose.add(this._editor.onDidChangeModel(()=>this._onModelChanged())),this._onModelChanged()}dispose(){this._callOnModelChange.dispose(),this._callOnDispose.dispose(),this.removeDecorations()}_onModelChanged(){this._callOnModelChange.clear();let e=this._editor.getModel();if(e){for(let t of this._model.references)if(t.uri.toString()===e.uri.toString()){this._addDecorations(t.parent);return}}}_addDecorations(t){if(!this._editor.hasModel())return;this._callOnModelChange.add(this._editor.getModel().onDidChangeDecorations(()=>this._onDecorationChanged()));let n=[],r=[];for(let i=0,a=t.children.length;i<a;i++){let a=t.children[i];this._decorationIgnoreSet.has(a.id)||a.uri.toString()===this._editor.getModel().uri.toString()&&(n.push({range:a.range,options:e.DecorationOptions}),r.push(i))}this._editor.changeDecorations(e=>{let i=e.deltaDecorations([],n);for(let e=0;e<i.length;e++)this._decorations.set(i[e],t.children[r[e]])})}_onDecorationChanged(){let e=[],t=this._editor.getModel();if(t){for(let[n,r]of this._decorations){let i=t.getDecorationRange(n);if(!i)continue;let a=!1;T.equalsRange(i,r.range)||((T.spansMultipleLines(i)||r.range.endColumn-r.range.startColumn!==i.endColumn-i.startColumn)&&(a=!0),a?(this._decorationIgnoreSet.add(r.id),e.push(n)):r.range=i)}for(let t=0,n=e.length;t<n;t++)this._decorations.delete(e[t]);this._editor.removeDecorations(e)}}removeDecorations(){this._editor.removeDecorations([...this._decorations.keys()]),this._decorations.clear()}},xg=class{constructor(){this.ratio=.7,this.heightInLines=18}static fromJSON(e){let t,n;try{let r=JSON.parse(e);t=r.ratio,n=r.heightInLines}catch{}return{ratio:t||.7,heightInLines:n||18}}},Sg=class extends pa{},Cg=class extends Yh{constructor(e,t,r,i,a,o,s,c,l){super(e,{showFrame:!1,showArrow:!0,isResizeable:!0,isAccessible:!0,supportOnTitleClick:!0},o),this._defaultTreeKeyboardSupport=t,this.layoutData=r,this._textModelResolverService=a,this._instantiationService=o,this._peekViewService=s,this._uriLabel=c,this._keybindingService=l,this._disposeOnNewModel=new n,this._callOnDispose=new n,this._onDidSelectReference=new g,this.onDidSelectReference=this._onDidSelectReference.event,this._dim=new A(0,0),this._isClosing=!1,this._applyTheme(i.getColorTheme()),this._callOnDispose.add(i.onDidColorThemeChange(this._applyTheme.bind(this))),this._peekViewService.addExclusiveWidget(e,this),this.create()}get isClosing(){return this._isClosing}dispose(){this._isClosing=!0,this.setModel(void 0),this._callOnDispose.dispose(),this._disposeOnNewModel.dispose(),c(this._preview),c(this._previewNotAvailableMessage),c(this._tree),c(this._previewModelReference),this._splitView.dispose(),super.dispose()}_applyTheme(e){let t=e.getColor($h)||E.transparent;this.style({arrowColor:t,frameColor:t,headerBackgroundColor:e.getColor(Xh)||E.transparent,primaryHeadingColor:e.getColor(Zh),secondaryHeadingColor:e.getColor(Qh)})}show(e){super.show(e,this.layoutData.heightInLines||18)}focusOnReferenceTree(){this._tree.domFocus()}focusOnPreviewEditor(){this._preview.focus()}isPreviewEditorFocused(){return this._preview.hasTextFocus()}_onTitleClick(e){this._preview&&this._preview.getModel()&&this._onDidSelectReference.fire({element:this._getFocusedReference(),kind:e.ctrlKey||e.metaKey||e.altKey?`side`:`open`,source:`title`})}_fillBody(e){this.setCssClass(`reference-zone-widget`),this._messageContainer=M(e,O(`div.messages`)),yr(this._messageContainer),this._splitView=new Ri(e,{orientation:1}),this._previewContainer=M(e,O(`div.preview.inline`)),this._preview=this._instantiationService.createInstance(Ph,this._previewContainer,{scrollBeyondLastLine:!1,scrollbar:{verticalScrollbarSize:14,horizontal:`auto`,useShadows:!0,verticalHasArrows:!1,horizontalHasArrows:!1,alwaysConsumeMouseWheel:!0},overviewRulerLanes:2,fixedOverflowWidgets:!0,minimap:{enabled:!1}},{},this.editor),yr(this._previewContainer),this._previewNotAvailableMessage=this._instantiationService.createInstance(Jc,S(`missingPreviewMessage`,`no preview available`),_i,Jc.DEFAULT_CREATION_OPTIONS,null),this._treeContainer=M(e,O(`div.ref-tree.inline`));let t={keyboardSupport:this._defaultTreeKeyboardSupport,accessibilityProvider:new _g,keyboardNavigationLabelProvider:this._instantiationService.createInstance(dg),identityProvider:new fg,openOnSingleClick:!0,selectionNavigation:!0,overrideStyles:{listBackground:eg}};this._defaultTreeKeyboardSupport&&this._callOnDispose.add(Gn(this._treeContainer,`keydown`,e=>{e.equals(9)&&(this._keybindingService.dispatchEvent(e,e.target),e.stopPropagation())},!0)),this._tree=this._instantiationService.createInstance(Sg,`ReferencesWidget`,this._treeContainer,new ug,[this._instantiationService.createInstance(mg),this._instantiationService.createInstance(gg)],this._instantiationService.createInstance(lg),t),this._splitView.addView({onDidChange:we.None,element:this._previewContainer,minimumSize:200,maximumSize:Number.MAX_VALUE,layout:e=>{this._preview.layout({height:this._dim.height,width:e})}},wo.Distribute),this._splitView.addView({onDidChange:we.None,element:this._treeContainer,minimumSize:100,maximumSize:Number.MAX_VALUE,layout:e=>{this._treeContainer.style.height=`${this._dim.height}px`,this._treeContainer.style.width=`${e}px`,this._tree.layout(this._dim.height,e)}},wo.Distribute),this._disposables.add(this._splitView.onDidSashChange(()=>{this._dim.width&&(this.layoutData.ratio=this._splitView.getViewSize(0)/this._dim.width)},void 0));let n=(e,t)=>{e instanceof ng&&(t===`show`&&this._revealReference(e,!1),this._onDidSelectReference.fire({element:e,kind:t,source:`tree`}))};this._disposables.add(this._tree.onDidOpen(e=>{e.sideBySide?n(e.element,`side`):e.editorOptions.pinned?n(e.element,`goto`):n(e.element,`show`)})),yr(this._treeContainer)}_onWidth(e){this._dim&&this._doLayoutBody(this._dim.height,e)}_doLayoutBody(e,t){super._doLayoutBody(e,t),this._dim=new A(t,e),this.layoutData.heightInLines=this._viewZone?this._viewZone.heightInLines:this.layoutData.heightInLines,this._splitView.layout(t),this._splitView.resizeView(0,t*this.layoutData.ratio)}setSelection(e){return this._revealReference(e,!0).then(()=>{this._model&&(this._tree.setSelection([e]),this._tree.setFocus([e]))})}setModel(e){return this._disposeOnNewModel.clear(),this._model=e,this._model?this._onNewModel():Promise.resolve()}_onNewModel(){return this._model?this._model.isEmpty?(this.setTitle(``),this._messageContainer.innerText=S(`noResults`,`No results`),Cn(this._messageContainer),Promise.resolve(void 0)):(yr(this._messageContainer),this._decorationsManager=new bg(this._preview,this._model),this._disposeOnNewModel.add(this._decorationsManager),this._disposeOnNewModel.add(this._model.onDidChangeReferenceRange(e=>this._tree.rerender(e))),this._disposeOnNewModel.add(this._preview.onMouseDown(e=>{let{event:t,target:n}=e;if(t.detail!==2)return;let r=this._getFocusedReference();r&&this._onDidSelectReference.fire({element:{uri:r.uri,range:n.range},kind:t.ctrlKey||t.metaKey||t.altKey?`side`:`open`,source:`editor`})})),this.container.classList.add(`results-loaded`),Cn(this._treeContainer),Cn(this._previewContainer),this._splitView.layout(this._dim.width),this.focusOnReferenceTree(),this._tree.setInput(this._model.groups.length===1?this._model.groups[0]:this._model)):Promise.resolve(void 0)}_getFocusedReference(){let[e]=this._tree.getFocus();if(e instanceof ng)return e;if(e instanceof ig&&e.children.length>0)return e.children[0]}async revealReference(e){await this._revealReference(e,!1),this._onDidSelectReference.fire({element:e,kind:`goto`,source:`tree`})}async _revealReference(e,t){if(this._revealedReference===e)return;this._revealedReference=e,e.uri.scheme===Bt.inMemory?this.setTitle(S(`peekView.alternateTitle`,`References`)):this.setTitle(Vc(e.uri),this._uriLabel.getUriLabel(Us(e.uri)));let n=this._textModelResolverService.createModelReference(e.uri);this._tree.getInput()===e.parent?this._tree.reveal(e):(t&&this._tree.reveal(e.parent),await this._tree.expand(e.parent),this._tree.reveal(e));let r=await n;if(!this._model){r.dispose();return}c(this._previewModelReference);let i=r.object;if(i){let t=this._preview.getModel()===i.textEditorModel?0:1,n=T.lift(e.range).collapseToStart();this._previewModelReference=r,this._preview.setModel(i.textEditorModel),this._preview.setSelection(n),this._preview.revealRangeInCenter(n,t)}else this._preview.setModel(this._previewNotAvailableMessage),r.dispose()}};Cg=vg([yg(3,Zc),yg(4,Bs),yg(5,Y),yg(6,Wh),yg(7,Ca),yg(8,ua)],Cg);var wg=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Tg=function(e,t){return function(n,r){t(n,r,e)}},Eg;const Dg=new G(`referenceSearchVisible`,!1,S(`referenceSearchVisible`,`Whether reference peek is visible, like 'Peek References' or 'Peek Definition'`));var Og=class{static#e=Eg=this;static#t=this.ID=`editor.contrib.referencesController`;static get(e){return e.getContribution(Eg.ID)}constructor(e,t,r,i,a,o,s,c){this._defaultTreeKeyboardSupport=e,this._editor=t,this._editorService=i,this._notificationService=a,this._instantiationService=o,this._storageService=s,this._configurationService=c,this._disposables=new n,this._requestIdPool=0,this._ignoreModelChangeEvent=!1,this._referenceSearchVisible=Dg.bindTo(r)}dispose(){this._referenceSearchVisible.reset(),this._disposables.dispose(),this._widget?.dispose(),this._model?.dispose(),this._widget=void 0,this._model=void 0}toggleWidget(e,t,n){let i;if(this._widget&&(i=this._widget.position),this.closeWidget(),i&&e.containsPosition(i))return;this._peekMode=n,this._referenceSearchVisible.set(!0),this._disposables.add(this._editor.onDidChangeModelLanguage(()=>{this.closeWidget()})),this._disposables.add(this._editor.onDidChangeModel(()=>{this._ignoreModelChangeEvent||this.closeWidget()}));let a=`peekViewLayout`,o=xg.fromJSON(this._storageService.get(a,0,`{}`));this._widget=this._instantiationService.createInstance(Cg,this._editor,this._defaultTreeKeyboardSupport,o),this._widget.setTitle(S(`labelLoading`,`Loading...`)),this._widget.show(e),this._disposables.add(this._widget.onDidClose(()=>{t.cancel(),this._widget?(this._storageService.store(a,JSON.stringify(this._widget.layoutData),0,1),this._widget.isClosing||this.closeWidget(),this._widget=void 0):this.closeWidget()})),this._disposables.add(this._widget.onDidSelectReference(e=>{let{element:t,kind:r}=e;if(t)switch(r){case`open`:(e.source!==`editor`||!this._configurationService.getValue(`editor.stablePeek`))&&this.openReference(t,!1,!1);break;case`side`:this.openReference(t,!0,!1);break;case`goto`:n?this._gotoReference(t,!0):this.openReference(t,!1,!0);break}}));let s=++this._requestIdPool;t.then(t=>{if(s!==this._requestIdPool||!this._widget){t.dispose();return}return this._model?.dispose(),this._model=t,this._widget.setModel(this._model).then(()=>{if(this._widget&&this._model&&this._editor.hasModel()){this._model.isEmpty?this._widget.setMetaTitle(``):this._widget.setMetaTitle(S(`metaTitle.N`,`{0} ({1})`,this._model.title,this._model.references.length));let t=this._editor.getModel().uri,n=new r(e.startLineNumber,e.startColumn),i=this._model.nearestReference(t,n);if(i)return this._widget.setSelection(i).then(()=>{this._widget&&this._editor.getOption(87)===`editor`&&this._widget.focusOnPreviewEditor()})}})},e=>{this._notificationService.error(e)})}changeFocusBetweenPreviewAndReferences(){this._widget&&(this._widget.isPreviewEditorFocused()?this._widget.focusOnReferenceTree():this._widget.focusOnPreviewEditor())}async goToNextOrPreviousReference(e){if(!this._editor.hasModel()||!this._model||!this._widget)return;let t=this._widget.position;if(!t)return;let n=this._model.nearestReference(this._editor.getModel().uri,t);if(!n)return;let r=this._model.nextOrPreviousReference(n,e),i=this._editor.hasTextFocus(),a=this._widget.isPreviewEditorFocused();await this._widget.setSelection(r),await this._gotoReference(r,!1),i?this._editor.focus():this._widget&&a&&this._widget.focusOnPreviewEditor()}async revealReference(e){!this._editor.hasModel()||!this._model||!this._widget||await this._widget.revealReference(e)}closeWidget(e=!0){this._widget?.dispose(),this._model?.dispose(),this._referenceSearchVisible.reset(),this._disposables.clear(),this._widget=void 0,this._model=void 0,e&&this._editor.focus(),this._requestIdPool+=1}_gotoReference(e,t){this._widget?.hide(),this._ignoreModelChangeEvent=!0;let n=T.lift(e.range).collapseToStart();return this._editorService.openCodeEditor({resource:e.uri,options:{selection:n,selectionSource:`code.jump`,pinned:t}},this._editor).then(e=>{if(this._ignoreModelChangeEvent=!1,!e||!this._widget){this.closeWidget();return}if(this._editor===e)this._widget.show(n),this._widget.focusOnReferenceTree();else{let t=Eg.get(e),r=this._model.clone();this.closeWidget(),e.focus(),t?.toggleWidget(n,et(e=>Promise.resolve(r)),this._peekMode??!1)}},e=>{this._ignoreModelChangeEvent=!1,C(e)})}openReference(e,t,n){t||this.closeWidget();let{uri:r,range:i}=e;this._editorService.openCodeEditor({resource:r,options:{selection:i,selectionSource:`code.jump`,pinned:n}},this._editor,t)}};Og=Eg=wg([Tg(2,W),Tg(3,Ko),Tg(4,Ro),Tg(5,Y),Tg(6,Pa),Tg(7,F)],Og);function kg(e,t){let n=qh(e);if(!n)return;let r=Og.get(n);r&&t(r)}Uc.registerCommandAndKeybindingRule({id:`togglePeekWidgetFocus`,weight:100,primary:ne(2089,60),when:z.or(Dg,Gh.inPeekEditor),handler(e){kg(e,e=>{e.changeFocusBetweenPreviewAndReferences()})}}),Uc.registerCommandAndKeybindingRule({id:`goToNextReference`,weight:90,primary:62,secondary:[70],when:z.or(Dg,Gh.inPeekEditor),handler(e){kg(e,e=>{e.goToNextOrPreviousReference(!0)})}}),Uc.registerCommandAndKeybindingRule({id:`goToPreviousReference`,weight:90,primary:1086,secondary:[1094],when:z.or(Dg,Gh.inPeekEditor),handler(e){kg(e,e=>{e.goToNextOrPreviousReference(!1)})}}),B.registerCommandAlias(`goToNextReferenceFromEmbeddedEditor`,`goToNextReference`),B.registerCommandAlias(`goToPreviousReferenceFromEmbeddedEditor`,`goToPreviousReference`),B.registerCommandAlias(`closeReferenceSearchEditor`,`closeReferenceSearch`),B.registerCommand(`closeReferenceSearch`,e=>kg(e,e=>e.closeWidget())),Uc.registerKeybindingRule({id:`closeReferenceSearch`,weight:-1,primary:9,secondary:[1033],when:z.and(Gh.inPeekEditor,z.not(`config.editor.stablePeek`))}),Uc.registerKeybindingRule({id:`closeReferenceSearch`,weight:250,primary:9,secondary:[1033],when:z.and(Dg,z.not(`config.editor.stablePeek`),z.or(q.editorTextFocus,vo.negate()))}),Uc.registerCommandAndKeybindingRule({id:`revealReference`,weight:200,primary:3,mac:{primary:3,secondary:[2066]},when:z.and(Dg,Ja,Ll.negate(),li.negate()),handler(e){let t=e.get(Yi).lastFocusedList?.getFocus();Array.isArray(t)&&t[0]instanceof ng&&kg(e,e=>e.revealReference(t[0]))}}),Uc.registerCommandAndKeybindingRule({id:`openReferenceToSide`,weight:100,primary:2051,mac:{primary:259},when:z.and(Dg,Ja,Ll.negate(),li.negate()),handler(e){let t=e.get(Yi).lastFocusedList?.getFocus();Array.isArray(t)&&t[0]instanceof ng&&kg(e,e=>e.openReference(t[0],!0,!0))}}),B.registerCommand(`openReference`,e=>{let t=e.get(Yi).lastFocusedList?.getFocus();Array.isArray(t)&&t[0]instanceof ng&&kg(e,e=>e.openReference(t[0],!1,!0))});var Ag=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},jg=function(e,t){return function(n,r){t(n,r,e)}};const Mg=new G(`hasSymbols`,!1,S(`hasSymbols`,`Whether there are symbol locations that can be navigated via keyboard-only.`)),Ng=kl(`ISymbolNavigationService`);var Pg=class{constructor(e,t,n,r){this._editorService=t,this._notificationService=n,this._keybindingService=r,this._currentModel=void 0,this._currentIdx=-1,this._ignoreEditorChange=!1,this._ctxHasSymbols=Mg.bindTo(e)}reset(){this._ctxHasSymbols.reset(),this._currentState?.dispose(),this._currentMessage?.dispose(),this._currentModel=void 0,this._currentIdx=-1}put(e){let t=e.parent.parent;if(t.references.length<=1){this.reset();return}this._currentModel=t,this._currentIdx=t.references.indexOf(e),this._ctxHasSymbols.set(!0),this._showMessage();let n=new Fg(this._editorService);this._currentState=ce(n,n.onDidChange(e=>{if(this._ignoreEditorChange)return;let n=this._editorService.getActiveCodeEditor();if(!n)return;let r=n.getModel(),i=n.getPosition();if(!r||!i)return;let a=!1,o=!1;for(let e of t.references)if(qc(e.uri,r.uri))a=!0,o||=T.containsPosition(e.range,i);else if(a)break;(!a||!o)&&this.reset()}))}revealNext(e){if(!this._currentModel)return Promise.resolve();this._currentIdx+=1,this._currentIdx%=this._currentModel.references.length;let t=this._currentModel.references[this._currentIdx];return this._showMessage(),this._ignoreEditorChange=!0,this._editorService.openCodeEditor({resource:t.uri,options:{selection:T.collapseToStart(t.range),selectionRevealType:3}},e).finally(()=>{this._ignoreEditorChange=!1})}_showMessage(){this._currentMessage?.dispose();let e=this._keybindingService.lookupKeybinding(`editor.gotoNextSymbolFromResult`),t=e?S(`location.kb`,`Symbol {0} of {1}, {2} for next`,this._currentIdx+1,this._currentModel.references.length,e.getLabel()):S(`location`,`Symbol {0} of {1}`,this._currentIdx+1,this._currentModel.references.length);this._currentMessage=this._notificationService.status(t)}};Pg=Ag([jg(0,W),jg(1,Ko),jg(2,Ro),jg(3,ua)],Pg),$r(Ng,Pg,1),P(new class extends la{constructor(){super({id:`editor.gotoNextSymbolFromResult`,precondition:Mg,kbOpts:{weight:100,primary:70}})}runEditorCommand(e,t){return e.get(Ng).revealNext(t)}}),Uc.registerCommandAndKeybindingRule({id:`editor.gotoNextSymbolFromResult.cancel`,weight:100,when:Mg,primary:9,handler(e){e.get(Ng).reset()}});var Fg=class{constructor(e){this._listener=new Map,this._disposables=new n,this._onDidChange=new g,this.onDidChange=this._onDidChange.event,this._disposables.add(e.onCodeEditorRemove(this._onDidRemoveEditor,this)),this._disposables.add(e.onCodeEditorAdd(this._onDidAddEditor,this)),e.listCodeEditors().forEach(this._onDidAddEditor,this)}dispose(){this._disposables.dispose(),this._onDidChange.dispose(),c(this._listener.values())}_onDidAddEditor(e){this._listener.set(e,ce(e.onDidChangeCursorPosition(t=>this._onDidChange.fire({editor:e})),e.onDidChangeModelContent(t=>this._onDidChange.fire({editor:e}))))}_onDidRemoveEditor(e){this._listener.get(e)?.dispose(),this._listener.delete(e)}};Fg=Ag([jg(0,Ko)],Fg);function Ig(e,t){return t.uri.scheme===e.uri.scheme?!0:!Ye(t.uri,Bt.walkThroughSnippet,Bt.vscodeChatCodeBlock,Bt.vscodeChatCodeCompareBlock)}async function Lg(e,t,n,r,i){let a=n.ordered(e,r).map(n=>Promise.resolve(i(n,e,t)).then(void 0,e=>{Re(e)}));return bt((await Promise.all(a)).flat()).filter(t=>Ig(e,t))}function Rg(e,t,n,r,i){return Lg(t,n,e,r,(e,t,n)=>e.provideDefinition(t,n,i))}function zg(e,t,n,r,i){return Lg(t,n,e,r,(e,t,n)=>e.provideDeclaration(t,n,i))}function Bg(e,t,n,r,i){return Lg(t,n,e,r,(e,t,n)=>e.provideImplementation(t,n,i))}function Vg(e,t,n,r,i){return Lg(t,n,e,r,(e,t,n)=>e.provideTypeDefinition(t,n,i))}function Hg(e,t,n,r,i,a){return Lg(t,n,e,i,async(e,t,n)=>{let i=(await e.provideReferences(t,n,{includeDeclaration:!0},a))?.filter(e=>Ig(t,e));if(!r||!i||i.length!==2)return i;let o=(await e.provideReferences(t,n,{includeDeclaration:!1},a))?.filter(e=>Ig(t,e));return o&&o.length===1?o:i})}async function Ug(e){let t=new ag(await e(),``),n=t.references.map(e=>e.link);return t.dispose(),n}Pi(`_executeDefinitionProvider`,(e,t,n)=>{let r=Rg(e.get(V).definitionProvider,t,n,!1,w.None);return Ug(()=>r)}),Pi(`_executeDefinitionProvider_recursive`,(e,t,n)=>{let r=Rg(e.get(V).definitionProvider,t,n,!0,w.None);return Ug(()=>r)}),Pi(`_executeTypeDefinitionProvider`,(e,t,n)=>{let r=Vg(e.get(V).typeDefinitionProvider,t,n,!1,w.None);return Ug(()=>r)}),Pi(`_executeTypeDefinitionProvider_recursive`,(e,t,n)=>{let r=Vg(e.get(V).typeDefinitionProvider,t,n,!0,w.None);return Ug(()=>r)}),Pi(`_executeDeclarationProvider`,(e,t,n)=>{let r=zg(e.get(V).declarationProvider,t,n,!1,w.None);return Ug(()=>r)}),Pi(`_executeDeclarationProvider_recursive`,(e,t,n)=>{let r=zg(e.get(V).declarationProvider,t,n,!0,w.None);return Ug(()=>r)}),Pi(`_executeReferenceProvider`,(e,t,n)=>{let r=Hg(e.get(V).referenceProvider,t,n,!1,!1,w.None);return Ug(()=>r)}),Pi(`_executeReferenceProvider_recursive`,(e,t,n)=>{let r=Hg(e.get(V).referenceProvider,t,n,!1,!0,w.None);return Ug(()=>r)}),Pi(`_executeImplementationProvider`,(e,t,n)=>{let r=Bg(e.get(V).implementationProvider,t,n,!1,w.None);return Ug(()=>r)}),Pi(`_executeImplementationProvider_recursive`,(e,t,n)=>{let r=Bg(e.get(V).implementationProvider,t,n,!0,w.None);return Ug(()=>r)}),qr.appendMenuItem(R.EditorContext,{submenu:R.EditorContextPeek,title:S(`peek.submenu`,`Peek`),group:`navigation`,order:100});var Wg=class e{static is(t){return!t||typeof t!=`object`?!1:!!(t instanceof e||r.isIPosition(t.position)&&t.model)}constructor(e,t){this.model=e,this.position=t}},Gg=class e extends Gi{static#e=this._allSymbolNavigationCommands=new Map;static#t=this._activeAlternativeCommands=new Set;static all(){return e._allSymbolNavigationCommands.values()}static _patchConfig(e){let t={...e,f1:!0};if(t.menu)for(let n of ue.wrap(t.menu))(n.id===R.EditorContext||n.id===R.EditorContextPeek)&&(n.when=z.and(e.precondition,n.when));return t}constructor(t,n){super(e._patchConfig(n)),this.configuration=t,e._allSymbolNavigationCommands.set(n.id,this)}runEditorCommand(t,n,r,i){if(!n.hasModel())return Promise.resolve(void 0);let a=t.get(Ro),o=t.get(Ko),s=t.get(ni),c=t.get(Ng),l=t.get(V),u=t.get(Y),d=n.getModel(),f=n.getPosition(),p=Wg.is(r)?r:new Wg(d,f),m=new fl(n,5),h=sn(this._getLocationModel(l,p.model,p.position,m.token),m.token).then(async t=>{if(!t||m.token.isCancellationRequested)return;qa(t.ariaMessage);let a;if(t.referenceAt(d.uri,f)){let t=this._getAlternativeCommand(n);!e._activeAlternativeCommands.has(t)&&e._allSymbolNavigationCommands.has(t)&&(a=e._allSymbolNavigationCommands.get(t))}let s=t.references.length;if(s===0){if(!this.configuration.muteMessage){let e=d.getWordAtPosition(f);Sd.get(n)?.showMessage(this._getNoResultFoundMessage(e),f)}}else if(s===1&&a)e._activeAlternativeCommands.add(this.desc.id),u.invokeFunction(t=>a.runEditorCommand(t,n,r,i).finally(()=>{e._activeAlternativeCommands.delete(this.desc.id)}));else return this._onResult(o,c,n,t,i)},e=>{a.error(e)}).finally(()=>{m.dispose()});return s.showWhile(h,250),h}async _onResult(e,t,n,r,i){let a=this._getGoToPreference(n);if(!(n instanceof Ph)&&(this.configuration.openInPeek||a===`peek`&&r.references.length>1))this._openInPeek(n,r,i);else{let o=r.firstReference(),s=r.references.length>1&&a===`gotoAndPeek`,c=await this._openReference(n,e,o,this.configuration.openToSide,!s);s&&c?this._openInPeek(c,r,i):r.dispose(),a===`goto`&&t.put(o)}}async _openReference(e,t,n,r,i){let a;if(re(n)&&(a=n.targetSelectionRange),a||=n.range,!a)return;let o=await t.openCodeEditor({resource:n.uri,options:{selection:T.collapseToStart(a),selectionRevealType:3,selectionSource:`code.jump`}},e,r);if(o){if(i){let e=o.getModel(),t=o.createDecorationsCollection([{range:a,options:{description:`symbol-navigate-action-highlight`,className:`symbolHighlight`}}]);setTimeout(()=>{o.getModel()===e&&t.clear()},350)}return o}}_openInPeek(e,t,n){let r=Og.get(e);r&&e.hasModel()?r.toggleWidget(n??e.getSelection(),et(e=>Promise.resolve(t)),this.configuration.openInPeek):t.dispose()}},Kg=class extends Gg{async _getLocationModel(e,t,n,r){return new ag(await Rg(e.definitionProvider,t,n,!1,r),S(`def.title`,`Definitions`))}_getNoResultFoundMessage(e){return e&&e.word?S(`noResultWord`,`No definition found for '{0}'`,e.word):S(`generic.noResults`,`No definition found`)}_getAlternativeCommand(e){return e.getOption(58).alternativeDefinitionCommand}_getGoToPreference(e){return e.getOption(58).multipleDefinitions}};H(class e extends Kg{static#e=this.id=`editor.action.revealDefinition`;constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:e.id,title:{...x(`actions.goToDecl.label`,`Go to Definition`),mnemonicTitle:S({key:`miGotoDefinition`,comment:[`&& denotes a mnemonic`]},`Go to &&Definition`)},precondition:q.hasDefinitionProvider,keybinding:[{when:q.editorTextFocus,primary:70,weight:100},{when:z.and(q.editorTextFocus,Ui),primary:2118,weight:100}],menu:[{id:R.EditorContext,group:`navigation`,order:1.1},{id:R.MenubarGoMenu,precondition:null,group:`4_symbol_nav`,order:2}]}),B.registerCommandAlias(`editor.action.goToDeclaration`,e.id)}}),H(class e extends Kg{static#e=this.id=`editor.action.revealDefinitionAside`;constructor(){super({openToSide:!0,openInPeek:!1,muteMessage:!1},{id:e.id,title:x(`actions.goToDeclToSide.label`,`Open Definition to the Side`),precondition:z.and(q.hasDefinitionProvider,q.isInEmbeddedEditor.toNegated()),keybinding:[{when:q.editorTextFocus,primary:ne(2089,70),weight:100},{when:z.and(q.editorTextFocus,Ui),primary:ne(2089,2118),weight:100}]}),B.registerCommandAlias(`editor.action.openDeclarationToTheSide`,e.id)}}),H(class e extends Kg{static#e=this.id=`editor.action.peekDefinition`;constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:e.id,title:x(`actions.previewDecl.label`,`Peek Definition`),precondition:z.and(q.hasDefinitionProvider,Gh.notInPeekEditor,q.isInEmbeddedEditor.toNegated()),keybinding:{when:q.editorTextFocus,primary:582,linux:{primary:3140},weight:100},menu:{id:R.EditorContextPeek,group:`peek`,order:2}}),B.registerCommandAlias(`editor.action.previewDeclaration`,e.id)}});var qg=class extends Gg{async _getLocationModel(e,t,n,r){return new ag(await zg(e.declarationProvider,t,n,!1,r),S(`decl.title`,`Declarations`))}_getNoResultFoundMessage(e){return e&&e.word?S(`decl.noResultWord`,`No declaration found for '{0}'`,e.word):S(`decl.generic.noResults`,`No declaration found`)}_getAlternativeCommand(e){return e.getOption(58).alternativeDeclarationCommand}_getGoToPreference(e){return e.getOption(58).multipleDeclarations}};H(class e extends qg{static#e=this.id=`editor.action.revealDeclaration`;constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:e.id,title:{...x(`actions.goToDeclaration.label`,`Go to Declaration`),mnemonicTitle:S({key:`miGotoDeclaration`,comment:[`&& denotes a mnemonic`]},`Go to &&Declaration`)},precondition:z.and(q.hasDeclarationProvider,q.isInEmbeddedEditor.toNegated()),menu:[{id:R.EditorContext,group:`navigation`,order:1.3},{id:R.MenubarGoMenu,precondition:null,group:`4_symbol_nav`,order:3}]})}_getNoResultFoundMessage(e){return e&&e.word?S(`decl.noResultWord`,`No declaration found for '{0}'`,e.word):S(`decl.generic.noResults`,`No declaration found`)}}),H(class extends qg{constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:`editor.action.peekDeclaration`,title:x(`actions.peekDecl.label`,`Peek Declaration`),precondition:z.and(q.hasDeclarationProvider,Gh.notInPeekEditor,q.isInEmbeddedEditor.toNegated()),menu:{id:R.EditorContextPeek,group:`peek`,order:3}})}});var Jg=class extends Gg{async _getLocationModel(e,t,n,r){return new ag(await Vg(e.typeDefinitionProvider,t,n,!1,r),S(`typedef.title`,`Type Definitions`))}_getNoResultFoundMessage(e){return e&&e.word?S(`goToTypeDefinition.noResultWord`,`No type definition found for '{0}'`,e.word):S(`goToTypeDefinition.generic.noResults`,`No type definition found`)}_getAlternativeCommand(e){return e.getOption(58).alternativeTypeDefinitionCommand}_getGoToPreference(e){return e.getOption(58).multipleTypeDefinitions}};H(class e extends Jg{static#e=this.ID=`editor.action.goToTypeDefinition`;constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:e.ID,title:{...x(`actions.goToTypeDefinition.label`,`Go to Type Definition`),mnemonicTitle:S({key:`miGotoTypeDefinition`,comment:[`&& denotes a mnemonic`]},`Go to &&Type Definition`)},precondition:q.hasTypeDefinitionProvider,keybinding:{when:q.editorTextFocus,primary:0,weight:100},menu:[{id:R.EditorContext,group:`navigation`,order:1.4},{id:R.MenubarGoMenu,precondition:null,group:`4_symbol_nav`,order:3}]})}}),H(class e extends Jg{static#e=this.ID=`editor.action.peekTypeDefinition`;constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:e.ID,title:x(`actions.peekTypeDefinition.label`,`Peek Type Definition`),precondition:z.and(q.hasTypeDefinitionProvider,Gh.notInPeekEditor,q.isInEmbeddedEditor.toNegated()),menu:{id:R.EditorContextPeek,group:`peek`,order:4}})}});var Yg=class extends Gg{async _getLocationModel(e,t,n,r){return new ag(await Bg(e.implementationProvider,t,n,!1,r),S(`impl.title`,`Implementations`))}_getNoResultFoundMessage(e){return e&&e.word?S(`goToImplementation.noResultWord`,`No implementation found for '{0}'`,e.word):S(`goToImplementation.generic.noResults`,`No implementation found`)}_getAlternativeCommand(e){return e.getOption(58).alternativeImplementationCommand}_getGoToPreference(e){return e.getOption(58).multipleImplementations}};H(class e extends Yg{static#e=this.ID=`editor.action.goToImplementation`;constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:e.ID,title:{...x(`actions.goToImplementation.label`,`Go to Implementations`),mnemonicTitle:S({key:`miGotoImplementation`,comment:[`&& denotes a mnemonic`]},`Go to &&Implementations`)},precondition:q.hasImplementationProvider,keybinding:{when:q.editorTextFocus,primary:2118,weight:100},menu:[{id:R.EditorContext,group:`navigation`,order:1.45},{id:R.MenubarGoMenu,precondition:null,group:`4_symbol_nav`,order:4}]})}}),H(class e extends Yg{static#e=this.ID=`editor.action.peekImplementation`;constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:e.ID,title:x(`actions.peekImplementation.label`,`Peek Implementations`),precondition:z.and(q.hasImplementationProvider,Gh.notInPeekEditor,q.isInEmbeddedEditor.toNegated()),keybinding:{when:q.editorTextFocus,primary:3142,weight:100},menu:{id:R.EditorContextPeek,group:`peek`,order:5}})}});var Xg=class extends Gg{_getNoResultFoundMessage(e){return e?S(`references.no`,`No references found for '{0}'`,e.word):S(`references.noGeneric`,`No references found`)}_getAlternativeCommand(e){return e.getOption(58).alternativeReferenceCommand}_getGoToPreference(e){return e.getOption(58).multipleReferences}};H(class extends Xg{constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:`editor.action.goToReferences`,title:{...x(`goToReferences.label`,`Go to References`),mnemonicTitle:S({key:`miGotoReference`,comment:[`&& denotes a mnemonic`]},`Go to &&References`)},precondition:z.and(q.hasReferenceProvider,Gh.notInPeekEditor,q.isInEmbeddedEditor.toNegated()),keybinding:{when:q.editorTextFocus,primary:1094,weight:100},menu:[{id:R.EditorContext,group:`navigation`,order:1.45},{id:R.MenubarGoMenu,precondition:null,group:`4_symbol_nav`,order:5}]})}async _getLocationModel(e,t,n,r){return new ag(await Hg(e.referenceProvider,t,n,!0,!1,r),S(`ref.title`,`References`))}}),H(class extends Xg{constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:`editor.action.referenceSearch.trigger`,title:x(`references.action.label`,`Peek References`),precondition:z.and(q.hasReferenceProvider,Gh.notInPeekEditor,q.isInEmbeddedEditor.toNegated()),menu:{id:R.EditorContextPeek,group:`peek`,order:6}})}async _getLocationModel(e,t,n,r){return new ag(await Hg(e.referenceProvider,t,n,!1,!1,r),S(`ref.title`,`References`))}});var Zg=class extends Gg{constructor(e,t,n){super(e,{id:`editor.action.goToLocation`,title:x(`label.generic`,`Go to Any Symbol`),precondition:z.and(Gh.notInPeekEditor,q.isInEmbeddedEditor.toNegated())}),this._references=t,this._gotoMultipleBehaviour=n}async _getLocationModel(e,t,n,r){return new ag(this._references,S(`generic.title`,`Locations`))}_getNoResultFoundMessage(e){return e&&S(`generic.noResult`,`No results for '{0}'`,e.word)||``}_getGoToPreference(e){return this._gotoMultipleBehaviour??e.getOption(58).multipleReferences}_getAlternativeCommand(){return``}};B.registerCommand({id:`editor.action.goToLocations`,metadata:{description:`Go to locations from a position in a file`,args:[{name:`uri`,description:`The text document in which to start`,constraint:y},{name:`position`,description:`The position at which to start`,constraint:r.isIPosition},{name:`locations`,description:`An array of locations.`,constraint:Array},{name:`multiple`,description:"Define what to do when having multiple results, either `peek`, `gotoAndPeek`, or `goto`"},{name:`noResultsMessage`,description:`Human readable message that shows when locations is empty.`}]},handler:async(e,t,n,i,a,s,c)=>{o(y.isUri(t)),o(r.isIPosition(n)),o(Array.isArray(i)),o(a===void 0||typeof a==`string`),o(c===void 0||typeof c==`boolean`);let l=e.get(Ko),u=await l.openCodeEditor({resource:t},l.getFocusedCodeEditor());if(vl(u))return u.setPosition(n),u.revealPositionInCenterIfOutsideViewport(n,0),u.invokeWithinContext(e=>{let t=new class extends Zg{_getNoResultFoundMessage(e){return s||super._getNoResultFoundMessage(e)}}({muteMessage:!s,openInPeek:!!c,openToSide:!1},i,a);e.get(Y).invokeFunction(t.run.bind(t),u)})}}),B.registerCommand({id:`editor.action.peekLocations`,metadata:{description:`Peek locations from a position in a file`,args:[{name:`uri`,description:`The text document in which to start`,constraint:y},{name:`position`,description:`The position at which to start`,constraint:r.isIPosition},{name:`locations`,description:`An array of locations.`,constraint:Array},{name:`multiple`,description:"Define what to do when having multiple results, either `peek`, `gotoAndPeek`, or `goto`"}]},handler:async(e,t,n,r,i)=>{e.get(lc).executeCommand(`editor.action.goToLocations`,t,n,r,i,void 0,!0)}}),B.registerCommand({id:`editor.action.findReferences`,handler:(e,t,n)=>{o(y.isUri(t)),o(r.isIPosition(n));let i=e.get(V),a=e.get(Ko);return a.openCodeEditor({resource:t},a.getFocusedCodeEditor()).then(e=>{if(!vl(e)||!e.hasModel())return;let t=Og.get(e);if(!t)return;let a=et(t=>Hg(i.referenceProvider,e.getModel(),r.lift(n),!1,!1,t).then(e=>new ag(e,S(`ref.title`,`References`)))),o=new T(n.lineNumber,n.column,n.lineNumber,n.column);return Promise.resolve(t.toggleWidget(o,a,!1))})}}),B.registerCommandAlias(`editor.action.showReferences`,`editor.action.peekLocations`);async function Qg(e,t,n,r){let i=e.get(Bs),a=e.get(Ga),o=e.get(lc),s=e.get(Y),c=e.get(Ro);if(await r.item.resolve(w.None),!r.part.location)return;let l=r.part.location,u=[],d=new Set(qr.getMenuItems(R.EditorContext).map(e=>el(e)?e.command.id:ku()));for(let e of Gg.all())d.has(e.desc.id)&&u.push(new hs(e.desc.id,Ra.label(e.desc,{renderShortTitle:!0}),void 0,!0,async()=>{let n=await i.createModelReference(l.uri);try{let i=new Wg(n.object.textEditorModel,T.getStartPosition(l.range)),a=r.item.anchor.range;await s.invokeFunction(e.runEditorCommand.bind(e),t,i,a)}finally{n.dispose()}}));if(r.part.command){let{command:e}=r.part;u.push(new Ds),u.push(new hs(e.id,e.title,void 0,!0,async()=>{try{await o.executeCommand(e.id,...e.arguments??[])}catch(e){c.notify({severity:za.Error,source:r.item.provider.displayName,message:e})}}))}let f=t.getOption(128);a.showContextMenu({domForShadowRoot:f?t.getDomNode()??void 0:void 0,getAnchor:()=>{let e=gt(n);return{x:e.left,y:e.top+e.height+8}},getActions:()=>u,onHide:()=>{t.focus()},autoSelectFirstItem:!0})}async function $g(e,t,n,r){let i=await e.get(Bs).createModelReference(r.uri);await n.invokeWithinContext(async e=>{let a=t.hasSideBySideModifier,o=e.get(W),s=Gh.inPeekEditor.getValue(o);return new Kg({openToSide:a,openInPeek:!a&&n.getOption(89)&&!s,muteMessage:!0},{title:{value:``,original:``},id:``,precondition:void 0}).run(e,new Wg(i.object.textEditorModel,T.getStartPosition(r.range)),T.lift(r.range))}),i.dispose()}var e_=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},t_=function(e,t){return function(n,r){t(n,r,e)}},n_,r_=class e{constructor(){this._entries=new yl(50)}get(t){let n=e._key(t);return this._entries.get(n)}set(t,n){let r=e._key(t);this._entries.set(r,n)}static _key(e){return`${e.uri.toString()}/${e.getVersionId()}`}},i_=kl(`IInlayHintsCache`);$r(i_,r_,1);var a_=class{constructor(e,t){this.item=e,this.index=t}get part(){let e=this.item.hint.label;return typeof e==`string`?{label:e}:e[this.index]}},o_=class{constructor(e,t){this.part=e,this.hasTriggerModifier=t}},s_=class{static#e=n_=this;static#t=this.ID=`editor.contrib.InlayHints`;static#n=this._MAX_DECORATORS=1500;static#r=this._MAX_LABEL_LEN=43;static get(e){return e.getContribution(n_.ID)??void 0}constructor(e,t,r,i,a,o,s){this._editor=e,this._languageFeaturesService=t,this._inlayHintsCache=i,this._commandService=a,this._notificationService=o,this._instaService=s,this._disposables=new n,this._sessionDisposables=new n,this._decorationsMetadata=new Map,this._ruleFactory=new ft(this._editor),this._activeRenderMode=0,this._debounceInfo=r.for(t.inlayHintsProvider,`InlayHint`,{min:25}),this._disposables.add(t.inlayHintsProvider.onDidChange(()=>this._update())),this._disposables.add(e.onDidChangeModel(()=>this._update())),this._disposables.add(e.onDidChangeModelLanguage(()=>this._update())),this._disposables.add(e.onDidChangeConfiguration(e=>{e.hasChanged(142)&&this._update()})),this._update()}dispose(){this._sessionDisposables.dispose(),this._removeAllDecorations(),this._disposables.dispose()}_update(){this._sessionDisposables.clear(),this._removeAllDecorations();let e=this._editor.getOption(142);if(e.enabled===`off`)return;let t=this._editor.getModel();if(!t||!this._languageFeaturesService.inlayHintsProvider.has(t))return;if(e.enabled===`on`)this._activeRenderMode=0;else{let t,n;e.enabled===`onUnlessPressed`?(t=0,n=1):(t=1,n=0),this._activeRenderMode=t,this._sessionDisposables.add(Fn.getInstance().event(e=>{if(!this._editor.hasModel())return;let r=e.altKey&&e.ctrlKey&&!(e.shiftKey||e.metaKey)?n:t;if(r!==this._activeRenderMode){this._activeRenderMode=r;let e=this._editor.getModel(),t=this._copyInlayHintsWithCurrentAnchor(e);this._updateHintsDecorators([e.getFullModelRange()],t),a.schedule(0)}}))}let n=this._inlayHintsCache.get(t);n&&this._updateHintsDecorators([t.getFullModelRange()],n),this._sessionDisposables.add(b(()=>{t.isDisposed()||this._cacheHintsForFastRestore(t)}));let r,i=new Set,a=new yt(async()=>{let e=Date.now();r?.dispose(!0),r=new ie;let n=t.onWillDispose(()=>r?.cancel());try{let n=r.token,o=await Ah.create(this._languageFeaturesService.inlayHintsProvider,t,this._getHintsRanges(),n);if(a.delay=this._debounceInfo.update(t,Date.now()-e),n.isCancellationRequested){o.dispose();return}for(let e of o.provider)typeof e.onDidChangeInlayHints==`function`&&!i.has(e)&&(i.add(e),this._sessionDisposables.add(e.onDidChangeInlayHints(()=>{a.isScheduled()||a.schedule()})));this._sessionDisposables.add(o),this._updateHintsDecorators(o.ranges,o.items),this._cacheHintsForFastRestore(t)}catch(e){C(e)}finally{r.dispose(),n.dispose()}},this._debounceInfo.get(t));this._sessionDisposables.add(a),this._sessionDisposables.add(b(()=>r?.dispose(!0))),a.schedule(0),this._sessionDisposables.add(this._editor.onDidScrollChange(e=>{(e.scrollTopChanged||!a.isScheduled())&&a.schedule()})),this._sessionDisposables.add(this._editor.onDidChangeModelContent(e=>{r?.cancel();let t=Math.max(a.delay,1250);a.schedule(t)})),this._sessionDisposables.add(this._installDblClickGesture(()=>a.schedule(0))),this._sessionDisposables.add(this._installLinkGesture()),this._sessionDisposables.add(this._installContextMenu())}_installLinkGesture(){let e=new n,t=e.add(new Dh(this._editor)),r=new n;return e.add(r),e.add(t.onMouseMoveOrRelevantKeyDown(e=>{let[t]=e,n=this._getInlayHintLabelPart(t),i=this._editor.getModel();if(!n||!i){r.clear();return}let a=new ie;r.add(b(()=>a.dispose(!0))),n.item.resolve(a.token),this._activeInlayHintPart=n.part.command||n.part.location?new o_(n,t.hasTriggerModifier):void 0;let o=i.validatePosition(n.item.hint.position).lineNumber,s=new T(o,1,o,i.getLineMaxColumn(o)),c=this._getInlineHintsForRange(s);this._updateHintsDecorators([s],c),r.add(b(()=>{this._activeInlayHintPart=void 0,this._updateHintsDecorators([s],c)}))})),e.add(t.onCancel(()=>r.clear())),e.add(t.onExecute(async e=>{let t=this._getInlayHintLabelPart(e);if(t){let n=t.part;n.location?this._instaService.invokeFunction($g,e,this._editor,n.location):Be.is(n.command)&&await this._invokeCommand(n.command,t.item)}})),e}_getInlineHintsForRange(e){let t=new Set;for(let n of this._decorationsMetadata.values())e.containsRange(n.item.anchor.range)&&t.add(n.item);return Array.from(t)}_installDblClickGesture(e){return this._editor.onMouseUp(async t=>{if(t.event.detail!==2)return;let n=this._getInlayHintLabelPart(t);if(n&&(t.event.preventDefault(),await n.item.resolve(w.None),On(n.item.hint.textEdits))){let t=n.item.hint.textEdits.map(e=>Fa.replace(T.lift(e.range),e.text));this._editor.executeEdits(`inlayHint.default`,t),e()}})}_installContextMenu(){return this._editor.onContextMenu(async e=>{if(!Bn(e.event.target))return;let t=this._getInlayHintLabelPart(e);t&&await this._instaService.invokeFunction(Qg,this._editor,e.event.target,t)})}_getInlayHintLabelPart(e){if(e.target.type!==6)return;let t=e.target.detail.injectedText?.options;if(t instanceof Zo&&t?.attachedData instanceof a_)return t.attachedData}async _invokeCommand(e,t){try{await this._commandService.executeCommand(e.id,...e.arguments??[])}catch(e){this._notificationService.notify({severity:za.Error,source:t.provider.displayName,message:e})}}_cacheHintsForFastRestore(e){let t=this._copyInlayHintsWithCurrentAnchor(e);this._inlayHintsCache.set(e,t)}_copyInlayHintsWithCurrentAnchor(e){let t=new Map;for(let[n,r]of this._decorationsMetadata){if(t.has(r.item))continue;let i=e.getDecorationRange(n);if(i){let e=new Oh(i,r.item.anchor.direction),n=r.item.with({anchor:e});t.set(r.item,n)}}return Array.from(t.values())}_getHintsRanges(){let e=this._editor.getModel(),t=this._editor.getVisibleRangesPlusViewportAboveBelow(),n=[];for(let r of t.sort(T.compareRangesUsingStarts)){let t=e.validateRange(new T(r.startLineNumber-30,r.startColumn,r.endLineNumber+30,r.endColumn));n.length===0||!T.areIntersectingOrTouching(n[n.length-1],t)?n.push(t):n[n.length-1]=T.plusRange(n[n.length-1],t)}return n}_updateHintsDecorators(e,t){let n=[],r=(e,t,r,i,a)=>{let o={content:r,inlineClassNameAffectsLetterSpacing:!0,inlineClassName:t.className,cursorStops:i,attachedData:a};n.push({item:e,classNameRef:t,decoration:{range:e.anchor.range,options:{description:`InlayHint`,showIfCollapsed:e.anchor.range.isEmpty(),collapseOnReplaceEdit:!e.anchor.range.isEmpty(),stickiness:0,[e.anchor.direction]:this._activeRenderMode===0?o:void 0}}})},i=(e,t)=>{r(e,this._ruleFactory.createClassNameRef({width:`${a/3|0}px`,display:`inline-block`}),``,t?Uo.Right:Uo.None)},{fontSize:a,fontFamily:o,padding:s,isUniform:c}=this._getLayoutInfo(),l=`--code-editorInlayHintsFontFamily`;this._editor.getContainerDomNode().style.setProperty(l,o);let u={line:0,totalLen:0};for(let e of t){if(u.line!==e.anchor.range.startLineNumber&&(u={line:e.anchor.range.startLineNumber,totalLen:0}),u.totalLen>n_._MAX_LABEL_LEN)continue;e.hint.paddingLeft&&i(e,!1);let t=typeof e.hint.label==`string`?[{label:e.hint.label}]:e.hint.label;for(let n=0;n<t.length;n++){let i=t[n],o=n===0,d=n===t.length-1,f={fontSize:`${a}px`,fontFamily:`var(${l}), ${hr.fontFamily}`,verticalAlign:c?`baseline`:`middle`,unicodeBidi:`isolate`};On(e.hint.textEdits)&&(f.cursor=`default`),this._fillInColors(f,e.hint),(i.command||i.location)&&this._activeInlayHintPart?.part.item===e&&this._activeInlayHintPart.part.index===n&&(f.textDecoration=`underline`,this._activeInlayHintPart.hasTriggerModifier&&(f.color=Bc(dt),f.cursor=`pointer`)),s&&(o&&d?(f.padding=`1px ${Math.max(1,a/4)|0}px`,f.borderRadius=`${a/4|0}px`):o?(f.padding=`1px 0 1px ${Math.max(1,a/4)|0}px`,f.borderRadius=`${a/4|0}px 0 0 ${a/4|0}px`):d?(f.padding=`1px ${Math.max(1,a/4)|0}px 1px 0`,f.borderRadius=`0 ${a/4|0}px ${a/4|0}px 0`):f.padding=`1px 0 1px 0`);let p=i.label;u.totalLen+=p.length;let m=!1,h=u.totalLen-n_._MAX_LABEL_LEN;if(h>0&&(p=p.slice(0,-h)+``,m=!0),r(e,this._ruleFactory.createClassNameRef(f),c_(p),d&&!e.hint.paddingRight?Uo.Right:Uo.None,new a_(e,n)),m)break}if(e.hint.paddingRight&&i(e,!0),n.length>n_._MAX_DECORATORS)break}let d=[];for(let[t,n]of this._decorationsMetadata){let r=this._editor.getModel()?.getDecorationRange(t);r&&e.some(e=>e.containsRange(r))&&(d.push(t),n.classNameRef.dispose(),this._decorationsMetadata.delete(t))}let f=Xi.capture(this._editor);this._editor.changeDecorations(e=>{let t=e.deltaDecorations(d,n.map(e=>e.decoration));for(let e=0;e<t.length;e++){let r=n[e];this._decorationsMetadata.set(t[e],r)}}),f.restore(this._editor)}_fillInColors(e,t){t.kind===me.Parameter?(e.backgroundColor=Bc(rr),e.color=Bc(kr)):t.kind===me.Type?(e.backgroundColor=Bc(In),e.color=Bc(Un)):(e.backgroundColor=Bc(Tr),e.color=Bc(Nn))}_getLayoutInfo(){let e=this._editor.getOption(142),t=e.padding,n=this._editor.getOption(52),r=this._editor.getOption(49),i=e.fontSize;(!i||i<5||i>n)&&(i=n);let a=e.fontFamily||r;return{fontSize:i,fontFamily:a,padding:t,isUniform:!t&&a===r&&i===n}}_removeAllDecorations(){this._editor.removeDecorations(Array.from(this._decorationsMetadata.keys()));for(let e of this._decorationsMetadata.values())e.classNameRef.dispose();this._decorationsMetadata.clear()}};s_=n_=e_([t_(1,V),t_(2,Qi),t_(3,i_),t_(4,lc),t_(5,Ro),t_(6,Y)],s_);function c_(e){return e.replace(/[ \t]/g,`\xA0`)}B.registerCommand(`_executeInlayHintProvider`,async(e,...t)=>{let[n,r]=t;o(y.isUri(n)),o(T.isIRange(r));let{inlayHintsProvider:i}=e.get(V),a=await e.get(Bs).createModelReference(n);try{let e=await Ah.create(i,a.object.textEditorModel,[T.lift(r)],w.None),t=e.items.map(e=>e.hint);return setTimeout(()=>e.dispose(),0),t}finally{a.dispose()}});var l_=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},u_=function(e,t){return function(n,r){t(n,r,e)}},d_=class extends cm{constructor(e,t,n,r){super(10,t,e.item.anchor.range,n,r,!0),this.part=e}},f_=class extends gh{constructor(e,t,n,r,i,a,o,s,c){super(e,t,n,a,s,r,i,c),this._resolverService=o,this.hoverOrdinal=6}suggestHoverAnchor(e){if(!s_.get(this._editor)||e.target.type!==6)return null;let t=e.target.detail.injectedText?.options;return t instanceof Zo&&t.attachedData instanceof a_?new d_(t.attachedData,this,e.event.posx,e.event.posy):null}computeSync(){return[]}computeAsync(e,t,n){return e instanceof d_?new Xe(async t=>{let{part:r}=e;if(await r.item.resolve(n),n.isCancellationRequested)return;let i;typeof r.item.hint.tooltip==`string`?i=new Va().appendText(r.item.hint.tooltip):r.item.hint.tooltip&&(i=r.item.hint.tooltip),i&&t.emitOne(new mh(this,e.range,[i],!1,0)),On(r.item.hint.textEdits)&&t.emitOne(new mh(this,e.range,[new Va().appendText(S(`hint.dbl`,`Double-click to insert`))],!1,10001));let a;if(typeof r.part.tooltip==`string`?a=new Va().appendText(r.part.tooltip):r.part.tooltip&&(a=r.part.tooltip),a&&t.emitOne(new mh(this,e.range,[a],!1,1)),r.part.location||r.part.command){let n,i=this._editor.getOption(78)===`altKey`?Le?S(`links.navigate.kb.meta.mac`,`cmd + click`):S(`links.navigate.kb.meta`,`ctrl + click`):Le?S(`links.navigate.kb.alt.mac`,`option + click`):S(`links.navigate.kb.alt`,`alt + click`);r.part.location&&r.part.command?n=new Va().appendText(S(`hint.defAndCommand`,`Go to Definition ({0}), right click for more`,i)):r.part.location?n=new Va().appendText(S(`hint.def`,`Go to Definition ({0})`,i)):r.part.command&&(n=new Va(`[${S(`hint.cmd`,`Execute Command`)}](${jh(r.part.command)} "${r.part.command.title}") (${i})`,{isTrusted:!0})),n&&t.emitOne(new mh(this,e.range,[n],!1,1e4))}let o=await this._resolveInlayHintLabelPartHover(r,n);for await(let e of o)t.emitOne(e)}):Xe.EMPTY}async _resolveInlayHintLabelPartHover(e,t){if(!e.part.location)return Xe.EMPTY;let{uri:n,range:i}=e.part.location,a=await this._resolverService.createModelReference(n);try{let n=a.object.textEditorModel;return this._languageFeaturesService.hoverProvider.has(n)?oh(this._languageFeaturesService.hoverProvider,n,new r(i.startLineNumber,i.startColumn),t).filter(e=>!Xr(e.hover.contents)).map(t=>new mh(this,e.item.anchor.range,t.hover.contents,!1,2+t.ordinal)):Xe.EMPTY}finally{a.dispose()}}};f_=l_([u_(1,Ys),u_(2,wi),u_(3,ua),u_(4,oi),u_(5,F),u_(6,Bs),u_(7,V),u_(8,lc)],f_);var p_=class e extends _{constructor(t,n,r,i,a,o){super();let s=n.anchor,c=n.hoverParts;this._renderedHoverParts=this._register(new h_(t,r,c,o,a));let{showAtPosition:l,showAtSecondaryPosition:u}=e.computeHoverPositions(t,s.range,c);this.shouldAppearBeforeContent=c.some(e=>e.isBeforeContent),this.showAtPosition=l,this.showAtSecondaryPosition=u,this.initialMousePosX=s.initialMousePosX,this.initialMousePosY=s.initialMousePosY,this.shouldFocus=i.shouldFocus,this.source=i.source}get domNode(){return this._renderedHoverParts.domNode}get domNodeHasChildren(){return this._renderedHoverParts.domNodeHasChildren}get focusedHoverPartIndex(){return this._renderedHoverParts.focusedHoverPartIndex}async updateHoverVerbosityLevel(e,t,n){this._renderedHoverParts.updateHoverVerbosityLevel(e,t,n)}isColorPickerVisible(){return this._renderedHoverParts.isColorPickerVisible()}static computeHoverPositions(e,t,n){let i=1;if(e.hasModel()){let n=e._getViewModel(),a=n.coordinatesConverter,o=a.convertModelRangeToViewRange(t),s=n.getLineMinColumn(o.startLineNumber),c=new r(o.startLineNumber,s);i=a.convertViewPositionToModelPosition(c).column}let a=t.startLineNumber,o=t.startColumn,s;for(let e of n){let t=e.range,n=t.startLineNumber===a,r=t.endLineNumber===a;if(n&&r){let e=t.startColumn,n=Math.min(o,e);o=Math.max(n,i)}e.forceShowAtRange&&(s=t)}let c,l;if(s){let e=s.getStartPosition();c=e,l=e}else c=t.getStartPosition(),l=new r(a,o);return{showAtPosition:c,showAtSecondaryPosition:l}}},m_=class{constructor(e,t){this._statusBar=t,e.appendChild(this._statusBar.hoverElement)}get hoverElement(){return this._statusBar.hoverElement}get actions(){return this._statusBar.actions}dispose(){this._statusBar.dispose()}},h_=class t extends _{static#e=this._DECORATION_OPTIONS=U.register({description:`content-hover-highlight`,className:`hoverHighlight`});constructor(e,t,n,r,i){super(),this._renderedParts=[],this._focusedHoverPartIndex=-1,this._context=i,this._fragment=document.createDocumentFragment(),this._register(this._renderParts(t,n,i,r)),this._register(this._registerListenersOnRenderedParts()),this._register(this._createEditorDecorations(e,n)),this._updateMarkdownAndColorParticipantInfo(t)}_createEditorDecorations(e,n){if(n.length===0)return _.None;let r=n[0].range;for(let e of n){let t=e.range;r=T.plusRange(r,t)}let i=e.createDecorationsCollection();return i.set([{range:r,options:t._DECORATION_OPTIONS}]),b(()=>{i.clear()})}_renderParts(e,t,r,i){let a=new rh(i),o={fragment:this._fragment,statusBar:a,...r},s=new n;for(let n of e){let e=this._renderHoverPartsForParticipant(t,n,o);s.add(e);for(let t of e.renderedHoverParts)this._renderedParts.push({type:`hoverPart`,participant:n,hoverPart:t.hoverPart,hoverElement:t.hoverElement})}let c=this._renderStatusBar(this._fragment,a);return c&&(s.add(c),this._renderedParts.push({type:`statusBar`,hoverElement:c.hoverElement,actions:c.actions})),b(()=>{s.dispose()})}_renderHoverPartsForParticipant(e,t,n){let r=e.filter(e=>e.owner===t);return r.length>0?t.renderHoverParts(n,r):new lm([])}_renderStatusBar(e,t){if(t.hasContent)return new m_(e,t)}_registerListenersOnRenderedParts(){let e=new n;return this._renderedParts.forEach((t,n)=>{let r=t.hoverElement;r.tabIndex=0,e.add(D(r,j.FOCUS_IN,e=>{e.stopPropagation(),this._focusedHoverPartIndex=n})),e.add(D(r,j.FOCUS_OUT,e=>{e.stopPropagation(),this._focusedHoverPartIndex=-1}))}),e}_updateMarkdownAndColorParticipantInfo(e){let t=e.find(e=>e instanceof gh&&!(e instanceof f_));t&&(this._markdownHoverParticipant=t),this._colorHoverParticipant=e.find(e=>e instanceof mm)}async updateHoverVerbosityLevel(e,t,n){if(!this._markdownHoverParticipant)return;let r=this._normalizedIndexToMarkdownHoverIndexRange(this._markdownHoverParticipant,t);if(r===void 0)return;let i=await this._markdownHoverParticipant.updateMarkdownHoverVerbosityLevel(e,r,n);i&&(this._renderedParts[t]={type:`hoverPart`,participant:this._markdownHoverParticipant,hoverPart:i.hoverPart,hoverElement:i.hoverElement},this._context.onContentsChanged())}isColorPickerVisible(){return this._colorHoverParticipant?.isColorPickerVisible()??!1}_normalizedIndexToMarkdownHoverIndexRange(t,n){let r=this._renderedParts[n];if(!r||r.type!==`hoverPart`||r.participant!==t)return;let i=this._renderedParts.findIndex(e=>e.type===`hoverPart`&&e.participant===t);if(i===-1)throw new e;return n-i}get domNode(){return this._fragment}get domNodeHasChildren(){return this._fragment.hasChildNodes()}get focusedHoverPartIndex(){return this._focusedHoverPartIndex}},g_=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},__=function(e,t){return function(n,r){t(n,r,e)}},v_=class extends _{constructor(e,t,n){super(),this._editor=e,this._instantiationService=t,this._keybindingService=n,this._currentResult=null,this._onContentsChanged=this._register(new g),this.onContentsChanged=this._onContentsChanged.event,this._contentHoverWidget=this._register(this._instantiationService.createInstance(Ym,this._editor)),this._participants=this._initializeHoverParticipants(),this._computer=new Zm(this._editor,this._participants),this._hoverOperation=this._register(new zm(this._editor,this._computer)),this._registerListeners()}_initializeHoverParticipants(){let e=[];for(let t of um.getAll()){let n=this._instantiationService.createInstance(t,this._editor);e.push(n)}return e.sort((e,t)=>e.hoverOrdinal-t.hoverOrdinal),this._register(this._contentHoverWidget.onDidResize(()=>{this._participants.forEach(e=>e.handleResize?.())})),e}_registerListeners(){this._register(this._hoverOperation.onResult(e=>{if(!this._computer.anchor)return;let t=e.hasLoadingMessage?this._addLoadingMessage(e.value):e.value;this._withResult(new Qm(this._computer.anchor,t,e.isComplete))}));let e=this._contentHoverWidget.getDomNode();this._register(Gn(e,`keydown`,e=>{e.equals(9)&&this.hide()})),this._register(Gn(e,`mouseleave`,e=>{this._onMouseLeave(e)})),this._register(He.onDidChange(()=>{this._contentHoverWidget.position&&this._currentResult&&this._setCurrentResult(this._currentResult)}))}_startShowingOrUpdateHover(e,t,n,r,i){if(!(this._contentHoverWidget.position&&this._currentResult))return e?(this._startHoverOperationIfNecessary(e,t,n,r,!1),!0):!1;let a=this._editor.getOption(60).sticky,o=i&&this._contentHoverWidget.isMouseGettingCloser(i.event.posx,i.event.posy);return a&&o?(e&&this._startHoverOperationIfNecessary(e,t,n,r,!0),!0):e?this._currentResult.anchor.equals(e)?!0:e.canAdoptVisibleHover(this._currentResult.anchor,this._contentHoverWidget.position)?(this._setCurrentResult(this._currentResult.filter(e)),this._startHoverOperationIfNecessary(e,t,n,r,!1),!0):(this._setCurrentResult(null),this._startHoverOperationIfNecessary(e,t,n,r,!1),!0):(this._setCurrentResult(null),!1)}_startHoverOperationIfNecessary(e,t,n,r,i){this._computer.anchor&&this._computer.anchor.equals(e)||(this._hoverOperation.cancel(),this._computer.anchor=e,this._computer.shouldFocus=r,this._computer.source=n,this._computer.insistOnKeepingHoverVisible=i,this._hoverOperation.start(t))}_setCurrentResult(e){let t=e;this._currentResult!==t&&(t&&t.hoverParts.length===0&&(t=null),this._currentResult=t,this._currentResult?this._showHover(this._currentResult):this._hideHover())}_addLoadingMessage(e){if(!this._computer.anchor)return e;for(let t of this._participants){if(!t.createLoadingMessage)continue;let n=t.createLoadingMessage(this._computer.anchor);if(n)return e.slice(0).concat([n])}return e}_withResult(e){if(this._contentHoverWidget.position&&this._currentResult&&this._currentResult.isComplete||this._setCurrentResult(e),!e.isComplete)return;let t=e.hoverParts.length===0,n=this._computer.insistOnKeepingHoverVisible;t&&n||this._setCurrentResult(e)}_showHover(e){let t=this._getHoverContext();this._renderedContentHover=new p_(this._editor,e,this._participants,this._computer,t,this._keybindingService),this._renderedContentHover.domNodeHasChildren?this._contentHoverWidget.show(this._renderedContentHover):this._renderedContentHover.dispose()}_hideHover(){this._contentHoverWidget.hide()}_getHoverContext(){return{hide:()=>{this.hide()},onContentsChanged:()=>{this._onContentsChanged.fire(),this._contentHoverWidget.onContentsChanged()},setMinimumDimensions:e=>{this._contentHoverWidget.setMinimumDimensions(e)}}}showsOrWillShow(e){if(this._contentHoverWidget.isResizing)return!0;let t=this._findHoverAnchorCandidates(e);if(!(t.length>0))return this._startShowingOrUpdateHover(null,0,0,!1,e);let n=t[0];return this._startShowingOrUpdateHover(n,0,0,!1,e)}_findHoverAnchorCandidates(e){let t=[];for(let n of this._participants){if(!n.suggestHoverAnchor)continue;let r=n.suggestHoverAnchor(e);r&&t.push(r)}let n=e.target;switch(n.type){case 6:t.push(new sm(0,n.range,e.event.posx,e.event.posy));break;case 7:{let r=this._editor.getOption(50).typicalHalfwidthCharacterWidth/2;if(!(!n.detail.isAfterLines&&typeof n.detail.horizontalDistanceToText==`number`&&n.detail.horizontalDistanceToText<r))break;t.push(new sm(0,n.range,e.event.posx,e.event.posy));break}}return t.sort((e,t)=>t.priority-e.priority),t}_onMouseLeave(e){let t=this._editor.getDomNode();(!t||!Lm(t,e.x,e.y))&&this.hide()}startShowingAtRange(e,t,n,r){this._startShowingOrUpdateHover(new sm(0,e,void 0,void 0),t,n,r,null)}async updateHoverVerbosityLevel(e,t,n){this._renderedContentHover?.updateHoverVerbosityLevel(e,t,n)}focusedHoverPartIndex(){return this._renderedContentHover?.focusedHoverPartIndex??-1}containsNode(e){return e?this._contentHoverWidget.getDomNode().contains(e):!1}focus(){this._contentHoverWidget.focus()}scrollUp(){this._contentHoverWidget.scrollUp()}scrollDown(){this._contentHoverWidget.scrollDown()}scrollLeft(){this._contentHoverWidget.scrollLeft()}scrollRight(){this._contentHoverWidget.scrollRight()}pageUp(){this._contentHoverWidget.pageUp()}pageDown(){this._contentHoverWidget.pageDown()}goToTop(){this._contentHoverWidget.goToTop()}goToBottom(){this._contentHoverWidget.goToBottom()}hide(){this._computer.anchor=null,this._hoverOperation.cancel(),this._setCurrentResult(null)}getDomNode(){return this._contentHoverWidget.getDomNode()}get isColorPickerVisible(){return this._renderedContentHover?.isColorPickerVisible()??!1}get isVisibleFromKeyboard(){return this._contentHoverWidget.isVisibleFromKeyboard}get isVisible(){return this._contentHoverWidget.isVisible}get isFocused(){return this._contentHoverWidget.isFocused}get isResizing(){return this._contentHoverWidget.isResizing}get widget(){return this._contentHoverWidget}};v_=g_([__(1,Y),__(2,ua)],v_);var y_=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},b_=function(e,t){return function(n,r){t(n,r,e)}},x_,S_=class extends _{static#e=x_=this;static#t=this.ID=`editor.contrib.contentHover`;constructor(e,t,r){super(),this._editor=e,this._instantiationService=t,this._keybindingService=r,this._onHoverContentsChanged=this._register(new g),this.shouldKeepOpenOnEditorMouseMoveOrLeave=!1,this._listenersStore=new n,this._hoverState={mouseDown:!1,activatedByDecoratorClick:!1},this._reactToEditorMouseMoveRunner=this._register(new yt(()=>this._reactToEditorMouseMove(this._mouseMoveEvent),0)),this._hookListeners(),this._register(this._editor.onDidChangeConfiguration(e=>{e.hasChanged(60)&&(this._unhookListeners(),this._hookListeners())}))}static get(e){return e.getContribution(x_.ID)}_hookListeners(){let e=this._editor.getOption(60);this._hoverSettings={enabled:e.enabled,sticky:e.sticky,hidingDelay:e.hidingDelay},e.enabled?(this._listenersStore.add(this._editor.onMouseDown(e=>this._onEditorMouseDown(e))),this._listenersStore.add(this._editor.onMouseUp(()=>this._onEditorMouseUp())),this._listenersStore.add(this._editor.onMouseMove(e=>this._onEditorMouseMove(e))),this._listenersStore.add(this._editor.onKeyDown(e=>this._onKeyDown(e)))):(this._listenersStore.add(this._editor.onMouseMove(e=>this._onEditorMouseMove(e))),this._listenersStore.add(this._editor.onKeyDown(e=>this._onKeyDown(e)))),this._listenersStore.add(this._editor.onMouseLeave(e=>this._onEditorMouseLeave(e))),this._listenersStore.add(this._editor.onDidChangeModel(()=>{this._cancelScheduler(),this._hideWidgets()})),this._listenersStore.add(this._editor.onDidChangeModelContent(()=>this._cancelScheduler())),this._listenersStore.add(this._editor.onDidScrollChange(e=>this._onEditorScrollChanged(e)))}_unhookListeners(){this._listenersStore.clear()}_cancelScheduler(){this._mouseMoveEvent=void 0,this._reactToEditorMouseMoveRunner.cancel()}_onEditorScrollChanged(e){(e.scrollTopChanged||e.scrollLeftChanged)&&this._hideWidgets()}_onEditorMouseDown(e){this._hoverState.mouseDown=!0,!this._shouldNotHideCurrentHoverWidget(e)&&this._hideWidgets()}_shouldNotHideCurrentHoverWidget(e){return this._isMouseOnContentHoverWidget(e)||this._isContentWidgetResizing()}_isMouseOnContentHoverWidget(e){let t=this._contentWidget?.getDomNode();return t?Lm(t,e.event.posx,e.event.posy):!1}_onEditorMouseUp(){this._hoverState.mouseDown=!1}_onEditorMouseLeave(e){this.shouldKeepOpenOnEditorMouseMoveOrLeave||(this._cancelScheduler(),!this._shouldNotHideCurrentHoverWidget(e)&&this._hideWidgets())}_shouldNotRecomputeCurrentHoverWidget(e){let t=this._hoverSettings.sticky;return((e,t)=>{let n=this._isMouseOnContentHoverWidget(e);return t&&n})(e,t)||(e=>{let t=this._isMouseOnContentHoverWidget(e),n=this._contentWidget?.isColorPickerVisible??!1;return t&&n})(e)||((e,t)=>(t&&this._contentWidget?.containsNode(e.event.browserEvent.view?.document.activeElement)&&!e.event.browserEvent.view?.getSelection()?.isCollapsed)??!1)(e,t)}_onEditorMouseMove(e){if(this.shouldKeepOpenOnEditorMouseMoveOrLeave||(this._mouseMoveEvent=e,this._contentWidget?.isFocused||this._contentWidget?.isResizing))return;let t=this._hoverSettings.sticky;if(t&&this._contentWidget?.isVisibleFromKeyboard)return;if(this._shouldNotRecomputeCurrentHoverWidget(e)){this._reactToEditorMouseMoveRunner.cancel();return}let n=this._hoverSettings.hidingDelay;if(this._contentWidget?.isVisible&&t&&n>0){this._reactToEditorMouseMoveRunner.isScheduled()||this._reactToEditorMouseMoveRunner.schedule(n);return}this._reactToEditorMouseMove(e)}_reactToEditorMouseMove(e){if(!e)return;let t=e.target.element?.classList.contains(`colorpicker-color-decoration`),n=this._editor.getOption(149),r=this._hoverSettings.enabled,i=this._hoverState.activatedByDecoratorClick;if(t&&(n===`click`&&!i||n===`hover`&&!r||n===`clickAndHover`&&!r&&!i)||!t&&!r&&!i){this._hideWidgets();return}this._tryShowHoverWidget(e)||this._hideWidgets()}_tryShowHoverWidget(e){return this._getOrCreateContentWidget().showsOrWillShow(e)}_onKeyDown(e){if(!this._editor.hasModel())return;let t=this._keybindingService.softDispatch(e,this._editor.getDomNode()),n=t.kind===1||t.kind===2&&(t.commandId===`editor.action.showHover`||t.commandId===`editor.action.increaseHoverVerbosityLevel`||t.commandId===`editor.action.decreaseHoverVerbosityLevel`)&&this._contentWidget?.isVisible;e.keyCode===5||e.keyCode===6||e.keyCode===57||e.keyCode===4||n||this._hideWidgets()}_hideWidgets(){this._hoverState.mouseDown&&this._contentWidget?.isColorPickerVisible||Nm.dropDownVisible||(this._hoverState.activatedByDecoratorClick=!1,this._contentWidget?.hide())}_getOrCreateContentWidget(){return this._contentWidget||(this._contentWidget=this._instantiationService.createInstance(v_,this._editor),this._listenersStore.add(this._contentWidget.onContentsChanged(()=>this._onHoverContentsChanged.fire()))),this._contentWidget}showContentHover(e,t,n,r,i=!1){this._hoverState.activatedByDecoratorClick=i,this._getOrCreateContentWidget().startShowingAtRange(e,t,n,r)}_isContentWidgetResizing(){return this._contentWidget?.widget.isResizing||!1}focusedHoverPartIndex(){return this._getOrCreateContentWidget().focusedHoverPartIndex()}updateHoverVerbosityLevel(e,t,n){this._getOrCreateContentWidget().updateHoverVerbosityLevel(e,t,n)}focus(){this._contentWidget?.focus()}scrollUp(){this._contentWidget?.scrollUp()}scrollDown(){this._contentWidget?.scrollDown()}scrollLeft(){this._contentWidget?.scrollLeft()}scrollRight(){this._contentWidget?.scrollRight()}pageUp(){this._contentWidget?.pageUp()}pageDown(){this._contentWidget?.pageDown()}goToTop(){this._contentWidget?.goToTop()}goToBottom(){this._contentWidget?.goToBottom()}get isColorPickerVisible(){return this._contentWidget?.isColorPickerVisible}get isHoverVisible(){return this._contentWidget?.isVisible}dispose(){super.dispose(),this._unhookListeners(),this._listenersStore.dispose(),this._contentWidget?.dispose()}};S_=x_=y_([b_(1,Y),b_(2,ua)],S_);var C_=class extends _{static#e=this.ID=`editor.contrib.colorContribution`;constructor(e){super(),this._editor=e,this._register(e.onMouseDown(e=>this.onMouseDown(e)))}dispose(){super.dispose()}onMouseDown(e){let t=this._editor.getOption(149);if(t!==`click`&&t!==`clickAndHover`)return;let n=e.target;if(n.type!==6||!n.detail.injectedText||n.detail.injectedText.options.attachedData!==qp||!n.range)return;let r=this._editor.getContribution(S_.ID);if(r&&!r.isColorPickerVisible){let e=new T(n.range.startLineNumber,n.range.startColumn+1,n.range.endLineNumber,n.range.endColumn+1);r.showContentHover(e,1,0,!1,!0)}}};I(C_.ID,C_,2),um.register(mm);var w_=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},T_=function(e,t){return function(n,r){t(n,r,e)}},E_,D_,O_=class extends _{static#e=E_=this;static#t=this.ID=`editor.contrib.standaloneColorPickerController`;constructor(e,t,n){super(),this._editor=e,this._instantiationService=n,this._standaloneColorPickerWidget=null,this._standaloneColorPickerVisible=q.standaloneColorPickerVisible.bindTo(t),this._standaloneColorPickerFocused=q.standaloneColorPickerFocused.bindTo(t)}showOrFocus(){this._editor.hasModel()&&(this._standaloneColorPickerVisible.get()?this._standaloneColorPickerFocused.get()||this._standaloneColorPickerWidget?.focus():this._standaloneColorPickerWidget=this._instantiationService.createInstance(j_,this._editor,this._standaloneColorPickerVisible,this._standaloneColorPickerFocused))}hide(){this._standaloneColorPickerFocused.set(!1),this._standaloneColorPickerVisible.set(!1),this._standaloneColorPickerWidget?.hide(),this._editor.focus()}insertColor(){this._standaloneColorPickerWidget?.updateEditor(),this.hide()}static get(e){return e.getContribution(E_.ID)}};O_=E_=w_([T_(1,W),T_(2,Y)],O_),I(O_.ID,O_,1);var k_=8,A_=22,j_=class extends _{static#e=D_=this;static#t=this.ID=`editor.contrib.standaloneColorPickerWidget`;constructor(e,t,n,r,i,a,o){super(),this._editor=e,this._standaloneColorPickerVisible=t,this._standaloneColorPickerFocused=n,this._keybindingService=i,this._languageFeaturesService=a,this._editorWorkerService=o,this.allowEditorOverflow=!0,this._position=void 0,this._body=document.createElement(`div`),this._colorHover=null,this._selectionSetInEditor=!1,this._onResult=this._register(new g),this.onResult=this._onResult.event,this._standaloneColorPickerVisible.set(!0),this._standaloneColorPickerParticipant=r.createInstance(gm,this._editor),this._position=this._editor._getViewModel()?.getPrimaryCursorState().modelState.position;let s=this._editor.getSelection(),c=s?{startLineNumber:s.startLineNumber,startColumn:s.startColumn,endLineNumber:s.endLineNumber,endColumn:s.endColumn}:{startLineNumber:0,endLineNumber:0,endColumn:0,startColumn:0},l=this._register(An(this._body));this._register(l.onDidBlur(e=>{this.hide()})),this._register(l.onDidFocus(e=>{this.focus()})),this._register(this._editor.onDidChangeCursorPosition(()=>{this._selectionSetInEditor?this._selectionSetInEditor=!1:this.hide()})),this._register(this._editor.onMouseMove(e=>{let t=e.target.element?.classList;t&&t.contains(`colorpicker-color-decoration`)&&this.hide()})),this._register(this.onResult(e=>{this._render(e.value,e.foundInEditor)})),this._start(c),this._body.style.zIndex=`50`,this._editor.addContentWidget(this)}updateEditor(){this._colorHover&&this._standaloneColorPickerParticipant.updateEditorModel(this._colorHover)}getId(){return D_.ID}getDomNode(){return this._body}getPosition(){if(!this._position)return null;let e=this._editor.getOption(60).above;return{position:this._position,secondaryPosition:this._position,preference:e?[1,2]:[2,1],positionAffinity:2}}hide(){this.dispose(),this._standaloneColorPickerVisible.set(!1),this._standaloneColorPickerFocused.set(!1),this._editor.removeContentWidget(this),this._editor.focus()}focus(){this._standaloneColorPickerFocused.set(!0),this._body.focus()}async _start(e){let t=await this._computeAsync(e);t&&this._onResult.fire(new M_(t.result,t.foundInEditor))}async _computeAsync(e){if(!this._editor.hasModel())return null;let t={range:e,color:{red:0,green:0,blue:0,alpha:1}},n=await this._standaloneColorPickerParticipant.createColorHover(t,new Fp(this._editorWorkerService),this._languageFeaturesService.colorProvider);return n?{result:n.colorHover,foundInEditor:n.foundInEditor}:null}_render(e,t){let n=document.createDocumentFragment(),r={fragment:n,statusBar:this._register(new rh(this._keybindingService)),onContentsChanged:()=>{},hide:()=>this.hide()};this._colorHover=e;let i=this._standaloneColorPickerParticipant.renderHoverParts(r,[e]);if(!i)return;this._register(i.disposables);let a=i.colorPicker;this._body.classList.add(`standalone-colorpicker-body`),this._body.style.maxHeight=Math.max(this._editor.getLayoutInfo().height/4,250)+`px`,this._body.style.maxWidth=Math.max(this._editor.getLayoutInfo().width*.66,500)+`px`,this._body.tabIndex=0,this._body.appendChild(n),a.layout();let o=a.body,s=o.saturationBox.domNode.clientWidth,c=o.domNode.clientWidth-s-A_-k_,l=a.body.enterButton;l?.onClicked(()=>{this.updateEditor(),this.hide()});let u=a.header,d=u.pickedColorNode;d.style.width=s+k_+`px`;let f=u.originalColorNode;f.style.width=c+`px`,a.header.closeButton?.onClicked(()=>{this.hide()}),t&&(l&&(l.button.textContent=`Replace`),this._selectionSetInEditor=!0,this._editor.setSelection(e.range)),this._editor.layoutContentWidget(this)}};j_=D_=w_([T_(3,Y),T_(4,ua),T_(5,V),T_(6,pi)],j_);var M_=class{constructor(e,t){this.value=e,this.foundInEditor=t}},N_=class extends Gi{constructor(){super({id:`editor.action.showOrFocusStandaloneColorPicker`,title:{...x(`showOrFocusStandaloneColorPicker`,`Show or Focus Standalone Color Picker`),mnemonicTitle:S({key:`mishowOrFocusStandaloneColorPicker`,comment:[`&& denotes a mnemonic`]},`&&Show or Focus Standalone Color Picker`)},precondition:void 0,menu:[{id:R.CommandPalette}],metadata:{description:x(`showOrFocusStandaloneColorPickerDescription`,`Show or focus a standalone color picker which uses the default color provider. It displays hex/rgb/hsl colors.`)}})}runEditorCommand(e,t){O_.get(t)?.showOrFocus()}},P_=class extends N{constructor(){super({id:`editor.action.hideColorPicker`,label:S({key:`hideColorPicker`,comment:[`Action that hides the color picker`]},`Hide the Color Picker`),alias:`Hide the Color Picker`,precondition:q.standaloneColorPickerVisible.isEqualTo(!0),kbOpts:{primary:9,weight:100},metadata:{description:x(`hideColorPickerDescription`,`Hide the standalone color picker.`)}})}run(e,t){O_.get(t)?.hide()}},F_=class extends N{constructor(){super({id:`editor.action.insertColorWithStandaloneColorPicker`,label:S({key:`insertColorWithStandaloneColorPicker`,comment:[`Action that inserts color with standalone color picker`]},`Insert Color with Standalone Color Picker`),alias:`Insert Color with Standalone Color Picker`,precondition:q.standaloneColorPickerFocused.isEqualTo(!0),kbOpts:{primary:3,weight:100},metadata:{description:x(`insertColorWithStandaloneColorPickerDescription`,`Insert hex/rgb/hsl colors with the focused standalone color picker.`)}})}run(e,t){O_.get(t)?.insertColor()}};L(P_),L(F_),H(N_);var I_=class e{constructor(e,t,n){this.languageConfigurationService=n,this._selection=e,this._insertSpace=t,this._usedEndToken=null}static _haystackHasNeedleAtOffset(e,t,n){if(n<0)return!1;let r=t.length,i=e.length;if(n+r>i)return!1;for(let i=0;i<r;i++){let r=e.charCodeAt(n+i),a=t.charCodeAt(i);if(r!==a&&!(r>=65&&r<=90&&r+32===a)&&!(a>=65&&a<=90&&a+32===r))return!1}return!0}_createOperationsForBlockComment(t,n,r,i,a,o){let s=t.startLineNumber,c=t.startColumn,l=t.endLineNumber,u=t.endColumn,d=a.getLineContent(s),f=a.getLineContent(l),p=d.lastIndexOf(n,c-1+n.length),m=f.indexOf(r,u-1-r.length);if(p!==-1&&m!==-1)if(s===l)d.substring(p+n.length,m).indexOf(r)>=0&&(p=-1,m=-1);else{let e=d.substring(p+n.length),t=f.substring(0,m);(e.indexOf(r)>=0||t.indexOf(r)>=0)&&(p=-1,m=-1)}let h;p!==-1&&m!==-1?(i&&p+n.length<d.length&&d.charCodeAt(p+n.length)===32&&(n+=` `),i&&m>0&&f.charCodeAt(m-1)===32&&(r=` `+r,--m),h=e._createRemoveBlockCommentOperations(new T(s,p+n.length+1,l,m+1),n,r)):(h=e._createAddBlockCommentOperations(t,n,r,this._insertSpace),this._usedEndToken=h.length===1?r:null);for(let e of h)o.addTrackedEditOperation(e.range,e.text)}static _createRemoveBlockCommentOperations(e,t,n){let r=[];return T.isEmpty(e)?r.push(Fa.delete(new T(e.startLineNumber,e.startColumn-t.length,e.endLineNumber,e.endColumn+n.length))):(r.push(Fa.delete(new T(e.startLineNumber,e.startColumn-t.length,e.startLineNumber,e.startColumn))),r.push(Fa.delete(new T(e.endLineNumber,e.endColumn,e.endLineNumber,e.endColumn+n.length)))),r}static _createAddBlockCommentOperations(e,t,n,i){let a=[];return T.isEmpty(e)?a.push(Fa.replace(new T(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn),t+`  `+n)):(a.push(Fa.insert(new r(e.startLineNumber,e.startColumn),t+(i?` `:``))),a.push(Fa.insert(new r(e.endLineNumber,e.endColumn),(i?` `:``)+n))),a}getEditOperations(e,t){let n=this._selection.startLineNumber,r=this._selection.startColumn;e.tokenization.tokenizeIfCheap(n);let i=e.getLanguageIdAtPosition(n,r),a=this.languageConfigurationService.getLanguageConfiguration(i).comments;!a||!a.blockCommentStartToken||!a.blockCommentEndToken||this._createOperationsForBlockComment(this._selection,a.blockCommentStartToken,a.blockCommentEndToken,this._insertSpace,e,t)}computeCursorState(e,t){let n=t.getInverseEditOperations();if(n.length===2){let e=n[0],t=n[1];return new v(e.range.endLineNumber,e.range.endColumn,t.range.startLineNumber,t.range.startColumn)}else{let e=n[0].range,t=this._usedEndToken?-this._usedEndToken.length-1:0;return new v(e.endLineNumber,e.endColumn+t,e.endLineNumber,e.endColumn+t)}}},L_=class e{constructor(e,t,n,r,i,a,o){this.languageConfigurationService=e,this._selection=t,this._indentSize=n,this._type=r,this._insertSpace=i,this._selectionId=null,this._deltaColumn=0,this._moveEndPositionDown=!1,this._ignoreEmptyLines=a,this._ignoreFirstLine=o||!1}static _gatherPreflightCommentStrings(e,t,n,r){e.tokenization.tokenizeIfCheap(t);let i=e.getLanguageIdAtPosition(t,1),a=r.getLanguageConfiguration(i).comments,o=a?a.lineCommentToken:null;if(!o)return null;let s=[];for(let e=0,r=n-t+1;e<r;e++)s[e]={ignore:!1,commentStr:o,commentStrOffset:0,commentStrLength:o.length};return s}static _analyzeLines(e,t,n,r,i,a,o,s){let c=!0,l;l=e===0?!0:e!==1;for(let s=0,u=r.length;s<u;s++){let u=r[s],d=i+s;if(d===i&&o){u.ignore=!0;continue}let f=n.getLineContent(d),p=hn(f);if(p===-1){u.ignore=a,u.commentStrOffset=f.length;continue}if(c=!1,u.ignore=!1,u.commentStrOffset=p,l&&!I_._haystackHasNeedleAtOffset(f,u.commentStr,p)&&(e===0?l=!1:e===1||(u.ignore=!0)),l&&t){let e=p+u.commentStrLength;e<f.length&&f.charCodeAt(e)===32&&(u.commentStrLength+=1)}}if(e===0&&c){l=!1;for(let e=0,t=r.length;e<t;e++)r[e].ignore=!1}return{supported:!0,shouldRemoveComments:l,lines:r}}static _gatherPreflightData(t,n,r,i,a,o,s,c){let l=e._gatherPreflightCommentStrings(r,i,a,c);return l===null?{supported:!1}:e._analyzeLines(t,n,r,l,i,o,s,c)}_executeLineComments(t,n,i,a){let o;i.shouldRemoveComments?o=e._createRemoveLineCommentsOperations(i.lines,a.startLineNumber):(e._normalizeInsertionPoint(t,i.lines,a.startLineNumber,this._indentSize),o=this._createAddLineCommentsOperations(i.lines,a.startLineNumber));let s=new r(a.positionLineNumber,a.positionColumn);for(let e=0,r=o.length;e<r;e++)n.addEditOperation(o[e].range,o[e].text),T.isEmpty(o[e].range)&&T.getStartPosition(o[e].range).equals(s)&&t.getLineContent(s.lineNumber).length+1===s.column&&(this._deltaColumn=(o[e].text||``).length);this._selectionId=n.trackSelection(a)}_attemptRemoveBlockComment(e,t,n,r){let i=t.startLineNumber,a=t.endLineNumber,o=r.length+Math.max(e.getLineFirstNonWhitespaceColumn(t.startLineNumber),t.startColumn),s=e.getLineContent(i).lastIndexOf(n,o-1),c=e.getLineContent(a).indexOf(r,t.endColumn-1-n.length);return s!==-1&&c===-1&&(c=e.getLineContent(i).indexOf(r,s+n.length),a=i),s===-1&&c!==-1&&(s=e.getLineContent(a).lastIndexOf(n,c),i=a),t.isEmpty()&&(s===-1||c===-1)&&(s=e.getLineContent(i).indexOf(n),s!==-1&&(c=e.getLineContent(i).indexOf(r,s+n.length))),s!==-1&&e.getLineContent(i).charCodeAt(s+n.length)===32&&(n+=` `),c!==-1&&e.getLineContent(a).charCodeAt(c-1)===32&&(r=` `+r,--c),s!==-1&&c!==-1?I_._createRemoveBlockCommentOperations(new T(i,s+n.length+1,a,c+1),n,r):null}_executeBlockComment(e,t,n){e.tokenization.tokenizeIfCheap(n.startLineNumber);let r=e.getLanguageIdAtPosition(n.startLineNumber,1),i=this.languageConfigurationService.getLanguageConfiguration(r).comments;if(!i||!i.blockCommentStartToken||!i.blockCommentEndToken)return;let a=i.blockCommentStartToken,o=i.blockCommentEndToken,s=this._attemptRemoveBlockComment(e,n,a,o);if(!s){if(n.isEmpty()){let t=e.getLineContent(n.startLineNumber),r=hn(t);r===-1&&(r=t.length),s=I_._createAddBlockCommentOperations(new T(n.startLineNumber,r+1,n.startLineNumber,t.length+1),a,o,this._insertSpace)}else s=I_._createAddBlockCommentOperations(new T(n.startLineNumber,e.getLineFirstNonWhitespaceColumn(n.startLineNumber),n.endLineNumber,e.getLineMaxColumn(n.endLineNumber)),a,o,this._insertSpace);s.length===1&&(this._deltaColumn=a.length+1)}this._selectionId=t.trackSelection(n);for(let e of s)t.addEditOperation(e.range,e.text)}getEditOperations(t,n){let r=this._selection;if(this._moveEndPositionDown=!1,r.startLineNumber===r.endLineNumber&&this._ignoreFirstLine){n.addEditOperation(new T(r.startLineNumber,t.getLineMaxColumn(r.startLineNumber),r.startLineNumber+1,1),r.startLineNumber===t.getLineCount()?``:`
`),this._selectionId=n.trackSelection(r);return}r.startLineNumber<r.endLineNumber&&r.endColumn===1&&(this._moveEndPositionDown=!0,r=r.setEndPosition(r.endLineNumber-1,t.getLineMaxColumn(r.endLineNumber-1)));let i=e._gatherPreflightData(this._type,this._insertSpace,t,r.startLineNumber,r.endLineNumber,this._ignoreEmptyLines,this._ignoreFirstLine,this.languageConfigurationService);return i.supported?this._executeLineComments(t,n,i,r):this._executeBlockComment(t,n,r)}computeCursorState(e,t){let n=t.getTrackedSelection(this._selectionId);return this._moveEndPositionDown&&(n=n.setEndPosition(n.endLineNumber+1,1)),new v(n.selectionStartLineNumber,n.selectionStartColumn+this._deltaColumn,n.positionLineNumber,n.positionColumn+this._deltaColumn)}static _createRemoveLineCommentsOperations(e,t){let n=[];for(let r=0,i=e.length;r<i;r++){let i=e[r];i.ignore||n.push(Fa.delete(new T(t+r,i.commentStrOffset+1,t+r,i.commentStrOffset+i.commentStrLength+1)))}return n}_createAddLineCommentsOperations(e,t){let n=[],i=this._insertSpace?` `:``;for(let a=0,o=e.length;a<o;a++){let o=e[a];o.ignore||n.push(Fa.insert(new r(t+a,o.commentStrOffset+1),o.commentStr+i))}return n}static nextVisibleColumn(e,t,n,r){return n?e+(t-e%t):e+r}static _normalizeInsertionPoint(t,n,r,i){let a=1073741824,o,s;for(let o=0,s=n.length;o<s;o++){if(n[o].ignore)continue;let s=t.getLineContent(r+o),c=0;for(let t=0,r=n[o].commentStrOffset;c<a&&t<r;t++)c=e.nextVisibleColumn(c,i,s.charCodeAt(t)===9,1);c<a&&(a=c)}a=Math.floor(a/i)*i;for(let c=0,l=n.length;c<l;c++){if(n[c].ignore)continue;let l=t.getLineContent(r+c),u=0;for(o=0,s=n[c].commentStrOffset;u<a&&o<s;o++)u=e.nextVisibleColumn(u,i,l.charCodeAt(o)===9,1);u>a?n[c].commentStrOffset=o-1:n[c].commentStrOffset=o}}},R_=class extends N{constructor(e,t){super(t),this._type=e}run(e,t){let n=e.get(Ci);if(!t.hasModel())return;let r=t.getModel(),i=[],a=r.getOptions(),o=t.getOption(23),s=t.getSelections().map((e,t)=>({selection:e,index:t,ignoreFirstLine:!1}));s.sort((e,t)=>T.compareRangesUsingStarts(e.selection,t.selection));let c=s[0];for(let e=1;e<s.length;e++){let t=s[e];c.selection.endLineNumber===t.selection.startLineNumber&&(c.index<t.index?t.ignoreFirstLine=!0:(c.ignoreFirstLine=!0,c=t))}for(let e of s)i.push(new L_(n,e.selection,a.indentSize,this._type,o.insertSpace,o.ignoreEmptyLines,e.ignoreFirstLine));t.pushUndoStop(),t.executeCommands(this.id,i),t.pushUndoStop()}},z_=class extends R_{constructor(){super(0,{id:`editor.action.commentLine`,label:S(`comment.line`,`Toggle Line Comment`),alias:`Toggle Line Comment`,precondition:q.writable,kbOpts:{kbExpr:q.editorTextFocus,primary:2138,weight:100},menuOpts:{menuId:R.MenubarEditMenu,group:`5_insert`,title:S({key:`miToggleLineComment`,comment:[`&& denotes a mnemonic`]},`&&Toggle Line Comment`),order:1}})}},B_=class extends R_{constructor(){super(1,{id:`editor.action.addCommentLine`,label:S(`comment.line.add`,`Add Line Comment`),alias:`Add Line Comment`,precondition:q.writable,kbOpts:{kbExpr:q.editorTextFocus,primary:ne(2089,2081),weight:100}})}},V_=class extends R_{constructor(){super(2,{id:`editor.action.removeCommentLine`,label:S(`comment.line.remove`,`Remove Line Comment`),alias:`Remove Line Comment`,precondition:q.writable,kbOpts:{kbExpr:q.editorTextFocus,primary:ne(2089,2099),weight:100}})}},H_=class extends N{constructor(){super({id:`editor.action.blockComment`,label:S(`comment.block`,`Toggle Block Comment`),alias:`Toggle Block Comment`,precondition:q.writable,kbOpts:{kbExpr:q.editorTextFocus,primary:1567,linux:{primary:3103},weight:100},menuOpts:{menuId:R.MenubarEditMenu,group:`5_insert`,title:S({key:`miToggleBlockComment`,comment:[`&& denotes a mnemonic`]},`Toggle &&Block Comment`),order:2}})}run(e,t){let n=e.get(Ci);if(!t.hasModel())return;let r=t.getOption(23),i=[],a=t.getSelections();for(let e of a)i.push(new I_(e,r.insertSpace,n));t.pushUndoStop(),t.executeCommands(this.id,i),t.pushUndoStop()}};L(z_),L(B_),L(V_),L(H_);var U_=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},W_=function(e,t){return function(n,r){t(n,r,e)}},G_,K_=class{static#e=G_=this;static#t=this.ID=`editor.contrib.contextmenu`;static get(e){return e.getContribution(G_.ID)}constructor(e,t,r,i,a,o,s,c){this._contextMenuService=t,this._contextViewService=r,this._contextKeyService=i,this._keybindingService=a,this._menuService=o,this._configurationService=s,this._workspaceContextService=c,this._toDispose=new n,this._contextMenuIsBeingShownCount=0,this._editor=e,this._toDispose.add(this._editor.onContextMenu(e=>this._onContextMenu(e))),this._toDispose.add(this._editor.onMouseWheel(e=>{if(this._contextMenuIsBeingShownCount>0){let t=this._contextViewService.getContextViewElement(),n=e.srcElement;n.shadowRoot&&qt(t)===n.shadowRoot||this._contextViewService.hideContextView()}})),this._toDispose.add(this._editor.onKeyDown(e=>{this._editor.getOption(24)&&e.keyCode===58&&(e.preventDefault(),e.stopPropagation(),this.showContextMenu())}))}_onContextMenu(e){if(!this._editor.hasModel())return;if(!this._editor.getOption(24)){this._editor.focus(),e.target.position&&!this._editor.getSelection().containsPosition(e.target.position)&&this._editor.setPosition(e.target.position);return}if(e.target.type===12||e.target.type===6&&e.target.detail.injectedText)return;if(e.event.preventDefault(),e.event.stopPropagation(),e.target.type===11)return this._showScrollbarContextMenu(e.event);if(e.target.type!==6&&e.target.type!==7&&e.target.type!==1)return;if(this._editor.focus(),e.target.position){let t=!1;for(let n of this._editor.getSelections())if(n.containsPosition(e.target.position)){t=!0;break}t||this._editor.setPosition(e.target.position)}let t=null;e.target.type!==1&&(t=e.event),this.showContextMenu(t)}showContextMenu(e){if(!this._editor.getOption(24)||!this._editor.hasModel())return;let t=this._getMenuActions(this._editor.getModel(),this._editor.contextMenuId);t.length>0&&this._doShowContextMenu(t,e)}_getMenuActions(e,t){let n=[],r=this._menuService.getMenuActions(t,this._contextKeyService,{arg:e.uri});for(let t of r){let[,r]=t,i=0;for(let t of r)if(t instanceof xs){let r=this._getMenuActions(e,t.item.submenu);r.length>0&&(n.push(new jc(t.id,t.label,r)),i++)}else n.push(t),i++;i&&n.push(new Ds)}return n.length&&n.pop(),n}_doShowContextMenu(e,t=null){if(!this._editor.hasModel())return;let n=this._editor.getOption(60);this._editor.updateOptions({hover:{enabled:!1}});let r=t;if(!r){this._editor.revealPosition(this._editor.getPosition(),1),this._editor.render();let e=this._editor.getScrolledVisiblePosition(this._editor.getPosition()),t=gt(this._editor.getDomNode());r={x:t.left+e.left,y:t.top+e.top+e.height}}let i=this._editor.getOption(128)&&!xe;this._contextMenuIsBeingShownCount++,this._contextMenuService.showContextMenu({domForShadowRoot:i?this._editor.getOverflowWidgetsDomNode()??this._editor.getDomNode():void 0,getAnchor:()=>r,getActions:()=>e,getActionViewItem:e=>{let t=this._keybindingFor(e);if(t)return new da(e,e,{label:!0,keybinding:t.getLabel(),isMenu:!0});let n=e;return typeof n.getActionViewItem==`function`?n.getActionViewItem():new da(e,e,{icon:!0,label:!0,isMenu:!0})},getKeyBinding:e=>this._keybindingFor(e),onHide:e=>{this._contextMenuIsBeingShownCount--,this._editor.updateOptions({hover:n})}})}_showScrollbarContextMenu(e){if(!this._editor.hasModel()||bi(this._workspaceContextService.getWorkspace()))return;let t=this._editor.getOption(73),n=0,r=e=>({id:`menu-action-${++n}`,label:e.label,tooltip:``,class:void 0,enabled:e.enabled===void 0?!0:e.enabled,checked:e.checked,run:e.run}),i=(e,t)=>new jc(`menu-action-${++n}`,e,t,void 0),a=(e,t,n,a,o)=>{if(!t)return r({label:e,enabled:t,run:()=>{}});let s=e=>()=>{this._configurationService.updateValue(n,e)},c=[];for(let e of o)c.push(r({label:e.label,checked:a===e.value,run:s(e.value)}));return i(e,c)},o=[];o.push(r({label:S(`context.minimap.minimap`,`Minimap`),checked:t.enabled,run:()=>{this._configurationService.updateValue(`editor.minimap.enabled`,!t.enabled)}})),o.push(new Ds),o.push(r({label:S(`context.minimap.renderCharacters`,`Render Characters`),enabled:t.enabled,checked:t.renderCharacters,run:()=>{this._configurationService.updateValue(`editor.minimap.renderCharacters`,!t.renderCharacters)}})),o.push(a(S(`context.minimap.size`,`Vertical size`),t.enabled,`editor.minimap.size`,t.size,[{label:S(`context.minimap.size.proportional`,`Proportional`),value:`proportional`},{label:S(`context.minimap.size.fill`,`Fill`),value:`fill`},{label:S(`context.minimap.size.fit`,`Fit`),value:`fit`}])),o.push(a(S(`context.minimap.slider`,`Slider`),t.enabled,`editor.minimap.showSlider`,t.showSlider,[{label:S(`context.minimap.slider.mouseover`,`Mouse Over`),value:`mouseover`},{label:S(`context.minimap.slider.always`,`Always`),value:`always`}]));let s=this._editor.getOption(128)&&!xe;this._contextMenuIsBeingShownCount++,this._contextMenuService.showContextMenu({domForShadowRoot:s?this._editor.getDomNode():void 0,getAnchor:()=>e,getActions:()=>o,onHide:e=>{this._contextMenuIsBeingShownCount--,this._editor.focus()}})}_keybindingFor(e){return this._keybindingService.lookupKeybinding(e.id)}dispose(){this._contextMenuIsBeingShownCount>0&&this._contextViewService.hideContextView(),this._toDispose.dispose()}};K_=G_=U_([W_(1,Ga),W_(2,Pl),W_(3,W),W_(4,ua),W_(5,Eo),W_(6,F),W_(7,mi)],K_);var q_=class extends N{constructor(){super({id:`editor.action.showContextMenu`,label:S(`action.showContextMenu.label`,`Show Editor Context Menu`),alias:`Show Editor Context Menu`,precondition:void 0,kbOpts:{kbExpr:q.textInputFocus,primary:1092,weight:100}})}run(e,t){K_.get(t)?.showContextMenu()}};I(K_.ID,K_,2),L(q_);var J_=class{constructor(e){this.selections=e}equals(e){let t=this.selections.length;if(t!==e.selections.length)return!1;for(let n=0;n<t;n++)if(!this.selections[n].equalsSelection(e.selections[n]))return!1;return!0}},Y_=class{constructor(e,t,n){this.cursorState=e,this.scrollTop=t,this.scrollLeft=n}},X_=class e extends _{static#e=this.ID=`editor.contrib.cursorUndoRedoController`;static get(t){return t.getContribution(e.ID)}constructor(e){super(),this._editor=e,this._isCursorUndoRedo=!1,this._undoStack=[],this._redoStack=[],this._register(e.onDidChangeModel(e=>{this._undoStack=[],this._redoStack=[]})),this._register(e.onDidChangeModelContent(e=>{this._undoStack=[],this._redoStack=[]})),this._register(e.onDidChangeCursorSelection(t=>{if(this._isCursorUndoRedo||!t.oldSelections||t.oldModelVersionId!==t.modelVersionId)return;let n=new J_(t.oldSelections);this._undoStack.length>0&&this._undoStack[this._undoStack.length-1].cursorState.equals(n)||(this._undoStack.push(new Y_(n,e.getScrollTop(),e.getScrollLeft())),this._redoStack=[],this._undoStack.length>50&&this._undoStack.shift())}))}cursorUndo(){!this._editor.hasModel()||this._undoStack.length===0||(this._redoStack.push(new Y_(new J_(this._editor.getSelections()),this._editor.getScrollTop(),this._editor.getScrollLeft())),this._applyState(this._undoStack.pop()))}cursorRedo(){!this._editor.hasModel()||this._redoStack.length===0||(this._undoStack.push(new Y_(new J_(this._editor.getSelections()),this._editor.getScrollTop(),this._editor.getScrollLeft())),this._applyState(this._redoStack.pop()))}_applyState(e){this._isCursorUndoRedo=!0,this._editor.setSelections(e.cursorState.selections),this._editor.setScrollPosition({scrollTop:e.scrollTop,scrollLeft:e.scrollLeft}),this._isCursorUndoRedo=!1}},Z_=class extends N{constructor(){super({id:`cursorUndo`,label:S(`cursor.undo`,`Cursor Undo`),alias:`Cursor Undo`,precondition:void 0,kbOpts:{kbExpr:q.textInputFocus,primary:2099,weight:100}})}run(e,t,n){X_.get(t)?.cursorUndo()}},Q_=class extends N{constructor(){super({id:`cursorRedo`,label:S(`cursor.redo`,`Cursor Redo`),alias:`Cursor Redo`,precondition:void 0})}run(e,t,n){X_.get(t)?.cursorRedo()}};I(X_.ID,X_,0),L(Z_),L(Q_);var $_=class{constructor(e,t,n){this.selection=e,this.targetPosition=t,this.copy=n,this.targetSelection=null}getEditOperations(e,t){let n=e.getValueInRange(this.selection);if(this.copy||t.addEditOperation(this.selection,null),t.addEditOperation(new T(this.targetPosition.lineNumber,this.targetPosition.column,this.targetPosition.lineNumber,this.targetPosition.column),n),this.selection.containsPosition(this.targetPosition)&&!(this.copy&&(this.selection.getEndPosition().equals(this.targetPosition)||this.selection.getStartPosition().equals(this.targetPosition)))){this.targetSelection=this.selection;return}if(this.copy){this.targetSelection=new v(this.targetPosition.lineNumber,this.targetPosition.column,this.selection.endLineNumber-this.selection.startLineNumber+this.targetPosition.lineNumber,this.selection.startLineNumber===this.selection.endLineNumber?this.targetPosition.column+this.selection.endColumn-this.selection.startColumn:this.selection.endColumn);return}if(this.targetPosition.lineNumber>this.selection.endLineNumber){this.targetSelection=new v(this.targetPosition.lineNumber-this.selection.endLineNumber+this.selection.startLineNumber,this.targetPosition.column,this.targetPosition.lineNumber,this.selection.startLineNumber===this.selection.endLineNumber?this.targetPosition.column+this.selection.endColumn-this.selection.startColumn:this.selection.endColumn);return}if(this.targetPosition.lineNumber<this.selection.endLineNumber){this.targetSelection=new v(this.targetPosition.lineNumber,this.targetPosition.column,this.targetPosition.lineNumber+this.selection.endLineNumber-this.selection.startLineNumber,this.selection.startLineNumber===this.selection.endLineNumber?this.targetPosition.column+this.selection.endColumn-this.selection.startColumn:this.selection.endColumn);return}this.selection.endColumn<=this.targetPosition.column?this.targetSelection=new v(this.targetPosition.lineNumber-this.selection.endLineNumber+this.selection.startLineNumber,(this.selection.startLineNumber,this.selection.endLineNumber,this.targetPosition.column-this.selection.endColumn+this.selection.startColumn),this.targetPosition.lineNumber,this.selection.startLineNumber===this.selection.endLineNumber?this.targetPosition.column:this.selection.endColumn):this.targetSelection=new v(this.targetPosition.lineNumber-this.selection.endLineNumber+this.selection.startLineNumber,this.targetPosition.column,this.targetPosition.lineNumber,this.targetPosition.column+this.selection.endColumn-this.selection.startColumn)}computeCursorState(e,t){return this.targetSelection}};function ev(e){return Le?e.altKey:e.ctrlKey}var tv=class e extends _{static#e=this.ID=`editor.contrib.dragAndDrop`;static#t=this.TRIGGER_KEY_VALUE=Le?6:5;constructor(e){super(),this._editor=e,this._dndDecorationIds=this._editor.createDecorationsCollection(),this._register(this._editor.onMouseDown(e=>this._onEditorMouseDown(e))),this._register(this._editor.onMouseUp(e=>this._onEditorMouseUp(e))),this._register(this._editor.onMouseDrag(e=>this._onEditorMouseDrag(e))),this._register(this._editor.onMouseDrop(e=>this._onEditorMouseDrop(e))),this._register(this._editor.onMouseDropCanceled(()=>this._onEditorMouseDropCanceled())),this._register(this._editor.onKeyDown(e=>this.onEditorKeyDown(e))),this._register(this._editor.onKeyUp(e=>this.onEditorKeyUp(e))),this._register(this._editor.onDidBlurEditorWidget(()=>this.onEditorBlur())),this._register(this._editor.onDidBlurEditorText(()=>this.onEditorBlur())),this._mouseDown=!1,this._modifierPressed=!1,this._dragSelection=null}onEditorBlur(){this._removeDecoration(),this._dragSelection=null,this._mouseDown=!1,this._modifierPressed=!1}onEditorKeyDown(e){!this._editor.getOption(35)||this._editor.getOption(22)||(ev(e)&&(this._modifierPressed=!0),this._mouseDown&&ev(e)&&this._editor.updateOptions({mouseStyle:`copy`}))}onEditorKeyUp(t){!this._editor.getOption(35)||this._editor.getOption(22)||(ev(t)&&(this._modifierPressed=!1),this._mouseDown&&t.keyCode===e.TRIGGER_KEY_VALUE&&this._editor.updateOptions({mouseStyle:`default`}))}_onEditorMouseDown(e){this._mouseDown=!0}_onEditorMouseUp(e){this._mouseDown=!1,this._editor.updateOptions({mouseStyle:`text`})}_onEditorMouseDrag(e){let t=e.target;if(this._dragSelection===null){let e=(this._editor.getSelections()||[]).filter(e=>t.position&&e.containsPosition(t.position));if(e.length===1)this._dragSelection=e[0];else return}ev(e.event)?this._editor.updateOptions({mouseStyle:`copy`}):this._editor.updateOptions({mouseStyle:`default`}),t.position&&(this._dragSelection.containsPosition(t.position)?this._removeDecoration():this.showAt(t.position))}_onEditorMouseDropCanceled(){this._editor.updateOptions({mouseStyle:`text`}),this._removeDecoration(),this._dragSelection=null,this._mouseDown=!1}_onEditorMouseDrop(t){if(t.target&&(this._hitContent(t.target)||this._hitMargin(t.target))&&t.target.position){let n=new r(t.target.position.lineNumber,t.target.position.column);if(this._dragSelection===null){let e=null;if(t.event.shiftKey){let t=this._editor.getSelection();if(t){let{selectionStartLineNumber:r,selectionStartColumn:i}=t;e=[new v(r,i,n.lineNumber,n.column)]}}else e=(this._editor.getSelections()||[]).map(e=>e.containsPosition(n)?new v(n.lineNumber,n.column,n.lineNumber,n.column):e);this._editor.setSelections(e||[],`mouse`,3)}else (!this._dragSelection.containsPosition(n)||(ev(t.event)||this._modifierPressed)&&(this._dragSelection.getEndPosition().equals(n)||this._dragSelection.getStartPosition().equals(n)))&&(this._editor.pushUndoStop(),this._editor.executeCommand(e.ID,new $_(this._dragSelection,n,ev(t.event)||this._modifierPressed)),this._editor.pushUndoStop())}this._editor.updateOptions({mouseStyle:`text`}),this._removeDecoration(),this._dragSelection=null,this._mouseDown=!1}static#n=this._DECORATION_OPTIONS=U.register({description:`dnd-target`,className:`dnd-target`});showAt(t){this._dndDecorationIds.set([{range:new T(t.lineNumber,t.column,t.lineNumber,t.column),options:e._DECORATION_OPTIONS}]),this._editor.revealPosition(t,1)}_removeDecoration(){this._dndDecorationIds.clear()}_hitContent(e){return e.type===6||e.type===7}_hitMargin(e){return e.type===2||e.type===3||e.type===4}dispose(){this._removeDecoration(),this._dragSelection=null,this._mouseDown=!1,this._modifierPressed=!1,super.dispose()}};I(tv.ID,tv,2),I(zd.ID,zd,0),wl($u),P(new class extends la{constructor(){super({id:Id,precondition:Ld,kbOpts:{weight:100,primary:2137}})}runEditorCommand(e,t){return zd.get(t)?.changePasteType()}}),P(new class extends la{constructor(){super({id:`editor.hidePasteWidget`,precondition:Ld,kbOpts:{weight:100,primary:9}})}runEditorCommand(e,t){zd.get(t)?.clearWidgets()}}),L(class e extends N{static#e=this.argsSchema={type:`object`,properties:{kind:{type:`string`,description:S(`pasteAs.kind`,`The kind of the paste edit to try applying. If not provided or there are multiple edits for this kind, the editor will show a picker.`)}}};constructor(){super({id:`editor.action.pasteAs`,label:S(`pasteAs`,`Paste As...`),alias:`Paste As...`,precondition:q.writable,metadata:{description:`Paste as`,args:[{name:`args`,schema:e.argsSchema}]}})}run(e,t,n){let r=typeof n?.kind==`string`?n.kind:void 0;return!r&&n&&(r=typeof n.id==`string`?n.id:void 0),zd.get(t)?.pasteAs(r?new X(r):void 0)}}),L(class extends N{constructor(){super({id:`editor.action.pasteAsText`,label:S(`pasteAsText`,`Paste as Text`),alias:`Paste as Text`,precondition:q.writable})}run(e,t){return zd.get(t)?.pasteAs({providerId:qu.id})}});var nv=class{constructor(){this._dragOperations=new Map}removeDragOperationTransfer(e){if(e&&this._dragOperations.has(e)){let t=this._dragOperations.get(e);return this._dragOperations.delete(e),t}}},rv=class{constructor(e){this.identifier=e}};const iv=kl(`treeViewsDndService`);$r(iv,nv,1);var av=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},ov=function(e,t){return function(n,r){t(n,r,e)}},sv;const cv=`editor.experimental.dropIntoEditor.defaultProvider`,lv=`editor.changeDropType`,uv=new G(`dropWidgetVisible`,!1,S(`dropWidgetVisible`,`Whether the drop widget is showing`));var dv=class extends _{static#e=sv=this;static#t=this.ID=`editor.contrib.dropIntoEditorController`;static get(e){return e.getContribution(sv.ID)}constructor(e,t,n,r,i){super(),this._configService=n,this._languageFeaturesService=r,this._treeViewsDragAndDropService=i,this.treeItemsTransfer=zu.getInstance(),this._dropProgressManager=this._register(t.createInstance(vd,`dropIntoEditor`,e)),this._postDropWidgetManager=this._register(t.createInstance(Md,`dropIntoEditor`,e,uv,{id:lv,label:S(`postDropWidgetTitle`,`Show drop options...`)})),this._register(e.onDropIntoEditor(t=>this.onDropIntoEditor(e,t.position,t.event)))}clearWidgets(){this._postDropWidgetManager.clear()}changeDropType(){this._postDropWidgetManager.tryShowSelector()}async onDropIntoEditor(e,t,r){if(!r.dataTransfer||!e.hasModel())return;this._currentOperation?.cancel(),e.focus(),e.setPosition(t);let i=et(async a=>{let o=new n,s=o.add(new fl(e,1,void 0,a));try{let n=await this.extractDataTransferData(r);if(n.size===0||s.token.isCancellationRequested)return;let i=e.getModel();if(!i)return;let c=this._languageFeaturesService.documentDropEditProvider.ordered(i).filter(e=>e.dropMimeTypes?e.dropMimeTypes.some(e=>n.matches(e)):!0),l=o.add(await this.getDropEdits(c,i,t,n,s));if(s.token.isCancellationRequested)return;if(l.edits.length){let n=this.getInitialActiveEditIndex(i,l.edits),r=e.getOption(36).showDropSelector===`afterDrop`;await this._postDropWidgetManager.applyEditAndShowIfNeeded([T.fromPositions(t)],{activeEditIndex:n,allEdits:l.edits},r,async e=>e,a)}}finally{o.dispose(),this._currentOperation===i&&(this._currentOperation=void 0)}});this._dropProgressManager.showWhile(t,S(`dropIntoEditorProgress`,`Running drop handlers. Click to cancel`),i,{cancel:()=>i.cancel()}),this._currentOperation=i}async getDropEdits(e,t,r,i,a){let o=new n;return{edits:pd(bt(await sn(Promise.all(e.map(async e=>{try{let n=await e.provideDocumentDropEdits(t,r,i,a.token);return n&&o.add(n),n?.edits.map(t=>({...t,providerId:e.id}))}catch(e){console.error(e)}})),a.token)??[]).flat()),dispose:()=>o.dispose()}}getInitialActiveEditIndex(e,t){let n=this._configService.getValue(cv,{resource:e.uri});for(let[e,r]of Object.entries(n)){let n=new X(r),i=t.findIndex(t=>n.value===t.providerId&&t.handledMimeType&&Pu(e,[t.handledMimeType]));if(i>=0)return i}return 0}async extractDataTransferData(e){if(!e.dataTransfer)return new Mu;let t=Uu(e.dataTransfer);if(this.treeItemsTransfer.hasData(rv.prototype)){let e=this.treeItemsTransfer.getData(rv.prototype);if(Array.isArray(e))for(let n of e){let e=await this._treeViewsDragAndDropService.removeDragOperationTransfer(n.identifier);if(e)for(let[n,r]of e)t.replace(n,r)}}return t}};dv=sv=av([ov(1,Y),ov(2,F),ov(3,V),ov(4,iv)],dv),I(dv.ID,dv,2),wl(Qu),P(new class extends la{constructor(){super({id:lv,precondition:uv,kbOpts:{weight:100,primary:2137}})}runEditorCommand(e,t,n){dv.get(t)?.changeDropType()}}),P(new class extends la{constructor(){super({id:`editor.hideDropWidget`,precondition:uv,kbOpts:{weight:100,primary:9}})}runEditorCommand(e,t,n){dv.get(t)?.clearWidgets()}}),un.as(Ea.Configuration).registerConfiguration({...ji,properties:{[cv]:{type:`object`,scope:5,description:S(`defaultProviderDescription`,`Configures the default drop provider to use for content of a given mime type.`),default:{},additionalProperties:{type:`string`}}}});var fv=class e{constructor(e){this._editor=e,this._decorations=[],this._overviewRulerApproximateDecorations=[],this._findScopeDecorationIds=[],this._rangeHighlightDecorationId=null,this._highlightedDecorationId=null,this._startPosition=this._editor.getPosition()}dispose(){this._editor.removeDecorations(this._allDecorations()),this._decorations=[],this._overviewRulerApproximateDecorations=[],this._findScopeDecorationIds=[],this._rangeHighlightDecorationId=null,this._highlightedDecorationId=null}reset(){this._decorations=[],this._overviewRulerApproximateDecorations=[],this._findScopeDecorationIds=[],this._rangeHighlightDecorationId=null,this._highlightedDecorationId=null}getCount(){return this._decorations.length}getFindScope(){return this._findScopeDecorationIds[0]?this._editor.getModel().getDecorationRange(this._findScopeDecorationIds[0]):null}getFindScopes(){if(this._findScopeDecorationIds.length){let e=this._findScopeDecorationIds.map(e=>this._editor.getModel().getDecorationRange(e)).filter(e=>!!e);if(e.length)return e}return null}getStartPosition(){return this._startPosition}setStartPosition(e){this._startPosition=e,this.setCurrentFindMatch(null)}_getDecorationIndex(e){let t=this._decorations.indexOf(e);return t>=0?t+1:1}getDecorationRangeAt(e){let t=e<this._decorations.length?this._decorations[e]:null;return t?this._editor.getModel().getDecorationRange(t):null}getCurrentMatchesPosition(t){let n=this._editor.getModel().getDecorationsInRange(t);for(let t of n){let n=t.options;if(n===e._FIND_MATCH_DECORATION||n===e._CURRENT_FIND_MATCH_DECORATION)return this._getDecorationIndex(t.id)}return 0}setCurrentFindMatch(t){let n=null,r=0;if(t)for(let e=0,i=this._decorations.length;e<i;e++){let i=this._editor.getModel().getDecorationRange(this._decorations[e]);if(t.equalsRange(i)){n=this._decorations[e],r=e+1;break}}return(this._highlightedDecorationId!==null||n!==null)&&this._editor.changeDecorations(t=>{if(this._highlightedDecorationId!==null&&(t.changeDecorationOptions(this._highlightedDecorationId,e._FIND_MATCH_DECORATION),this._highlightedDecorationId=null),n!==null&&(this._highlightedDecorationId=n,t.changeDecorationOptions(this._highlightedDecorationId,e._CURRENT_FIND_MATCH_DECORATION)),this._rangeHighlightDecorationId!==null&&(t.removeDecoration(this._rangeHighlightDecorationId),this._rangeHighlightDecorationId=null),n!==null){let r=this._editor.getModel().getDecorationRange(n);if(r.startLineNumber!==r.endLineNumber&&r.endColumn===1){let e=r.endLineNumber-1,t=this._editor.getModel().getLineMaxColumn(e);r=new T(r.startLineNumber,r.startColumn,e,t)}this._rangeHighlightDecorationId=t.addDecoration(r,e._RANGE_HIGHLIGHT_DECORATION)}}),r}set(t,n){this._editor.changeDecorations(r=>{let i=e._FIND_MATCH_DECORATION,a=[];if(t.length>1e3){i=e._FIND_MATCH_NO_OVERVIEW_DECORATION;let n=this._editor.getModel().getLineCount(),r=this._editor.getLayoutInfo().height/n,o=Math.max(2,Math.ceil(3/r)),s=t[0].range.startLineNumber,c=t[0].range.endLineNumber;for(let n=1,r=t.length;n<r;n++){let r=t[n].range;c+o>=r.startLineNumber?r.endLineNumber>c&&(c=r.endLineNumber):(a.push({range:new T(s,1,c,1),options:e._FIND_MATCH_ONLY_OVERVIEW_DECORATION}),s=r.startLineNumber,c=r.endLineNumber)}a.push({range:new T(s,1,c,1),options:e._FIND_MATCH_ONLY_OVERVIEW_DECORATION})}let o=Array(t.length);for(let e=0,n=t.length;e<n;e++)o[e]={range:t[e].range,options:i};this._decorations=r.deltaDecorations(this._decorations,o),this._overviewRulerApproximateDecorations=r.deltaDecorations(this._overviewRulerApproximateDecorations,a),this._rangeHighlightDecorationId&&=(r.removeDecoration(this._rangeHighlightDecorationId),null),this._findScopeDecorationIds.length&&(this._findScopeDecorationIds.forEach(e=>r.removeDecoration(e)),this._findScopeDecorationIds=[]),n?.length&&(this._findScopeDecorationIds=n.map(t=>r.addDecoration(t,e._FIND_SCOPE_DECORATION)))})}matchBeforePosition(e){if(this._decorations.length===0)return null;for(let t=this._decorations.length-1;t>=0;t--){let n=this._decorations[t],r=this._editor.getModel().getDecorationRange(n);if(!(!r||r.endLineNumber>e.lineNumber)&&(r.endLineNumber<e.lineNumber||!(r.endColumn>e.column)))return r}return this._editor.getModel().getDecorationRange(this._decorations[this._decorations.length-1])}matchAfterPosition(e){if(this._decorations.length===0)return null;for(let t=0,n=this._decorations.length;t<n;t++){let n=this._decorations[t],r=this._editor.getModel().getDecorationRange(n);if(!(!r||r.startLineNumber<e.lineNumber)&&(r.startLineNumber>e.lineNumber||!(r.startColumn<e.column)))return r}return this._editor.getModel().getDecorationRange(this._decorations[0])}_allDecorations(){let e=[];return e=e.concat(this._decorations),e=e.concat(this._overviewRulerApproximateDecorations),this._findScopeDecorationIds.length&&e.push(...this._findScopeDecorationIds),this._rangeHighlightDecorationId&&e.push(this._rangeHighlightDecorationId),e}static#e=this._CURRENT_FIND_MATCH_DECORATION=U.register({description:`current-find-match`,stickiness:1,zIndex:13,className:`currentFindMatch`,inlineClassName:`currentFindMatchInline`,showIfCollapsed:!0,overviewRuler:{color:Bc(Xt),position:sl.Center},minimap:{color:Bc(er),position:1}});static#t=this._FIND_MATCH_DECORATION=U.register({description:`find-match`,stickiness:1,zIndex:10,className:`findMatch`,inlineClassName:`findMatchInline`,showIfCollapsed:!0,overviewRuler:{color:Bc(Xt),position:sl.Center},minimap:{color:Bc(er),position:1}});static#n=this._FIND_MATCH_NO_OVERVIEW_DECORATION=U.register({description:`find-match-no-overview`,stickiness:1,className:`findMatch`,showIfCollapsed:!0});static#r=this._FIND_MATCH_ONLY_OVERVIEW_DECORATION=U.register({description:`find-match-only-overview`,stickiness:1,overviewRuler:{color:Bc(Xt),position:sl.Center}});static#i=this._RANGE_HIGHLIGHT_DECORATION=U.register({description:`find-range-highlight`,stickiness:1,className:`rangeHighlight`,isWholeLine:!0});static#a=this._FIND_SCOPE_DECORATION=U.register({description:`find-scope`,className:`findScope`,isWholeLine:!0})},pv=class{constructor(e,t,n){this._editorSelection=e,this._ranges=t,this._replaceStrings=n,this._trackedEditorSelectionId=null}getEditOperations(e,t){if(this._ranges.length>0){let e=[];for(let t=0;t<this._ranges.length;t++)e.push({range:this._ranges[t],text:this._replaceStrings[t]});e.sort((e,t)=>T.compareRangesUsingStarts(e.range,t.range));let n=[],r=e[0];for(let t=1;t<e.length;t++)r.range.endLineNumber===e[t].range.startLineNumber&&r.range.endColumn===e[t].range.startColumn?(r.range=r.range.plusRange(e[t].range),r.text+=e[t].text):(n.push(r),r=e[t]);n.push(r);for(let e of n)t.addEditOperation(e.range,e.text)}this._trackedEditorSelectionId=t.trackSelection(this._editorSelection)}computeCursorState(e,t){return t.getTrackedSelection(this._trackedEditorSelectionId)}};function mv(e,t){if(e&&e[0]!==``){let n=hv(e,t,`-`),r=hv(e,t,`_`);return n&&!r?gv(e,t,`-`):!n&&r?gv(e,t,`_`):e[0].toUpperCase()===e[0]?t.toUpperCase():e[0].toLowerCase()===e[0]?t.toLowerCase():nn(e[0][0])&&t.length>0?t[0].toUpperCase()+t.substr(1):e[0][0].toUpperCase()!==e[0][0]&&t.length>0?t[0].toLowerCase()+t.substr(1):t}else return t}function hv(e,t,n){return e[0].indexOf(n)!==-1&&t.indexOf(n)!==-1&&e[0].split(n).length===t.split(n).length}function gv(e,t,n){let r=t.split(n),i=e[0].split(n),a=``;return r.forEach((e,t)=>{a+=mv([i[t]],e)+n}),a.slice(0,-1)}var _v=class{constructor(e){this.staticValue=e,this.kind=0}},vv=class{constructor(e){this.pieces=e,this.kind=1}},yv=class e{static fromStaticValue(t){return new e([bv.staticValue(t)])}get hasReplacementPatterns(){return this._state.kind===1}constructor(e){!e||e.length===0?this._state=new _v(``):e.length===1&&e[0].staticValue!==null?this._state=new _v(e[0].staticValue):this._state=new vv(e)}buildReplaceString(t,n){if(this._state.kind===0)return n?mv(t,this._state.staticValue):this._state.staticValue;let r=``;for(let n=0,i=this._state.pieces.length;n<i;n++){let i=this._state.pieces[n];if(i.staticValue!==null){r+=i.staticValue;continue}let a=e._substitute(i.matchIndex,t);if(i.caseOps!==null&&i.caseOps.length>0){let e=[],t=i.caseOps.length,n=0;for(let r=0,o=a.length;r<o;r++){if(n>=t){e.push(a.slice(r));break}switch(i.caseOps[n]){case`U`:e.push(a[r].toUpperCase());break;case`u`:e.push(a[r].toUpperCase()),n++;break;case`L`:e.push(a[r].toLowerCase());break;case`l`:e.push(a[r].toLowerCase()),n++;break;default:e.push(a[r])}}a=e.join(``)}r+=a}return r}static _substitute(e,t){if(t===null)return``;if(e===0)return t[0];let n=``;for(;e>0;){if(e<t.length)return(t[e]||``)+n;n=String(e%10)+n,e=Math.floor(e/10)}return`$`+n}},bv=class e{static staticValue(t){return new e(t,-1,null)}static caseOps(t,n){return new e(null,t,n)}constructor(e,t,n){this.staticValue=e,this.matchIndex=t,!n||n.length===0?this.caseOps=null:this.caseOps=n.slice(0)}},xv=class{constructor(e){this._source=e,this._lastCharIndex=0,this._result=[],this._resultLen=0,this._currentStaticPiece=``}emitUnchanged(e){this._emitStatic(this._source.substring(this._lastCharIndex,e)),this._lastCharIndex=e}emitStatic(e,t){this._emitStatic(e),this._lastCharIndex=t}_emitStatic(e){e.length!==0&&(this._currentStaticPiece+=e)}emitMatchIndex(e,t,n){this._currentStaticPiece.length!==0&&(this._result[this._resultLen++]=bv.staticValue(this._currentStaticPiece),this._currentStaticPiece=``),this._result[this._resultLen++]=bv.caseOps(e,n),this._lastCharIndex=t}finalize(){return this.emitUnchanged(this._source.length),this._currentStaticPiece.length!==0&&(this._result[this._resultLen++]=bv.staticValue(this._currentStaticPiece),this._currentStaticPiece=``),new yv(this._result)}};function Sv(e){if(!e||e.length===0)return new yv(null);let t=[],n=new xv(e);for(let r=0,i=e.length;r<i;r++){let a=e.charCodeAt(r);if(a===92){if(r++,r>=i)break;let a=e.charCodeAt(r);switch(a){case 92:n.emitUnchanged(r-1),n.emitStatic(`\\`,r+1);break;case 110:n.emitUnchanged(r-1),n.emitStatic(`
`,r+1);break;case 116:n.emitUnchanged(r-1),n.emitStatic(`	`,r+1);break;case 117:case 85:case 108:case 76:n.emitUnchanged(r-1),n.emitStatic(``,r+1),t.push(String.fromCharCode(a));break}continue}if(a===36){if(r++,r>=i)break;let a=e.charCodeAt(r);if(a===36){n.emitUnchanged(r-1),n.emitStatic(`$`,r+1);continue}if(a===48||a===38){n.emitUnchanged(r-1),n.emitMatchIndex(0,r+1,t),t.length=0;continue}if(49<=a&&a<=57){let o=a-48;if(r+1<i){let i=e.charCodeAt(r+1);if(48<=i&&i<=57){r++,o=o*10+(i-48),n.emitUnchanged(r-2),n.emitMatchIndex(o,r+1,t),t.length=0;continue}}n.emitUnchanged(r-1),n.emitMatchIndex(o,r+1,t),t.length=0;continue}}}return n.finalize()}const Cv=new G(`findWidgetVisible`,!1);Cv.toNegated();const wv=new G(`findInputFocussed`,!1),Tv=new G(`replaceInputFocussed`,!1),Ev={primary:545,mac:{primary:2593}},Dv={primary:565,mac:{primary:2613}},Ov={primary:560,mac:{primary:2608}},kv={primary:554,mac:{primary:2602}},Av={primary:558,mac:{primary:2606}},Q={StartFindAction:`actions.find`,StartFindWithSelection:`actions.findWithSelection`,StartFindWithArgs:`editor.actions.findWithArgs`,NextMatchFindAction:`editor.action.nextMatchFindAction`,PreviousMatchFindAction:`editor.action.previousMatchFindAction`,GoToMatchFindAction:`editor.action.goToMatchFindAction`,NextSelectionMatchFindAction:`editor.action.nextSelectionMatchFindAction`,PreviousSelectionMatchFindAction:`editor.action.previousSelectionMatchFindAction`,StartFindReplaceAction:`editor.action.startFindReplaceAction`,CloseFindWidgetCommand:`closeFindWidget`,ToggleCaseSensitiveCommand:`toggleFindCaseSensitive`,ToggleWholeWordCommand:`toggleFindWholeWord`,ToggleRegexCommand:`toggleFindRegex`,ToggleSearchScopeCommand:`toggleFindInSelection`,TogglePreserveCaseCommand:`togglePreserveCase`,ReplaceOneAction:`editor.action.replaceOne`,ReplaceAllAction:`editor.action.replaceAll`,SelectAllMatchesAction:`editor.action.selectAllMatches`},jv=19999;var Mv=240,Nv=class e{constructor(e,t){this._toDispose=new n,this._editor=e,this._state=t,this._isDisposed=!1,this._startSearchingTimer=new Yt,this._decorations=new fv(e),this._toDispose.add(this._decorations),this._updateDecorationsScheduler=new yt(()=>{if(this._editor.hasModel())return this.research(!1)},100),this._toDispose.add(this._updateDecorationsScheduler),this._toDispose.add(this._editor.onDidChangeCursorPosition(e=>{(e.reason===3||e.reason===5||e.reason===6)&&this._decorations.setStartPosition(this._editor.getPosition())})),this._ignoreModelContentChanged=!1,this._toDispose.add(this._editor.onDidChangeModelContent(e=>{this._ignoreModelContentChanged||(e.isFlush&&this._decorations.reset(),this._decorations.setStartPosition(this._editor.getPosition()),this._updateDecorationsScheduler.schedule())})),this._toDispose.add(this._state.onFindReplaceStateChange(e=>this._onStateChanged(e))),this.research(!1,this._state.searchScope)}dispose(){this._isDisposed=!0,c(this._startSearchingTimer),this._toDispose.dispose()}_onStateChanged(e){this._isDisposed||this._editor.hasModel()&&(e.searchString||e.isReplaceRevealed||e.isRegex||e.wholeWord||e.matchCase||e.searchScope)&&(this._editor.getModel().isTooLargeForSyncing()?(this._startSearchingTimer.cancel(),this._startSearchingTimer.setIfNotSet(()=>{e.searchScope?this.research(e.moveCursor,this._state.searchScope):this.research(e.moveCursor)},Mv)):e.searchScope?this.research(e.moveCursor,this._state.searchScope):this.research(e.moveCursor))}static _getSearchRange(e,t){return t||e.getFullModelRange()}research(e,t){let n=null;t===void 0?n=this._decorations.getFindScopes():t!==null&&(n=Array.isArray(t)?t:[t]),n!==null&&(n=n.map(e=>{if(e.startLineNumber!==e.endLineNumber){let t=e.endLineNumber;return e.endColumn===1&&--t,new T(e.startLineNumber,1,t,this._editor.getModel().getLineMaxColumn(t))}return e}));let r=this._findMatches(n,!1,jv);this._decorations.set(r,n);let i=this._editor.getSelection(),a=this._decorations.getCurrentMatchesPosition(i);if(a===0&&r.length>0){let e=tl(r.map(e=>e.range),e=>T.compareRangesUsingStarts(e,i)>=0);a=e>0?e-1+1:a}this._state.changeMatchInfo(a,this._decorations.getCount(),void 0),e&&this._editor.getOption(41).cursorMoveOnType&&this._moveToNextMatch(this._decorations.getStartPosition())}_hasMatches(){return this._state.matchesCount>0}_cannotFind(){if(!this._hasMatches()){let e=this._decorations.getFindScope();return e&&this._editor.revealRangeInCenterIfOutsideViewport(e,0),!0}return!1}_setCurrentFindMatch(e){let t=this._decorations.setCurrentFindMatch(e);this._state.changeMatchInfo(t,this._decorations.getCount(),e),this._editor.setSelection(e),this._editor.revealRangeInCenterIfOutsideViewport(e,0)}_prevSearchPosition(e){let t=this._state.isRegex&&(this._state.searchString.indexOf(`^`)>=0||this._state.searchString.indexOf(`$`)>=0),{lineNumber:n,column:i}=e,a=this._editor.getModel();return t||i===1?(n===1?n=a.getLineCount():n--,i=a.getLineMaxColumn(n)):i--,new r(n,i)}_moveToPrevMatch(t,n=!1){if(!this._state.canNavigateBack()){let e=this._decorations.matchAfterPosition(t);e&&this._setCurrentFindMatch(e);return}if(this._decorations.getCount()<19999){let e=this._decorations.matchBeforePosition(t);e&&e.isEmpty()&&e.getStartPosition().equals(t)&&(t=this._prevSearchPosition(t),e=this._decorations.matchBeforePosition(t)),e&&this._setCurrentFindMatch(e);return}if(this._cannotFind())return;let i=this._decorations.getFindScope(),a=e._getSearchRange(this._editor.getModel(),i);a.getEndPosition().isBefore(t)&&(t=a.getEndPosition()),t.isBefore(a.getStartPosition())&&(t=a.getEndPosition());let{lineNumber:o,column:s}=t,c=this._editor.getModel(),l=new r(o,s),u=c.findPreviousMatch(this._state.searchString,l,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(132):null,!1);if(u&&u.range.isEmpty()&&u.range.getStartPosition().equals(l)&&(l=this._prevSearchPosition(l),u=c.findPreviousMatch(this._state.searchString,l,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(132):null,!1)),u){if(!n&&!a.containsRange(u.range))return this._moveToPrevMatch(u.range.getStartPosition(),!0);this._setCurrentFindMatch(u.range)}}moveToPrevMatch(){this._moveToPrevMatch(this._editor.getSelection().getStartPosition())}_nextSearchPosition(e){let t=this._state.isRegex&&(this._state.searchString.indexOf(`^`)>=0||this._state.searchString.indexOf(`$`)>=0),{lineNumber:n,column:i}=e,a=this._editor.getModel();return t||i===a.getLineMaxColumn(n)?(n===a.getLineCount()?n=1:n++,i=1):i++,new r(n,i)}_moveToNextMatch(e){if(!this._state.canNavigateForward()){let t=this._decorations.matchBeforePosition(e);t&&this._setCurrentFindMatch(t);return}if(this._decorations.getCount()<19999){let t=this._decorations.matchAfterPosition(e);t&&t.isEmpty()&&t.getStartPosition().equals(e)&&(e=this._nextSearchPosition(e),t=this._decorations.matchAfterPosition(e)),t&&this._setCurrentFindMatch(t);return}let t=this._getNextMatch(e,!1,!0);t&&this._setCurrentFindMatch(t.range)}_getNextMatch(t,n,i,a=!1){if(this._cannotFind())return null;let o=this._decorations.getFindScope(),s=e._getSearchRange(this._editor.getModel(),o);s.getEndPosition().isBefore(t)&&(t=s.getStartPosition()),t.isBefore(s.getStartPosition())&&(t=s.getStartPosition());let{lineNumber:c,column:l}=t,u=this._editor.getModel(),d=new r(c,l),f=u.findNextMatch(this._state.searchString,d,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(132):null,n);return i&&f&&f.range.isEmpty()&&f.range.getStartPosition().equals(d)&&(d=this._nextSearchPosition(d),f=u.findNextMatch(this._state.searchString,d,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(132):null,n)),f?!a&&!s.containsRange(f.range)?this._getNextMatch(f.range.getEndPosition(),n,i,!0):f:null}moveToNextMatch(){this._moveToNextMatch(this._editor.getSelection().getEndPosition())}_moveToMatch(e){let t=this._decorations.getDecorationRangeAt(e);t&&this._setCurrentFindMatch(t)}moveToMatch(e){this._moveToMatch(e)}_getReplacePattern(){return this._state.isRegex?Sv(this._state.replaceString):yv.fromStaticValue(this._state.replaceString)}replace(){if(!this._hasMatches())return;let e=this._getReplacePattern(),t=this._editor.getSelection(),n=this._getNextMatch(t.getStartPosition(),!0,!1);if(n)if(t.equalsRange(n.range)){let i=e.buildReplaceString(n.matches,this._state.preserveCase),a=new Nc(t,i);this._executeEditorCommand(`replace`,a),this._decorations.setStartPosition(new r(t.startLineNumber,t.startColumn+i.length)),this.research(!0)}else this._decorations.setStartPosition(this._editor.getPosition()),this._setCurrentFindMatch(n.range)}_findMatches(t,n,r){let i=(t||[null]).map(t=>e._getSearchRange(this._editor.getModel(),t));return this._editor.getModel().findMatches(this._state.searchString,i,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(132):null,n,r)}replaceAll(){if(!this._hasMatches())return;let e=this._decorations.getFindScopes();e===null&&this._state.matchesCount>=19999?this._largeReplaceAll():this._regularReplaceAll(e),this.research(!1)}_largeReplaceAll(){let e=new Ls(this._state.searchString,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(132):null).parseSearchRequest();if(!e)return;let t=e.regex;if(!t.multiline){let e=`mu`;t.ignoreCase&&(e+=`i`),t.global&&(e+=`g`),t=new RegExp(t.source,e)}let n=this._editor.getModel(),r=n.getValue(1),i=n.getFullModelRange(),a=this._getReplacePattern(),o,s=this._state.preserveCase;o=a.hasReplacementPatterns||s?r.replace(t,function(){return a.buildReplaceString(arguments,s)}):r.replace(t,a.buildReplaceString(null,s));let c=new vc(i,o,this._editor.getSelection());this._executeEditorCommand(`replaceAll`,c)}_regularReplaceAll(e){let t=this._getReplacePattern(),n=this._findMatches(e,t.hasReplacementPatterns||this._state.preserveCase,1073741824),r=[];for(let e=0,i=n.length;e<i;e++)r[e]=t.buildReplaceString(n[e].matches,this._state.preserveCase);let i=new pv(this._editor.getSelection(),n.map(e=>e.range),r);this._executeEditorCommand(`replaceAll`,i)}selectAllMatches(){if(!this._hasMatches())return;let e=this._decorations.getFindScopes(),t=this._findMatches(e,!1,1073741824).map(e=>new v(e.range.startLineNumber,e.range.startColumn,e.range.endLineNumber,e.range.endColumn)),n=this._editor.getSelection();for(let e=0,r=t.length;e<r;e++)if(t[e].equalsRange(n)){t=[n].concat(t.slice(0,e),t.slice(e+1));break}this._editor.setSelections(t)}_executeEditorCommand(e,t){try{this._ignoreModelContentChanged=!0,this._editor.pushUndoStop(),this._editor.executeCommand(e,t),this._editor.pushUndoStop()}finally{this._ignoreModelContentChanged=!1}}},Pv=class e extends Na{static#e=this.ID=`editor.contrib.findOptionsWidget`;constructor(e,t,n){super(),this._hideSoon=this._register(new yt(()=>this._hide(),2e3)),this._isVisible=!1,this._editor=e,this._state=t,this._keybindingService=n,this._domNode=document.createElement(`div`),this._domNode.className=`findOptionsWidget`,this._domNode.style.display=`none`,this._domNode.style.top=`10px`,this._domNode.style.zIndex=`12`,this._domNode.setAttribute(`role`,`presentation`),this._domNode.setAttribute(`aria-hidden`,`true`);let r={inputActiveOptionBorder:tn(Wt),inputActiveOptionForeground:tn(Ge),inputActiveOptionBackground:tn(vn)},i=this._register(si());this.caseSensitive=this._register(new Ao({appendTitle:this._keybindingLabelFor(Q.ToggleCaseSensitiveCommand),isChecked:this._state.matchCase,hoverDelegate:i,...r})),this._domNode.appendChild(this.caseSensitive.domNode),this._register(this.caseSensitive.onChange(()=>{this._state.change({matchCase:this.caseSensitive.checked},!1)})),this.wholeWords=this._register(new Ha({appendTitle:this._keybindingLabelFor(Q.ToggleWholeWordCommand),isChecked:this._state.wholeWord,hoverDelegate:i,...r})),this._domNode.appendChild(this.wholeWords.domNode),this._register(this.wholeWords.onChange(()=>{this._state.change({wholeWord:this.wholeWords.checked},!1)})),this.regex=this._register(new Vo({appendTitle:this._keybindingLabelFor(Q.ToggleRegexCommand),isChecked:this._state.isRegex,hoverDelegate:i,...r})),this._domNode.appendChild(this.regex.domNode),this._register(this.regex.onChange(()=>{this._state.change({isRegex:this.regex.checked},!1)})),this._editor.addOverlayWidget(this),this._register(this._state.onFindReplaceStateChange(e=>{let t=!1;e.isRegex&&(this.regex.checked=this._state.isRegex,t=!0),e.wholeWord&&(this.wholeWords.checked=this._state.wholeWord,t=!0),e.matchCase&&(this.caseSensitive.checked=this._state.matchCase,t=!0),!this._state.isRevealed&&t&&this._revealTemporarily()})),this._register(D(this._domNode,j.MOUSE_LEAVE,e=>this._onMouseLeave())),this._register(D(this._domNode,`mouseover`,e=>this._onMouseOver()))}_keybindingLabelFor(e){let t=this._keybindingService.lookupKeybinding(e);return t?` (${t.getLabel()})`:``}dispose(){this._editor.removeOverlayWidget(this),super.dispose()}getId(){return e.ID}getDomNode(){return this._domNode}getPosition(){return{preference:0}}highlightFindOptions(){this._revealTemporarily()}_revealTemporarily(){this._show(),this._hideSoon.schedule()}_onMouseLeave(){this._hideSoon.schedule()}_onMouseOver(){this._hideSoon.cancel()}_show(){this._isVisible||(this._isVisible=!0,this._domNode.style.display=`block`)}_hide(){this._isVisible&&(this._isVisible=!1,this._domNode.style.display=`none`)}};function Fv(e,t){return e===1?!0:e===2?!1:t}var Iv=class extends _{get searchString(){return this._searchString}get replaceString(){return this._replaceString}get isRevealed(){return this._isRevealed}get isReplaceRevealed(){return this._isReplaceRevealed}get isRegex(){return Fv(this._isRegexOverride,this._isRegex)}get wholeWord(){return Fv(this._wholeWordOverride,this._wholeWord)}get matchCase(){return Fv(this._matchCaseOverride,this._matchCase)}get preserveCase(){return Fv(this._preserveCaseOverride,this._preserveCase)}get actualIsRegex(){return this._isRegex}get actualWholeWord(){return this._wholeWord}get actualMatchCase(){return this._matchCase}get actualPreserveCase(){return this._preserveCase}get searchScope(){return this._searchScope}get matchesPosition(){return this._matchesPosition}get matchesCount(){return this._matchesCount}get currentMatch(){return this._currentMatch}constructor(){super(),this._onFindReplaceStateChange=this._register(new g),this.onFindReplaceStateChange=this._onFindReplaceStateChange.event,this._searchString=``,this._replaceString=``,this._isRevealed=!1,this._isReplaceRevealed=!1,this._isRegex=!1,this._isRegexOverride=0,this._wholeWord=!1,this._wholeWordOverride=0,this._matchCase=!1,this._matchCaseOverride=0,this._preserveCase=!1,this._preserveCaseOverride=0,this._searchScope=null,this._matchesPosition=0,this._matchesCount=0,this._currentMatch=null,this._loop=!0,this._isSearching=!1,this._filters=null}changeMatchInfo(e,t,n){let r={moveCursor:!1,updateHistory:!1,searchString:!1,replaceString:!1,isRevealed:!1,isReplaceRevealed:!1,isRegex:!1,wholeWord:!1,matchCase:!1,preserveCase:!1,searchScope:!1,matchesPosition:!1,matchesCount:!1,currentMatch:!1,loop:!1,isSearching:!1,filters:!1},i=!1;t===0&&(e=0),e>t&&(e=t),this._matchesPosition!==e&&(this._matchesPosition=e,r.matchesPosition=!0,i=!0),this._matchesCount!==t&&(this._matchesCount=t,r.matchesCount=!0,i=!0),n!==void 0&&(T.equalsRange(this._currentMatch,n)||(this._currentMatch=n,r.currentMatch=!0,i=!0)),i&&this._onFindReplaceStateChange.fire(r)}change(e,t,n=!0){let r={moveCursor:t,updateHistory:n,searchString:!1,replaceString:!1,isRevealed:!1,isReplaceRevealed:!1,isRegex:!1,wholeWord:!1,matchCase:!1,preserveCase:!1,searchScope:!1,matchesPosition:!1,matchesCount:!1,currentMatch:!1,loop:!1,isSearching:!1,filters:!1},i=!1,a=this.isRegex,o=this.wholeWord,s=this.matchCase,c=this.preserveCase;e.searchString!==void 0&&this._searchString!==e.searchString&&(this._searchString=e.searchString,r.searchString=!0,i=!0),e.replaceString!==void 0&&this._replaceString!==e.replaceString&&(this._replaceString=e.replaceString,r.replaceString=!0,i=!0),e.isRevealed!==void 0&&this._isRevealed!==e.isRevealed&&(this._isRevealed=e.isRevealed,r.isRevealed=!0,i=!0),e.isReplaceRevealed!==void 0&&this._isReplaceRevealed!==e.isReplaceRevealed&&(this._isReplaceRevealed=e.isReplaceRevealed,r.isReplaceRevealed=!0,i=!0),e.isRegex!==void 0&&(this._isRegex=e.isRegex),e.wholeWord!==void 0&&(this._wholeWord=e.wholeWord),e.matchCase!==void 0&&(this._matchCase=e.matchCase),e.preserveCase!==void 0&&(this._preserveCase=e.preserveCase),e.searchScope!==void 0&&(e.searchScope?.every(e=>this._searchScope?.some(t=>!T.equalsRange(t,e)))||(this._searchScope=e.searchScope,r.searchScope=!0,i=!0)),e.loop!==void 0&&this._loop!==e.loop&&(this._loop=e.loop,r.loop=!0,i=!0),e.isSearching!==void 0&&this._isSearching!==e.isSearching&&(this._isSearching=e.isSearching,r.isSearching=!0,i=!0),e.filters!==void 0&&(this._filters?this._filters.update(e.filters):this._filters=e.filters,r.filters=!0,i=!0),this._isRegexOverride=e.isRegexOverride===void 0?0:e.isRegexOverride,this._wholeWordOverride=e.wholeWordOverride===void 0?0:e.wholeWordOverride,this._matchCaseOverride=e.matchCaseOverride===void 0?0:e.matchCaseOverride,this._preserveCaseOverride=e.preserveCaseOverride===void 0?0:e.preserveCaseOverride,a!==this.isRegex&&(i=!0,r.isRegex=!0),o!==this.wholeWord&&(i=!0,r.wholeWord=!0),s!==this.matchCase&&(i=!0,r.matchCase=!0),c!==this.preserveCase&&(i=!0,r.preserveCase=!0),i&&this._onFindReplaceStateChange.fire(r)}canNavigateBack(){return this.canNavigateInLoop()||this.matchesPosition!==1}canNavigateForward(){return this.canNavigateInLoop()||this.matchesPosition<this.matchesCount}canNavigateInLoop(){return this._loop||this.matchesCount>=19999}},Lv=S(`defaultLabel`,`input`),Rv=S(`label.preserveCaseToggle`,`Preserve Case`),zv=class extends $c{constructor(e){super({icon:i.preserveCase,title:Rv+e.appendTitle,isChecked:e.isChecked,hoverDelegate:e.hoverDelegate??go(`element`),inputActiveOptionBorder:e.inputActiveOptionBorder,inputActiveOptionForeground:e.inputActiveOptionForeground,inputActiveOptionBackground:e.inputActiveOptionBackground})}},Bv=class extends Na{constructor(e,t,n,r){super(),this._showOptionButtons=n,this.fixFocusOnOptionClickEnabled=!0,this.cachedOptionsWidth=0,this._onDidOptionChange=this._register(new g),this.onDidOptionChange=this._onDidOptionChange.event,this._onKeyDown=this._register(new g),this.onKeyDown=this._onKeyDown.event,this._onMouseDown=this._register(new g),this._onInput=this._register(new g),this._onKeyUp=this._register(new g),this._onPreserveCaseKeyDown=this._register(new g),this.onPreserveCaseKeyDown=this._onPreserveCaseKeyDown.event,this.contextViewProvider=t,this.placeholder=r.placeholder||``,this.validation=r.validation,this.label=r.label||Lv;let i=r.appendPreserveCaseLabel||``,a=r.history||[],o=!!r.flexibleHeight,s=!!r.flexibleWidth,c=r.flexibleMaxHeight;this.domNode=document.createElement(`div`),this.domNode.classList.add(`monaco-findInput`),this.inputBox=this._register(new Io(this.domNode,this.contextViewProvider,{ariaLabel:this.label||``,placeholder:this.placeholder||``,validationOptions:{validation:this.validation},history:a,showHistoryHint:r.showHistoryHint,flexibleHeight:o,flexibleWidth:s,flexibleMaxHeight:c,inputBoxStyles:r.inputBoxStyles})),this.preserveCase=this._register(new zv({appendTitle:i,isChecked:!1,...r.toggleStyles})),this._register(this.preserveCase.onChange(e=>{this._onDidOptionChange.fire(e),!e&&this.fixFocusOnOptionClickEnabled&&this.inputBox.focus(),this.validate()})),this._register(this.preserveCase.onKeyDown(e=>{this._onPreserveCaseKeyDown.fire(e)})),this._showOptionButtons?this.cachedOptionsWidth=this.preserveCase.width():this.cachedOptionsWidth=0;let l=[this.preserveCase.domNode];this.onkeydown(this.domNode,e=>{if(e.equals(15)||e.equals(17)||e.equals(9)){let t=l.indexOf(this.domNode.ownerDocument.activeElement);if(t>=0){let n=-1;e.equals(17)?n=(t+1)%l.length:e.equals(15)&&(n=t===0?l.length-1:t-1),e.equals(9)?(l[t].blur(),this.inputBox.focus()):n>=0&&l[n].focus(),nr.stop(e,!0)}}});let u=document.createElement(`div`);u.className=`controls`,u.style.display=this._showOptionButtons?`block`:`none`,u.appendChild(this.preserveCase.domNode),this.domNode.appendChild(u),e?.appendChild(this.domNode),this.onkeydown(this.inputBox.inputElement,e=>this._onKeyDown.fire(e)),this.onkeyup(this.inputBox.inputElement,e=>this._onKeyUp.fire(e)),this.oninput(this.inputBox.inputElement,e=>this._onInput.fire()),this.onmousedown(this.inputBox.inputElement,e=>this._onMouseDown.fire(e))}enable(){this.domNode.classList.remove(`disabled`),this.inputBox.enable(),this.preserveCase.enable()}disable(){this.domNode.classList.add(`disabled`),this.inputBox.disable(),this.preserveCase.disable()}setEnabled(e){e?this.enable():this.disable()}select(){this.inputBox.select()}focus(){this.inputBox.focus()}getPreserveCase(){return this.preserveCase.checked}setPreserveCase(e){this.preserveCase.checked=e}focusOnPreserve(){this.preserveCase.focus()}validate(){this.inputBox?.validate()}set width(e){this.inputBox.paddingRight=this.cachedOptionsWidth,this.domNode.style.width=e+`px`}dispose(){super.dispose()}},Vv=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Hv=function(e,t){return function(n,r){t(n,r,e)}};const Uv=new G(`suggestWidgetVisible`,!1,S(`suggestWidgetVisible`,`Whether suggestion are visible`));var Wv=`historyNavigationWidgetFocus`,Gv=`historyNavigationForwardsEnabled`,Kv=`historyNavigationBackwardsEnabled`,qv=void 0,Jv=[];function Yv(e,t){if(Jv.includes(t))throw Error(`Cannot register the same widget multiple times`);Jv.push(t);let r=new n,i=new G(Wv,!1).bindTo(e),a=new G(Gv,!0).bindTo(e),o=new G(Kv,!0).bindTo(e),s=()=>{i.set(!0),qv=t},c=()=>{i.set(!1),qv===t&&(qv=void 0)};return mn(t.element)&&s(),r.add(t.onDidFocus(()=>s())),r.add(t.onDidBlur(()=>c())),r.add(b(()=>{Jv.splice(Jv.indexOf(t),1),c()})),{historyNavigationForwardsEnablement:a,historyNavigationBackwardsEnablement:o,dispose(){r.dispose()}}}var Xv=class extends ta{constructor(e,t,n,r){super(e,t,n);let i=this._register(r.createScoped(this.inputBox.element));this._register(Yv(i,this.inputBox))}};Xv=Vv([Hv(3,W)],Xv);var Zv=class extends Bv{constructor(e,t,n,r,i=!1){super(e,t,i,n);let a=this._register(r.createScoped(this.inputBox.element));this._register(Yv(a,this.inputBox))}};Zv=Vv([Hv(3,W)],Zv),Uc.registerCommandAndKeybindingRule({id:`history.showPrevious`,weight:200,when:z.and(z.has(Wv),z.equals(Kv,!0),z.not(`isComposing`),Uv.isEqualTo(!1)),primary:16,secondary:[528],handler:e=>{qv?.showPreviousValue()}}),Uc.registerCommandAndKeybindingRule({id:`history.showNext`,weight:200,when:z.and(z.has(Wv),z.equals(Gv,!0),z.not(`isComposing`),Uv.isEqualTo(!1)),primary:18,secondary:[530],handler:e=>{qv?.showNextValue()}});function Qv(e){return e.lookupKeybinding(`history.showPrevious`)?.getElectronAccelerator()===`Up`&&e.lookupKeybinding(`history.showNext`)?.getElectronAccelerator()===`Down`}var $v=ri(`find-collapsed`,i.chevronRight,S(`findCollapsedIcon`,`Icon to indicate that the editor find widget is collapsed.`)),ey=ri(`find-expanded`,i.chevronDown,S(`findExpandedIcon`,`Icon to indicate that the editor find widget is expanded.`));const ty=ri(`find-selection`,i.selection,S(`findSelectionIcon`,`Icon for 'Find in Selection' in the editor find widget.`)),ny=ri(`find-replace`,i.replace,S(`findReplaceIcon`,`Icon for 'Replace' in the editor find widget.`)),ry=ri(`find-replace-all`,i.replaceAll,S(`findReplaceAllIcon`,`Icon for 'Replace All' in the editor find widget.`)),iy=ri(`find-previous-match`,i.arrowUp,S(`findPreviousMatchIcon`,`Icon for 'Find Previous' in the editor find widget.`)),ay=ri(`find-next-match`,i.arrowDown,S(`findNextMatchIcon`,`Icon for 'Find Next' in the editor find widget.`));var oy=S(`label.findDialog`,`Find / Replace`),sy=S(`label.find`,`Find`),cy=S(`placeholder.find`,`Find`),ly=S(`label.previousMatchButton`,`Previous Match`),uy=S(`label.nextMatchButton`,`Next Match`),dy=S(`label.toggleSelectionFind`,`Find in Selection`),fy=S(`label.closeButton`,`Close`),py=S(`label.replace`,`Replace`),my=S(`placeholder.replace`,`Replace`),hy=S(`label.replaceButton`,`Replace`),gy=S(`label.replaceAllButton`,`Replace All`),_y=S(`label.toggleReplaceButton`,`Toggle Replace`),vy=S(`title.matchesCountLimit`,`Only the first {0} results are highlighted, but all find operations work on the entire text.`,jv);const yy=S(`label.matchesLocation`,`{0} of {1}`),by=S(`label.noResults`,`No results`);var xy=419,Sy=221,Cy=69,wy=33,Ty=`ctrlEnterReplaceAll.windows.donotask`,Ey=Le?256:2048,Dy=class{constructor(e){this.afterLineNumber=e,this.heightInPx=wy,this.suppressMouseDown=!1,this.domNode=document.createElement(`div`),this.domNode.className=`dock-find-viewzone`}};function Oy(e,t,n){let r=!!t.match(/\n/);if(n&&r&&n.selectionStart>0){e.stopPropagation();return}}function ky(e,t,n){let r=!!t.match(/\n/);if(n&&r&&n.selectionEnd<n.value.length){e.stopPropagation();return}}var Ay=class e extends Na{static#e=this.ID=`editor.contrib.findWidget`;constructor(e,t,n,r,i,a,o,s,c,l){super(),this._hoverService=l,this._cachedHeight=null,this._revealTimeouts=[],this._codeEditor=e,this._controller=t,this._state=n,this._contextViewProvider=r,this._keybindingService=i,this._contextKeyService=a,this._storageService=s,this._notificationService=c,this._ctrlEnterReplaceAllWarningPrompted=!!s.getBoolean(Ty,0),this._isVisible=!1,this._isReplaceVisible=!1,this._ignoreChangeEvent=!1,this._updateHistoryDelayer=new Nt(500),this._register(b(()=>this._updateHistoryDelayer.cancel())),this._register(this._state.onFindReplaceStateChange(e=>this._onStateChanged(e))),this._buildDomNode(),this._updateButtons(),this._tryUpdateWidgetWidth(),this._findInput.inputBox.layout(),this._register(this._codeEditor.onDidChangeConfiguration(e=>{if(e.hasChanged(92)&&(this._codeEditor.getOption(92)&&this._state.change({isReplaceRevealed:!1},!1),this._updateButtons()),e.hasChanged(146)&&this._tryUpdateWidgetWidth(),e.hasChanged(2)&&this.updateAccessibilitySupport(),e.hasChanged(41)){let e=this._codeEditor.getOption(41).loop;this._state.change({loop:e},!1);let t=this._codeEditor.getOption(41).addExtraSpaceOnTop;t&&!this._viewZone&&(this._viewZone=new Dy(0),this._showViewZone()),!t&&this._viewZone&&this._removeViewZone()}})),this.updateAccessibilitySupport(),this._register(this._codeEditor.onDidChangeCursorSelection(()=>{this._isVisible&&this._updateToggleSelectionFindButton()})),this._register(this._codeEditor.onDidFocusEditorWidget(async()=>{if(this._isVisible){let e=await this._controller.getGlobalBufferTerm();e&&e!==this._state.searchString&&(this._state.change({searchString:e},!1),this._findInput.select())}})),this._findInputFocused=wv.bindTo(a),this._findFocusTracker=this._register(An(this._findInput.inputBox.inputElement)),this._register(this._findFocusTracker.onDidFocus(()=>{this._findInputFocused.set(!0),this._updateSearchScope()})),this._register(this._findFocusTracker.onDidBlur(()=>{this._findInputFocused.set(!1)})),this._replaceInputFocused=Tv.bindTo(a),this._replaceFocusTracker=this._register(An(this._replaceInput.inputBox.inputElement)),this._register(this._replaceFocusTracker.onDidFocus(()=>{this._replaceInputFocused.set(!0),this._updateSearchScope()})),this._register(this._replaceFocusTracker.onDidBlur(()=>{this._replaceInputFocused.set(!1)})),this._codeEditor.addOverlayWidget(this),this._codeEditor.getOption(41).addExtraSpaceOnTop&&(this._viewZone=new Dy(0)),this._register(this._codeEditor.onDidChangeModel(()=>{this._isVisible&&(this._viewZoneId=void 0)})),this._register(this._codeEditor.onDidScrollChange(e=>{if(e.scrollTopChanged){this._layoutViewZone();return}setTimeout(()=>{this._layoutViewZone()},0)}))}getId(){return e.ID}getDomNode(){return this._domNode}getPosition(){return this._isVisible?{preference:0}:null}_onStateChanged(e){if(e.searchString){try{this._ignoreChangeEvent=!0,this._findInput.setValue(this._state.searchString)}finally{this._ignoreChangeEvent=!1}this._updateButtons()}if(e.replaceString&&(this._replaceInput.inputBox.value=this._state.replaceString),e.isRevealed&&(this._state.isRevealed?this._reveal():this._hide(!0)),e.isReplaceRevealed&&(this._state.isReplaceRevealed?!this._codeEditor.getOption(92)&&!this._isReplaceVisible&&(this._isReplaceVisible=!0,this._replaceInput.width=rn(this._findInput.domNode),this._updateButtons(),this._replaceInput.inputBox.layout()):this._isReplaceVisible&&(this._isReplaceVisible=!1,this._updateButtons())),(e.isRevealed||e.isReplaceRevealed)&&(this._state.isRevealed||this._state.isReplaceRevealed)&&this._tryUpdateHeight()&&this._showViewZone(),e.isRegex&&this._findInput.setRegex(this._state.isRegex),e.wholeWord&&this._findInput.setWholeWords(this._state.wholeWord),e.matchCase&&this._findInput.setCaseSensitive(this._state.matchCase),e.preserveCase&&this._replaceInput.setPreserveCase(this._state.preserveCase),e.searchScope&&(this._state.searchScope?this._toggleSelectionFind.checked=!0:this._toggleSelectionFind.checked=!1,this._updateToggleSelectionFindButton()),e.searchString||e.matchesCount||e.matchesPosition){let e=this._state.searchString.length>0&&this._state.matchesCount===0;this._domNode.classList.toggle(`no-results`,e),this._updateMatchesCount(),this._updateButtons()}(e.searchString||e.currentMatch)&&this._layoutViewZone(),e.updateHistory&&this._delayedUpdateHistory(),e.loop&&this._updateButtons()}_delayedUpdateHistory(){this._updateHistoryDelayer.trigger(this._updateHistory.bind(this)).then(void 0,C)}_updateHistory(){this._state.searchString&&this._findInput.inputBox.addToHistory(),this._state.replaceString&&this._replaceInput.inputBox.addToHistory()}_updateMatchesCount(){this._matchesCount.style.minWidth=Cy+`px`,this._state.matchesCount>=19999?this._matchesCount.title=vy:this._matchesCount.title=``,this._matchesCount.firstChild?.remove();let e;if(this._state.matchesCount>0){let t=String(this._state.matchesCount);this._state.matchesCount>=19999&&(t+=`+`);let n=String(this._state.matchesPosition);n===`0`&&(n=`?`),e=dn(yy,n,t)}else e=by;this._matchesCount.appendChild(document.createTextNode(e)),qa(this._getAriaLabel(e,this._state.currentMatch,this._state.searchString)),Cy=Math.max(Cy,this._matchesCount.clientWidth)}_getAriaLabel(e,t,n){if(e===by)return n===``?S(`ariaSearchNoResultEmpty`,`{0} found`,e):S(`ariaSearchNoResult`,`{0} found for '{1}'`,e,n);if(t){let r=S(`ariaSearchNoResultWithLineNum`,`{0} found for '{1}', at {2}`,e,n,t.startLineNumber+`:`+t.startColumn),i=this._codeEditor.getModel();return i&&t.startLineNumber<=i.getLineCount()&&t.startLineNumber>=1?`${i.getLineContent(t.startLineNumber)}, ${r}`:r}return S(`ariaSearchNoResultWithLineNumNoCurrentMatch`,`{0} found for '{1}'`,e,n)}_updateToggleSelectionFindButton(){let e=this._codeEditor.getSelection(),t=e?e.startLineNumber!==e.endLineNumber||e.startColumn!==e.endColumn:!1,n=this._toggleSelectionFind.checked;this._isVisible&&(n||t)?this._toggleSelectionFind.enable():this._toggleSelectionFind.disable()}_updateButtons(){this._findInput.setEnabled(this._isVisible),this._replaceInput.setEnabled(this._isVisible&&this._isReplaceVisible),this._updateToggleSelectionFindButton(),this._closeBtn.setEnabled(this._isVisible);let e=this._state.searchString.length>0,t=!!this._state.matchesCount;this._prevBtn.setEnabled(this._isVisible&&e&&t&&this._state.canNavigateBack()),this._nextBtn.setEnabled(this._isVisible&&e&&t&&this._state.canNavigateForward()),this._replaceBtn.setEnabled(this._isVisible&&this._isReplaceVisible&&e),this._replaceAllBtn.setEnabled(this._isVisible&&this._isReplaceVisible&&e),this._domNode.classList.toggle(`replaceToggled`,this._isReplaceVisible),this._toggleReplaceBtn.setExpanded(this._isReplaceVisible);let n=!this._codeEditor.getOption(92);this._toggleReplaceBtn.setEnabled(this._isVisible&&n)}_reveal(){if(this._revealTimeouts.forEach(e=>{clearTimeout(e)}),this._revealTimeouts=[],!this._isVisible){this._isVisible=!0;let e=this._codeEditor.getSelection();switch(this._codeEditor.getOption(41).autoFindInSelection){case`always`:this._toggleSelectionFind.checked=!0;break;case`never`:this._toggleSelectionFind.checked=!1;break;case`multiline`:{let t=!!e&&e.startLineNumber!==e.endLineNumber;this._toggleSelectionFind.checked=t;break}default:break}this._tryUpdateWidgetWidth(),this._updateButtons(),this._revealTimeouts.push(setTimeout(()=>{this._domNode.classList.add(`visible`),this._domNode.setAttribute(`aria-hidden`,`false`)},0)),this._revealTimeouts.push(setTimeout(()=>{this._findInput.validate()},200)),this._codeEditor.layoutOverlayWidget(this);let t=!0;if(this._codeEditor.getOption(41).seedSearchStringFromSelection&&e){let n=this._codeEditor.getDomNode();if(n){let r=gt(n),i=this._codeEditor.getScrolledVisiblePosition(e.getStartPosition()),a=r.left+(i?i.left:0),o=i?i.top:0;if(this._viewZone&&o<this._viewZone.heightInPx){e.endLineNumber>e.startLineNumber&&(t=!1);let n=Ur(this._domNode).left;a>n&&(t=!1);let i=this._codeEditor.getScrolledVisiblePosition(e.getEndPosition());r.left+(i?i.left:0)>n&&(t=!1)}}}this._showViewZone(t)}}_hide(e){this._revealTimeouts.forEach(e=>{clearTimeout(e)}),this._revealTimeouts=[],this._isVisible&&(this._isVisible=!1,this._updateButtons(),this._domNode.classList.remove(`visible`),this._domNode.setAttribute(`aria-hidden`,`true`),this._findInput.clearMessage(),e&&this._codeEditor.focus(),this._codeEditor.layoutOverlayWidget(this),this._removeViewZone())}_layoutViewZone(e){if(!this._codeEditor.getOption(41).addExtraSpaceOnTop){this._removeViewZone();return}if(!this._isVisible)return;let t=this._viewZone;this._viewZoneId!==void 0||!t||this._codeEditor.changeViewZones(n=>{t.heightInPx=this._getHeight(),this._viewZoneId=n.addZone(t),this._codeEditor.setScrollTop(e||this._codeEditor.getScrollTop()+t.heightInPx)})}_showViewZone(e=!0){if(!this._isVisible||!this._codeEditor.getOption(41).addExtraSpaceOnTop)return;this._viewZone===void 0&&(this._viewZone=new Dy(0));let t=this._viewZone;this._codeEditor.changeViewZones(n=>{if(this._viewZoneId!==void 0){let r=this._getHeight();if(r===t.heightInPx)return;let i=r-t.heightInPx;t.heightInPx=r,n.layoutZone(this._viewZoneId),e&&this._codeEditor.setScrollTop(this._codeEditor.getScrollTop()+i);return}else{let r=this._getHeight();if(r-=this._codeEditor.getOption(84).top,r<=0)return;t.heightInPx=r,this._viewZoneId=n.addZone(t),e&&this._codeEditor.setScrollTop(this._codeEditor.getScrollTop()+r)}})}_removeViewZone(){this._codeEditor.changeViewZones(e=>{this._viewZoneId!==void 0&&(e.removeZone(this._viewZoneId),this._viewZoneId=void 0,this._viewZone&&=(this._codeEditor.setScrollTop(this._codeEditor.getScrollTop()-this._viewZone.heightInPx),void 0))})}_tryUpdateWidgetWidth(){if(!this._isVisible||!this._domNode.isConnected)return;let e=this._codeEditor.getLayoutInfo();if(e.contentWidth<=0){this._domNode.classList.add(`hiddenEditor`);return}else this._domNode.classList.contains(`hiddenEditor`)&&this._domNode.classList.remove(`hiddenEditor`);let t=e.width,n=e.minimap.minimapWidth,r=!1,i=!1,a=!1;if(this._resized&&rn(this._domNode)>xy){this._domNode.style.maxWidth=`${t-28-n-15}px`,this._replaceInput.width=rn(this._findInput.domNode);return}if(xy+28+n>=t&&(i=!0),xy+28+n-Cy>=t&&(a=!0),xy+28+n-Cy>=t+50&&(r=!0),this._domNode.classList.toggle(`collapsed-find-widget`,r),this._domNode.classList.toggle(`narrow-find-widget`,a),this._domNode.classList.toggle(`reduced-find-widget`,i),!a&&!r&&(this._domNode.style.maxWidth=`${t-28-n-15}px`),this._findInput.layout({collapsedFindWidget:r,narrowFindWidget:a,reducedFindWidget:i}),this._resized){let e=this._findInput.inputBox.element.clientWidth;e>0&&(this._replaceInput.width=e)}else this._isReplaceVisible&&(this._replaceInput.width=rn(this._findInput.domNode))}_getHeight(){let e=0;return e+=4,e+=this._findInput.inputBox.height+2,this._isReplaceVisible&&(e+=4,e+=this._replaceInput.inputBox.height+2),e+=4,e}_tryUpdateHeight(){let e=this._getHeight();return this._cachedHeight!==null&&this._cachedHeight===e?!1:(this._cachedHeight=e,this._domNode.style.height=`${e}px`,!0)}focusFindInput(){this._findInput.select(),this._findInput.focus()}focusReplaceInput(){this._replaceInput.select(),this._replaceInput.focus()}highlightFindOptions(){this._findInput.highlightFindOptions()}_updateSearchScope(){if(this._codeEditor.hasModel()&&this._toggleSelectionFind.checked){let e=this._codeEditor.getSelections();e.map(e=>{e.endColumn===1&&e.endLineNumber>e.startLineNumber&&(e=e.setEndPosition(e.endLineNumber-1,this._codeEditor.getModel().getLineMaxColumn(e.endLineNumber-1)));let t=this._state.currentMatch;return e.startLineNumber!==e.endLineNumber&&!T.equalsRange(e,t)?e:null}).filter(e=>!!e),e.length&&this._state.change({searchScope:e},!0)}}_onFindInputMouseDown(e){e.middleButton&&e.stopPropagation()}_onFindInputKeyDown(e){if(e.equals(Ey|3))if(this._keybindingService.dispatchEvent(e,e.target)){e.preventDefault();return}else{this._findInput.inputBox.insertAtCursor(`
`),e.preventDefault();return}if(e.equals(2)){this._isReplaceVisible?this._replaceInput.focus():this._findInput.focusOnCaseSensitive(),e.preventDefault();return}if(e.equals(2066)){this._codeEditor.focus(),e.preventDefault();return}if(e.equals(16))return Oy(e,this._findInput.getValue(),this._findInput.domNode.querySelector(`textarea`));if(e.equals(18))return ky(e,this._findInput.getValue(),this._findInput.domNode.querySelector(`textarea`))}_onReplaceInputKeyDown(e){if(e.equals(Ey|3))if(this._keybindingService.dispatchEvent(e,e.target)){e.preventDefault();return}else{_e&&Ee&&!this._ctrlEnterReplaceAllWarningPrompted&&(this._notificationService.info(S(`ctrlEnter.keybindingChanged`,`Ctrl+Enter now inserts line break instead of replacing all. You can modify the keybinding for editor.action.replaceAll to override this behavior.`)),this._ctrlEnterReplaceAllWarningPrompted=!0,this._storageService.store(Ty,!0,0,0)),this._replaceInput.inputBox.insertAtCursor(`
`),e.preventDefault();return}if(e.equals(2)){this._findInput.focusOnCaseSensitive(),e.preventDefault();return}if(e.equals(1026)){this._findInput.focus(),e.preventDefault();return}if(e.equals(2066)){this._codeEditor.focus(),e.preventDefault();return}if(e.equals(16))return Oy(e,this._replaceInput.inputBox.value,this._replaceInput.inputBox.element.querySelector(`textarea`));if(e.equals(18))return ky(e,this._replaceInput.inputBox.value,this._replaceInput.inputBox.element.querySelector(`textarea`))}getVerticalSashLeft(e){return 0}_keybindingLabelFor(e){let t=this._keybindingService.lookupKeybinding(e);return t?` (${t.getLabel()})`:``}_buildDomNode(){this._findInput=this._register(new Xv(null,this._contextViewProvider,{width:Sy,label:sy,placeholder:cy,appendCaseSensitiveLabel:this._keybindingLabelFor(Q.ToggleCaseSensitiveCommand),appendWholeWordsLabel:this._keybindingLabelFor(Q.ToggleWholeWordCommand),appendRegexLabel:this._keybindingLabelFor(Q.ToggleRegexCommand),validation:e=>{if(e.length===0||!this._findInput.getRegex())return null;try{return new RegExp(e,`gu`),null}catch(e){return{content:e.message}}},flexibleHeight:!0,flexibleWidth:!0,flexibleMaxHeight:118,showCommonFindToggles:!0,showHistoryHint:()=>Qv(this._keybindingService),inputBoxStyles:ti,toggleStyles:ga},this._contextKeyService)),this._findInput.setRegex(!!this._state.isRegex),this._findInput.setCaseSensitive(!!this._state.matchCase),this._findInput.setWholeWords(!!this._state.wholeWord),this._register(this._findInput.onKeyDown(e=>this._onFindInputKeyDown(e))),this._register(this._findInput.inputBox.onDidChange(()=>{this._ignoreChangeEvent||this._state.change({searchString:this._findInput.getValue()},!0)})),this._register(this._findInput.onDidOptionChange(()=>{this._state.change({isRegex:this._findInput.getRegex(),wholeWord:this._findInput.getWholeWords(),matchCase:this._findInput.getCaseSensitive()},!0)})),this._register(this._findInput.onCaseSensitiveKeyDown(e=>{e.equals(1026)&&this._isReplaceVisible&&(this._replaceInput.focus(),e.preventDefault())})),this._register(this._findInput.onRegexKeyDown(e=>{e.equals(2)&&this._isReplaceVisible&&(this._replaceInput.focusOnPreserve(),e.preventDefault())})),this._register(this._findInput.inputBox.onDidHeightChange(e=>{this._tryUpdateHeight()&&this._showViewZone()})),fe&&this._register(this._findInput.onMouseDown(e=>this._onFindInputMouseDown(e))),this._matchesCount=document.createElement(`div`),this._matchesCount.className=`matchesCount`,this._updateMatchesCount();let e=this._register(si());this._prevBtn=this._register(new jy({label:ly+this._keybindingLabelFor(Q.PreviousMatchFindAction),icon:iy,hoverDelegate:e,onTrigger:()=>{ae(this._codeEditor.getAction(Q.PreviousMatchFindAction)).run().then(void 0,C)}},this._hoverService)),this._nextBtn=this._register(new jy({label:uy+this._keybindingLabelFor(Q.NextMatchFindAction),icon:ay,hoverDelegate:e,onTrigger:()=>{ae(this._codeEditor.getAction(Q.NextMatchFindAction)).run().then(void 0,C)}},this._hoverService));let t=document.createElement(`div`);t.className=`find-part`,t.appendChild(this._findInput.domNode);let n=document.createElement(`div`);n.className=`find-actions`,t.appendChild(n),n.appendChild(this._matchesCount),n.appendChild(this._prevBtn.domNode),n.appendChild(this._nextBtn.domNode),this._toggleSelectionFind=this._register(new $c({icon:ty,title:dy+this._keybindingLabelFor(Q.ToggleSearchScopeCommand),isChecked:!1,hoverDelegate:e,inputActiveOptionBackground:tn(vn),inputActiveOptionBorder:tn(Wt),inputActiveOptionForeground:tn(Ge)})),this._register(this._toggleSelectionFind.onChange(()=>{if(this._toggleSelectionFind.checked){if(this._codeEditor.hasModel()){let e=this._codeEditor.getSelections();e=e.map(e=>(e.endColumn===1&&e.endLineNumber>e.startLineNumber&&(e=e.setEndPosition(e.endLineNumber-1,this._codeEditor.getModel().getLineMaxColumn(e.endLineNumber-1))),e.isEmpty()?null:e)).filter(e=>!!e),e.length&&this._state.change({searchScope:e},!0)}}else this._state.change({searchScope:null},!0)})),n.appendChild(this._toggleSelectionFind.domNode),this._closeBtn=this._register(new jy({label:fy+this._keybindingLabelFor(Q.CloseFindWidgetCommand),icon:$s,hoverDelegate:e,onTrigger:()=>{this._state.change({isRevealed:!1,searchScope:null},!1)},onKeyDown:e=>{e.equals(2)&&this._isReplaceVisible&&(this._replaceBtn.isEnabled()?this._replaceBtn.focus():this._codeEditor.focus(),e.preventDefault())}},this._hoverService)),this._replaceInput=this._register(new Zv(null,void 0,{label:py,placeholder:my,appendPreserveCaseLabel:this._keybindingLabelFor(Q.TogglePreserveCaseCommand),history:[],flexibleHeight:!0,flexibleWidth:!0,flexibleMaxHeight:118,showHistoryHint:()=>Qv(this._keybindingService),inputBoxStyles:ti,toggleStyles:ga},this._contextKeyService,!0)),this._replaceInput.setPreserveCase(!!this._state.preserveCase),this._register(this._replaceInput.onKeyDown(e=>this._onReplaceInputKeyDown(e))),this._register(this._replaceInput.inputBox.onDidChange(()=>{this._state.change({replaceString:this._replaceInput.inputBox.value},!1)})),this._register(this._replaceInput.inputBox.onDidHeightChange(e=>{this._isReplaceVisible&&this._tryUpdateHeight()&&this._showViewZone()})),this._register(this._replaceInput.onDidOptionChange(()=>{this._state.change({preserveCase:this._replaceInput.getPreserveCase()},!0)})),this._register(this._replaceInput.onPreserveCaseKeyDown(e=>{e.equals(2)&&(this._prevBtn.isEnabled()?this._prevBtn.focus():this._nextBtn.isEnabled()?this._nextBtn.focus():this._toggleSelectionFind.enabled?this._toggleSelectionFind.focus():this._closeBtn.isEnabled()&&this._closeBtn.focus(),e.preventDefault())}));let r=this._register(si());this._replaceBtn=this._register(new jy({label:hy+this._keybindingLabelFor(Q.ReplaceOneAction),icon:ny,hoverDelegate:r,onTrigger:()=>{this._controller.replace()},onKeyDown:e=>{e.equals(1026)&&(this._closeBtn.focus(),e.preventDefault())}},this._hoverService)),this._replaceAllBtn=this._register(new jy({label:gy+this._keybindingLabelFor(Q.ReplaceAllAction),icon:ry,hoverDelegate:r,onTrigger:()=>{this._controller.replaceAll()}},this._hoverService));let i=document.createElement(`div`);i.className=`replace-part`,i.appendChild(this._replaceInput.domNode);let a=document.createElement(`div`);a.className=`replace-actions`,i.appendChild(a),a.appendChild(this._replaceBtn.domNode),a.appendChild(this._replaceAllBtn.domNode),this._toggleReplaceBtn=this._register(new jy({label:_y,className:`codicon toggle left`,onTrigger:()=>{this._state.change({isReplaceRevealed:!this._isReplaceVisible},!1),this._isReplaceVisible&&(this._replaceInput.width=rn(this._findInput.domNode),this._replaceInput.inputBox.layout()),this._showViewZone()}},this._hoverService)),this._toggleReplaceBtn.setExpanded(this._isReplaceVisible),this._domNode=document.createElement(`div`),this._domNode.className=`editor-widget find-widget`,this._domNode.setAttribute(`aria-hidden`,`true`),this._domNode.ariaLabel=oy,this._domNode.role=`dialog`,this._domNode.style.width=`${xy}px`,this._domNode.appendChild(this._toggleReplaceBtn.domNode),this._domNode.appendChild(t),this._domNode.appendChild(this._closeBtn.domNode),this._domNode.appendChild(i),this._resizeSash=this._register(new zc(this._domNode,this,{orientation:0,size:2})),this._resized=!1;let o=xy;this._register(this._resizeSash.onDidStart(()=>{o=rn(this._domNode)})),this._register(this._resizeSash.onDidChange(e=>{this._resized=!0;let t=o+e.startX-e.currentX;t<xy||t>(parseFloat(Pt(this._domNode).maxWidth)||0)||(this._domNode.style.width=`${t}px`,this._isReplaceVisible&&(this._replaceInput.width=rn(this._findInput.domNode)),this._findInput.inputBox.layout(),this._tryUpdateHeight())})),this._register(this._resizeSash.onDidReset(()=>{let e=rn(this._domNode);if(e<xy)return;let t=xy;if(!this._resized||e===xy){let e=this._codeEditor.getLayoutInfo();t=e.width-28-e.minimap.minimapWidth-15,this._resized=!0}this._domNode.style.width=`${t}px`,this._isReplaceVisible&&(this._replaceInput.width=rn(this._findInput.domNode)),this._findInput.inputBox.layout()}))}updateAccessibilitySupport(){let e=this._codeEditor.getOption(2);this._findInput.setFocusInputOnOptionClick(e!==2)}},jy=class extends Na{constructor(e,t){super(),this._opts=e;let n=`button`;this._opts.className&&(n=n+` `+this._opts.className),this._opts.icon&&(n=n+` `+J.asClassName(this._opts.icon)),this._domNode=document.createElement(`div`),this._domNode.tabIndex=0,this._domNode.className=n,this._domNode.setAttribute(`role`,`button`),this._domNode.setAttribute(`aria-label`,this._opts.label),this._register(t.setupManagedHover(e.hoverDelegate??go(`element`),this._domNode,this._opts.label)),this.onclick(this._domNode,e=>{this._opts.onTrigger(),e.preventDefault()}),this.onkeydown(this._domNode,e=>{if(e.equals(10)||e.equals(3)){this._opts.onTrigger(),e.preventDefault();return}this._opts.onKeyDown?.(e)})}get domNode(){return this._domNode}isEnabled(){return this._domNode.tabIndex>=0}focus(){this._domNode.focus()}setEnabled(e){this._domNode.classList.toggle(`disabled`,!e),this._domNode.setAttribute(`aria-disabled`,String(!e)),this._domNode.tabIndex=e?0:-1}setExpanded(e){this._domNode.setAttribute(`aria-expanded`,String(!!e)),e?(this._domNode.classList.remove(...J.asClassNameArray($v)),this._domNode.classList.add(...J.asClassNameArray(ey))):(this._domNode.classList.remove(...J.asClassNameArray(ey)),this._domNode.classList.add(...J.asClassNameArray($v)))}};yc((e,t)=>{let n=e.getColor(yn);n&&t.addRule(`.monaco-editor .findMatch { border: 1px ${Mn(e.type)?`dotted`:`solid`} ${n}; box-sizing: border-box; }`);let r=e.getColor(Ke);r&&t.addRule(`.monaco-editor .findScope { border: 1px ${Mn(e.type)?`dashed`:`solid`} ${r}; }`);let i=e.getColor(kt);i&&t.addRule(`.monaco-editor .find-widget { border: 1px solid ${i}; }`);let a=e.getColor(gn);a&&t.addRule(`.monaco-editor .findMatchInline { color: ${a}; }`);let o=e.getColor(Kt);o&&t.addRule(`.monaco-editor .currentFindMatchInline { color: ${o}; }`)});var My=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Ny=function(e,t){return function(n,r){t(n,r,e)}},Py,Fy=524288;function Iy(e,t=`single`,n=!1){if(!e.hasModel())return null;let r=e.getSelection();if(t===`single`&&r.startLineNumber===r.endLineNumber||t===`multiple`){if(r.isEmpty()){let t=e.getConfiguredWordAtPosition(r.getStartPosition());if(t&&!1===n)return t.word}else if(e.getModel().getValueLengthInRange(r)<Fy)return e.getModel().getValueInRange(r)}return null}var Ly=class extends _{static#e=Py=this;static#t=this.ID=`editor.contrib.findController`;get editor(){return this._editor}static get(e){return e.getContribution(Py.ID)}constructor(e,t,n,r,i,a){super(),this._editor=e,this._findWidgetVisible=Cv.bindTo(t),this._contextKeyService=t,this._storageService=n,this._clipboardService=r,this._notificationService=i,this._hoverService=a,this._updateHistoryDelayer=new Nt(500),this._state=this._register(new Iv),this.loadQueryState(),this._register(this._state.onFindReplaceStateChange(e=>this._onStateChanged(e))),this._model=null,this._register(this._editor.onDidChangeModel(()=>{let e=this._editor.getModel()&&this._state.isRevealed;this.disposeModel(),this._state.change({searchScope:null,matchCase:this._storageService.getBoolean(`editor.matchCase`,1,!1),wholeWord:this._storageService.getBoolean(`editor.wholeWord`,1,!1),isRegex:this._storageService.getBoolean(`editor.isRegex`,1,!1),preserveCase:this._storageService.getBoolean(`editor.preserveCase`,1,!1)},!1),e&&this._start({forceRevealReplace:!1,seedSearchStringFromSelection:`none`,seedSearchStringFromNonEmptySelection:!1,seedSearchStringFromGlobalClipboard:!1,shouldFocus:0,shouldAnimate:!1,updateSearchScope:!1,loop:this._editor.getOption(41).loop})}))}dispose(){this.disposeModel(),super.dispose()}disposeModel(){this._model&&=(this._model.dispose(),null)}_onStateChanged(e){this.saveQueryState(e),e.isRevealed&&(this._state.isRevealed?this._findWidgetVisible.set(!0):(this._findWidgetVisible.reset(),this.disposeModel())),e.searchString&&this.setGlobalBufferTerm(this._state.searchString)}saveQueryState(e){e.isRegex&&this._storageService.store(`editor.isRegex`,this._state.actualIsRegex,1,1),e.wholeWord&&this._storageService.store(`editor.wholeWord`,this._state.actualWholeWord,1,1),e.matchCase&&this._storageService.store(`editor.matchCase`,this._state.actualMatchCase,1,1),e.preserveCase&&this._storageService.store(`editor.preserveCase`,this._state.actualPreserveCase,1,1)}loadQueryState(){this._state.change({matchCase:this._storageService.getBoolean(`editor.matchCase`,1,this._state.matchCase),wholeWord:this._storageService.getBoolean(`editor.wholeWord`,1,this._state.wholeWord),isRegex:this._storageService.getBoolean(`editor.isRegex`,1,this._state.isRegex),preserveCase:this._storageService.getBoolean(`editor.preserveCase`,1,this._state.preserveCase)},!1)}isFindInputFocused(){return!!wv.getValue(this._contextKeyService)}getState(){return this._state}closeFindWidget(){this._state.change({isRevealed:!1,searchScope:null},!1),this._editor.focus()}toggleCaseSensitive(){this._state.change({matchCase:!this._state.matchCase},!1),this._state.isRevealed||this.highlightFindOptions()}toggleWholeWords(){this._state.change({wholeWord:!this._state.wholeWord},!1),this._state.isRevealed||this.highlightFindOptions()}toggleRegex(){this._state.change({isRegex:!this._state.isRegex},!1),this._state.isRevealed||this.highlightFindOptions()}togglePreserveCase(){this._state.change({preserveCase:!this._state.preserveCase},!1),this._state.isRevealed||this.highlightFindOptions()}toggleSearchScope(){if(this._state.searchScope)this._state.change({searchScope:null},!0);else if(this._editor.hasModel()){let e=this._editor.getSelections();e=e.map(e=>(e.endColumn===1&&e.endLineNumber>e.startLineNumber&&(e=e.setEndPosition(e.endLineNumber-1,this._editor.getModel().getLineMaxColumn(e.endLineNumber-1))),e.isEmpty()?null:e)).filter(e=>!!e),e.length&&this._state.change({searchScope:e},!0)}}setSearchString(e){this._state.isRegex&&(e=St(e)),this._state.change({searchString:e},!1)}highlightFindOptions(e=!1){}async _start(e,t){if(this.disposeModel(),!this._editor.hasModel())return;let n={...t,isRevealed:!0};if(e.seedSearchStringFromSelection===`single`){let t=Iy(this._editor,e.seedSearchStringFromSelection,e.seedSearchStringFromNonEmptySelection);t&&(this._state.isRegex?n.searchString=St(t):n.searchString=t)}else if(e.seedSearchStringFromSelection===`multiple`&&!e.updateSearchScope){let t=Iy(this._editor,e.seedSearchStringFromSelection);t&&(n.searchString=t)}if(!n.searchString&&e.seedSearchStringFromGlobalClipboard){let e=await this.getGlobalBufferTerm();if(!this._editor.hasModel())return;e&&(n.searchString=e)}if(e.forceRevealReplace||n.isReplaceRevealed?n.isReplaceRevealed=!0:this._findWidgetVisible.get()||(n.isReplaceRevealed=!1),e.updateSearchScope){let e=this._editor.getSelections();e.some(e=>!e.isEmpty())&&(n.searchScope=e)}n.loop=e.loop,this._state.change(n,!1),this._model||=new Nv(this._editor,this._state)}start(e,t){return this._start(e,t)}moveToNextMatch(){return this._model?(this._model.moveToNextMatch(),!0):!1}moveToPrevMatch(){return this._model?(this._model.moveToPrevMatch(),!0):!1}goToMatch(e){return this._model?(this._model.moveToMatch(e),!0):!1}replace(){return this._model?(this._model.replace(),!0):!1}replaceAll(){return this._model?this._editor.getModel()?.isTooLargeForHeapOperation()?(this._notificationService.warn(S(`too.large.for.replaceall`,`The file is too large to perform a replace all operation.`)),!1):(this._model.replaceAll(),!0):!1}selectAllMatches(){return this._model?(this._model.selectAllMatches(),this._editor.focus(),!0):!1}async getGlobalBufferTerm(){return this._editor.getOption(41).globalFindClipboard&&this._editor.hasModel()&&!this._editor.getModel().isTooLargeForSyncing()?this._clipboardService.readFindText():``}setGlobalBufferTerm(e){this._editor.getOption(41).globalFindClipboard&&this._editor.hasModel()&&!this._editor.getModel().isTooLargeForSyncing()&&this._clipboardService.writeFindText(e)}};Ly=Py=My([Ny(1,W),Ny(2,Pa),Ny(3,_l),Ny(4,Ro),Ny(5,oi)],Ly);var Ry=class extends Ly{constructor(e,t,n,r,i,a,o,s,c){super(e,n,o,s,a,c),this._contextViewService=t,this._keybindingService=r,this._themeService=i,this._widget=null,this._findOptionsWidget=null}async _start(e,t){this._widget||this._createFindWidget();let n=this._editor.getSelection(),r=!1;switch(this._editor.getOption(41).autoFindInSelection){case`always`:r=!0;break;case`never`:r=!1;break;case`multiline`:r=!!n&&n.startLineNumber!==n.endLineNumber;break;default:break}e.updateSearchScope=e.updateSearchScope||r,await super._start(e,t),this._widget&&(e.shouldFocus===2?this._widget.focusReplaceInput():e.shouldFocus===1&&this._widget.focusFindInput())}highlightFindOptions(e=!1){this._widget||this._createFindWidget(),this._state.isRevealed&&!e?this._widget.highlightFindOptions():this._findOptionsWidget.highlightFindOptions()}_createFindWidget(){this._widget=this._register(new Ay(this._editor,this,this._state,this._contextViewService,this._keybindingService,this._contextKeyService,this._themeService,this._storageService,this._notificationService,this._hoverService)),this._findOptionsWidget=this._register(new Pv(this._editor,this._state,this._keybindingService))}};Ry=My([Ny(1,Pl),Ny(2,W),Ny(3,ua),Ny(4,Zc),Ny(5,Ro),Ny(6,Pa),Ny(7,_l),Ny(8,oi)],Ry),ra(new ai({id:Q.StartFindAction,label:S(`startFindAction`,`Find`),alias:`Find`,precondition:z.or(q.focus,z.has(`editorIsOpen`)),kbOpts:{kbExpr:null,primary:2084,weight:100},menuOpts:{menuId:R.MenubarEditMenu,group:`3_find`,title:S({key:`miFind`,comment:[`&& denotes a mnemonic`]},`&&Find`),order:1}})).addImplementation(0,(e,t,n)=>{let r=Ly.get(t);return r?r.start({forceRevealReplace:!1,seedSearchStringFromSelection:t.getOption(41).seedSearchStringFromSelection===`never`?`none`:`single`,seedSearchStringFromNonEmptySelection:t.getOption(41).seedSearchStringFromSelection===`selection`,seedSearchStringFromGlobalClipboard:t.getOption(41).globalFindClipboard,shouldFocus:1,shouldAnimate:!0,updateSearchScope:!1,loop:t.getOption(41).loop}):!1});var zy={description:`Open a new In-Editor Find Widget.`,args:[{name:`Open a new In-Editor Find Widget args`,schema:{properties:{searchString:{type:`string`},replaceString:{type:`string`},isRegex:{type:`boolean`},matchWholeWord:{type:`boolean`},isCaseSensitive:{type:`boolean`},preserveCase:{type:`boolean`},findInSelection:{type:`boolean`}}}}]},By=class extends N{constructor(){super({id:Q.StartFindWithArgs,label:S(`startFindWithArgsAction`,`Find With Arguments`),alias:`Find With Arguments`,precondition:void 0,kbOpts:{kbExpr:null,primary:0,weight:100},metadata:zy})}async run(e,t,n){let r=Ly.get(t);if(r){let e=n?{searchString:n.searchString,replaceString:n.replaceString,isReplaceRevealed:n.replaceString!==void 0,isRegex:n.isRegex,wholeWord:n.matchWholeWord,matchCase:n.isCaseSensitive,preserveCase:n.preserveCase}:{};await r.start({forceRevealReplace:!1,seedSearchStringFromSelection:r.getState().searchString.length===0&&t.getOption(41).seedSearchStringFromSelection!==`never`?`single`:`none`,seedSearchStringFromNonEmptySelection:t.getOption(41).seedSearchStringFromSelection===`selection`,seedSearchStringFromGlobalClipboard:!0,shouldFocus:1,shouldAnimate:!0,updateSearchScope:n?.findInSelection||!1,loop:t.getOption(41).loop},e),r.setGlobalBufferTerm(r.getState().searchString)}}},Vy=class extends N{constructor(){super({id:Q.StartFindWithSelection,label:S(`startFindWithSelectionAction`,`Find With Selection`),alias:`Find With Selection`,precondition:void 0,kbOpts:{kbExpr:null,primary:0,mac:{primary:2083},weight:100}})}async run(e,t){let n=Ly.get(t);n&&(await n.start({forceRevealReplace:!1,seedSearchStringFromSelection:`multiple`,seedSearchStringFromNonEmptySelection:!1,seedSearchStringFromGlobalClipboard:!1,shouldFocus:0,shouldAnimate:!0,updateSearchScope:!1,loop:t.getOption(41).loop}),n.setGlobalBufferTerm(n.getState().searchString))}},Hy=class extends N{async run(e,t){let n=Ly.get(t);n&&!this._run(n)&&(await n.start({forceRevealReplace:!1,seedSearchStringFromSelection:n.getState().searchString.length===0&&t.getOption(41).seedSearchStringFromSelection!==`never`?`single`:`none`,seedSearchStringFromNonEmptySelection:t.getOption(41).seedSearchStringFromSelection===`selection`,seedSearchStringFromGlobalClipboard:!0,shouldFocus:0,shouldAnimate:!0,updateSearchScope:!1,loop:t.getOption(41).loop}),this._run(n))}},Uy=class extends Hy{constructor(){super({id:Q.NextMatchFindAction,label:S(`findNextMatchAction`,`Find Next`),alias:`Find Next`,precondition:void 0,kbOpts:[{kbExpr:q.focus,primary:61,mac:{primary:2085,secondary:[61]},weight:100},{kbExpr:z.and(q.focus,wv),primary:3,weight:100}]})}_run(e){return e.moveToNextMatch()?(e.editor.pushUndoStop(),!0):!1}},Wy=class extends Hy{constructor(){super({id:Q.PreviousMatchFindAction,label:S(`findPreviousMatchAction`,`Find Previous`),alias:`Find Previous`,precondition:void 0,kbOpts:[{kbExpr:q.focus,primary:1085,mac:{primary:3109,secondary:[1085]},weight:100},{kbExpr:z.and(q.focus,wv),primary:1027,weight:100}]})}_run(e){return e.moveToPrevMatch()}},Gy=class extends N{constructor(){super({id:Q.GoToMatchFindAction,label:S(`findMatchAction.goToMatch`,`Go to Match...`),alias:`Go to Match...`,precondition:Cv}),this._highlightDecorations=[]}run(e,t,r){let i=Ly.get(t);if(!i)return;let a=i.getState().matchesCount;if(a<1){e.get(Ro).notify({severity:za.Warning,message:S(`findMatchAction.noResults`,`No matches. Try searching for something else.`)});return}let o=e.get(xc),s=new n,c=s.add(o.createInputBox());c.placeholder=S(`findMatchAction.inputPlaceHolder`,`Type a number to go to a specific match (between 1 and {0})`,a);let l=e=>{let t=parseInt(e);if(isNaN(t))return;let n=i.getState().matchesCount;if(t>0&&t<=n)return t-1;if(t<0&&t>=-n)return n+t},u=e=>{let n=l(e);if(typeof n==`number`){c.validationMessage=void 0,i.goToMatch(n);let e=i.getState().currentMatch;e&&this.addDecorations(t,e)}else c.validationMessage=S(`findMatchAction.inputValidationMessage`,`Please type a number between 1 and {0}`,i.getState().matchesCount),this.clearDecorations(t)};s.add(c.onDidChangeValue(e=>{u(e)})),s.add(c.onDidAccept(()=>{let e=l(c.value);typeof e==`number`?(i.goToMatch(e),c.hide()):c.validationMessage=S(`findMatchAction.inputValidationMessage`,`Please type a number between 1 and {0}`,i.getState().matchesCount)})),s.add(c.onDidHide(()=>{this.clearDecorations(t),s.dispose()})),c.show()}clearDecorations(e){e.changeDecorations(e=>{this._highlightDecorations=e.deltaDecorations(this._highlightDecorations,[])})}addDecorations(e,t){e.changeDecorations(e=>{this._highlightDecorations=e.deltaDecorations(this._highlightDecorations,[{range:t,options:{description:`find-match-quick-access-range-highlight`,className:`rangeHighlight`,isWholeLine:!0}},{range:t,options:{description:`find-match-quick-access-range-highlight-overview`,overviewRuler:{color:Bc(Ol),position:sl.Full}}}])})}},Ky=class extends N{async run(e,t){let n=Ly.get(t);if(!n)return;let r=Iy(t,`single`,!1);r&&n.setSearchString(r),this._run(n)||(await n.start({forceRevealReplace:!1,seedSearchStringFromSelection:`none`,seedSearchStringFromNonEmptySelection:!1,seedSearchStringFromGlobalClipboard:!1,shouldFocus:0,shouldAnimate:!0,updateSearchScope:!1,loop:t.getOption(41).loop}),this._run(n))}},qy=class extends Ky{constructor(){super({id:Q.NextSelectionMatchFindAction,label:S(`nextSelectionMatchFindAction`,`Find Next Selection`),alias:`Find Next Selection`,precondition:void 0,kbOpts:{kbExpr:q.focus,primary:2109,weight:100}})}_run(e){return e.moveToNextMatch()}},Jy=class extends Ky{constructor(){super({id:Q.PreviousSelectionMatchFindAction,label:S(`previousSelectionMatchFindAction`,`Find Previous Selection`),alias:`Find Previous Selection`,precondition:void 0,kbOpts:{kbExpr:q.focus,primary:3133,weight:100}})}_run(e){return e.moveToPrevMatch()}};ra(new ai({id:Q.StartFindReplaceAction,label:S(`startReplace`,`Replace`),alias:`Replace`,precondition:z.or(q.focus,z.has(`editorIsOpen`)),kbOpts:{kbExpr:null,primary:2086,mac:{primary:2596},weight:100},menuOpts:{menuId:R.MenubarEditMenu,group:`3_find`,title:S({key:`miReplace`,comment:[`&& denotes a mnemonic`]},`&&Replace`),order:2}})).addImplementation(0,(e,t,n)=>{if(!t.hasModel()||t.getOption(92))return!1;let r=Ly.get(t);if(!r)return!1;let i=t.getSelection(),a=r.isFindInputFocused(),o=!i.isEmpty()&&i.startLineNumber===i.endLineNumber&&t.getOption(41).seedSearchStringFromSelection!==`never`&&!a,s=a||o?2:1;return r.start({forceRevealReplace:!0,seedSearchStringFromSelection:o?`single`:`none`,seedSearchStringFromNonEmptySelection:t.getOption(41).seedSearchStringFromSelection===`selection`,seedSearchStringFromGlobalClipboard:t.getOption(41).seedSearchStringFromSelection!==`never`,shouldFocus:s,shouldAnimate:!0,updateSearchScope:!1,loop:t.getOption(41).loop})}),I(Ly.ID,Ry,0),L(By),L(Vy),L(Uy),L(Wy),L(Gy),L(qy),L(Jy);var Yy=la.bindToContribution(Ly.get);P(new Yy({id:Q.CloseFindWidgetCommand,precondition:Cv,handler:e=>e.closeFindWidget(),kbOpts:{weight:105,kbExpr:z.and(q.focus,z.not(`isComposing`)),primary:9,secondary:[1033]}})),P(new Yy({id:Q.ToggleCaseSensitiveCommand,precondition:void 0,handler:e=>e.toggleCaseSensitive(),kbOpts:{weight:105,kbExpr:q.focus,primary:Ev.primary,mac:Ev.mac,win:Ev.win,linux:Ev.linux}})),P(new Yy({id:Q.ToggleWholeWordCommand,precondition:void 0,handler:e=>e.toggleWholeWords(),kbOpts:{weight:105,kbExpr:q.focus,primary:Dv.primary,mac:Dv.mac,win:Dv.win,linux:Dv.linux}})),P(new Yy({id:Q.ToggleRegexCommand,precondition:void 0,handler:e=>e.toggleRegex(),kbOpts:{weight:105,kbExpr:q.focus,primary:Ov.primary,mac:Ov.mac,win:Ov.win,linux:Ov.linux}})),P(new Yy({id:Q.ToggleSearchScopeCommand,precondition:void 0,handler:e=>e.toggleSearchScope(),kbOpts:{weight:105,kbExpr:q.focus,primary:kv.primary,mac:kv.mac,win:kv.win,linux:kv.linux}})),P(new Yy({id:Q.TogglePreserveCaseCommand,precondition:void 0,handler:e=>e.togglePreserveCase(),kbOpts:{weight:105,kbExpr:q.focus,primary:Av.primary,mac:Av.mac,win:Av.win,linux:Av.linux}})),P(new Yy({id:Q.ReplaceOneAction,precondition:Cv,handler:e=>e.replace(),kbOpts:{weight:105,kbExpr:q.focus,primary:3094}})),P(new Yy({id:Q.ReplaceOneAction,precondition:Cv,handler:e=>e.replace(),kbOpts:{weight:105,kbExpr:z.and(q.focus,Tv),primary:3}})),P(new Yy({id:Q.ReplaceAllAction,precondition:Cv,handler:e=>e.replaceAll(),kbOpts:{weight:105,kbExpr:q.focus,primary:2563}})),P(new Yy({id:Q.ReplaceAllAction,precondition:Cv,handler:e=>e.replaceAll(),kbOpts:{weight:105,kbExpr:z.and(q.focus,Tv),primary:void 0,mac:{primary:2051}}})),P(new Yy({id:Q.SelectAllMatchesAction,precondition:Cv,handler:e=>e.selectAllMatches(),kbOpts:{weight:105,kbExpr:q.focus,primary:515}}));const Xy={0:` `,1:`u`,2:`r`},Zy=16777215;var Qy=4278190080,$y=class{constructor(e){let t=Math.ceil(e/32);this._states=new Uint32Array(t)}get(e){let t=e/32|0,n=e%32;return(this._states[t]&1<<n)!=0}set(e,t){let n=e/32|0,r=e%32,i=this._states[n];t?this._states[n]=i|1<<r:this._states[n]=i&~(1<<r)}},eb=class e{constructor(e,t,n){if(e.length!==t.length||e.length>65535)throw Error(`invalid startIndexes or endIndexes size`);this._startIndexes=e,this._endIndexes=t,this._collapseStates=new $y(e.length),this._userDefinedStates=new $y(e.length),this._recoveredStates=new $y(e.length),this._types=n,this._parentsComputed=!1}ensureParentIndices(){if(!this._parentsComputed){this._parentsComputed=!0;let e=[],t=(t,n)=>{let r=e[e.length-1];return this.getStartLineNumber(r)<=t&&this.getEndLineNumber(r)>=n};for(let n=0,r=this._startIndexes.length;n<r;n++){let r=this._startIndexes[n],i=this._endIndexes[n];if(r>16777215||i>16777215)throw Error(`startLineNumber or endLineNumber must not exceed `+Zy);for(;e.length>0&&!t(r,i);)e.pop();let a=e.length>0?e[e.length-1]:-1;e.push(n),this._startIndexes[n]=r+((a&255)<<24),this._endIndexes[n]=i+((a&65280)<<16)}}}get length(){return this._startIndexes.length}getStartLineNumber(e){return this._startIndexes[e]&Zy}getEndLineNumber(e){return this._endIndexes[e]&Zy}getType(e){return this._types?this._types[e]:void 0}hasTypes(){return!!this._types}isCollapsed(e){return this._collapseStates.get(e)}setCollapsed(e,t){this._collapseStates.set(e,t)}isUserDefined(e){return this._userDefinedStates.get(e)}setUserDefined(e,t){return this._userDefinedStates.set(e,t)}isRecovered(e){return this._recoveredStates.get(e)}setRecovered(e,t){return this._recoveredStates.set(e,t)}getSource(e){return this.isUserDefined(e)?1:this.isRecovered(e)?2:0}setSource(e,t){t===1?(this.setUserDefined(e,!0),this.setRecovered(e,!1)):t===2?(this.setUserDefined(e,!1),this.setRecovered(e,!0)):(this.setUserDefined(e,!1),this.setRecovered(e,!1))}setCollapsedAllOfType(e,t){let n=!1;if(this._types)for(let r=0;r<this._types.length;r++)this._types[r]===e&&(this.setCollapsed(r,t),n=!0);return n}toRegion(e){return new tb(this,e)}getParentIndex(e){this.ensureParentIndices();let t=((this._startIndexes[e]&Qy)>>>24)+((this._endIndexes[e]&Qy)>>>16);return t===65535?-1:t}contains(e,t){return this.getStartLineNumber(e)<=t&&this.getEndLineNumber(e)>=t}findIndex(e){let t=0,n=this._startIndexes.length;if(n===0)return-1;for(;t<n;){let r=Math.floor((t+n)/2);e<this.getStartLineNumber(r)?n=r:t=r+1}return t-1}findRange(e){let t=this.findIndex(e);if(t>=0){if(this.getEndLineNumber(t)>=e)return t;for(t=this.getParentIndex(t);t!==-1;){if(this.contains(t,e))return t;t=this.getParentIndex(t)}}return-1}toString(){let e=[];for(let t=0;t<this.length;t++)e[t]=`[${Xy[this.getSource(t)]}${this.isCollapsed(t)?`+`:`-`}] ${this.getStartLineNumber(t)}/${this.getEndLineNumber(t)}`;return e.join(`, `)}toFoldRange(e){return{startLineNumber:this._startIndexes[e]&Zy,endLineNumber:this._endIndexes[e]&Zy,type:this._types?this._types[e]:void 0,isCollapsed:this.isCollapsed(e),source:this.getSource(e)}}static fromFoldRanges(t){let n=t.length,r=new Uint32Array(n),i=new Uint32Array(n),a=[],o=!1;for(let e=0;e<n;e++){let n=t[e];r[e]=n.startLineNumber,i[e]=n.endLineNumber,a.push(n.type),n.type&&(o=!0)}o||(a=void 0);let s=new e(r,i,a);for(let e=0;e<n;e++)t[e].isCollapsed&&s.setCollapsed(e,!0),s.setSource(e,t[e].source);return s}static sanitizeAndMerge(e,t,n,r){n??=Number.MAX_VALUE;let i=(e,t)=>Array.isArray(e)?(n=>n<t?e[n]:void 0):(n=>n<t?e.toFoldRange(n):void 0),a=i(e,e.length),o=i(t,t.length),s=0,c=0,l=a(0),u=o(0),d=[],f,p=0,m=[];for(;l||u;){let e;if(u&&(!l||l.startLineNumber>=u.startLineNumber))l&&l.startLineNumber===u.startLineNumber?(u.source===1?e=u:(e=l,e.isCollapsed=u.isCollapsed&&(l.endLineNumber===u.endLineNumber||!r?.startsInside(l.startLineNumber+1,l.endLineNumber+1)),e.source=0),l=a(++s)):(e=u,u.isCollapsed&&u.source===0&&(e.source=2)),u=o(++c);else{let t=c,n=u;for(;;){if(!n||n.startLineNumber>l.endLineNumber){e=l;break}if(n.source===1&&n.endLineNumber>l.endLineNumber)break;n=o(++t)}l=a(++s)}if(e){for(;f&&f.endLineNumber<e.startLineNumber;)f=d.pop();e.endLineNumber>e.startLineNumber&&e.startLineNumber>p&&e.endLineNumber<=n&&(!f||f.endLineNumber>=e.endLineNumber)&&(m.push(e),p=e.startLineNumber,f&&d.push(f),f=e)}}return m}},tb=class{constructor(e,t){this.ranges=e,this.index=t}get startLineNumber(){return this.ranges.getStartLineNumber(this.index)}get endLineNumber(){return this.ranges.getEndLineNumber(this.index)}get regionIndex(){return this.index}get parentIndex(){return this.ranges.getParentIndex(this.index)}get isCollapsed(){return this.ranges.isCollapsed(this.index)}containedBy(e){return e.startLineNumber<=this.startLineNumber&&e.endLineNumber>=this.endLineNumber}containsLine(e){return this.startLineNumber<=e&&e<=this.endLineNumber}},nb=class{get regions(){return this._regions}get textModel(){return this._textModel}constructor(e,t){this._updateEventEmitter=new g,this.onDidChange=this._updateEventEmitter.event,this._textModel=e,this._decorationProvider=t,this._regions=new eb(new Uint32Array,new Uint32Array),this._editorDecorationIds=[]}toggleCollapseState(e){if(!e.length)return;e=e.sort((e,t)=>e.regionIndex-t.regionIndex);let t={};this._decorationProvider.changeDecorations(n=>{let r=0,i=-1,a=-1,o=e=>{for(;r<e;){let e=this._regions.getEndLineNumber(r),t=this._regions.isCollapsed(r);if(e<=i){let i=this.regions.getSource(r)!==0;n.changeDecorationOptions(this._editorDecorationIds[r],this._decorationProvider.getDecorationOption(t,e<=a,i))}t&&e>a&&(a=e),r++}};for(let n of e){let e=n.regionIndex,r=this._editorDecorationIds[e];if(r&&!t[r]){t[r]=!0,o(e);let n=!this._regions.isCollapsed(e);this._regions.setCollapsed(e,n),i=Math.max(i,this._regions.getEndLineNumber(e))}}o(this._regions.length)}),this._updateEventEmitter.fire({model:this,collapseStateChanged:e})}removeManualRanges(e){let t=[],n=t=>{for(let n of e)if(!(n.startLineNumber>t.endLineNumber||t.startLineNumber>n.endLineNumber))return!0;return!1};for(let e=0;e<this._regions.length;e++){let r=this._regions.toFoldRange(e);(r.source===0||!n(r))&&t.push(r)}this.updatePost(eb.fromFoldRanges(t))}update(e,t){let n=this._currentFoldedOrManualRanges(t),r=eb.sanitizeAndMerge(e,n,this._textModel.getLineCount(),t);this.updatePost(eb.fromFoldRanges(r))}updatePost(e){let t=[],n=-1;for(let r=0,i=e.length;r<i;r++){let i=e.getStartLineNumber(r),a=e.getEndLineNumber(r),o=e.isCollapsed(r),s=e.getSource(r)!==0,c={startLineNumber:i,startColumn:this._textModel.getLineMaxColumn(i),endLineNumber:a,endColumn:this._textModel.getLineMaxColumn(a)+1};t.push({range:c,options:this._decorationProvider.getDecorationOption(o,a<=n,s)}),o&&a>n&&(n=a)}this._decorationProvider.changeDecorations(e=>this._editorDecorationIds=e.deltaDecorations(this._editorDecorationIds,t)),this._regions=e,this._updateEventEmitter.fire({model:this})}_currentFoldedOrManualRanges(e){let t=[];for(let n=0,r=this._regions.length;n<r;n++){let r=this.regions.isCollapsed(n),i=this.regions.getSource(n);if(r||i!==0){let a=this._regions.toFoldRange(n),o=this._textModel.getDecorationRange(this._editorDecorationIds[n]);o&&(r&&e?.startsInside(o.startLineNumber+1,o.endLineNumber)&&(r=!1),t.push({startLineNumber:o.startLineNumber,endLineNumber:o.endLineNumber,type:a.type,isCollapsed:r,source:i}))}}return t}getMemento(){let e=this._currentFoldedOrManualRanges(),t=[],n=this._textModel.getLineCount();for(let r=0,i=e.length;r<i;r++){let i=e[r];if(i.startLineNumber>=i.endLineNumber||i.startLineNumber<1||i.endLineNumber>n)continue;let a=this._getLinesChecksum(i.startLineNumber+1,i.endLineNumber);t.push({startLineNumber:i.startLineNumber,endLineNumber:i.endLineNumber,isCollapsed:i.isCollapsed,source:i.source,checksum:a})}return t.length>0?t:void 0}applyMemento(e){if(!Array.isArray(e))return;let t=[],n=this._textModel.getLineCount();for(let r of e){if(r.startLineNumber>=r.endLineNumber||r.startLineNumber<1||r.endLineNumber>n)continue;let e=this._getLinesChecksum(r.startLineNumber+1,r.endLineNumber);(!r.checksum||e===r.checksum)&&t.push({startLineNumber:r.startLineNumber,endLineNumber:r.endLineNumber,type:void 0,isCollapsed:r.isCollapsed??!0,source:r.source??0})}let r=eb.sanitizeAndMerge(this._regions,t,n);this.updatePost(eb.fromFoldRanges(r))}_getLinesChecksum(e,t){return Ir(this._textModel.getLineContent(e)+this._textModel.getLineContent(t))%1e6}dispose(){this._decorationProvider.removeDecorations(this._editorDecorationIds)}getAllRegionsAtLine(e,t){let n=[];if(this._regions){let r=this._regions.findRange(e),i=1;for(;r>=0;){let e=this._regions.toRegion(r);(!t||t(e,i))&&n.push(e),i++,r=e.parentIndex}}return n}getRegionAtLine(e){if(this._regions){let t=this._regions.findRange(e);if(t>=0)return this._regions.toRegion(t)}return null}getRegionsInside(e,t){let n=[],r=e?e.regionIndex+1:0,i=e?e.endLineNumber:Number.MAX_VALUE;if(t&&t.length===2){let e=[];for(let a=r,o=this._regions.length;a<o;a++){let r=this._regions.toRegion(a);if(this._regions.getStartLineNumber(a)<i){for(;e.length>0&&!r.containedBy(e[e.length-1]);)e.pop();e.push(r),t(r,e.length)&&n.push(r)}else break}}else for(let e=r,a=this._regions.length;e<a;e++){let r=this._regions.toRegion(e);if(this._regions.getStartLineNumber(e)<i)(!t||t(r))&&n.push(r);else break}return n}};function rb(e,t,n){let r=[];for(let i of n){let n=e.getRegionAtLine(i);if(n){let i=!n.isCollapsed;if(r.push(n),t>1){let a=e.getRegionsInside(n,(e,n)=>e.isCollapsed!==i&&n<t);r.push(...a)}}}e.toggleCollapseState(r)}function ib(e,t,n=Number.MAX_VALUE,r){let i=[];if(r&&r.length>0)for(let a of r){let r=e.getRegionAtLine(a);if(r&&(r.isCollapsed!==t&&i.push(r),n>1)){let a=e.getRegionsInside(r,(e,r)=>e.isCollapsed!==t&&r<n);i.push(...a)}}else{let r=e.getRegionsInside(null,(e,r)=>e.isCollapsed!==t&&r<n);i.push(...r)}e.toggleCollapseState(i)}function ab(e,t,n,r){let i=[];for(let a of r){let r=e.getAllRegionsAtLine(a,(e,r)=>e.isCollapsed!==t&&r<=n);i.push(...r)}e.toggleCollapseState(i)}function ob(e,t,n){let r=[];for(let i of n){let n=e.getAllRegionsAtLine(i,e=>e.isCollapsed!==t);n.length>0&&r.push(n[0])}e.toggleCollapseState(r)}function sb(e,t,n,r){let i=e.getRegionsInside(null,(e,i)=>i===t&&e.isCollapsed!==n&&!r.some(t=>e.containsLine(t)));e.toggleCollapseState(i)}function cb(e,t,n){let r=[];for(let t of n){let n=e.getAllRegionsAtLine(t,void 0);n.length>0&&r.push(n[0])}let i=e.getRegionsInside(null,e=>r.every(t=>!t.containedBy(e)&&!e.containedBy(t))&&e.isCollapsed!==t);e.toggleCollapseState(i)}function lb(e,t,n){let r=e.textModel,i=e.regions,a=[];for(let e=i.length-1;e>=0;e--)if(n!==i.isCollapsed(e)){let n=i.getStartLineNumber(e);t.test(r.getLineContent(n))&&a.push(i.toRegion(e))}e.toggleCollapseState(a)}function ub(e,t,n){let r=e.regions,i=[];for(let e=r.length-1;e>=0;e--)n!==r.isCollapsed(e)&&t===r.getType(e)&&i.push(r.toRegion(e));e.toggleCollapseState(i)}function db(e,t){let n=null,r=t.getRegionAtLine(e);if(r!==null&&(n=r.startLineNumber,e===n)){let e=r.parentIndex;n=e===-1?null:t.regions.getStartLineNumber(e)}return n}function fb(e,t){let n=t.getRegionAtLine(e);if(n!==null&&n.startLineNumber===e){if(e!==n.startLineNumber)return n.startLineNumber;{let e=n.parentIndex,r=0;for(e!==-1&&(r=t.regions.getStartLineNumber(n.parentIndex));n!==null;)if(n.regionIndex>0){if(n=t.regions.toRegion(n.regionIndex-1),n.startLineNumber<=r)return null;if(n.parentIndex===e)return n.startLineNumber}else return null}}else if(t.regions.length>0)for(n=t.regions.toRegion(t.regions.length-1);n!==null;){if(n.startLineNumber<e)return n.startLineNumber;n=n.regionIndex>0?t.regions.toRegion(n.regionIndex-1):null}return null}function pb(e,t){let n=t.getRegionAtLine(e);if(n!==null&&n.startLineNumber===e){let e=n.parentIndex,r=0;if(e!==-1)r=t.regions.getEndLineNumber(n.parentIndex);else if(t.regions.length===0)return null;else r=t.regions.getEndLineNumber(t.regions.length-1);for(;n!==null;)if(n.regionIndex<t.regions.length){if(n=t.regions.toRegion(n.regionIndex+1),n.startLineNumber>=r)return null;if(n.parentIndex===e)return n.startLineNumber}else return null}else if(t.regions.length>0)for(n=t.regions.toRegion(0);n!==null;){if(n.startLineNumber>e)return n.startLineNumber;n=n.regionIndex<t.regions.length?t.regions.toRegion(n.regionIndex+1):null}return null}var mb=class{get onDidChange(){return this._updateEventEmitter.event}get hiddenRanges(){return this._hiddenRanges}constructor(e){this._updateEventEmitter=new g,this._hasLineChanges=!1,this._foldingModel=e,this._foldingModelListener=e.onDidChange(e=>this.updateHiddenRanges()),this._hiddenRanges=[],e.regions.length&&this.updateHiddenRanges()}notifyChangeModelContent(e){this._hiddenRanges.length&&!this._hasLineChanges&&(this._hasLineChanges=e.changes.some(e=>e.range.endLineNumber!==e.range.startLineNumber||ia(e.text)[0]!==0))}updateHiddenRanges(){let e=!1,t=[],n=0,r=0,i=Number.MAX_VALUE,a=-1,o=this._foldingModel.regions;for(;n<o.length;n++){if(!o.isCollapsed(n))continue;let s=o.getStartLineNumber(n)+1,c=o.getEndLineNumber(n);i<=s&&c<=a||(!e&&r<this._hiddenRanges.length&&this._hiddenRanges[r].startLineNumber===s&&this._hiddenRanges[r].endLineNumber===c?(t.push(this._hiddenRanges[r]),r++):(e=!0,t.push(new T(s,1,c,1))),i=s,a=c)}(this._hasLineChanges||e||r<this._hiddenRanges.length)&&this.applyHiddenRanges(t)}applyHiddenRanges(e){this._hiddenRanges=e,this._hasLineChanges=!1,this._updateEventEmitter.fire(e)}hasRanges(){return this._hiddenRanges.length>0}isHidden(e){return gb(this._hiddenRanges,e)!==null}adjustSelections(e){let t=!1,n=this._foldingModel.textModel,r=null,i=e=>((!r||!hb(e,r))&&(r=gb(this._hiddenRanges,e)),r?r.startLineNumber-1:null);for(let r=0,a=e.length;r<a;r++){let a=e[r],o=i(a.startLineNumber);o&&(a=a.setStartPosition(o,n.getLineMaxColumn(o)),t=!0);let s=i(a.endLineNumber);s&&(a=a.setEndPosition(s,n.getLineMaxColumn(s)),t=!0),e[r]=a}return t}dispose(){this.hiddenRanges.length>0&&(this._hiddenRanges=[],this._updateEventEmitter.fire(this._hiddenRanges)),this._foldingModelListener&&=(this._foldingModelListener.dispose(),null)}};function hb(e,t){return e>=t.startLineNumber&&e<=t.endLineNumber}function gb(e,t){let n=tl(e,e=>t<e.startLineNumber)-1;return n>=0&&e[n].endLineNumber>=t?e[n]:null}var _b=5e3,vb=`indent`,yb=class{constructor(e,t,n){this.editorModel=e,this.languageConfigurationService=t,this.foldingRangesLimit=n,this.id=vb}dispose(){}compute(e){let t=this.languageConfigurationService.getLanguageConfiguration(this.editorModel.getLanguageId()).foldingRules,n=t&&!!t.offSide,r=t&&t.markers;return Promise.resolve(Sb(this.editorModel,n,r,this.foldingRangesLimit))}},bb=class{constructor(e){this._startIndexes=[],this._endIndexes=[],this._indentOccurrences=[],this._length=0,this._foldingRangesLimit=e}insertFirst(e,t,n){if(e>16777215||t>16777215)return;let r=this._length;this._startIndexes[r]=e,this._endIndexes[r]=t,this._length++,n<1e3&&(this._indentOccurrences[n]=(this._indentOccurrences[n]||0)+1)}toIndentRanges(e){let t=this._foldingRangesLimit.limit;if(this._length<=t){this._foldingRangesLimit.update(this._length,!1);let e=new Uint32Array(this._length),t=new Uint32Array(this._length);for(let n=this._length-1,r=0;n>=0;n--,r++)e[r]=this._startIndexes[n],t[r]=this._endIndexes[n];return new eb(e,t)}else{this._foldingRangesLimit.update(this._length,t);let n=0,r=this._indentOccurrences.length;for(let e=0;e<this._indentOccurrences.length;e++){let i=this._indentOccurrences[e];if(i){if(i+n>t){r=e;break}n+=i}}let i=e.getOptions().tabSize,a=new Uint32Array(t),o=new Uint32Array(t);for(let s=this._length-1,c=0;s>=0;s--){let l=this._startIndexes[s],u=ls(e.getLineContent(l),i);(u<r||u===r&&n++<t)&&(a[c]=l,o[c]=this._endIndexes[s],c++)}return new eb(a,o)}}},xb={limit:_b,update:()=>{}};function Sb(e,t,n,r=xb){let i=e.getOptions().tabSize,a=new bb(r),o;n&&(o=RegExp(`(${n.start.source})|(?:${n.end.source})`));let s=[],c=e.getLineCount()+1;s.push({indent:-1,endAbove:c,line:c});for(let n=e.getLineCount();n>0;n--){let r=e.getLineContent(n),c=ls(r,i),l=s[s.length-1];if(c===-1){t&&(l.endAbove=n);continue}let u;if(o&&(u=r.match(o)))if(u[1]){let e=s.length-1;for(;e>0&&s[e].indent!==-2;)e--;if(e>0){s.length=e+1,l=s[e],a.insertFirst(n,l.line,c),l.line=n,l.indent=c,l.endAbove=n;continue}}else{s.push({indent:-2,endAbove:n,line:n});continue}if(l.indent>c){do s.pop(),l=s[s.length-1];while(l.indent>c);let e=l.endAbove-1;e-n>=1&&a.insertFirst(n,e,c)}l.indent===c?l.endAbove=n:s.push({indent:c,endAbove:n,line:n})}return a.toIndentRanges(e)}var Cb=k(`editor.foldBackground`,{light:xt(gr,.3),dark:xt(gr,.3),hcDark:null,hcLight:null},S(`foldBackgroundBackground`,`Background color behind folded ranges. The color must not be opaque so as not to hide underlying decorations.`),!0);k(`editor.foldPlaceholderForeground`,{light:`#808080`,dark:`#808080`,hcDark:null,hcLight:null},S(`collapsedTextColor`,`Color of the collapsed text after the first line of a folded range.`)),k(`editorGutter.foldingControlForeground`,$e,S(`editorGutter.foldingControlForeground`,`Color of the folding control in the editor gutter.`));const wb=ri(`folding-expanded`,i.chevronDown,S(`foldingExpandedIcon`,`Icon for expanded ranges in the editor glyph margin.`)),Tb=ri(`folding-collapsed`,i.chevronRight,S(`foldingCollapsedIcon`,`Icon for collapsed ranges in the editor glyph margin.`)),Eb=ri(`folding-manual-collapsed`,Tb,S(`foldingManualCollapedIcon`,`Icon for manually collapsed ranges in the editor glyph margin.`)),Db=ri(`folding-manual-expanded`,wb,S(`foldingManualExpandedIcon`,`Icon for manually expanded ranges in the editor glyph margin.`));var Ob={color:Bc(Cb),position:1},kb=S(`linesCollapsed`,`Click to expand the range.`),Ab=S(`linesExpanded`,`Click to collapse the range.`),jb=class e{static#e=this.COLLAPSED_VISUAL_DECORATION=U.register({description:`folding-collapsed-visual-decoration`,stickiness:0,afterContentClassName:`inline-folded`,isWholeLine:!0,linesDecorationsTooltip:kb,firstLineDecorationClassName:J.asClassName(Tb)});static#t=this.COLLAPSED_HIGHLIGHTED_VISUAL_DECORATION=U.register({description:`folding-collapsed-highlighted-visual-decoration`,stickiness:0,afterContentClassName:`inline-folded`,className:`folded-background`,minimap:Ob,isWholeLine:!0,linesDecorationsTooltip:kb,firstLineDecorationClassName:J.asClassName(Tb)});static#n=this.MANUALLY_COLLAPSED_VISUAL_DECORATION=U.register({description:`folding-manually-collapsed-visual-decoration`,stickiness:0,afterContentClassName:`inline-folded`,isWholeLine:!0,linesDecorationsTooltip:kb,firstLineDecorationClassName:J.asClassName(Eb)});static#r=this.MANUALLY_COLLAPSED_HIGHLIGHTED_VISUAL_DECORATION=U.register({description:`folding-manually-collapsed-highlighted-visual-decoration`,stickiness:0,afterContentClassName:`inline-folded`,className:`folded-background`,minimap:Ob,isWholeLine:!0,linesDecorationsTooltip:kb,firstLineDecorationClassName:J.asClassName(Eb)});static#i=this.NO_CONTROLS_COLLAPSED_RANGE_DECORATION=U.register({description:`folding-no-controls-range-decoration`,stickiness:0,afterContentClassName:`inline-folded`,isWholeLine:!0,linesDecorationsTooltip:kb});static#a=this.NO_CONTROLS_COLLAPSED_HIGHLIGHTED_RANGE_DECORATION=U.register({description:`folding-no-controls-range-decoration`,stickiness:0,afterContentClassName:`inline-folded`,className:`folded-background`,minimap:Ob,isWholeLine:!0,linesDecorationsTooltip:kb});static#o=this.EXPANDED_VISUAL_DECORATION=U.register({description:`folding-expanded-visual-decoration`,stickiness:1,isWholeLine:!0,firstLineDecorationClassName:`alwaysShowFoldIcons `+J.asClassName(wb),linesDecorationsTooltip:Ab});static#s=this.EXPANDED_AUTO_HIDE_VISUAL_DECORATION=U.register({description:`folding-expanded-auto-hide-visual-decoration`,stickiness:1,isWholeLine:!0,firstLineDecorationClassName:J.asClassName(wb),linesDecorationsTooltip:Ab});static#c=this.MANUALLY_EXPANDED_VISUAL_DECORATION=U.register({description:`folding-manually-expanded-visual-decoration`,stickiness:0,isWholeLine:!0,firstLineDecorationClassName:`alwaysShowFoldIcons `+J.asClassName(Db),linesDecorationsTooltip:Ab});static#l=this.MANUALLY_EXPANDED_AUTO_HIDE_VISUAL_DECORATION=U.register({description:`folding-manually-expanded-auto-hide-visual-decoration`,stickiness:0,isWholeLine:!0,firstLineDecorationClassName:J.asClassName(Db),linesDecorationsTooltip:Ab});static#u=this.NO_CONTROLS_EXPANDED_RANGE_DECORATION=U.register({description:`folding-no-controls-range-decoration`,stickiness:0,isWholeLine:!0});static#d=this.HIDDEN_RANGE_DECORATION=U.register({description:`folding-hidden-range-decoration`,stickiness:1});constructor(e){this.editor=e,this.showFoldingControls=`mouseover`,this.showFoldingHighlights=!0}getDecorationOption(t,n,r){return n?e.HIDDEN_RANGE_DECORATION:this.showFoldingControls===`never`?t?this.showFoldingHighlights?e.NO_CONTROLS_COLLAPSED_HIGHLIGHTED_RANGE_DECORATION:e.NO_CONTROLS_COLLAPSED_RANGE_DECORATION:e.NO_CONTROLS_EXPANDED_RANGE_DECORATION:t?r?this.showFoldingHighlights?e.MANUALLY_COLLAPSED_HIGHLIGHTED_VISUAL_DECORATION:e.MANUALLY_COLLAPSED_VISUAL_DECORATION:this.showFoldingHighlights?e.COLLAPSED_HIGHLIGHTED_VISUAL_DECORATION:e.COLLAPSED_VISUAL_DECORATION:this.showFoldingControls===`mouseover`?r?e.MANUALLY_EXPANDED_AUTO_HIDE_VISUAL_DECORATION:e.EXPANDED_AUTO_HIDE_VISUAL_DECORATION:r?e.MANUALLY_EXPANDED_VISUAL_DECORATION:e.EXPANDED_VISUAL_DECORATION}changeDecorations(e){return this.editor.changeDecorations(e)}removeDecorations(e){this.editor.removeDecorations(e)}},Mb={},Nb=`syntax`,Pb=class{constructor(e,t,r,i,a){this.editorModel=e,this.providers=t,this.handleFoldingRangesChange=r,this.foldingRangesLimit=i,this.fallbackRangeProvider=a,this.id=Nb,this.disposables=new n,a&&this.disposables.add(a);for(let e of t)typeof e.onDidChange==`function`&&this.disposables.add(e.onDidChange(r))}compute(e){return Fb(this.providers,this.editorModel,e).then(t=>t?Lb(t,this.foldingRangesLimit):this.fallbackRangeProvider?.compute(e)??null)}dispose(){this.disposables.dispose()}};function Fb(e,t,n){let r=null,i=e.map((e,i)=>Promise.resolve(e.provideFoldingRanges(t,Mb,n)).then(e=>{if(!n.isCancellationRequested&&Array.isArray(e)){Array.isArray(r)||(r=[]);let n=t.getLineCount();for(let t of e)t.start>0&&t.end>t.start&&t.end<=n&&r.push({start:t.start,end:t.end,rank:i,kind:t.kind})}},Re));return Promise.all(i).then(e=>r)}var Ib=class{constructor(e){this._startIndexes=[],this._endIndexes=[],this._nestingLevels=[],this._nestingLevelCounts=[],this._types=[],this._length=0,this._foldingRangesLimit=e}add(e,t,n,r){if(e>16777215||t>16777215)return;let i=this._length;this._startIndexes[i]=e,this._endIndexes[i]=t,this._nestingLevels[i]=r,this._types[i]=n,this._length++,r<30&&(this._nestingLevelCounts[r]=(this._nestingLevelCounts[r]||0)+1)}toIndentRanges(){let e=this._foldingRangesLimit.limit;if(this._length<=e){this._foldingRangesLimit.update(this._length,!1);let e=new Uint32Array(this._length),t=new Uint32Array(this._length);for(let n=0;n<this._length;n++)e[n]=this._startIndexes[n],t[n]=this._endIndexes[n];return new eb(e,t,this._types)}else{this._foldingRangesLimit.update(this._length,e);let t=0,n=this._nestingLevelCounts.length;for(let r=0;r<this._nestingLevelCounts.length;r++){let i=this._nestingLevelCounts[r];if(i){if(i+t>e){n=r;break}t+=i}}let r=new Uint32Array(e),i=new Uint32Array(e),a=[];for(let o=0,s=0;o<this._length;o++){let c=this._nestingLevels[o];(c<n||c===n&&t++<e)&&(r[s]=this._startIndexes[o],i[s]=this._endIndexes[o],a[s]=this._types[o],s++)}return new eb(r,i,a)}}};function Lb(e,t){let n=e.sort((e,t)=>{let n=e.start-t.start;return n===0&&(n=e.rank-t.rank),n}),r=new Ib(t),i,a=[];for(let e of n)if(!i)i=e,r.add(e.start,e.end,e.kind&&e.kind.value,a.length);else if(e.start>i.start)if(e.end<=i.end)a.push(i),i=e,r.add(e.start,e.end,e.kind&&e.kind.value,a.length);else{if(e.start>i.end){do i=a.pop();while(i&&e.start>i.end);i&&a.push(i),i=e}r.add(e.start,e.end,e.kind&&e.kind.value,a.length)}return r.toIndentRanges()}var Rb=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},zb=function(e,t){return function(n,r){t(n,r,e)}},Bb,Vb=new G(`foldingEnabled`,!1),Hb=class extends _{static#e=Bb=this;static#t=this.ID=`editor.contrib.folding`;static get(e){return e.getContribution(Bb.ID)}static getFoldingRangeProviders(e,t){let n=e.foldingRangeProvider.ordered(t);return Bb._foldingRangeSelector?.(n,t)??n}constructor(e,t,r,i,a,o){super(),this.contextKeyService=t,this.languageConfigurationService=r,this.languageFeaturesService=o,this.localToDispose=this._register(new n),this.editor=e,this._foldingLimitReporter=new Ub(e);let s=this.editor.getOptions();this._isEnabled=s.get(43),this._useFoldingProviders=s.get(44)!==`indentation`,this._unfoldOnClickAfterEndOfLine=s.get(48),this._restoringViewState=!1,this._currentModelHasFoldedImports=!1,this._foldingImportsByDefault=s.get(46),this.updateDebounceInfo=a.for(o.foldingRangeProvider,`Folding`,{min:200}),this.foldingModel=null,this.hiddenRangeModel=null,this.rangeProvider=null,this.foldingRegionPromise=null,this.foldingModelPromise=null,this.updateScheduler=null,this.cursorChangedScheduler=null,this.mouseDownInfo=null,this.foldingDecorationProvider=new jb(e),this.foldingDecorationProvider.showFoldingControls=s.get(111),this.foldingDecorationProvider.showFoldingHighlights=s.get(45),this.foldingEnabled=Vb.bindTo(this.contextKeyService),this.foldingEnabled.set(this._isEnabled),this._register(this.editor.onDidChangeModel(()=>this.onModelChanged())),this._register(this.editor.onDidChangeConfiguration(e=>{if(e.hasChanged(43)&&(this._isEnabled=this.editor.getOptions().get(43),this.foldingEnabled.set(this._isEnabled),this.onModelChanged()),e.hasChanged(47)&&this.onModelChanged(),e.hasChanged(111)||e.hasChanged(45)){let e=this.editor.getOptions();this.foldingDecorationProvider.showFoldingControls=e.get(111),this.foldingDecorationProvider.showFoldingHighlights=e.get(45),this.triggerFoldingModelChanged()}e.hasChanged(44)&&(this._useFoldingProviders=this.editor.getOptions().get(44)!==`indentation`,this.onFoldingStrategyChanged()),e.hasChanged(48)&&(this._unfoldOnClickAfterEndOfLine=this.editor.getOptions().get(48)),e.hasChanged(46)&&(this._foldingImportsByDefault=this.editor.getOptions().get(46))})),this.onModelChanged()}saveViewState(){let e=this.editor.getModel();if(!e||!this._isEnabled||e.isTooLargeForTokenization())return{};if(this.foldingModel){let t=this.foldingModel.getMemento(),n=this.rangeProvider?this.rangeProvider.id:void 0;return{collapsedRegions:t,lineCount:e.getLineCount(),provider:n,foldedImports:this._currentModelHasFoldedImports}}}restoreViewState(e){let t=this.editor.getModel();if(!(!t||!this._isEnabled||t.isTooLargeForTokenization()||!this.hiddenRangeModel)&&e&&(this._currentModelHasFoldedImports=!!e.foldedImports,e.collapsedRegions&&e.collapsedRegions.length>0&&this.foldingModel)){this._restoringViewState=!0;try{this.foldingModel.applyMemento(e.collapsedRegions)}finally{this._restoringViewState=!1}}}onModelChanged(){this.localToDispose.clear();let e=this.editor.getModel();!this._isEnabled||!e||e.isTooLargeForTokenization()||(this._currentModelHasFoldedImports=!1,this.foldingModel=new nb(e,this.foldingDecorationProvider),this.localToDispose.add(this.foldingModel),this.hiddenRangeModel=new mb(this.foldingModel),this.localToDispose.add(this.hiddenRangeModel),this.localToDispose.add(this.hiddenRangeModel.onDidChange(e=>this.onHiddenRangesChanges(e))),this.updateScheduler=new Nt(this.updateDebounceInfo.get(e)),this.cursorChangedScheduler=new yt(()=>this.revealCursor(),200),this.localToDispose.add(this.cursorChangedScheduler),this.localToDispose.add(this.languageFeaturesService.foldingRangeProvider.onDidChange(()=>this.onFoldingStrategyChanged())),this.localToDispose.add(this.editor.onDidChangeModelLanguageConfiguration(()=>this.onFoldingStrategyChanged())),this.localToDispose.add(this.editor.onDidChangeModelContent(e=>this.onDidChangeModelContent(e))),this.localToDispose.add(this.editor.onDidChangeCursorPosition(()=>this.onCursorPositionChanged())),this.localToDispose.add(this.editor.onMouseDown(e=>this.onEditorMouseDown(e))),this.localToDispose.add(this.editor.onMouseUp(e=>this.onEditorMouseUp(e))),this.localToDispose.add({dispose:()=>{this.foldingRegionPromise&&=(this.foldingRegionPromise.cancel(),null),this.updateScheduler?.cancel(),this.updateScheduler=null,this.foldingModel=null,this.foldingModelPromise=null,this.hiddenRangeModel=null,this.cursorChangedScheduler=null,this.rangeProvider?.dispose(),this.rangeProvider=null}}),this.triggerFoldingModelChanged())}onFoldingStrategyChanged(){this.rangeProvider?.dispose(),this.rangeProvider=null,this.triggerFoldingModelChanged()}getRangeProvider(e){if(this.rangeProvider)return this.rangeProvider;let t=new yb(e,this.languageConfigurationService,this._foldingLimitReporter);if(this.rangeProvider=t,this._useFoldingProviders&&this.foldingModel){let n=Bb.getFoldingRangeProviders(this.languageFeaturesService,e);n.length>0&&(this.rangeProvider=new Pb(e,n,()=>this.triggerFoldingModelChanged(),this._foldingLimitReporter,t))}return this.rangeProvider}getFoldingModel(){return this.foldingModelPromise}onDidChangeModelContent(e){this.hiddenRangeModel?.notifyChangeModelContent(e),this.triggerFoldingModelChanged()}triggerFoldingModelChanged(){this.updateScheduler&&(this.foldingRegionPromise&&=(this.foldingRegionPromise.cancel(),null),this.foldingModelPromise=this.updateScheduler.trigger(()=>{let e=this.foldingModel;if(!e)return null;let t=new u,n=this.getRangeProvider(e.textModel),r=this.foldingRegionPromise=et(e=>n.compute(e));return r.then(n=>{if(n&&r===this.foldingRegionPromise){let r;if(this._foldingImportsByDefault&&!this._currentModelHasFoldedImports){let e=n.setCollapsedAllOfType(Me.Imports.value,!0);e&&(r=Xi.capture(this.editor),this._currentModelHasFoldedImports=e)}let i=this.editor.getSelections();e.update(n,Gb(i)),r?.restore(this.editor);let a=this.updateDebounceInfo.update(e.textModel,t.elapsed());this.updateScheduler&&(this.updateScheduler.defaultDelay=a)}return e})}).then(void 0,e=>(C(e),null)))}onHiddenRangesChanges(e){if(this.hiddenRangeModel&&e.length&&!this._restoringViewState){let e=this.editor.getSelections();e&&this.hiddenRangeModel.adjustSelections(e)&&this.editor.setSelections(e)}this.editor.setHiddenAreas(e,this)}onCursorPositionChanged(){this.hiddenRangeModel&&this.hiddenRangeModel.hasRanges()&&this.cursorChangedScheduler.schedule()}revealCursor(){let e=this.getFoldingModel();e&&e.then(e=>{if(e){let t=this.editor.getSelections();if(t&&t.length>0){let n=[];for(let r of t){let t=r.selectionStartLineNumber;this.hiddenRangeModel&&this.hiddenRangeModel.isHidden(t)&&n.push(...e.getAllRegionsAtLine(t,e=>e.isCollapsed&&t>e.startLineNumber))}n.length&&(e.toggleCollapseState(n),this.reveal(t[0].getPosition()))}}}).then(void 0,C)}onEditorMouseDown(e){if(this.mouseDownInfo=null,!this.hiddenRangeModel||!e.target||!e.target.range||!e.event.leftButton&&!e.event.middleButton)return;let t=e.target.range,n=!1;switch(e.target.type){case 4:{let t=e.target.detail,r=e.target.element.offsetLeft;if(t.offsetX-r<4)return;n=!0;break}case 7:if(this._unfoldOnClickAfterEndOfLine&&this.hiddenRangeModel.hasRanges()&&!e.target.detail.isAfterLines)break;return;case 6:if(this.hiddenRangeModel.hasRanges()){let e=this.editor.getModel();if(e&&t.startColumn===e.getLineMaxColumn(t.startLineNumber))break}return;default:return}this.mouseDownInfo={lineNumber:t.startLineNumber,iconClicked:n}}onEditorMouseUp(e){let t=this.foldingModel;if(!t||!this.mouseDownInfo||!e.target)return;let n=this.mouseDownInfo.lineNumber,r=this.mouseDownInfo.iconClicked,i=e.target.range;if(!i||i.startLineNumber!==n)return;if(r){if(e.target.type!==4)return}else{let e=this.editor.getModel();if(!e||i.startColumn!==e.getLineMaxColumn(n))return}let a=t.getRegionAtLine(n);if(a&&a.startLineNumber===n){let i=a.isCollapsed;if(r||i){let r=e.event.altKey,o=[];if(r){let e=t.getRegionsInside(null,e=>!e.containedBy(a)&&!a.containedBy(e));for(let t of e)t.isCollapsed&&o.push(t);o.length===0&&(o=e)}else{let n=e.event.middleButton||e.event.shiftKey;if(n)for(let e of t.getRegionsInside(a))e.isCollapsed===i&&o.push(e);(i||!n||o.length===0)&&o.push(a)}t.toggleCollapseState(o),this.reveal({lineNumber:n,column:1})}}}reveal(e){this.editor.revealPositionInCenterIfOutsideViewport(e,0)}};Hb=Bb=Rb([zb(1,W),zb(2,Ci),zb(3,Ro),zb(4,Qi),zb(5,V)],Hb);var Ub=class{constructor(e){this.editor=e,this._onDidChange=new g,this._computed=0,this._limited=!1}get limit(){return this.editor.getOptions().get(47)}update(e,t){(e!==this._computed||t!==this._limited)&&(this._computed=e,this._limited=t,this._onDidChange.fire())}},Wb=class extends N{runEditorCommand(e,t,n){let r=e.get(Ci),i=Hb.get(t);if(!i)return;let a=i.getFoldingModel();if(a)return this.reportTelemetry(e,t),a.then(e=>{if(e){this.invoke(i,e,t,n,r);let a=t.getSelection();a&&i.reveal(a.getStartPosition())}})}getSelectedLines(e){let t=e.getSelections();return t?t.map(e=>e.startLineNumber):[]}getLineNumbers(e,t){return e&&e.selectionLines?e.selectionLines.map(e=>e+1):this.getSelectedLines(t)}run(e,t){}};function Gb(e){return!e||e.length===0?{startsInside:()=>!1}:{startsInside(t,n){for(let r of e){let e=r.startLineNumber;if(e>=t&&e<=n)return!0}return!1}}}function Kb(e){if(!s(e)){if(!p(e))return!1;let t=e;if(!s(t.levels)&&!Ce(t.levels)||!s(t.direction)&&!h(t.direction)||!s(t.selectionLines)&&(!Array.isArray(t.selectionLines)||!t.selectionLines.every(Ce)))return!1}return!0}var qb=class extends Wb{constructor(){super({id:`editor.unfold`,label:S(`unfoldAction.label`,`Unfold`),alias:`Unfold`,precondition:Vb,kbOpts:{kbExpr:q.editorTextFocus,primary:3166,mac:{primary:2654},weight:100},metadata:{description:`Unfold the content in the editor`,args:[{name:`Unfold editor argument`,description:`Property-value pairs that can be passed through this argument:
						* 'levels': Number of levels to unfold. If not set, defaults to 1.
						* 'direction': If 'up', unfold given number of levels up otherwise unfolds down.
						* 'selectionLines': Array of the start lines (0-based) of the editor selections to apply the unfold action to. If not set, the active selection(s) will be used.
						`,constraint:Kb,schema:{type:`object`,properties:{levels:{type:`number`,default:1},direction:{type:`string`,enum:[`up`,`down`],default:`down`},selectionLines:{type:`array`,items:{type:`number`}}}}}]}})}invoke(e,t,n,r){let i=r&&r.levels||1,a=this.getLineNumbers(r,n);r&&r.direction===`up`?ab(t,!1,i,a):ib(t,!1,i,a)}},Jb=class extends Wb{constructor(){super({id:`editor.unfoldRecursively`,label:S(`unFoldRecursivelyAction.label`,`Unfold Recursively`),alias:`Unfold Recursively`,precondition:Vb,kbOpts:{kbExpr:q.editorTextFocus,primary:ne(2089,2142),weight:100}})}invoke(e,t,n,r){ib(t,!1,Number.MAX_VALUE,this.getSelectedLines(n))}},Yb=class extends Wb{constructor(){super({id:`editor.fold`,label:S(`foldAction.label`,`Fold`),alias:`Fold`,precondition:Vb,kbOpts:{kbExpr:q.editorTextFocus,primary:3164,mac:{primary:2652},weight:100},metadata:{description:`Fold the content in the editor`,args:[{name:`Fold editor argument`,description:`Property-value pairs that can be passed through this argument:
							* 'levels': Number of levels to fold.
							* 'direction': If 'up', folds given number of levels up otherwise folds down.
							* 'selectionLines': Array of the start lines (0-based) of the editor selections to apply the fold action to. If not set, the active selection(s) will be used.
							If no levels or direction is set, folds the region at the locations or if already collapsed, the first uncollapsed parent instead.
						`,constraint:Kb,schema:{type:`object`,properties:{levels:{type:`number`},direction:{type:`string`,enum:[`up`,`down`]},selectionLines:{type:`array`,items:{type:`number`}}}}}]}})}invoke(e,t,n,r){let i=this.getLineNumbers(r,n),a=r&&r.levels,o=r&&r.direction;typeof a!=`number`&&typeof o!=`string`?ob(t,!0,i):o===`up`?ab(t,!0,a||1,i):ib(t,!0,a||1,i)}},Xb=class extends Wb{constructor(){super({id:`editor.toggleFold`,label:S(`toggleFoldAction.label`,`Toggle Fold`),alias:`Toggle Fold`,precondition:Vb,kbOpts:{kbExpr:q.editorTextFocus,primary:ne(2089,2090),weight:100}})}invoke(e,t,n){rb(t,1,this.getSelectedLines(n))}},Zb=class extends Wb{constructor(){super({id:`editor.foldRecursively`,label:S(`foldRecursivelyAction.label`,`Fold Recursively`),alias:`Fold Recursively`,precondition:Vb,kbOpts:{kbExpr:q.editorTextFocus,primary:ne(2089,2140),weight:100}})}invoke(e,t,n){let r=this.getSelectedLines(n);ib(t,!0,Number.MAX_VALUE,r)}},Qb=class extends Wb{constructor(){super({id:`editor.toggleFoldRecursively`,label:S(`toggleFoldRecursivelyAction.label`,`Toggle Fold Recursively`),alias:`Toggle Fold Recursively`,precondition:Vb,kbOpts:{kbExpr:q.editorTextFocus,primary:ne(2089,3114),weight:100}})}invoke(e,t,n){let r=this.getSelectedLines(n);rb(t,Number.MAX_VALUE,r)}},$b=class extends Wb{constructor(){super({id:`editor.foldAllBlockComments`,label:S(`foldAllBlockComments.label`,`Fold All Block Comments`),alias:`Fold All Block Comments`,precondition:Vb,kbOpts:{kbExpr:q.editorTextFocus,primary:ne(2089,2138),weight:100}})}invoke(e,t,n,r,i){if(t.regions.hasTypes())ub(t,Me.Comment.value,!0);else{let e=n.getModel();if(!e)return;let r=i.getLanguageConfiguration(e.getLanguageId()).comments;r&&r.blockCommentStartToken&&lb(t,RegExp(`^\\s*`+St(r.blockCommentStartToken)),!0)}}},ex=class extends Wb{constructor(){super({id:`editor.foldAllMarkerRegions`,label:S(`foldAllMarkerRegions.label`,`Fold All Regions`),alias:`Fold All Regions`,precondition:Vb,kbOpts:{kbExpr:q.editorTextFocus,primary:ne(2089,2077),weight:100}})}invoke(e,t,n,r,i){if(t.regions.hasTypes())ub(t,Me.Region.value,!0);else{let e=n.getModel();if(!e)return;let r=i.getLanguageConfiguration(e.getLanguageId()).foldingRules;r&&r.markers&&r.markers.start&&lb(t,new RegExp(r.markers.start),!0)}}},tx=class extends Wb{constructor(){super({id:`editor.unfoldAllMarkerRegions`,label:S(`unfoldAllMarkerRegions.label`,`Unfold All Regions`),alias:`Unfold All Regions`,precondition:Vb,kbOpts:{kbExpr:q.editorTextFocus,primary:ne(2089,2078),weight:100}})}invoke(e,t,n,r,i){if(t.regions.hasTypes())ub(t,Me.Region.value,!1);else{let e=n.getModel();if(!e)return;let r=i.getLanguageConfiguration(e.getLanguageId()).foldingRules;r&&r.markers&&r.markers.start&&lb(t,new RegExp(r.markers.start),!1)}}},nx=class extends Wb{constructor(){super({id:`editor.foldAllExcept`,label:S(`foldAllExcept.label`,`Fold All Except Selected`),alias:`Fold All Except Selected`,precondition:Vb,kbOpts:{kbExpr:q.editorTextFocus,primary:ne(2089,2136),weight:100}})}invoke(e,t,n){cb(t,!0,this.getSelectedLines(n))}},rx=class extends Wb{constructor(){super({id:`editor.unfoldAllExcept`,label:S(`unfoldAllExcept.label`,`Unfold All Except Selected`),alias:`Unfold All Except Selected`,precondition:Vb,kbOpts:{kbExpr:q.editorTextFocus,primary:ne(2089,2134),weight:100}})}invoke(e,t,n){cb(t,!1,this.getSelectedLines(n))}},ix=class extends Wb{constructor(){super({id:`editor.foldAll`,label:S(`foldAllAction.label`,`Fold All`),alias:`Fold All`,precondition:Vb,kbOpts:{kbExpr:q.editorTextFocus,primary:ne(2089,2069),weight:100}})}invoke(e,t,n){ib(t,!0)}},ax=class extends Wb{constructor(){super({id:`editor.unfoldAll`,label:S(`unfoldAllAction.label`,`Unfold All`),alias:`Unfold All`,precondition:Vb,kbOpts:{kbExpr:q.editorTextFocus,primary:ne(2089,2088),weight:100}})}invoke(e,t,n){ib(t,!1)}},ox=class e extends Wb{static#e=this.ID_PREFIX=`editor.foldLevel`;static#t=this.ID=t=>e.ID_PREFIX+t;getFoldingLevel(){return parseInt(this.id.substr(e.ID_PREFIX.length))}invoke(e,t,n){sb(t,this.getFoldingLevel(),!0,this.getSelectedLines(n))}},sx=class extends Wb{constructor(){super({id:`editor.gotoParentFold`,label:S(`gotoParentFold.label`,`Go to Parent Fold`),alias:`Go to Parent Fold`,precondition:Vb,kbOpts:{kbExpr:q.editorTextFocus,weight:100}})}invoke(e,t,n){let r=this.getSelectedLines(n);if(r.length>0){let e=db(r[0],t);e!==null&&n.setSelection({startLineNumber:e,startColumn:1,endLineNumber:e,endColumn:1})}}},cx=class extends Wb{constructor(){super({id:`editor.gotoPreviousFold`,label:S(`gotoPreviousFold.label`,`Go to Previous Folding Range`),alias:`Go to Previous Folding Range`,precondition:Vb,kbOpts:{kbExpr:q.editorTextFocus,weight:100}})}invoke(e,t,n){let r=this.getSelectedLines(n);if(r.length>0){let e=fb(r[0],t);e!==null&&n.setSelection({startLineNumber:e,startColumn:1,endLineNumber:e,endColumn:1})}}},lx=class extends Wb{constructor(){super({id:`editor.gotoNextFold`,label:S(`gotoNextFold.label`,`Go to Next Folding Range`),alias:`Go to Next Folding Range`,precondition:Vb,kbOpts:{kbExpr:q.editorTextFocus,weight:100}})}invoke(e,t,n){let r=this.getSelectedLines(n);if(r.length>0){let e=pb(r[0],t);e!==null&&n.setSelection({startLineNumber:e,startColumn:1,endLineNumber:e,endColumn:1})}}},ux=class extends Wb{constructor(){super({id:`editor.createFoldingRangeFromSelection`,label:S(`createManualFoldRange.label`,`Create Folding Range from Selection`),alias:`Create Folding Range from Selection`,precondition:Vb,kbOpts:{kbExpr:q.editorTextFocus,primary:ne(2089,2135),weight:100}})}invoke(e,t,n){let r=[],i=n.getSelections();if(i){for(let e of i){let t=e.endLineNumber;e.endColumn===1&&--t,t>e.startLineNumber&&(r.push({startLineNumber:e.startLineNumber,endLineNumber:t,type:void 0,isCollapsed:!0,source:1}),n.setSelection({startLineNumber:e.startLineNumber,startColumn:1,endLineNumber:e.startLineNumber,endColumn:1}))}if(r.length>0){r.sort((e,t)=>e.startLineNumber-t.startLineNumber);let e=eb.sanitizeAndMerge(t.regions,r,n.getModel()?.getLineCount());t.updatePost(eb.fromFoldRanges(e))}}}},dx=class extends Wb{constructor(){super({id:`editor.removeManualFoldingRanges`,label:S(`removeManualFoldingRanges.label`,`Remove Manual Folding Ranges`),alias:`Remove Manual Folding Ranges`,precondition:Vb,kbOpts:{kbExpr:q.editorTextFocus,primary:ne(2089,2137),weight:100}})}invoke(e,t,n){let r=n.getSelections();if(r){let n=[];for(let e of r){let{startLineNumber:t,endLineNumber:r}=e;n.push(r>=t?{startLineNumber:t,endLineNumber:r}:{endLineNumber:r,startLineNumber:t})}t.removeManualRanges(n),e.triggerFoldingModelChanged()}}};I(Hb.ID,Hb,0),L(qb),L(Jb),L(Yb),L(Zb),L(Qb),L(ix),L(ax),L($b),L(ex),L(tx),L(nx),L(rx),L(Xb),L(sx),L(cx),L(lx),L(ux),L(dx);for(let e=1;e<=7;e++)bo(new ox({id:ox.ID(e),label:S(`foldLevelAction.label`,`Fold Level {0}`,e),alias:`Fold Level ${e}`,precondition:Vb,kbOpts:{kbExpr:q.editorTextFocus,primary:ne(2089,2048|21+e),weight:100}}));B.registerCommand(`_executeFoldingRangeProvider`,async function(e,...t){let[n]=t;if(!(n instanceof y))throw Fe();let r=e.get(V),i=e.get(Ps).getModel(n);if(!i)throw Fe();let a=e.get(F);if(!a.getValue(`editor.folding`,{resource:n}))return[];let o=e.get(Ci),s=a.getValue(`editor.foldingStrategy`,{resource:n}),c={get limit(){return a.getValue(`editor.foldingMaximumRegions`,{resource:n})},update:(e,t)=>{}},l=new yb(i,o,c),u=l;if(s!==`indentation`){let e=Hb.getFoldingRangeProviders(r,i);e.length&&(u=new Pb(i,e,()=>{},c,l))}let d=await u.compute(w.None),f=[];try{if(d)for(let e=0;e<d.length;e++){let t=d.getType(e);f.push({start:d.getStartLineNumber(e),end:d.getEndLineNumber(e),kind:t?Me.fromValue(t):void 0})}return f}finally{u.dispose()}});var fx=class extends N{constructor(){super({id:`editor.action.fontZoomIn`,label:S(`EditorFontZoomIn.label`,`Increase Editor Font Size`),alias:`Increase Editor Font Size`,precondition:void 0})}run(e,t){is.setZoomLevel(is.getZoomLevel()+1)}},px=class extends N{constructor(){super({id:`editor.action.fontZoomOut`,label:S(`EditorFontZoomOut.label`,`Decrease Editor Font Size`),alias:`Decrease Editor Font Size`,precondition:void 0})}run(e,t){is.setZoomLevel(is.getZoomLevel()-1)}},mx=class extends N{constructor(){super({id:`editor.action.fontZoomReset`,label:S(`EditorFontZoomReset.label`,`Reset Editor Font Size`),alias:`Reset Editor Font Size`,precondition:void 0})}run(e,t){is.setZoomLevel(0)}};L(fx),L(px),L(mx);var hx=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},gx=function(e,t){return function(n,r){t(n,r,e)}},_x=class{static#e=this.ID=`editor.contrib.autoFormat`;constructor(e,t,r,i){this._editor=e,this._languageFeaturesService=t,this._workerService=r,this._accessibilitySignalService=i,this._disposables=new n,this._sessionDisposables=new n,this._disposables.add(t.onTypeFormattingEditProvider.onDidChange(this._update,this)),this._disposables.add(e.onDidChangeModel(()=>this._update())),this._disposables.add(e.onDidChangeModelLanguage(()=>this._update())),this._disposables.add(e.onDidChangeConfiguration(e=>{e.hasChanged(56)&&this._update()})),this._update()}dispose(){this._disposables.dispose(),this._sessionDisposables.dispose()}_update(){if(this._sessionDisposables.clear(),!this._editor.getOption(56)||!this._editor.hasModel())return;let e=this._editor.getModel(),[t]=this._languageFeaturesService.onTypeFormattingEditProvider.ordered(e);if(!t||!t.autoFormatTriggerCharacters)return;let n=new pl;for(let e of t.autoFormatTriggerCharacters)n.add(e.charCodeAt(0));this._sessionDisposables.add(this._editor.onDidType(e=>{let t=e.charCodeAt(e.length-1);n.has(t)&&this._trigger(String.fromCharCode(t))}))}_trigger(e){if(!this._editor.hasModel()||this._editor.getSelections().length>1||!this._editor.getSelection().isEmpty())return;let t=this._editor.getModel(),n=this._editor.getPosition(),r=new ie,i=this._editor.onDidChangeModelContent(e=>{if(e.isFlush){r.cancel(),i.dispose();return}for(let t=0,a=e.changes.length;t<a;t++)if(e.changes[t].range.endLineNumber<=n.lineNumber){r.cancel(),i.dispose();return}});ol(this._workerService,this._languageFeaturesService,t,n,e,t.getFormattingOptions(),r.token).then(e=>{r.token.isCancellationRequested||On(e)&&(this._accessibilitySignalService.playSignal(to.format,{userGesture:!1}),Tl.execute(this._editor,e,!0))}).finally(()=>{i.dispose()})}};_x=hx([gx(1,V),gx(2,pi),gx(3,hi)],_x);var vx=class{static#e=this.ID=`editor.contrib.formatOnPaste`;constructor(e,t,r){this.editor=e,this._languageFeaturesService=t,this._instantiationService=r,this._callOnDispose=new n,this._callOnModel=new n,this._callOnDispose.add(e.onDidChangeConfiguration(()=>this._update())),this._callOnDispose.add(e.onDidChangeModel(()=>this._update())),this._callOnDispose.add(e.onDidChangeModelLanguage(()=>this._update())),this._callOnDispose.add(t.documentRangeFormattingEditProvider.onDidChange(this._update,this))}dispose(){this._callOnDispose.dispose(),this._callOnModel.dispose()}_update(){this._callOnModel.clear(),this.editor.getOption(55)&&this.editor.hasModel()&&this._languageFeaturesService.documentRangeFormattingEditProvider.has(this.editor.getModel())&&this._callOnModel.add(this.editor.onDidPaste(({range:e})=>this._trigger(e)))}_trigger(e){this.editor.hasModel()&&(this.editor.getSelections().length>1||this._instantiationService.invokeFunction(As,this.editor,e,2,_a.None,w.None,!1).catch(C))}};vx=hx([gx(1,V),gx(2,Y)],vx);var yx=class extends N{constructor(){super({id:`editor.action.formatDocument`,label:S(`formatDocument.label`,`Format Document`),alias:`Format Document`,precondition:z.and(q.notInCompositeEditor,q.writable,q.hasDocumentFormattingProvider),kbOpts:{kbExpr:q.editorTextFocus,primary:1572,linux:{primary:3111},weight:100},contextMenuOpts:{group:`1_modification`,order:1.3}})}async run(e,t){if(t.hasModel()){let n=e.get(Y);await e.get(ni).showWhile(n.invokeFunction(Ho,t,1,_a.None,w.None,!0),250)}}},bx=class extends N{constructor(){super({id:`editor.action.formatSelection`,label:S(`formatSelection.label`,`Format Selection`),alias:`Format Selection`,precondition:z.and(q.writable,q.hasDocumentSelectionFormattingProvider),kbOpts:{kbExpr:q.editorTextFocus,primary:ne(2089,2084),weight:100},contextMenuOpts:{when:q.hasNonEmptySelection,group:`1_modification`,order:1.31}})}async run(e,t){if(!t.hasModel())return;let n=e.get(Y),r=t.getModel(),i=t.getSelections().map(e=>e.isEmpty()?new T(e.startLineNumber,1,e.startLineNumber,r.getLineMaxColumn(e.startLineNumber)):e);await e.get(ni).showWhile(n.invokeFunction(As,t,i,1,_a.None,w.None,!0),250)}};I(_x.ID,_x,2),I(vx.ID,vx,2),L(yx),L(bx),B.registerCommand(`editor.action.format`,async e=>{let t=e.get(Ko).getFocusedCodeEditor();if(!t||!t.hasModel())return;let n=e.get(lc);t.getSelection().isEmpty()?await n.executeCommand(`editor.action.formatDocument`):await n.executeCommand(`editor.action.formatSelection`)});var xx=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Sx=function(e,t){return function(n,r){t(n,r,e)}},Cx=class{remove(){this.parent?.children.delete(this.id)}static findId(e,t){let n;typeof e==`string`?n=`${t.id}/${e}`:(n=`${t.id}/${e.name}`,t.children.get(n)!==void 0&&(n=`${t.id}/${e.name}_${e.range.startLineNumber}_${e.range.startColumn}`));let r=n;for(let e=0;t.children.get(r)!==void 0;e++)r=`${n}_${e}`;return r}static empty(e){return e.children.size===0}},wx=class extends Cx{constructor(e,t,n){super(),this.id=e,this.parent=t,this.symbol=n,this.children=new Map}},Tx=class extends Cx{constructor(e,t,n,r){super(),this.id=e,this.parent=t,this.label=n,this.order=r,this.children=new Map}},Ex=class e extends Cx{static create(t,n,r){let i=new ie(r),a=new e(n.uri),o=t.ordered(n),s=o.map((t,r)=>{let o=Cx.findId(`provider_${r}`,a),s=new Tx(o,a,t.displayName??`Unknown Outline Provider`,r);return Promise.resolve(t.provideDocumentSymbols(n,i.token)).then(t=>{for(let n of t||[])e._makeOutlineElement(n,s);return s},e=>(Re(e),s)).then(e=>{Cx.empty(e)?e.remove():a._groups.set(o,e)})}),c=t.onDidChange(()=>{Ut(t.ordered(n),o)||i.cancel()});return Promise.all(s).then(()=>i.token.isCancellationRequested&&!r.isCancellationRequested?e.create(t,n,r):a._compact()).finally(()=>{i.dispose(),c.dispose(),i.dispose()})}static _makeOutlineElement(t,n){let r=new wx(Cx.findId(t,n),n,t);if(t.children)for(let n of t.children)e._makeOutlineElement(n,r);n.children.set(r.id,r)}constructor(e){super(),this.uri=e,this.id=`root`,this.parent=void 0,this._groups=new Map,this.children=new Map,this.id=`root`,this.parent=void 0}_compact(){let e=0;for(let[t,n]of this._groups)n.children.size===0?this._groups.delete(t):e+=1;if(e!==1)this.children=this._groups;else{let e=ue.first(this._groups.values());for(let[,t]of e.children)t.parent=this,this.children.set(t.id,t)}return this}getTopLevelSymbols(){let e=[];for(let t of this.children.values())t instanceof wx?e.push(t.symbol):e.push(...ue.map(t.children.values(),e=>e.symbol));return e.sort((e,t)=>T.compareRangesUsingStarts(e.range,t.range))}asListOfDocumentSymbols(){let t=this.getTopLevelSymbols(),n=[];return e._flattenDocumentSymbols(n,t,``),n.sort((e,t)=>r.compare(T.getStartPosition(e.range),T.getStartPosition(t.range))||r.compare(T.getEndPosition(t.range),T.getEndPosition(e.range)))}static _flattenDocumentSymbols(t,n,r){for(let i of n)t.push({kind:i.kind,tags:i.tags,name:i.name,detail:i.detail,containerName:i.containerName||r,range:i.range,selectionRange:i.selectionRange,children:void 0}),i.children&&e._flattenDocumentSymbols(t,i.children,i.name)}};const Dx=kl(`IOutlineModelService`);var Ox=class{constructor(e,t,r){this._languageFeaturesService=e,this._disposables=new n,this._cache=new yl(10,.7),this._debounceInformation=t.for(e.documentSymbolProvider,`DocumentSymbols`,{min:350}),this._disposables.add(r.onModelRemoved(e=>{this._cache.delete(e.id)}))}dispose(){this._disposables.dispose()}async getOrCreate(e,t){let n=this._languageFeaturesService.documentSymbolProvider,r=n.ordered(e),i=this._cache.get(e.id);if(!i||i.versionId!==e.getVersionId()||!Ut(i.provider,r)){let t=new ie;i={versionId:e.getVersionId(),provider:r,promiseCnt:0,source:t,promise:Ex.create(n,e,t.token),model:void 0},this._cache.set(e.id,i);let a=Date.now();i.promise.then(t=>{i.model=t,this._debounceInformation.update(e,Date.now()-a)}).catch(t=>{this._cache.delete(e.id)})}if(i.model)return i.model;i.promiseCnt+=1;let a=t.onCancellationRequested(()=>{--i.promiseCnt===0&&(i.source.cancel(),this._cache.delete(e.id))});try{return await i.promise}finally{a.dispose()}}};Ox=xx([Sx(0,V),Sx(1,Qi),Sx(2,Ps)],Ox),$r(Dx,Ox,1),B.registerCommand(`_executeDocumentSymbolProvider`,async function(e,...t){let[n]=t;o(y.isUri(n));let r=e.get(Dx),i=await e.get(Bs).createModelReference(n);try{return(await r.getOrCreate(i.object.textEditorModel,w.None)).getTopLevelSymbols()}finally{i.dispose()}});var kx=class e extends _{static#e=this.inlineSuggestionVisible=new G(`inlineSuggestionVisible`,!1,S(`inlineSuggestionVisible`,`Whether an inline suggestion is visible`));static#t=this.inlineSuggestionHasIndentation=new G(`inlineSuggestionHasIndentation`,!1,S(`inlineSuggestionHasIndentation`,`Whether the inline suggestion starts with whitespace`));static#n=this.inlineSuggestionHasIndentationLessThanTabSize=new G(`inlineSuggestionHasIndentationLessThanTabSize`,!0,S(`inlineSuggestionHasIndentationLessThanTabSize`,`Whether the inline suggestion starts with whitespace that is less than what would be inserted by tab`));static#r=this.suppressSuggestions=new G(`inlineSuggestionSuppressSuggestions`,void 0,S(`suppressSuggestions`,`Whether suggestions should be suppressed for the current suggestion`));constructor(t,n){super(),this.contextKeyService=t,this.model=n,this.inlineCompletionVisible=e.inlineSuggestionVisible.bindTo(this.contextKeyService),this.inlineCompletionSuggestsIndentation=e.inlineSuggestionHasIndentation.bindTo(this.contextKeyService),this.inlineCompletionSuggestsIndentationLessThanTabSize=e.inlineSuggestionHasIndentationLessThanTabSize.bindTo(this.contextKeyService),this.suppressSuggestions=e.suppressSuggestions.bindTo(this.contextKeyService),this._register(Ba(e=>{let t=this.model.read(e)?.state.read(e),n=!!t?.inlineCompletion&&t?.primaryGhostText!==void 0&&!t?.primaryGhostText.isEmpty();this.inlineCompletionVisible.set(n),t?.primaryGhostText&&t?.inlineCompletion&&this.suppressSuggestions.set(t.inlineCompletion.inlineCompletion.source.inlineCompletions.suppressSuggestions)})),this._register(Ba(e=>{let t=this.model.read(e),n=!1,r=!0,i=t?.primaryGhostText.read(e);if(t?.selectedSuggestItem&&i&&i.parts.length>0){let{column:e,lines:a}=i.parts[0],o=a[0];if(e<=t.textModel.getLineIndentColumn(i.lineNumber)){let e=hn(o);e===-1&&(e=o.length-1),n=e>0;let i=t.textModel.getOptions().tabSize;r=dr.visibleColumnFromColumn(o,e+1,i)<i}}this.inlineCompletionSuggestsIndentation.set(n),this.inlineCompletionSuggestsIndentationLessThanTabSize.set(r)}))}};function Ax(e){let t=new n,r=t.add(Lt());return t.add(Ba(t=>{r.setStyle(e.read(t))})),t}var jx=class{constructor(e,t){this.lineNumber=e,this.parts=t}equals(e){return this.lineNumber===e.lineNumber&&this.parts.length===e.parts.length&&this.parts.every((t,n)=>t.equals(e.parts[n]))}renderForScreenReader(e){if(this.parts.length===0)return``;let t=this.parts[this.parts.length-1],n=e.substr(0,t.column-1);return new Kc([...this.parts.map(e=>new wc(T.fromPositions(new r(1,e.column)),e.lines.join(`
`)))]).applyToString(n).substring(this.parts[0].column-1)}isEmpty(){return this.parts.every(e=>e.lines.length===0)}get lineCount(){return 1+this.parts.reduce((e,t)=>e+t.lines.length-1,0)}},Mx=class{constructor(e,t,n){this.column=e,this.text=t,this.preview=n,this.lines=Vr(this.text)}equals(e){return this.column===e.column&&this.lines.length===e.lines.length&&this.lines.every((t,n)=>t===e.lines[n])}},Nx=class{constructor(e,t,n,r=0){this.lineNumber=e,this.columnRange=t,this.text=n,this.additionalReservedLineCount=r,this.parts=[new Mx(this.columnRange.endColumnExclusive,this.text,!1)],this.newLines=Vr(this.text)}renderForScreenReader(e){return this.newLines.join(`
`)}get lineCount(){return this.newLines.length}isEmpty(){return this.parts.every(e=>e.lines.length===0)}equals(e){return this.lineNumber===e.lineNumber&&this.columnRange.equals(e.columnRange)&&this.newLines.length===e.newLines.length&&this.newLines.every((t,n)=>t===e.newLines[n])&&this.additionalReservedLineCount===e.additionalReservedLineCount}};function Px(e,t){return Ut(e,t,Fx)}function Fx(e,t){return e===t?!0:!e||!t?!1:e instanceof jx&&t instanceof jx||e instanceof Nx&&t instanceof Nx?e.equals(t):!1}var Ix=[];function Lx(){return Ix}var Rx=class{constructor(t,n){if(this.startColumn=t,this.endColumnExclusive=n,t>n)throw new e(`startColumn ${t} cannot be after endColumnExclusive ${n}`)}toRange(e){return new T(e,this.startColumn,e,this.endColumnExclusive)}equals(e){return this.startColumn===e.startColumn&&this.endColumnExclusive===e.endColumnExclusive}};function zx(e,t){let r=new n,i=e.createDecorationsCollection();return r.add(Yr({debugName:()=>`Apply decorations from ${t.debugName}`},e=>{let n=t.read(e);i.set(n)})),r.add({dispose:()=>{i.clear()}}),r}function Bx(e,t){return new r(e.lineNumber+t.lineNumber-1,t.lineNumber===1?e.column+t.column-1:t.column)}function Vx(e,t){return new r(e.lineNumber-t.lineNumber+1,e.lineNumber-t.lineNumber===0?e.column-t.column+1:e.column)}var Hx=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Ux=function(e,t){return function(n,r){t(n,r,e)}};const Wx=`ghost-text`;var Gx=class extends _{constructor(e,t,n){super(),this.editor=e,this.model=t,this.languageService=n,this.isDisposed=uc(this,!1),this.currentTextModel=$i(this,this.editor.onDidChangeModel,()=>this.editor.getModel()),this.uiState=K(this,e=>{if(this.isDisposed.read(e))return;let t=this.currentTextModel.read(e);if(t!==this.model.targetTextModel.read(e))return;let n=this.model.ghostText.read(e);if(!n)return;let r=n instanceof Nx?n.columnRange:void 0,i=[],a=[];function o(e,t){if(a.length>0){let n=a[a.length-1];t&&n.decorations.push(new Ht(n.content.length+1,n.content.length+1+e[0].length,t,0)),n.content+=e[0],e=e.slice(1)}for(let n of e)a.push({content:n,decorations:t?[new Ht(1,n.length+1,t,0)]:[]})}let s=t.getLineContent(n.lineNumber),c,l=0;for(let e of n.parts){let t=e.lines;c===void 0?(i.push({column:e.column,text:t[0],preview:e.preview}),t=t.slice(1)):o([s.substring(l,e.column-1)],void 0),t.length>0&&(o(t,Wx),c===void 0&&e.column<=s.length&&(c=e.column)),l=e.column-1}return c!==void 0&&o([s.substring(l)],void 0),{replacedRange:r,inlineTexts:i,additionalLines:a,hiddenRange:c===void 0?void 0:new Rx(c,s.length+1),lineNumber:n.lineNumber,additionalReservedLineCount:this.model.minReservedLineCount.read(e),targetTextModel:t}}),this.decorations=K(this,e=>{let t=this.uiState.read(e);if(!t)return[];let n=[];t.replacedRange&&n.push({range:t.replacedRange.toRange(t.lineNumber),options:{inlineClassName:`inline-completion-text-to-replace`,description:`GhostTextReplacement`}}),t.hiddenRange&&n.push({range:t.hiddenRange.toRange(t.lineNumber),options:{inlineClassName:`ghost-text-hidden`,description:`ghost-text-hidden`}});for(let e of t.inlineTexts)n.push({range:T.fromPositions(new r(t.lineNumber,e.column)),options:{description:Wx,after:{content:e.text,inlineClassName:e.preview?`ghost-text-decoration-preview`:`ghost-text-decoration`,cursorStops:Uo.Left},showIfCollapsed:!0}});return n}),this.additionalLinesWidget=this._register(new Kx(this.editor,this.languageService.languageIdCodec,K(e=>{let t=this.uiState.read(e);return t?{lineNumber:t.lineNumber,additionalLines:t.additionalLines,minReservedLineCount:t.additionalReservedLineCount,targetTextModel:t.targetTextModel}:void 0}))),this._register(b(()=>{this.isDisposed.set(!0,void 0)})),this._register(zx(this.editor,this.decorations))}ownsViewZone(e){return this.additionalLinesWidget.viewZoneId===e}};Gx=Hx([Ux(2,Ys)],Gx);var Kx=class extends _{get viewZoneId(){return this._viewZoneId}constructor(e,t,n){super(),this.editor=e,this.languageIdCodec=t,this.lines=n,this._viewZoneId=void 0,this.editorOptionsChanged=Oo(`editorOptionChanged`,we.filter(this.editor.onDidChangeConfiguration,e=>e.hasChanged(33)||e.hasChanged(118)||e.hasChanged(100)||e.hasChanged(95)||e.hasChanged(51)||e.hasChanged(50)||e.hasChanged(67))),this._register(Ba(e=>{let t=this.lines.read(e);this.editorOptionsChanged.read(e),t?this.updateLines(t.lineNumber,t.additionalLines,t.minReservedLineCount):this.clear()}))}dispose(){super.dispose(),this.clear()}clear(){this.editor.changeViewZones(e=>{this._viewZoneId&&=(e.removeZone(this._viewZoneId),void 0)})}updateLines(e,t,n){let r=this.editor.getModel();if(!r)return;let{tabSize:i}=r.getOptions();this.editor.changeViewZones(r=>{this._viewZoneId&&=(r.removeZone(this._viewZoneId),void 0);let a=Math.max(t.length,n);if(a>0){let n=document.createElement(`div`);qx(n,i,t,this.editor.getOptions(),this.languageIdCodec),this._viewZoneId=r.addZone({afterLineNumber:e,heightInLines:a,domNode:n,afterColumnAffinity:1})}})}};function qx(e,t,n,r,i){let a=r.get(33),o=r.get(118),s=r.get(95),c=r.get(51),l=r.get(50),u=r.get(67),d=new $t(1e4);d.appendString(`<div class="suggest-preview-text">`);for(let e=0,r=n.length;e<r;e++){let r=n[e],f=r.content;d.appendString(`<div class="view-line`),d.appendString(`" style="top:`),d.appendString(String(e*u)),d.appendString(`px;width:1000000px;">`);let p=Cr(f),m=an(f),h=Rc.createEmpty(f,i);rt(new Zt(l.isMonospace&&!a,l.canUseHalfwidthRightwardsArrow,f,!1,p,m,0,h,r.decorations,t,0,l.spaceWidth,l.middotWidth,l.wsmiddotWidth,o,`none`,s,c!==or.OFF,null),d),d.appendString(`</div>`)}d.appendString(`</div>`),Sl(e,l);let f=d.build();e.innerHTML=Jx?Jx.createHTML(f):f}const Jx=Ma(`editorGhostText`,{createHTML:e=>e});function Yx(e,t){let n=new rl(new Es,e=>t.getLanguageConfiguration(e)),r=cc(new ms(new Xx([e]),n),[],void 0,!0),i=``,a=e.getLineContent();function o(e,t){if(e.kind===2)if(o(e.openingBracket,t),t=Ac(t,e.openingBracket.length),e.child&&(o(e.child,t),t=Ac(t,e.child.length)),e.closingBracket)o(e.closingBracket,t),t=Ac(t,e.closingBracket.length);else{let t=n.getSingleLanguageBracketTokens(e.openingBracket.languageId).findClosingTokenText(e.openingBracket.bracketIds);i+=t}else if(e.kind!==3){if(e.kind===0||e.kind===1)i+=a.substring(hc(t),hc(Ac(t,e.length)));else if(e.kind===4)for(let n of e.children)o(n,t),t=Ac(t,n.length)}}return o(r,0),i}var Xx=class{constructor(e){this.lines=e,this.tokenization={getLineTokens:e=>this.lines[e-1]}}getLineCount(){return this.lines.length}getLineLength(e){return this.lines[e-1].getLineContent().length}};async function Zx(e,t,n,i,a=w.None,o){let s=t instanceof r?tS(t,n):t,c=e.all(n),l=new di;for(let e of c)e.groupId&&l.add(e.groupId,e);function u(e){if(!e.yieldsToGroupIds)return[];let t=[];for(let n of e.yieldsToGroupIds||[]){let e=l.get(n);for(let n of e)t.push(n)}return t}let d=new Map,f=new Set;function p(e,t){if(t=[...t,e],f.has(e))return t;f.add(e);try{let n=u(e);for(let e of n){let n=p(e,t);if(n)return n}}finally{f.delete(e)}}function m(e){let o=d.get(e);if(o)return o;let s=p(e,[]);s&&Re(Error(`Inline completions: cyclic yield-to dependency detected. Path: ${s.map(e=>e.toString?e.toString():``+e).join(` -> `)}`));let c=new Zn;return d.set(e,c.p),(async()=>{if(!s){let t=u(e);for(let e of t){let t=await m(e);if(t&&t.items.length>0)return}}try{return t instanceof r?await e.provideInlineCompletions(n,t,i,a):await e.provideInlineEdits?.(n,t,i,a)}catch(e){Re(e);return}})().then(e=>c.complete(e),e=>c.error(e)),c.p}let h=await Promise.all(c.map(async e=>({provider:e,completions:await m(e)}))),g=new Map,ee=[];for(let e of h){let t=e.completions;if(!t)continue;let r=new $x(t,e.provider);ee.push(r);for(let e of t.items){let t=eS.from(e,r,s,n,o);g.set(t.hash(),t)}}return new Qx(Array.from(g.values()),new Set(g.keys()),ee)}var Qx=class{constructor(e,t,n){this.completions=e,this.hashs=t,this.providerResults=n}has(e){return this.hashs.has(e.hash())}dispose(){for(let e of this.providerResults)e.removeRef()}},$x=class{constructor(e,t){this.inlineCompletions=e,this.provider=t,this.refCount=1}addRef(){this.refCount++}removeRef(){this.refCount--,this.refCount===0&&this.provider.freeInlineCompletions(this.inlineCompletions)}},eS=class e{static from(t,n,r,i,a){let o,s,c=t.range?T.lift(t.range):r;if(typeof t.insertText==`string`){if(o=t.insertText,a&&t.completeBracketPairs){o=nS(o,c.getStartPosition(),i,a);let e=o.length-t.insertText.length;e!==0&&(c=new T(c.startLineNumber,c.startColumn,c.endLineNumber,c.endColumn+e))}s=void 0}else if(`snippet`in t.insertText){let e=t.insertText.snippet.length;if(a&&t.completeBracketPairs){t.insertText.snippet=nS(t.insertText.snippet,c.getStartPosition(),i,a);let n=t.insertText.snippet.length-e;n!==0&&(c=new T(c.startLineNumber,c.startColumn,c.endLineNumber,c.endColumn+n))}let n=new dd().parse(t.insertText.snippet);n.children.length===1&&n.children[0]instanceof nd?(o=n.children[0].value,s=void 0):(o=n.toString(),s={snippet:t.insertText.snippet,range:c})}else cr(t.insertText);return new e(o,t.command,c,o,s,t.additionalTextEdits||Lx(),t,n)}constructor(e,t,n,r,i,a,o,s){this.filterText=e,this.command=t,this.range=n,this.insertText=r,this.snippetInfo=i,this.additionalTextEdits=a,this.sourceInlineCompletion=o,this.source=s,e=e.replace(/\r\n|\r/g,`
`),r=e.replace(/\r\n|\r/g,`
`)}withRange(t){return new e(this.filterText,this.command,t,this.insertText,this.snippetInfo,this.additionalTextEdits,this.sourceInlineCompletion,this.source)}hash(){return JSON.stringify({insertText:this.insertText,range:this.range.toString()})}toSingleTextEdit(){return new wc(this.range,this.insertText)}};function tS(e,t){let n=t.getWordAtPosition(e),r=t.getLineMaxColumn(e.lineNumber);return n?new T(e.lineNumber,n.startColumn,e.lineNumber,r):T.fromPositions(e,e.with(void 0,r))}function nS(e,t,n,r){let i=n.getLineContent(t.lineNumber).substring(0,t.column-1)+e,a=n.tokenization.tokenizeLineWithEdit(t,i.length-(t.column-1),e)?.sliceAndInflate(t.column-1,i.length,0);return a?Yx(a,r):e}function rS(e,t,n){let r=n?e.range.intersectRanges(n):e.range;if(!r)return e;let i=t.getValueInRange(r,1),a=ct(i,e.text),o=ss.ofText(i.substring(0,a)).addToPosition(e.range.getStartPosition()),s=e.text.substring(a);return new wc(T.fromPositions(o,e.range.getEndPosition()),s)}function iS(e,t){return e.text.startsWith(t.text)&&oS(e.range,t.range)}function aS(e,t,n,r,i=0){let a=rS(e,t);if(a.range.endLineNumber!==a.range.startLineNumber)return;let o=t.getLineContent(a.range.startLineNumber),s=Gt(o).length;if(a.range.startColumn-1<=s){let e=Gt(a.text).length,t=o.substring(a.range.startColumn-1,s),[n,r]=[a.range.getStartPosition(),a.range.getEndPosition()],i=n.column+t.length<=r.column?n.delta(0,t.length):r;a=new wc(T.fromPositions(i,r),a.text.startsWith(t)?a.text.substring(t.length):a.text.substring(e))}let c=t.getValueInRange(a.range),l=cS(c,a.text);if(!l)return;let u=a.range.startLineNumber,d=[];if(n===`prefix`){let e=l.filter(e=>e.originalLength===0);if(e.length>1||e.length===1&&e[0].originalStart!==c.length)return}let f=a.text.length-i;for(let e of l){let t=a.range.startColumn+e.originalStart+e.originalLength;if(n===`subwordSmart`&&r&&r.lineNumber===a.range.startLineNumber&&t<r.column||e.originalLength>0)return;if(e.modifiedLength===0)continue;let i=e.modifiedStart+e.modifiedLength,o=Math.max(e.modifiedStart,Math.min(i,f)),s=a.text.substring(e.modifiedStart,o),c=a.text.substring(o,Math.max(e.modifiedStart,i));s.length>0&&d.push(new Mx(t,s,!1)),c.length>0&&d.push(new Mx(t,c,!0))}return new jx(u,d)}function oS(e,t){return t.getStartPosition().equals(e.getStartPosition())&&t.getEndPosition().isBeforeOrEqual(e.getEndPosition())}var sS=void 0;function cS(e,t){if(sS?.originalValue===e&&sS?.newValue===t)return sS?.changes;{let n=uS(e,t,!0);if(n){let r=lS(n);if(r>0){let i=uS(e,t,!1);i&&lS(i)<r&&(n=i)}}return sS={originalValue:e,newValue:t,changes:n},n}}function lS(e){let t=0;for(let n of e)t+=n.originalLength;return t}function uS(e,t,n){if(e.length>5e3||t.length>5e3)return;function r(e){let t=0;for(let n=0,r=e.length;n<r;n++){let r=e.charCodeAt(n);r>t&&(t=r)}return t}let i=Math.max(r(e),r(t));function a(e){if(e<0)throw Error(`unexpected`);return i+e+1}function o(e){let t=0,r=0,i=new Int32Array(e.length);for(let o=0,s=e.length;o<s;o++)n&&e[o]===`(`?(i[o]=a(2*(r*100+t)),t++):n&&e[o]===`)`?(t=Math.max(t-1,0),i[o]=a(2*(r*100+t)+1),t===0&&r++):i[o]=e.charCodeAt(o);return i}let s=o(e),c=o(t);return new ro({getElements:()=>s},{getElements:()=>c}).ComputeDiff(!1).changes}var dS=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},fS=function(e,t){return function(n,r){t(n,r,e)}},pS=class extends _{constructor(e,t,n,r,i){super(),this.textModel=e,this.versionId=t,this._debounceValue=n,this.languageFeaturesService=r,this.languageConfigurationService=i,this._updateOperation=this._register(new l),this.inlineCompletions=us(`inlineCompletions`,void 0),this.suggestWidgetInlineCompletions=us(`suggestWidgetInlineCompletions`,void 0),this._register(this.textModel.onDidChangeContent(()=>{this._updateOperation.clear()}))}fetch(e,t,n){let r=new hS(e,t,this.textModel.getVersionId()),i=t.selectedSuggestionInfo?this.suggestWidgetInlineCompletions:this.inlineCompletions;if(this._updateOperation.value?.request.satisfies(r))return this._updateOperation.value.promise;if(i.get()?.request.satisfies(r))return Promise.resolve(!0);let a=!!this._updateOperation.value;this._updateOperation.clear();let o=new ie,s=(async()=>{if((a||t.triggerKind===Oe.Automatic)&&await mS(this._debounceValue.get(this.textModel),o.token),o.token.isCancellationRequested||this._store.isDisposed||this.textModel.getVersionId()!==r.versionId)return!1;let s=new Date,c=await Zx(this.languageFeaturesService.inlineCompletionsProvider,e,this.textModel,t,o.token,this.languageConfigurationService);if(o.token.isCancellationRequested||this._store.isDisposed||this.textModel.getVersionId()!==r.versionId)return!1;let l=new Date;this._debounceValue.update(this.textModel,l.getTime()-s.getTime());let u=new _S(c,r,this.textModel,this.versionId);if(n){let t=n.toInlineCompletion(void 0);n.canBeReused(this.textModel,e)&&!c.has(t)&&u.prepend(n.inlineCompletion,t.range,!0)}return this._updateOperation.clear(),gs(e=>{i.set(u,e)}),!0})(),c=new gS(r,o,s);return this._updateOperation.value=c,s}clear(e){this._updateOperation.clear(),this.inlineCompletions.set(void 0,e),this.suggestWidgetInlineCompletions.set(void 0,e)}clearSuggestWidgetInlineCompletions(e){this._updateOperation.value?.request.context.selectedSuggestionInfo&&this._updateOperation.clear(),this.suggestWidgetInlineCompletions.set(void 0,e)}cancelUpdate(){this._updateOperation.clear()}};pS=dS([fS(3,V),fS(4,Ci)],pS);function mS(e,t){return new Promise(n=>{let r,i=setTimeout(()=>{r&&r.dispose(),n()},e);t&&(r=t.onCancellationRequested(()=>{clearTimeout(i),r&&r.dispose(),n()}))})}var hS=class{constructor(e,t,n){this.position=e,this.context=t,this.versionId=n}satisfies(e){return this.position.equals(e.position)&&Os(this.context.selectedSuggestionInfo,e.context.selectedSuggestionInfo,Mc())&&(e.context.triggerKind===Oe.Automatic||this.context.triggerKind===Oe.Explicit)&&this.versionId===e.versionId}},gS=class{constructor(e,t,n){this.request=e,this.cancellationTokenSource=t,this.promise=n}dispose(){this.cancellationTokenSource.cancel()}},_S=class{get inlineCompletions(){return this._inlineCompletions}constructor(e,t,n,r){this.inlineCompletionProviderResult=e,this.request=t,this._textModel=n,this._versionId=r,this._refCount=1,this._prependedInlineCompletionItems=[];let i=n.deltaDecorations([],e.completions.map(e=>({range:e.range,options:{description:`inline-completion-tracking-range`}})));this._inlineCompletions=e.completions.map((e,t)=>new vS(e,i[t],this._textModel,this._versionId))}clone(){return this._refCount++,this}dispose(){if(this._refCount--,this._refCount===0){setTimeout(()=>{this._textModel.isDisposed()||this._textModel.deltaDecorations(this._inlineCompletions.map(e=>e.decorationId),[])},0),this.inlineCompletionProviderResult.dispose();for(let e of this._prependedInlineCompletionItems)e.source.removeRef()}}prepend(e,t,n){n&&e.source.addRef();let r=this._textModel.deltaDecorations([],[{range:t,options:{description:`inline-completion-tracking-range`}}])[0];this._inlineCompletions.unshift(new vS(e,r,this._textModel,this._versionId)),this._prependedInlineCompletionItems.push(e)}},vS=class{get forwardStable(){return this.inlineCompletion.source.inlineCompletions.enableForwardStability??!1}constructor(e,t,n,r){this.inlineCompletion=e,this.decorationId=t,this._textModel=n,this._modelVersion=r,this.semanticId=JSON.stringify([this.inlineCompletion.filterText,this.inlineCompletion.insertText,this.inlineCompletion.range.getStartPosition().toString()]),this._updatedRange=Ks({owner:this,equalsFn:T.equalsRange},e=>(this._modelVersion.read(e),this._textModel.getDecorationRange(this.decorationId)))}toInlineCompletion(e){return this.inlineCompletion.withRange(this._updatedRange.read(e)??yS)}toSingleTextEdit(e){return new wc(this._updatedRange.read(e)??yS,this.inlineCompletion.insertText)}isVisible(e,t,n){let r=rS(this._toFilterTextReplacement(n),e),i=this._updatedRange.read(n);if(!i||!this.inlineCompletion.range.getStartPosition().equals(i.getStartPosition())||t.lineNumber!==r.range.startLineNumber)return!1;let a=e.getValueInRange(r.range,1),o=r.text,s=Math.max(0,t.column-r.range.startColumn),c=o.substring(0,s),l=o.substring(s),u=a.substring(0,s),d=a.substring(s),f=e.getLineIndentColumn(r.range.startLineNumber);return r.range.startColumn<=f&&(u=u.trimStart(),u.length===0&&(d=d.trimStart()),c=c.trimStart(),c.length===0&&(l=l.trimStart())),c.startsWith(u)&&!!ns(d,l)}canBeReused(e,t){let n=this._updatedRange.read(void 0);return!!n&&n.containsPosition(t)&&this.isVisible(e,t,void 0)&&ss.ofRange(n).isGreaterThanOrEqualTo(ss.ofRange(this.inlineCompletion.range))}_toFilterTextReplacement(e){return new wc(this._updatedRange.read(e)??yS,this.inlineCompletion.filterText)}},yS=new T(1,1,1,1);const $={Visible:Uv,HasFocusedSuggestion:new G(`suggestWidgetHasFocusedSuggestion`,!1,S(`suggestWidgetHasSelection`,`Whether any suggestion is focused`)),DetailsVisible:new G(`suggestWidgetDetailsVisible`,!1,S(`suggestWidgetDetailsVisible`,`Whether suggestion details are visible`)),MultipleSuggestions:new G(`suggestWidgetMultipleSuggestions`,!1,S(`suggestWidgetMultipleSuggestions`,`Whether there are multiple suggestions to pick from`)),MakesTextEdit:new G(`suggestionMakesTextEdit`,!0,S(`suggestionMakesTextEdit`,`Whether inserting the current suggestion yields in a change or has everything already been typed`)),AcceptSuggestionsOnEnter:new G(`acceptSuggestionOnEnter`,!0,S(`acceptSuggestionOnEnter`,`Whether suggestions are inserted when pressing Enter`)),HasInsertAndReplaceRange:new G(`suggestionHasInsertAndReplaceRange`,!1,S(`suggestionHasInsertAndReplaceRange`,`Whether the current suggestion has insert and replace behaviour`)),InsertMode:new G(`suggestionInsertMode`,void 0,{type:`string`,description:S(`suggestionInsertMode`,`Whether the default behaviour is to insert or replace`)}),CanResolve:new G(`suggestionCanResolve`,!1,S(`suggestionCanResolve`,`Whether the current suggestion supports to resolve further details`))},bS=new R(`suggestWidgetStatusBar`);var xS=class{constructor(e,t,n,i){this.position=e,this.completion=t,this.container=n,this.provider=i,this.isInvalid=!1,this.score=Ts.Default,this.distance=0,this.textLabel=typeof t.label==`string`?t.label:t.label?.label,this.labelLow=this.textLabel.toLowerCase(),this.isInvalid=!this.textLabel,this.sortTextLow=t.sortText&&t.sortText.toLowerCase(),this.filterTextLow=t.filterText&&t.filterText.toLowerCase(),this.extensionId=t.extensionId,T.isIRange(t.range)?(this.editStart=new r(t.range.startLineNumber,t.range.startColumn),this.editInsertEnd=new r(t.range.endLineNumber,t.range.endColumn),this.editReplaceEnd=new r(t.range.endLineNumber,t.range.endColumn),this.isInvalid=this.isInvalid||T.spansMultipleLines(t.range)||t.range.startLineNumber!==e.lineNumber):(this.editStart=new r(t.range.insert.startLineNumber,t.range.insert.startColumn),this.editInsertEnd=new r(t.range.insert.endLineNumber,t.range.insert.endColumn),this.editReplaceEnd=new r(t.range.replace.endLineNumber,t.range.replace.endColumn),this.isInvalid=this.isInvalid||T.spansMultipleLines(t.range.insert)||T.spansMultipleLines(t.range.replace)||t.range.insert.startLineNumber!==e.lineNumber||t.range.replace.startLineNumber!==e.lineNumber||t.range.insert.startColumn!==t.range.replace.startColumn),typeof i.resolveCompletionItem!=`function`&&(this._resolveCache=Promise.resolve(),this._resolveDuration=0)}get isResolved(){return this._resolveDuration!==void 0}get resolveDuration(){return this._resolveDuration===void 0?-1:this._resolveDuration}async resolve(e){if(!this._resolveCache){let t=e.onCancellationRequested(()=>{this._resolveCache=void 0,this._resolveDuration=void 0}),n=new u(!0);this._resolveCache=Promise.resolve(this.provider.resolveCompletionItem(this.completion,e)).then(e=>{Object.assign(this.completion,e),this._resolveDuration=n.elapsed()},e=>{pe(e)&&(this._resolveCache=void 0,this._resolveDuration=void 0)}).finally(()=>{t.dispose()})}return this._resolveCache}},SS=class e{static#e=this.default=new e;constructor(e=2,t=new Set,n=new Set,r=new Map,i=!0){this.snippetSortOrder=e,this.kindFilter=t,this.providerFilter=n,this.providerItemsToReuse=r,this.showDeprecated=i}},CS;function wS(){return CS}var TS=class{constructor(e,t,n,r){this.items=e,this.needsClipboard=t,this.durations=n,this.disposable=r}};async function ES(e,t,r,i=SS.default,a={triggerKind:0},o=w.None){let s=new u;r=r.clone();let c=t.getWordAtPosition(r),l=c?new T(r.lineNumber,c.startColumn,r.lineNumber,c.endColumn):T.fromPositions(r),f={replace:l,insert:l.setEndPosition(r.lineNumber,r.column)},p=[],m=new n,h=[],g=!1,ee=(e,t,n)=>{let a=!1;if(!t)return a;for(let n of t.suggestions)if(!i.kindFilter.has(n.kind)){if(!i.showDeprecated&&n?.tags?.includes(1))continue;n.range||=f,n.sortText||=typeof n.label==`string`?n.label:n.label.label,!g&&n.insertTextRules&&n.insertTextRules&4&&(g=dd.guessNeedsClipboard(n.insertText)),p.push(new xS(r,n,t,e)),a=!0}return d(t)&&m.add(t),h.push({providerName:e._debugDisplayName??`unknown_provider`,elapsedProvider:t.duration??-1,elapsedOverall:n.elapsed()}),a},te=(async()=>{})();for(let n of e.orderedGroups(t)){let e=!1;if(await Promise.all(n.map(async n=>{if(i.providerItemsToReuse.has(n)){let t=i.providerItemsToReuse.get(n);t.forEach(e=>p.push(e)),e||=t.length>0;return}if(!(i.providerFilter.size>0&&!i.providerFilter.has(n)))try{let i=new u;e=ee(n,await n.provideCompletionItems(t,r,a,o),i)||e}catch(e){Re(e)}})),e||o.isCancellationRequested)break}return await te,o.isCancellationRequested?(m.dispose(),Promise.reject(new ge)):new TS(p.sort(jS(i.snippetSortOrder)),g,{entries:h,elapsed:s.elapsed()},m)}function DS(e,t){if(e.sortTextLow&&t.sortTextLow){if(e.sortTextLow<t.sortTextLow)return-1;if(e.sortTextLow>t.sortTextLow)return 1}return e.textLabel<t.textLabel?-1:e.textLabel>t.textLabel?1:e.completion.kind-t.completion.kind}function OS(e,t){if(e.completion.kind!==t.completion.kind){if(e.completion.kind===27)return-1;if(t.completion.kind===27)return 1}return DS(e,t)}function kS(e,t){if(e.completion.kind!==t.completion.kind){if(e.completion.kind===27)return 1;if(t.completion.kind===27)return-1}return DS(e,t)}var AS=new Map;AS.set(0,OS),AS.set(2,kS),AS.set(1,DS);function jS(e){return AS.get(e)}B.registerCommand(`_executeCompletionItemProvider`,async(e,...t)=>{let[n,i,a,s]=t;o(y.isUri(n)),o(r.isIPosition(i)),o(typeof a==`string`||!a),o(typeof s==`number`||!s);let{completionProvider:c}=e.get(V),l=await e.get(Bs).createModelReference(n);try{let e={incomplete:!1,suggestions:[]},t=[],n=l.object.textEditorModel.validatePosition(i),r=await ES(c,l.object.textEditorModel,n,void 0,{triggerCharacter:a??void 0,triggerKind:a?1:0});for(let n of r.items)t.length<(s??0)&&t.push(n.resolve(w.None)),e.incomplete=e.incomplete||n.container.incomplete,e.suggestions.push(n.completion);try{return await Promise.all(t),e}finally{setTimeout(()=>r.disposable.dispose(),100)}}finally{l.dispose()}});function MS(e,t){e.getContribution(`editor.contrib.suggestController`)?.triggerSuggest(new Set().add(t),void 0,!0)}var NS=class{static isAllOff(e){return e.other===`off`&&e.comments===`off`&&e.strings===`off`}static isAllOn(e){return e.other===`on`&&e.comments===`on`&&e.strings===`on`}static valueFor(e,t){switch(t){case 1:return e.comments;case 2:return e.strings;default:return e.other}}};function PS(e,t=_e){return lo(e,t)?e.charAt(0).toUpperCase()+e.slice(1):e}var FS=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},IS=function(e,t){return function(n,r){t(n,r,e)}};Object.freeze({CURRENT_YEAR:!0,CURRENT_YEAR_SHORT:!0,CURRENT_MONTH:!0,CURRENT_DATE:!0,CURRENT_HOUR:!0,CURRENT_MINUTE:!0,CURRENT_SECOND:!0,CURRENT_DAY_NAME:!0,CURRENT_DAY_NAME_SHORT:!0,CURRENT_MONTH_NAME:!0,CURRENT_MONTH_NAME_SHORT:!0,CURRENT_SECONDS_UNIX:!0,CURRENT_TIMEZONE_OFFSET:!0,SELECTION:!0,CLIPBOARD:!0,TM_SELECTED_TEXT:!0,TM_CURRENT_LINE:!0,TM_CURRENT_WORD:!0,TM_LINE_INDEX:!0,TM_LINE_NUMBER:!0,TM_FILENAME:!0,TM_FILENAME_BASE:!0,TM_DIRECTORY:!0,TM_FILEPATH:!0,CURSOR_INDEX:!0,CURSOR_NUMBER:!0,RELATIVE_FILEPATH:!0,BLOCK_COMMENT_START:!0,BLOCK_COMMENT_END:!0,LINE_COMMENT:!0,WORKSPACE_NAME:!0,WORKSPACE_FOLDER:!0,RANDOM:!0,RANDOM_HEX:!0,UUID:!0});var LS=class{constructor(e){this._delegates=e}resolve(e){for(let t of this._delegates){let n=t.resolve(e);if(n!==void 0)return n}}},RS=class{constructor(e,t,n,r){this._model=e,this._selection=t,this._selectionIdx=n,this._overtypingCapturer=r}resolve(e){let{name:t}=e;if(t===`SELECTION`||t===`TM_SELECTED_TEXT`){let t=this._model.getValueInRange(this._selection)||void 0,n=this._selection.startLineNumber!==this._selection.endLineNumber;if(!t&&this._overtypingCapturer){let e=this._overtypingCapturer.getLastOvertypedInfo(this._selectionIdx);e&&(t=e.value,n=e.multiline)}if(t&&n&&e.snippet){let n=Gt(this._model.getLineContent(this._selection.startLineNumber),0,this._selection.startColumn-1),r=n;e.snippet.walk(t=>t===e?!1:(t instanceof nd&&(r=Gt(Vr(t.value).pop())),!0));let i=ct(r,n);t=t.replace(/(\r\n|\r|\n)(.*)/g,(e,t,n)=>`${t}${r.substr(i)}${n}`)}return t}else if(t===`TM_CURRENT_LINE`)return this._model.getLineContent(this._selection.positionLineNumber);else if(t===`TM_CURRENT_WORD`){let e=this._model.getWordAtPosition({lineNumber:this._selection.positionLineNumber,column:this._selection.positionColumn});return e&&e.word||void 0}else if(t===`TM_LINE_INDEX`)return String(this._selection.positionLineNumber-1);else if(t===`TM_LINE_NUMBER`)return String(this._selection.positionLineNumber);else if(t===`CURSOR_INDEX`)return String(this._selectionIdx);else if(t===`CURSOR_NUMBER`)return String(this._selectionIdx+1)}},zS=class{constructor(e,t){this._labelService=e,this._model=t}resolve(e){let{name:t}=e;if(t===`TM_FILENAME`)return se(this._model.uri.fsPath);if(t===`TM_FILENAME_BASE`){let e=se(this._model.uri.fsPath),t=e.lastIndexOf(`.`);return t<=0?e:e.slice(0,t)}else if(t===`TM_DIRECTORY`)return le(this._model.uri.fsPath)===`.`?``:this._labelService.getUriLabel(Us(this._model.uri));else if(t===`TM_FILEPATH`)return this._labelService.getUriLabel(this._model.uri);else if(t===`RELATIVE_FILEPATH`)return this._labelService.getUriLabel(this._model.uri,{relative:!0,noPrefix:!0})}},BS=class{constructor(e,t,n,r){this._readClipboardText=e,this._selectionIdx=t,this._selectionCount=n,this._spread=r}resolve(e){if(e.name!==`CLIPBOARD`)return;let t=this._readClipboardText();if(t){if(this._spread){let e=t.split(/\r\n|\n|\r/).filter(e=>!Dn(e));if(e.length===this._selectionCount)return e[this._selectionIdx]}return t}}},VS=class{constructor(e,t,n){this._model=e,this._selection=t,this._languageConfigurationService=n}resolve(e){let{name:t}=e,n=this._model.getLanguageIdAtPosition(this._selection.selectionStartLineNumber,this._selection.selectionStartColumn),r=this._languageConfigurationService.getLanguageConfiguration(n).comments;if(r){if(t===`LINE_COMMENT`)return r.lineCommentToken||void 0;if(t===`BLOCK_COMMENT_START`)return r.blockCommentStartToken||void 0;if(t===`BLOCK_COMMENT_END`)return r.blockCommentEndToken||void 0}}};VS=FS([IS(2,Ci)],VS);var HS=class e{constructor(){this._date=new Date}static#e=this.dayNames=[S(`Sunday`,`Sunday`),S(`Monday`,`Monday`),S(`Tuesday`,`Tuesday`),S(`Wednesday`,`Wednesday`),S(`Thursday`,`Thursday`),S(`Friday`,`Friday`),S(`Saturday`,`Saturday`)];static#t=this.dayNamesShort=[S(`SundayShort`,`Sun`),S(`MondayShort`,`Mon`),S(`TuesdayShort`,`Tue`),S(`WednesdayShort`,`Wed`),S(`ThursdayShort`,`Thu`),S(`FridayShort`,`Fri`),S(`SaturdayShort`,`Sat`)];static#n=this.monthNames=[S(`January`,`January`),S(`February`,`February`),S(`March`,`March`),S(`April`,`April`),S(`May`,`May`),S(`June`,`June`),S(`July`,`July`),S(`August`,`August`),S(`September`,`September`),S(`October`,`October`),S(`November`,`November`),S(`December`,`December`)];static#r=this.monthNamesShort=[S(`JanuaryShort`,`Jan`),S(`FebruaryShort`,`Feb`),S(`MarchShort`,`Mar`),S(`AprilShort`,`Apr`),S(`MayShort`,`May`),S(`JuneShort`,`Jun`),S(`JulyShort`,`Jul`),S(`AugustShort`,`Aug`),S(`SeptemberShort`,`Sep`),S(`OctoberShort`,`Oct`),S(`NovemberShort`,`Nov`),S(`DecemberShort`,`Dec`)];resolve(t){let{name:n}=t;if(n===`CURRENT_YEAR`)return String(this._date.getFullYear());if(n===`CURRENT_YEAR_SHORT`)return String(this._date.getFullYear()).slice(-2);if(n===`CURRENT_MONTH`)return String(this._date.getMonth().valueOf()+1).padStart(2,`0`);if(n===`CURRENT_DATE`)return String(this._date.getDate().valueOf()).padStart(2,`0`);if(n===`CURRENT_HOUR`)return String(this._date.getHours().valueOf()).padStart(2,`0`);if(n===`CURRENT_MINUTE`)return String(this._date.getMinutes().valueOf()).padStart(2,`0`);if(n===`CURRENT_SECOND`)return String(this._date.getSeconds().valueOf()).padStart(2,`0`);if(n===`CURRENT_DAY_NAME`)return e.dayNames[this._date.getDay()];if(n===`CURRENT_DAY_NAME_SHORT`)return e.dayNamesShort[this._date.getDay()];if(n===`CURRENT_MONTH_NAME`)return e.monthNames[this._date.getMonth()];if(n===`CURRENT_MONTH_NAME_SHORT`)return e.monthNamesShort[this._date.getMonth()];if(n===`CURRENT_SECONDS_UNIX`)return String(Math.floor(this._date.getTime()/1e3));if(n===`CURRENT_TIMEZONE_OFFSET`){let e=this._date.getTimezoneOffset(),t=e>0?`-`:`+`,n=Math.trunc(Math.abs(e/60)),r=n<10?`0`+n:n,i=Math.abs(e)-n*60,a=i<10?`0`+i:i;return t+r+`:`+a}}},US=class{constructor(e){this._workspaceService=e}resolve(e){if(!this._workspaceService)return;let t=ka(this._workspaceService.getWorkspace());if(!oo(t)){if(e.name===`WORKSPACE_NAME`)return this._resolveWorkspaceName(t);if(e.name===`WORKSPACE_FOLDER`)return this._resoveWorkspacePath(t)}}_resolveWorkspaceName(e){if(Ei(e))return se(e.uri.path);let t=se(e.configPath.path);return t.endsWith(`code-workspace`)&&(t=t.substr(0,t.length-gl.length-1)),t}_resoveWorkspacePath(e){if(Ei(e))return PS(e.uri.fsPath);let t=se(e.configPath.path),n=e.configPath.fsPath;return n.endsWith(t)&&(n=n.substr(0,n.length-t.length-1)),n?PS(n):`/`}},WS=class{resolve(e){let{name:t}=e;if(t===`RANDOM`)return Math.random().toString().slice(-6);if(t===`RANDOM_HEX`)return Math.random().toString(16).slice(-6);if(t===`UUID`)return ku()}},GS=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},KS=function(e,t){return function(n,r){t(n,r,e)}},qS,JS=class e{static#e=this._decor={active:U.register({description:`snippet-placeholder-1`,stickiness:0,className:`snippet-placeholder`}),inactive:U.register({description:`snippet-placeholder-2`,stickiness:1,className:`snippet-placeholder`}),activeFinal:U.register({description:`snippet-placeholder-3`,stickiness:1,className:`finish-snippet-placeholder`}),inactiveFinal:U.register({description:`snippet-placeholder-4`,stickiness:1,className:`finish-snippet-placeholder`})};constructor(e,t,n){this._editor=e,this._snippet=t,this._snippetLineLeadingWhitespace=n,this._offset=-1,this._nestingLevel=1,this._placeholderGroups=wr(t.placeholders,id.compareByIndex),this._placeholderGroupsIdx=-1}initialize(e){this._offset=e.newPosition}dispose(){this._placeholderDecorations&&this._editor.removeDecorations([...this._placeholderDecorations.values()]),this._placeholderGroups.length=0}_initDecorations(){if(this._offset===-1)throw Error(`Snippet not initialized!`);if(this._placeholderDecorations)return;this._placeholderDecorations=new Map;let t=this._editor.getModel();this._editor.changeDecorations(n=>{for(let r of this._snippet.placeholders){let i=this._snippet.offset(r),a=this._snippet.fullLen(r),o=T.fromPositions(t.getPositionAt(this._offset+i),t.getPositionAt(this._offset+i+a)),s=r.isFinalTabstop?e._decor.inactiveFinal:e._decor.inactive,c=n.addDecoration(o,s);this._placeholderDecorations.set(r,c)}})}move(t){if(!this._editor.hasModel())return[];if(this._initDecorations(),this._placeholderGroupsIdx>=0){let e=[];for(let t of this._placeholderGroups[this._placeholderGroupsIdx])if(t.transform){let n=this._placeholderDecorations.get(t),r=this._editor.getModel().getDecorationRange(n),i=this._editor.getModel().getValueInRange(r),a=t.transform.resolve(i).split(/\r\n|\r|\n/);for(let e=1;e<a.length;e++)a[e]=this._editor.getModel().normalizeIndentation(this._snippetLineLeadingWhitespace+a[e]);e.push(Fa.replace(r,a.join(this._editor.getModel().getEOL())))}e.length>0&&this._editor.executeEdits(`snippet.placeholderTransform`,e)}let n=!1;t===!0&&this._placeholderGroupsIdx<this._placeholderGroups.length-1?(this._placeholderGroupsIdx+=1,n=!0):t===!1&&this._placeholderGroupsIdx>0&&(--this._placeholderGroupsIdx,n=!0);let r=this._editor.getModel().changeDecorations(t=>{let r=new Set,i=[];for(let a of this._placeholderGroups[this._placeholderGroupsIdx]){let o=this._placeholderDecorations.get(a),s=this._editor.getModel().getDecorationRange(o);i.push(new v(s.startLineNumber,s.startColumn,s.endLineNumber,s.endColumn)),n&&=this._hasPlaceholderBeenCollapsed(a),t.changeDecorationOptions(o,a.isFinalTabstop?e._decor.activeFinal:e._decor.active),r.add(a);for(let n of this._snippet.enclosingPlaceholders(a)){let i=this._placeholderDecorations.get(n);t.changeDecorationOptions(i,n.isFinalTabstop?e._decor.activeFinal:e._decor.active),r.add(n)}}for(let[n,i]of this._placeholderDecorations)r.has(n)||t.changeDecorationOptions(i,n.isFinalTabstop?e._decor.inactiveFinal:e._decor.inactive);return i});return n?this.move(t):r??[]}_hasPlaceholderBeenCollapsed(e){let t=e;for(;t;){if(t instanceof id){let e=this._placeholderDecorations.get(t);if(this._editor.getModel().getDecorationRange(e).isEmpty()&&t.toString().length>0)return!0}t=t.parent}return!1}get isAtFirstPlaceholder(){return this._placeholderGroupsIdx<=0||this._placeholderGroups.length===0}get isAtLastPlaceholder(){return this._placeholderGroupsIdx===this._placeholderGroups.length-1}get hasPlaceholder(){return this._snippet.placeholders.length>0}get isTrivialSnippet(){if(this._snippet.placeholders.length===0)return!0;if(this._snippet.placeholders.length===1){let[e]=this._snippet.placeholders;if(e.isFinalTabstop&&this._snippet.rightMostDescendant===e)return!0}return!1}computePossibleSelections(){let e=new Map;for(let t of this._placeholderGroups){let n;for(let r of t){if(r.isFinalTabstop)break;n||(n=[],e.set(r.index,n));let t=this._placeholderDecorations.get(r),i=this._editor.getModel().getDecorationRange(t);if(!i){e.delete(r.index);break}n.push(i)}}return e}get activeChoice(){if(!this._placeholderDecorations)return;let e=this._placeholderGroups[this._placeholderGroupsIdx][0];if(!e?.choice)return;let t=this._placeholderDecorations.get(e);if(!t)return;let n=this._editor.getModel().getDecorationRange(t);if(n)return{range:n,choice:e.choice}}get hasChoice(){let e=!1;return this._snippet.walk(t=>(e=t instanceof ad,!e)),e}merge(t){let n=this._editor.getModel();this._nestingLevel*=10,this._editor.changeDecorations(r=>{for(let i of this._placeholderGroups[this._placeholderGroupsIdx]){let a=t.shift();console.assert(a._offset!==-1),console.assert(!a._placeholderDecorations);let o=a._snippet.placeholderInfo.last.index;for(let e of a._snippet.placeholderInfo.all)e.isFinalTabstop?e.index=i.index+(o+1)/this._nestingLevel:e.index=i.index+e.index/this._nestingLevel;this._snippet.replace(i,a._snippet.children);let s=this._placeholderDecorations.get(i);r.removeDecoration(s),this._placeholderDecorations.delete(i);for(let t of a._snippet.placeholders){let i=a._snippet.offset(t),o=a._snippet.fullLen(t),s=T.fromPositions(n.getPositionAt(a._offset+i),n.getPositionAt(a._offset+i+o)),c=r.addDecoration(s,e._decor.inactive);this._placeholderDecorations.set(t,c)}}this._placeholderGroups=wr(this._snippet.placeholders,id.compareByIndex)})}},YS={overwriteBefore:0,overwriteAfter:0,adjustWhitespace:!0,clipboardText:void 0,overtypingCapturer:void 0},XS=qS=class{static adjustWhitespace(e,t,n,r,i){let a=Gt(e.getLineContent(t.lineNumber),0,t.column-1),o;return r.walk(t=>{if(!(t instanceof nd)||t.parent instanceof ad||i&&!i.has(t))return!0;let s=t.value.split(/\r\n|\r|\n/);if(n){let n=r.offset(t);if(n===0)s[0]=e.normalizeIndentation(s[0]);else{o??=r.toString();let t=o.charCodeAt(n-1);(t===10||t===13)&&(s[0]=e.normalizeIndentation(a+s[0]))}for(let t=1;t<s.length;t++)s[t]=e.normalizeIndentation(a+s[t])}let c=s.join(e.getEOL());return c!==t.value&&(t.parent.replace(t,[new nd(c)]),o=void 0),!0}),a}static adjustSelection(e,t,n,r){if(n!==0||r!==0){let{positionLineNumber:i,positionColumn:a}=t,o=a-n,s=a+r,c=e.validateRange({startLineNumber:i,startColumn:o,endLineNumber:i,endColumn:s});t=v.createWithDirection(c.startLineNumber,c.startColumn,c.endLineNumber,c.endColumn,t.getDirection())}return t}static createEditsAndSnippetsFromSelections(e,t,n,r,i,a,o,s,c){let l=[],u=[];if(!e.hasModel())return{edits:l,snippets:u};let d=e.getModel(),f=e.invokeWithinContext(e=>e.get(mi)),p=e.invokeWithinContext(e=>new zS(e.get(Ca),d)),m=()=>o,h=d.getValueInRange(qS.adjustSelection(d,e.getSelection(),n,0)),g=d.getValueInRange(qS.adjustSelection(d,e.getSelection(),0,r)),ee=d.getLineFirstNonWhitespaceColumn(e.getSelection().positionLineNumber),te=e.getSelections().map((e,t)=>({selection:e,idx:t})).sort((e,t)=>T.compareRangesUsingStarts(e.selection,t.selection));for(let{selection:o,idx:_}of te){let v=qS.adjustSelection(d,o,n,0),ne=qS.adjustSelection(d,o,0,r);h!==d.getValueInRange(v)&&(v=o),g!==d.getValueInRange(ne)&&(ne=o);let re=o.setStartPosition(v.startLineNumber,v.startColumn).setEndPosition(ne.endLineNumber,ne.endColumn),ie=new dd().parse(t,!0,i),ae=re.getStartPosition(),oe=qS.adjustWhitespace(d,ae,a||_>0&&ee!==d.getLineFirstNonWhitespaceColumn(o.positionLineNumber),ie);ie.resolveVariables(new LS([p,new BS(m,_,te.length,e.getOption(79)===`spread`),new RS(d,o,_,s),new VS(d,o,c),new HS,new US(f),new WS])),l[_]=Fa.replace(re,ie.toString()),l[_].identifier={major:_,minor:0},l[_]._isTracked=!0,u[_]=new JS(e,ie,oe)}return{edits:l,snippets:u}}static createEditsAndSnippetsFromEdits(e,t,n,r,i,a,o){if(!e.hasModel()||t.length===0)return{edits:[],snippets:[]};let s=[],c=e.getModel(),l=new dd,u=new ud,d=new LS([e.invokeWithinContext(e=>new zS(e.get(Ca),c)),new BS(()=>i,0,e.getSelections().length,e.getOption(79)===`spread`),new RS(c,e.getSelection(),0,a),new VS(c,e.getSelection(),o),new HS,new US(e.invokeWithinContext(e=>e.get(mi))),new WS]);t=t.sort((e,t)=>T.compareRangesUsingStarts(e.range,t.range));let f=0;for(let e=0;e<t.length;e++){let{range:n,template:r}=t[e];if(e>0){let r=t[e-1].range,i=T.fromPositions(r.getEndPosition(),n.getStartPosition()),a=new nd(c.getValueInRange(i));u.appendChild(a),f+=a.value.length}let i=l.parseFragment(r,u);qS.adjustWhitespace(c,n.getStartPosition(),!0,u,new Set(i)),u.resolveVariables(d);let a=u.toString(),o=a.slice(f);f=a.length;let p=Fa.replace(n,o);p.identifier={major:e,minor:0},p._isTracked=!0,s.push(p)}return l.ensureFinalTabstop(u,n,!0),{edits:s,snippets:[new JS(e,u,``)]}}constructor(e,t,n=YS,r){this._editor=e,this._template=t,this._options=n,this._languageConfigurationService=r,this._templateMerges=[],this._snippets=[]}dispose(){c(this._snippets)}_logInfo(){return`template="${this._template}", merged_templates="${this._templateMerges.join(` -> `)}"`}insert(){if(!this._editor.hasModel())return;let{edits:e,snippets:t}=typeof this._template==`string`?qS.createEditsAndSnippetsFromSelections(this._editor,this._template,this._options.overwriteBefore,this._options.overwriteAfter,!1,this._options.adjustWhitespace,this._options.clipboardText,this._options.overtypingCapturer,this._languageConfigurationService):qS.createEditsAndSnippetsFromEdits(this._editor,this._template,!1,this._options.adjustWhitespace,this._options.clipboardText,this._options.overtypingCapturer,this._languageConfigurationService);this._snippets=t,this._editor.executeEdits(`snippet`,e,e=>{let n=e.filter(e=>!!e.identifier);for(let e=0;e<t.length;e++)t[e].initialize(n[e].textChange);return this._snippets[0].hasPlaceholder?this._move(!0):n.map(e=>v.fromPositions(e.range.getEndPosition()))}),this._editor.revealRange(this._editor.getSelections()[0])}merge(e,t=YS){if(!this._editor.hasModel())return;this._templateMerges.push([this._snippets[0]._nestingLevel,this._snippets[0]._placeholderGroupsIdx,e]);let{edits:n,snippets:r}=qS.createEditsAndSnippetsFromSelections(this._editor,e,t.overwriteBefore,t.overwriteAfter,!0,t.adjustWhitespace,t.clipboardText,t.overtypingCapturer,this._languageConfigurationService);this._editor.executeEdits(`snippet`,n,e=>{let t=e.filter(e=>!!e.identifier);for(let e=0;e<r.length;e++)r[e].initialize(t[e].textChange);let n=r[0].isTrivialSnippet;if(!n){for(let e of this._snippets)e.merge(r);console.assert(r.length===0)}return this._snippets[0].hasPlaceholder&&!n?this._move(void 0):t.map(e=>v.fromPositions(e.range.getEndPosition()))})}next(){let e=this._move(!0);this._editor.setSelections(e),this._editor.revealPositionInCenterIfOutsideViewport(e[0].getPosition())}prev(){let e=this._move(!1);this._editor.setSelections(e),this._editor.revealPositionInCenterIfOutsideViewport(e[0].getPosition())}_move(e){let t=[];for(let n of this._snippets){let r=n.move(e);t.push(...r)}return t}get isAtFirstPlaceholder(){return this._snippets[0].isAtFirstPlaceholder}get isAtLastPlaceholder(){return this._snippets[0].isAtLastPlaceholder}get hasPlaceholder(){return this._snippets[0].hasPlaceholder}get hasChoice(){return this._snippets[0].hasChoice}get activeChoice(){return this._snippets[0].activeChoice}isSelectionWithinPlaceholders(){if(!this.hasPlaceholder)return!1;let e=this._editor.getSelections();if(e.length<this._snippets.length)return!1;let t=new Map;for(let n of this._snippets){let r=n.computePossibleSelections();if(t.size===0)for(let[n,i]of r){i.sort(T.compareRangesUsingStarts);for(let r of e)if(i[0].containsRange(r)){t.set(n,[]);break}}if(t.size===0)return!1;t.forEach((e,t)=>{e.push(...r.get(t))})}e.sort(T.compareRangesUsingStarts);for(let[n,r]of t){if(r.length!==e.length){t.delete(n);continue}r.sort(T.compareRangesUsingStarts);for(let i=0;i<r.length;i++)if(!r[i].containsRange(e[i])){t.delete(n);continue}}return t.size>0}};XS=qS=GS([KS(3,Ci)],XS);var ZS=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},QS=function(e,t){return function(n,r){t(n,r,e)}},$S,eC={overwriteBefore:0,overwriteAfter:0,undoStopBefore:!0,undoStopAfter:!0,adjustWhitespace:!0,clipboardText:void 0,overtypingCapturer:void 0},tC=class{static#e=$S=this;static#t=this.ID=`snippetController2`;static get(e){return e.getContribution($S.ID)}static#n=this.InSnippetMode=new G(`inSnippetMode`,!1,S(`inSnippetMode`,`Whether the editor in current in snippet mode`));static#r=this.HasNextTabstop=new G(`hasNextTabstop`,!1,S(`hasNextTabstop`,`Whether there is a next tab stop when in snippet mode`));static#i=this.HasPrevTabstop=new G(`hasPrevTabstop`,!1,S(`hasPrevTabstop`,`Whether there is a previous tab stop when in snippet mode`));constructor(e,t,r,i,a){this._editor=e,this._logService=t,this._languageFeaturesService=r,this._languageConfigurationService=a,this._snippetListener=new n,this._modelVersionId=-1,this._inSnippet=$S.InSnippetMode.bindTo(i),this._hasNextTabstop=$S.HasNextTabstop.bindTo(i),this._hasPrevTabstop=$S.HasPrevTabstop.bindTo(i)}dispose(){this._inSnippet.reset(),this._hasPrevTabstop.reset(),this._hasNextTabstop.reset(),this._session?.dispose(),this._snippetListener.dispose()}insert(e,t){try{this._doInsert(e,t===void 0?eC:{...eC,...t})}catch(t){this.cancel(),this._logService.error(t),this._logService.error(`snippet_error`),this._logService.error(`insert_template=`,e),this._logService.error(`existing_template=`,this._session?this._session._logInfo():`<no_session>`)}}_doInsert(e,t){if(this._editor.hasModel()){if(this._snippetListener.clear(),t.undoStopBefore&&this._editor.getModel().pushStackElement(),this._session&&typeof e!=`string`&&this.cancel(),this._session?(o(typeof e==`string`),this._session.merge(e,t)):(this._modelVersionId=this._editor.getModel().getAlternativeVersionId(),this._session=new XS(this._editor,e,t,this._languageConfigurationService),this._session.insert()),t.undoStopAfter&&this._editor.getModel().pushStackElement(),this._session?.hasChoice){let e={_debugDisplayName:`snippetChoiceCompletions`,provideCompletionItems:(e,t)=>{if(!this._session||e!==this._editor.getModel()||!r.equals(this._editor.getPosition(),t))return;let{activeChoice:n}=this._session;if(!n||n.choice.options.length===0)return;let i=e.getValueInRange(n.range),a=!!n.choice.options.find(e=>e.value===i),o=[];for(let e=0;e<n.choice.options.length;e++){let t=n.choice.options[e];o.push({kind:13,label:t.value,insertText:t.value,sortText:`a`.repeat(e+1),range:n.range,filterText:a?`${i}_${t.value}`:void 0,command:{id:`jumpToNextSnippetPlaceholder`,title:S(`next`,`Go to next placeholder...`)}})}return{suggestions:o}}},t=this._editor.getModel(),n,i=!1;this._choiceCompletions={provider:e,enable:()=>{i||=(n=this._languageFeaturesService.completionProvider.register({language:t.getLanguageId(),pattern:t.uri.fsPath,scheme:t.uri.scheme,exclusive:!0},e),this._snippetListener.add(n),!0)},disable:()=>{n?.dispose(),i=!1}}}this._updateState(),this._snippetListener.add(this._editor.onDidChangeModelContent(e=>e.isFlush&&this.cancel())),this._snippetListener.add(this._editor.onDidChangeModel(()=>this.cancel())),this._snippetListener.add(this._editor.onDidChangeCursorSelection(()=>this._updateState()))}}_updateState(){if(!(!this._session||!this._editor.hasModel())){if(this._modelVersionId===this._editor.getModel().getAlternativeVersionId()||!this._session.hasPlaceholder)return this.cancel();if(this._session.isAtLastPlaceholder||!this._session.isSelectionWithinPlaceholders())return this._editor.getModel().pushStackElement(),this.cancel();this._inSnippet.set(!0),this._hasPrevTabstop.set(!this._session.isAtFirstPlaceholder),this._hasNextTabstop.set(!this._session.isAtLastPlaceholder),this._handleChoice()}}_handleChoice(){if(!this._session||!this._editor.hasModel()){this._currentChoice=void 0;return}let{activeChoice:e}=this._session;if(!e||!this._choiceCompletions){this._choiceCompletions?.disable(),this._currentChoice=void 0;return}this._currentChoice!==e.choice&&(this._currentChoice=e.choice,this._choiceCompletions.enable(),queueMicrotask(()=>{MS(this._editor,this._choiceCompletions.provider)}))}finish(){for(;this._inSnippet.get();)this.next()}cancel(e=!1){this._inSnippet.reset(),this._hasPrevTabstop.reset(),this._hasNextTabstop.reset(),this._snippetListener.clear(),this._currentChoice=void 0,this._session?.dispose(),this._session=void 0,this._modelVersionId=-1,e&&this._editor.setSelections([this._editor.getSelection()])}prev(){this._session?.prev(),this._updateState()}next(){this._session?.next(),this._updateState()}isInSnippet(){return!!this._inSnippet.get()}};tC=$S=ZS([QS(1,Fc),QS(2,V),QS(3,W),QS(4,Ci)],tC),I(tC.ID,tC,4);var nC=la.bindToContribution(tC.get);P(new nC({id:`jumpToNextSnippetPlaceholder`,precondition:z.and(tC.InSnippetMode,tC.HasNextTabstop),handler:e=>e.next(),kbOpts:{weight:130,kbExpr:q.textInputFocus,primary:2}})),P(new nC({id:`jumpToPrevSnippetPlaceholder`,precondition:z.and(tC.InSnippetMode,tC.HasPrevTabstop),handler:e=>e.prev(),kbOpts:{weight:130,kbExpr:q.textInputFocus,primary:1026}})),P(new nC({id:`leaveSnippet`,precondition:tC.InSnippetMode,handler:e=>e.cancel(!0),kbOpts:{weight:130,kbExpr:q.textInputFocus,primary:9,secondary:[1033]}})),P(new nC({id:`acceptSnippet`,precondition:tC.InSnippetMode,handler:e=>e.finish()}));var rC=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},iC=function(e,t){return function(n,r){t(n,r,e)}},aC=class extends _{get isAcceptingPartially(){return this._isAcceptingPartially}constructor(e,t,n,i,a,o,s,c,l,u,d,f){super(),this.textModel=e,this.selectedSuggestItem=t,this._textModelVersionId=n,this._positions=i,this._debounceValue=a,this._suggestPreviewEnabled=o,this._suggestPreviewMode=s,this._inlineSuggestMode=c,this._enabled=l,this._instantiationService=u,this._commandService=d,this._languageConfigurationService=f,this._source=this._register(this._instantiationService.createInstance(pS,this.textModel,this._textModelVersionId,this._debounceValue)),this._isActive=uc(this,!1),this._forceUpdateExplicitlySignal=Po(this),this._selectedInlineCompletionId=uc(this,void 0),this._primaryPosition=K(this,e=>this._positions.read(e)[0]??new r(1,1)),this._isAcceptingPartially=!1,this._preserveCurrentCompletionReasons=new Set([oC.Redo,oC.Undo,oC.AcceptWord]),this._fetchInlineCompletionsPromise=Wc({owner:this,createEmptyChangeSummary:()=>({preserveCurrentCompletion:!1,inlineCompletionTriggerKind:Oe.Automatic}),handleChange:(e,t)=>(e.didChange(this._textModelVersionId)&&this._preserveCurrentCompletionReasons.has(this._getReason(e.change))?t.preserveCurrentCompletion=!0:e.didChange(this._forceUpdateExplicitlySignal)&&(t.inlineCompletionTriggerKind=Oe.Explicit),!0)},(e,t)=>{if(this._forceUpdateExplicitlySignal.read(e),!(this._enabled.read(e)&&this.selectedSuggestItem.read(e)||this._isActive.read(e))){this._source.cancelUpdate();return}this._textModelVersionId.read(e);let n=this._source.suggestWidgetInlineCompletions.get(),r=this.selectedSuggestItem.read(e);if(n&&!r){let e=this._source.inlineCompletions.get();gs(t=>{(!e||n.request.versionId>e.request.versionId)&&this._source.inlineCompletions.set(n.clone(),t),this._source.clearSuggestWidgetInlineCompletions(t)})}let i=this._primaryPosition.read(e),a={triggerKind:t.inlineCompletionTriggerKind,selectedSuggestionInfo:r?.toSelectedSuggestionInfo()},o=this.selectedInlineCompletion.get(),s=t.preserveCurrentCompletion||o?.forwardStable?o:void 0;return this._source.fetch(i,a,s)}),this._filteredInlineCompletionItems=Ks({owner:this,equalsFn:_c()},e=>{let t=this._source.inlineCompletions.read(e);if(!t)return[];let n=this._primaryPosition.read(e);return t.inlineCompletions.filter(t=>t.isVisible(this.textModel,n,e))}),this.selectedInlineCompletionIndex=K(this,e=>{let t=this._selectedInlineCompletionId.read(e),n=this._filteredInlineCompletionItems.read(e),r=this._selectedInlineCompletionId===void 0?-1:n.findIndex(e=>e.semanticId===t);return r===-1?(this._selectedInlineCompletionId.set(void 0,void 0),0):r}),this.selectedInlineCompletion=K(this,e=>this._filteredInlineCompletionItems.read(e)[this.selectedInlineCompletionIndex.read(e)]),this.activeCommands=Ks({owner:this,equalsFn:_c()},e=>this.selectedInlineCompletion.read(e)?.inlineCompletion.source.inlineCompletions.commands??[]),this.lastTriggerKind=this._source.inlineCompletions.map(this,e=>e?.request.context.triggerKind),this.inlineCompletionsCount=K(this,e=>{if(this.lastTriggerKind.read(e)===Oe.Explicit)return this._filteredInlineCompletionItems.read(e).length}),this.state=Ks({owner:this,equalsFn:(e,t)=>!e||!t?e===t:Px(e.ghostTexts,t.ghostTexts)&&e.inlineCompletion===t.inlineCompletion&&e.suggestItem===t.suggestItem},e=>{let t=this.textModel,n=this.selectedSuggestItem.read(e);if(n){let r=rS(n.toSingleTextEdit(),t),i=this._computeAugmentation(r,e);if(!this._suggestPreviewEnabled.read(e)&&!i)return;let a=i?.edit??r,o=i?i.edit.text.length-r.text.length:0,s=this._suggestPreviewMode.read(e),c=this._positions.read(e),l=[a,...sC(this.textModel,c,a)],u=l.map((e,n)=>aS(e,t,s,c[n],o)).filter(ee);return{edits:l,primaryGhostText:u[0]??new jx(a.range.endLineNumber,[]),ghostTexts:u,inlineCompletion:i?.completion,suggestItem:n}}else{if(!this._isActive.read(e))return;let n=this.selectedInlineCompletion.read(e);if(!n)return;let r=n.toSingleTextEdit(e),i=this._inlineSuggestMode.read(e),a=this._positions.read(e),o=[r,...sC(this.textModel,a,r)],s=o.map((e,n)=>aS(e,t,i,a[n],0)).filter(ee);return s[0]?{edits:o,primaryGhostText:s[0],ghostTexts:s,inlineCompletion:n,suggestItem:void 0}:void 0}}),this.ghostTexts=Ks({owner:this,equalsFn:Px},e=>{let t=this.state.read(e);if(t)return t.ghostTexts}),this.primaryGhostText=Ks({owner:this,equalsFn:Fx},e=>{let t=this.state.read(e);if(t)return t?.primaryGhostText}),this._register(zo(this._fetchInlineCompletionsPromise));let p;this._register(Ba(e=>{let t=this.state.read(e)?.inlineCompletion;if(t?.semanticId!==p?.semanticId&&(p=t,t)){let e=t.inlineCompletion,n=e.source;n.provider.handleItemDidShow?.(n.inlineCompletions,e.sourceInlineCompletion,e.insertText)}}))}_getReason(e){return e?.isUndoing?oC.Undo:e?.isRedoing?oC.Redo:this.isAcceptingPartially?oC.AcceptWord:oC.Other}async trigger(e){this._isActive.set(!0,e),await this._fetchInlineCompletionsPromise.get()}async triggerExplicitly(e){il(e,e=>{this._isActive.set(!0,e),this._forceUpdateExplicitlySignal.trigger(e)}),await this._fetchInlineCompletionsPromise.get()}stop(e){il(e,e=>{this._isActive.set(!1,e),this._source.clear(e)})}_computeAugmentation(e,t){let n=this.textModel,r=this._source.suggestWidgetInlineCompletions.read(t);return Oc(r?r.inlineCompletions:[this.selectedInlineCompletion.read(t)].filter(ee),r=>{let i=r.toSingleTextEdit(t);return i=rS(i,n,T.fromPositions(i.range.getStartPosition(),e.range.getEndPosition())),iS(i,e)?{completion:r,edit:i}:void 0})}async _deltaSelectedInlineCompletionIndex(e){await this.triggerExplicitly();let t=this._filteredInlineCompletionItems.get()||[];if(t.length>0){let n=(this.selectedInlineCompletionIndex.get()+e+t.length)%t.length;this._selectedInlineCompletionId.set(t[n].semanticId,void 0)}else this._selectedInlineCompletionId.set(void 0,void 0)}async next(){await this._deltaSelectedInlineCompletionIndex(1)}async previous(){await this._deltaSelectedInlineCompletionIndex(-1)}async accept(t){if(t.getModel()!==this.textModel)throw new e;let n=this.state.get();if(!n||n.primaryGhostText.isEmpty()||!n.inlineCompletion)return;let r=n.inlineCompletion.toInlineCompletion(void 0);if(r.command&&r.source.addRef(),t.pushUndoStop(),r.snippetInfo)t.executeEdits(`inlineSuggestion.accept`,[Fa.replace(r.range,``),...r.additionalTextEdits]),t.setPosition(r.snippetInfo.range.getStartPosition(),`inlineCompletionAccept`),tC.get(t)?.insert(r.snippetInfo.snippet,{undoStopBefore:!1});else{let e=n.edits,i=lC(e).map(e=>v.fromPositions(e));t.executeEdits(`inlineSuggestion.accept`,[...e.map(e=>Fa.replace(e.range,e.text)),...r.additionalTextEdits]),t.setSelections(i,`inlineCompletionAccept`)}this.stop(),r.command&&(await this._commandService.executeCommand(r.command.id,...r.command.arguments||[]).then(void 0,Re),r.source.removeRef())}async acceptNextWord(e){await this._acceptNext(e,(e,t)=>{let n=this.textModel.getLanguageIdAtPosition(e.lineNumber,e.column),r=this._languageConfigurationService.getLanguageConfiguration(n),i=new RegExp(r.wordDefinition.source,r.wordDefinition.flags.replace(`g`,``)),a=t.match(i),o=0;o=a&&a.index!==void 0?a.index===0?a[0].length:a.index:t.length;let s=/\s+/g.exec(t);return s&&s.index!==void 0&&s.index+s[0].length<o&&(o=s.index+s[0].length),o},0)}async acceptNextLine(e){await this._acceptNext(e,(e,t)=>{let n=t.match(/\n/);return n&&n.index!==void 0?n.index+1:t.length},1)}async _acceptNext(t,n,i){if(t.getModel()!==this.textModel)throw new e;let a=this.state.get();if(!a||a.primaryGhostText.isEmpty()||!a.inlineCompletion)return;let o=a.primaryGhostText,s=a.inlineCompletion.toInlineCompletion(void 0);if(s.snippetInfo||s.filterText!==s.insertText){await this.accept(t);return}let c=o.parts[0],l=new r(o.lineNumber,c.column),u=c.text,d=n(l,u);if(d===u.length&&o.parts.length===1){this.accept(t);return}let f=u.substring(0,d),p=this._positions.get(),m=p[0];s.source.addRef();try{this._isAcceptingPartially=!0;try{t.pushUndoStop();let e=T.fromPositions(m,l),n=new wc(e,t.getModel().getValueInRange(e)+f),r=[n,...sC(this.textModel,p,n)],i=lC(r).map(e=>v.fromPositions(e));t.executeEdits(`inlineSuggestion.accept`,r.map(e=>Fa.replace(e.range,e.text))),t.setSelections(i,`inlineCompletionPartialAccept`),t.revealPositionInCenterIfOutsideViewport(t.getPosition(),1)}finally{this._isAcceptingPartially=!1}if(s.source.provider.handlePartialAccept){let e=T.fromPositions(s.range.getStartPosition(),ss.ofText(f).addToPosition(l)),n=t.getModel().getValueInRange(e,1);s.source.provider.handlePartialAccept(s.source.inlineCompletions,s.sourceInlineCompletion,n.length,{kind:i})}}finally{s.source.removeRef()}}handleSuggestAccepted(e){let t=rS(e.toSingleTextEdit(),this.textModel),n=this._computeAugmentation(t,void 0);if(!n)return;let r=n.completion.inlineCompletion;r.source.provider.handlePartialAccept?.(r.source.inlineCompletions,r.sourceInlineCompletion,t.text.length,{kind:2})}};aC=rC([iC(9,Y),iC(10,lc),iC(11,Ci)],aC);var oC;(function(e){e[e.Undo=0]=`Undo`,e[e.Redo=1]=`Redo`,e[e.AcceptWord=2]=`AcceptWord`,e[e.Other=3]=`Other`})(oC||={});function sC(t,n,r){if(n.length===1)return[];let i=n[0],a=n.slice(1),o=r.range.getStartPosition(),s=r.range.getEndPosition(),c=t.getValueInRange(T.fromPositions(i,s)),l=Vx(i,o);if(l.lineNumber<1)return C(new e(`positionWithinTextEdit line number should be bigger than 0.
			Invalid subtraction between ${i.toString()} and ${o.toString()}`)),[];let u=cC(r.text,l);return a.map(e=>{let n=Bx(Vx(e,o),s),r=ct(c,t.getValueInRange(T.fromPositions(e,n)));return new wc(T.fromPositions(e,e.delta(0,r)),u)})}function cC(e,t){let n=``,r=jn(e);for(let e=t.lineNumber-1;e<r.length;e++)n+=r[e].substring(e===t.lineNumber-1?t.column-1:0);return n}function lC(e){let t=en.createSortPermutation(e,cn(e=>e.range,T.compareRangesUsingStarts)),n=new Kc(t.apply(e)).getNewRanges();return t.inverse().apply(n).map(e=>e.getEndPosition())}var uC=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},dC=function(e,t){return function(n,r){t(n,r,e)}},fC,pC=class{constructor(e){this.name=e}select(e,t,n){if(n.length===0)return 0;let r=n[0].score[0];for(let e=0;e<n.length;e++){let{score:t,completion:i}=n[e];if(t[0]!==r)break;if(i.preselect)return e}return 0}},mC=class extends pC{constructor(){super(`first`)}memorize(e,t,n){}toJSON(){}fromJSON(){}},hC=class extends pC{constructor(){super(`recentlyUsed`),this._cache=new yl(300,.66),this._seq=0}memorize(e,t,n){let r=`${e.getLanguageId()}/${n.textLabel}`;this._cache.set(r,{touch:this._seq++,type:n.completion.kind,insertText:n.completion.insertText})}select(e,t,n){if(n.length===0)return 0;let r=e.getLineContent(t.lineNumber).substr(t.column-10,t.column-1);if(/\s$/.test(r))return super.select(e,t,n);let i=n[0].score[0],a=-1,o=-1,s=-1;for(let t=0;t<n.length&&n[t].score[0]===i;t++){let r=`${e.getLanguageId()}/${n[t].textLabel}`,i=this._cache.peek(r);if(i&&i.touch>s&&i.type===n[t].completion.kind&&i.insertText===n[t].completion.insertText&&(s=i.touch,o=t),n[t].completion.preselect&&a===-1)return a=t}return o===-1?a===-1?0:a:o}toJSON(){return this._cache.toJSON()}fromJSON(e){this._cache.clear();for(let[t,n]of e)n.touch=0,n.type=typeof n.type==`number`?n.type:Ae.fromString(n.type),this._cache.set(t,n);this._seq=this._cache.size}},gC=class extends pC{constructor(){super(`recentlyUsedByPrefix`),this._trie=ic.forStrings(),this._seq=0}memorize(e,t,n){let{word:r}=e.getWordUntilPosition(t),i=`${e.getLanguageId()}/${r}`;this._trie.set(i,{type:n.completion.kind,insertText:n.completion.insertText,touch:this._seq++})}select(e,t,n){let{word:r}=e.getWordUntilPosition(t);if(!r)return super.select(e,t,n);let i=`${e.getLanguageId()}/${r}`,a=this._trie.get(i);if(a||=this._trie.findSubstr(i),a)for(let e=0;e<n.length;e++){let{kind:t,insertText:r}=n[e].completion;if(t===a.type&&r===a.insertText)return e}return super.select(e,t,n)}toJSON(){let e=[];return this._trie.forEach((t,n)=>e.push([n,t])),e.sort((e,t)=>-(e[1].touch-t[1].touch)).forEach((e,t)=>e[1].touch=t),e.slice(0,200)}fromJSON(e){if(this._trie.clear(),e.length>0){this._seq=e[0][1].touch+1;for(let[t,n]of e)n.type=typeof n.type==`number`?n.type:Ae.fromString(n.type),this._trie.set(t,n)}}},_C=class{static#e=fC=this;static#t=this._strategyCtors=new Map([[`recentlyUsedByPrefix`,gC],[`recentlyUsed`,hC],[`first`,mC]]);static#n=this._storagePrefix=`suggest/memories`;constructor(e,t){this._storageService=e,this._configService=t,this._disposables=new n,this._persistSoon=new yt(()=>this._saveState(),500),this._disposables.add(e.onWillSaveState(e=>{e.reason===Ai.SHUTDOWN&&this._saveState()}))}dispose(){this._disposables.dispose(),this._persistSoon.dispose()}memorize(e,t,n){this._withStrategy(e,t).memorize(e,t,n),this._persistSoon.schedule()}select(e,t,n){return this._withStrategy(e,t).select(e,t,n)}_withStrategy(e,t){let n=this._configService.getValue(`editor.suggestSelection`,{overrideIdentifier:e.getLanguageIdAtPosition(t.lineNumber,t.column),resource:e.uri});if(this._strategy?.name!==n){this._saveState(),this._strategy=new((fC._strategyCtors.get(n))||mC);try{let e=this._configService.getValue(`editor.suggest.shareSuggestSelections`)?0:1,t=this._storageService.get(`${fC._storagePrefix}/${n}`,e);t&&this._strategy.fromJSON(JSON.parse(t))}catch{}}return this._strategy}_saveState(){if(this._strategy){let e=this._configService.getValue(`editor.suggest.shareSuggestSelections`)?0:1,t=JSON.stringify(this._strategy);this._storageService.store(`${fC._storagePrefix}/${this._strategy.name}`,t,e,1)}}};_C=fC=uC([dC(0,Pa),dC(1,F)],_C);const vC=kl(`ISuggestMemories`);$r(vC,_C,1);var yC=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},bC=function(e,t){return function(n,r){t(n,r,e)}},xC,SC=class{static#e=xC=this;static#t=this.AtEnd=new G(`atEndOfWord`,!1);constructor(e,t){this._editor=e,this._enabled=!1,this._ckAtEnd=xC.AtEnd.bindTo(t),this._configListener=this._editor.onDidChangeConfiguration(e=>e.hasChanged(124)&&this._update()),this._update()}dispose(){this._configListener.dispose(),this._selectionListener?.dispose(),this._ckAtEnd.reset()}_update(){let e=this._editor.getOption(124)===`on`;if(this._enabled!==e)if(this._enabled=e,this._enabled){let e=()=>{if(!this._editor.hasModel()){this._ckAtEnd.set(!1);return}let e=this._editor.getModel(),t=this._editor.getSelection(),n=e.getWordAtPosition(t.getStartPosition());if(!n){this._ckAtEnd.set(!1);return}this._ckAtEnd.set(n.endColumn===t.getStartPosition().column)};this._selectionListener=this._editor.onDidChangeCursorSelection(e),e()}else this._selectionListener&&=(this._ckAtEnd.reset(),this._selectionListener.dispose(),void 0)}};SC=xC=yC([bC(1,W)],SC);var CC=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},wC=function(e,t){return function(n,r){t(n,r,e)}},TC,EC=class{static#e=TC=this;static#t=this.OtherSuggestions=new G(`hasOtherSuggestions`,!1);constructor(e,t){this._editor=e,this._index=0,this._ckOtherSuggestions=TC.OtherSuggestions.bindTo(t)}dispose(){this.reset()}reset(){this._ckOtherSuggestions.reset(),this._listener?.dispose(),this._model=void 0,this._acceptNext=void 0,this._ignore=!1}set({model:e,index:t},n){if(e.items.length===0){this.reset();return}if(TC._moveIndex(!0,e,t)===t){this.reset();return}this._acceptNext=n,this._model=e,this._index=t,this._listener=this._editor.onDidChangeCursorPosition(()=>{this._ignore||this.reset()}),this._ckOtherSuggestions.set(!0)}static _moveIndex(e,t,n){let r=n;for(let i=t.items.length;i>0&&(r=(r+t.items.length+(e?1:-1))%t.items.length,!(r===n||!t.items[r].completion.additionalTextEdits));i--);return r}next(){this._move(!0)}prev(){this._move(!1)}_move(e){if(this._model)try{this._ignore=!0,this._index=TC._moveIndex(e,this._model,this._index),this._acceptNext({index:this._index,item:this._model.items[this._index],model:this._model})}finally{this._ignore=!1}}};EC=TC=CC([wC(1,W)],EC);var DC=class{constructor(e,t,r,i){this._disposables=new n,this._disposables.add(r.onDidSuggest(e=>{e.completionModel.items.length===0&&this.reset()})),this._disposables.add(r.onDidCancel(e=>{this.reset()})),this._disposables.add(t.onDidShow(()=>this._onItem(t.getFocusedItem()))),this._disposables.add(t.onDidFocus(this._onItem,this)),this._disposables.add(t.onDidHide(this.reset,this)),this._disposables.add(e.onWillType(n=>{if(this._active&&!t.isFrozen()&&r.state!==0){let t=n.charCodeAt(n.length-1);this._active.acceptCharacters.has(t)&&e.getOption(0)&&i(this._active.item)}}))}_onItem(e){if(!e||!On(e.item.completion.commitCharacters)){this.reset();return}if(this._active&&this._active.item.item===e.item)return;let t=new pl;for(let n of e.item.completion.commitCharacters)n.length>0&&t.add(n.charCodeAt(0));this._active={acceptCharacters:t,item:e}}reset(){this._active=void 0}dispose(){this._disposables.dispose()}},OC=class e{async provideSelectionRanges(t,n){let r=[];for(let i of n){let n=[];r.push(n);let a=new Map;await new Promise(n=>e._bracketsRightYield(n,0,t,i,a)),await new Promise(r=>e._bracketsLeftYield(r,0,t,i,a,n))}return r}static#e=this._maxDuration=30;static#t=this._maxRounds=2;static _bracketsRightYield(t,n,r,i,a){let o=new Map,s=Date.now();for(;;){if(n>=e._maxRounds){t();break}if(!i){t();break}let c=r.bracketPairs.findNextBracket(i);if(!c){t();break}if(Date.now()-s>e._maxDuration){setTimeout(()=>e._bracketsRightYield(t,n+1,r,i,a));break}if(c.bracketInfo.isOpeningBracket){let e=c.bracketInfo.bracketText,t=o.has(e)?o.get(e):0;o.set(e,t+1)}else{let e=c.bracketInfo.getOpeningBrackets()[0].bracketText,t=o.has(e)?o.get(e):0;if(--t,o.set(e,Math.max(0,t)),t<0){let t=a.get(e);t||(t=new f,a.set(e,t)),t.push(c.range)}}i=c.range.getEndPosition()}}static _bracketsLeftYield(t,n,r,i,a,o){let s=new Map,c=Date.now();for(;;){if(n>=e._maxRounds&&a.size===0){t();break}if(!i){t();break}let l=r.bracketPairs.findPrevBracket(i);if(!l){t();break}if(Date.now()-c>e._maxDuration){setTimeout(()=>e._bracketsLeftYield(t,n+1,r,i,a,o));break}if(l.bracketInfo.isOpeningBracket){let t=l.bracketInfo.bracketText,n=s.has(t)?s.get(t):0;if(--n,s.set(t,Math.max(0,n)),n<0){let n=a.get(t);if(n){let i=n.shift();n.size===0&&a.delete(t);let s=T.fromPositions(l.range.getEndPosition(),i.getStartPosition()),c=T.fromPositions(l.range.getStartPosition(),i.getEndPosition());o.push({range:s}),o.push({range:c}),e._addBracketLeading(r,c,o)}}}else{let e=l.bracketInfo.getOpeningBrackets()[0].bracketText,t=s.has(e)?s.get(e):0;s.set(e,t+1)}i=l.range.getStartPosition()}}static _addBracketLeading(e,t,n){if(t.startLineNumber===t.endLineNumber)return;let i=t.startLineNumber,a=e.getLineFirstNonWhitespaceColumn(i);a!==0&&a!==t.startColumn&&(n.push({range:T.fromPositions(new r(i,a),t.getEndPosition())}),n.push({range:T.fromPositions(new r(i,1),t.getEndPosition())}));let o=i-1;if(o>0){let i=e.getLineFirstNonWhitespaceColumn(o);i===t.startColumn&&i!==e.getLineLastNonWhitespaceColumn(o)&&(n.push({range:T.fromPositions(new r(o,i),t.getEndPosition())}),n.push({range:T.fromPositions(new r(o,1),t.getEndPosition())}))}}},kC=class e{static#e=this.None=new class extends e{distance(){return 0}};static async create(t,n){if(!n.getOption(119).localityBonus||!n.hasModel())return e.None;let r=n.getModel(),i=n.getPosition();if(!t.canComputeWordRanges(r.uri))return e.None;let[a]=await new OC().provideSelectionRanges(r,[i]);if(a.length===0)return e.None;let o=await t.computeWordRanges(r.uri,a[0].range);if(!o)return e.None;let s=r.getWordUntilPosition(i);return delete o[s.word],new class extends e{distance(e,t){if(!i.equals(n.getPosition()))return 0;if(t.kind===17)return 2<<20;let r=o[typeof t.label==`string`?t.label:t.label.label];if(Xn(r))return 2<<20;let s=Tt(r,T.fromPositions(e),T.compareRangesUsingStarts),c=s>=0?r[s]:r[Math.max(0,~s-1)],l=a.length;for(let e of a){if(!T.containsRange(e.range,c))break;--l}return l}}}},AC=class{constructor(e,t){this.leadingLineContent=e,this.characterCountDelta=t}},jC=class e{constructor(t,n,r,i,a,o,s=kc.default,c=void 0){this.clipboardText=c,this._snippetCompareFn=e._compareCompletionItems,this._items=t,this._column=n,this._wordDistance=i,this._options=a,this._refilterKind=1,this._lineContext=r,this._fuzzyScoreOptions=s,o===`top`?this._snippetCompareFn=e._compareCompletionItemsSnippetsUp:o===`bottom`&&(this._snippetCompareFn=e._compareCompletionItemsSnippetsDown)}get lineContext(){return this._lineContext}set lineContext(e){(this._lineContext.leadingLineContent!==e.leadingLineContent||this._lineContext.characterCountDelta!==e.characterCountDelta)&&(this._refilterKind=this._lineContext.characterCountDelta<e.characterCountDelta&&this._filteredItems?2:1,this._lineContext=e)}get items(){return this._ensureCachedState(),this._filteredItems}getItemsByProvider(){return this._ensureCachedState(),this._itemsByProvider}getIncompleteProvider(){this._ensureCachedState();let e=new Set;for(let[t,n]of this.getItemsByProvider())n.length>0&&n[0].container.incomplete&&e.add(t);return e}get stats(){return this._ensureCachedState(),this._stats}_ensureCachedState(){this._refilterKind!==0&&this._createCachedState()}_createCachedState(){this._itemsByProvider=new Map;let e=[],{leadingLineContent:t,characterCountDelta:n}=this._lineContext,r=``,i=``,a=this._refilterKind===1?this._items:this._filteredItems,o=[],s=!this._options.filterGraceful||a.length>2e3?Ms:Wo;for(let c=0;c<a.length;c++){let l=a[c];if(l.isInvalid)continue;let u=this._itemsByProvider.get(l.provider);u?u.push(l):this._itemsByProvider.set(l.provider,[l]);let d=l.position.column-l.editStart.column,f=d+n-(l.position.column-this._column);if(r.length!==f&&(r=f===0?``:t.slice(-f),i=r.toLowerCase()),l.word=r,f===0)l.score=Ts.Default;else{let e=0;for(;e<d;){let t=r.charCodeAt(e);if(t===32||t===9)e+=1;else break}if(e>=f)l.score=Ts.Default;else if(typeof l.completion.filterText==`string`){let t=s(r,i,e,l.completion.filterText,l.filterTextLow,0,this._fuzzyScoreOptions);if(!t)continue;Jt(l.completion.filterText,l.textLabel)===0?l.score=t:(l.score=mc(r,i,e,l.textLabel,l.labelLow,0),l.score[0]=t[0])}else{let t=s(r,i,e,l.textLabel,l.labelLow,0,this._fuzzyScoreOptions);if(!t)continue;l.score=t}}l.idx=c,l.distance=this._wordDistance.distance(l.position,l.completion),o.push(l),e.push(l.textLabel.length)}this._filteredItems=o.sort(this._snippetCompareFn),this._refilterKind=0,this._stats={pLabelLen:e.length?Mr(e.length-.85,e,(e,t)=>e-t):0}}static _compareCompletionItems(e,t){return e.score[0]>t.score[0]?-1:e.score[0]<t.score[0]?1:e.distance<t.distance?-1:e.distance>t.distance?1:e.idx<t.idx?-1:e.idx>t.idx?1:0}static _compareCompletionItemsSnippetsDown(t,n){if(t.completion.kind!==n.completion.kind){if(t.completion.kind===27)return 1;if(n.completion.kind===27)return-1}return e._compareCompletionItems(t,n)}static _compareCompletionItemsSnippetsUp(t,n){if(t.completion.kind!==n.completion.kind){if(t.completion.kind===27)return-1;if(n.completion.kind===27)return 1}return e._compareCompletionItems(t,n)}},MC=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},NC=function(e,t){return function(n,r){t(n,r,e)}},PC,FC=class{static shouldAutoTrigger(e){if(!e.hasModel())return!1;let t=e.getModel(),n=e.getPosition();t.tokenization.tokenizeIfCheap(n.lineNumber);let r=t.getWordAtPosition(n);return!(!r||r.endColumn!==n.column&&r.startColumn+1!==n.column||!isNaN(Number(r.word)))}constructor(e,t,n){this.leadingLineContent=e.getLineContent(t.lineNumber).substr(0,t.column-1),this.leadingWord=e.getWordUntilPosition(t),this.lineNumber=t.lineNumber,this.column=t.column,this.triggerOptions=n}};function IC(e,t,n){if(!t.getContextKeyValue(kx.inlineSuggestionVisible.key))return!0;let r=t.getContextKeyValue(kx.suppressSuggestions.key);return r===void 0?!e.getOption(62).suppressSuggestions:!r}function LC(e,t,n){if(!t.getContextKeyValue(`inlineSuggestionVisible`))return!0;let r=t.getContextKeyValue(kx.suppressSuggestions.key);return r===void 0?!e.getOption(62).suppressSuggestions:!r}var RC=PC=class{constructor(e,t,r,i,a,o,s,c,l){this._editor=e,this._editorWorkerService=t,this._clipboardService=r,this._telemetryService=i,this._logService=a,this._contextKeyService=o,this._configurationService=s,this._languageFeaturesService=c,this._envService=l,this._toDispose=new n,this._triggerCharacterListener=new n,this._triggerQuickSuggest=new Yt,this._triggerState=void 0,this._completionDisposables=new n,this._onDidCancel=new g,this._onDidTrigger=new g,this._onDidSuggest=new g,this.onDidCancel=this._onDidCancel.event,this.onDidTrigger=this._onDidTrigger.event,this.onDidSuggest=this._onDidSuggest.event,this._telemetryGate=0,this._currentSelection=this._editor.getSelection()||new v(1,1,1,1),this._toDispose.add(this._editor.onDidChangeModel(()=>{this._updateTriggerCharacters(),this.cancel()})),this._toDispose.add(this._editor.onDidChangeModelLanguage(()=>{this._updateTriggerCharacters(),this.cancel()})),this._toDispose.add(this._editor.onDidChangeConfiguration(()=>{this._updateTriggerCharacters()})),this._toDispose.add(this._languageFeaturesService.completionProvider.onDidChange(()=>{this._updateTriggerCharacters(),this._updateActiveSuggestSession()}));let u=!1;this._toDispose.add(this._editor.onDidCompositionStart(()=>{u=!0})),this._toDispose.add(this._editor.onDidCompositionEnd(()=>{u=!1,this._onCompositionEnd()})),this._toDispose.add(this._editor.onDidChangeCursorSelection(e=>{u||this._onCursorChange(e)})),this._toDispose.add(this._editor.onDidChangeModelContent(()=>{!u&&this._triggerState!==void 0&&this._refilterCompletionItems()})),this._updateTriggerCharacters()}dispose(){c(this._triggerCharacterListener),c([this._onDidCancel,this._onDidSuggest,this._onDidTrigger,this._triggerQuickSuggest]),this._toDispose.dispose(),this._completionDisposables.dispose(),this.cancel()}_updateTriggerCharacters(){if(this._triggerCharacterListener.clear(),this._editor.getOption(92)||!this._editor.hasModel()||!this._editor.getOption(122))return;let e=new Map;for(let t of this._languageFeaturesService.completionProvider.all(this._editor.getModel()))for(let n of t.triggerCharacters||[]){let r=e.get(n);if(!r){r=new Set;let t=wS();t&&r.add(t),e.set(n,r)}r.add(t)}let t=t=>{if(!LC(this._editor,this._contextKeyService,this._configurationService)||FC.shouldAutoTrigger(this._editor))return;if(!t){let e=this._editor.getPosition();t=this._editor.getModel().getLineContent(e.lineNumber).substr(0,e.column-1)}let n=``;Pn(t.charCodeAt(t.length-1))?Er(t.charCodeAt(t.length-2))&&(n=t.substr(t.length-2)):n=t.charAt(t.length-1);let r=e.get(n);if(r){let e=new Map;if(this._completionModel)for(let[t,n]of this._completionModel.getItemsByProvider())r.has(t)||e.set(t,n);this.trigger({auto:!0,triggerKind:1,triggerCharacter:n,retrigger:!!this._completionModel,clipboardText:this._completionModel?.clipboardText,completionOptions:{providerFilter:r,providerItemsToReuse:e}})}};this._triggerCharacterListener.add(this._editor.onDidType(t)),this._triggerCharacterListener.add(this._editor.onDidCompositionEnd(()=>t()))}get state(){return this._triggerState?this._triggerState.auto?2:1:0}cancel(e=!1){this._triggerState!==void 0&&(this._triggerQuickSuggest.cancel(),this._requestToken?.cancel(),this._requestToken=void 0,this._triggerState=void 0,this._completionModel=void 0,this._context=void 0,this._onDidCancel.fire({retrigger:e}))}clear(){this._completionDisposables.clear()}_updateActiveSuggestSession(){this._triggerState!==void 0&&(!this._editor.hasModel()||!this._languageFeaturesService.completionProvider.has(this._editor.getModel())?this.cancel():this.trigger({auto:this._triggerState.auto,retrigger:!0}))}_onCursorChange(e){if(!this._editor.hasModel())return;let t=this._currentSelection;if(this._currentSelection=this._editor.getSelection(),!e.selection.isEmpty()||e.reason!==0&&e.reason!==3||e.source!==`keyboard`&&e.source!==`deleteLeft`){this.cancel();return}this._triggerState===void 0&&e.reason===0?(t.containsRange(this._currentSelection)||t.getEndPosition().isBeforeOrEqual(this._currentSelection.getPosition()))&&this._doTriggerQuickSuggest():this._triggerState!==void 0&&e.reason===3&&this._refilterCompletionItems()}_onCompositionEnd(){this._triggerState===void 0?this._doTriggerQuickSuggest():this._refilterCompletionItems()}_doTriggerQuickSuggest(){NS.isAllOff(this._editor.getOption(90))||this._editor.getOption(119).snippetsPreventQuickSuggestions&&tC.get(this._editor)?.isInSnippet()||(this.cancel(),this._triggerQuickSuggest.cancelAndSet(()=>{if(this._triggerState!==void 0||!FC.shouldAutoTrigger(this._editor)||!this._editor.hasModel()||!this._editor.hasWidgetFocus())return;let e=this._editor.getModel(),t=this._editor.getPosition(),n=this._editor.getOption(90);if(!NS.isAllOff(n)){if(!NS.isAllOn(n)){e.tokenization.tokenizeIfCheap(t.lineNumber);let r=e.tokenization.getLineTokens(t.lineNumber),i=r.getStandardTokenType(r.findTokenIndexAtOffset(Math.max(t.column-1-1,0)));if(NS.valueFor(n,i)!==`on`)return}IC(this._editor,this._contextKeyService,this._configurationService)&&this._languageFeaturesService.completionProvider.has(e)&&this.trigger({auto:!0})}},this._editor.getOption(91)))}_refilterCompletionItems(){o(this._editor.hasModel()),o(this._triggerState!==void 0);let e=new FC(this._editor.getModel(),this._editor.getPosition(),{...this._triggerState,refilter:!0});this._onNewContext(e)}trigger(e){if(!this._editor.hasModel())return;let t=this._editor.getModel(),n=new FC(t,this._editor.getPosition(),e);this.cancel(e.retrigger),this._triggerState=e,this._onDidTrigger.fire({auto:e.auto,shy:e.shy??!1,position:this._editor.getPosition()}),this._context=n;let r={triggerKind:e.triggerKind??0};e.triggerCharacter&&(r={triggerKind:1,triggerCharacter:e.triggerCharacter}),this._requestToken=new ie;let i=this._editor.getOption(113),a=1;switch(i){case`top`:a=0;break;case`bottom`:a=2;break}let{itemKind:o,showDeprecated:s}=PC.createSuggestFilter(this._editor),c=new SS(a,e.completionOptions?.kindFilter??o,e.completionOptions?.providerFilter,e.completionOptions?.providerItemsToReuse,s),l=kC.create(this._editorWorkerService,this._editor),u=ES(this._languageFeaturesService.completionProvider,t,this._editor.getPosition(),c,r,this._requestToken.token);Promise.all([u,l]).then(async([t,n])=>{if(this._requestToken?.dispose(),!this._editor.hasModel())return;let r=e?.clipboardText;if(!r&&t.needsClipboard&&(r=await this._clipboardService.readText()),this._triggerState===void 0)return;let i=new FC(this._editor.getModel(),this._editor.getPosition(),e),a={...kc.default,firstMatchCanBeWeak:!this._editor.getOption(119).matchOnWordStartOnly};if(this._completionModel=new jC(t.items,this._context.column,{leadingLineContent:i.leadingLineContent,characterCountDelta:i.column-this._context.column},n,this._editor.getOption(119),this._editor.getOption(113),a,r),this._completionDisposables.add(t.disposable),this._onNewContext(i),this._reportDurationsTelemetry(t.durations),!this._envService.isBuilt||this._envService.isExtensionDevelopment)for(let e of t.items)e.isInvalid&&this._logService.warn(`[suggest] did IGNORE invalid completion item from ${e.provider._debugDisplayName}`,e.completion)}).catch(C)}_reportDurationsTelemetry(e){this._telemetryGate++%230==0&&setTimeout(()=>{this._telemetryService.publicLog2(`suggest.durations.json`,{data:JSON.stringify(e)}),this._logService.debug(`suggest.durations.json`,e)})}static createSuggestFilter(e){let t=new Set;e.getOption(113)===`none`&&t.add(27);let n=e.getOption(119);return n.showMethods||t.add(0),n.showFunctions||t.add(1),n.showConstructors||t.add(2),n.showFields||t.add(3),n.showVariables||t.add(4),n.showClasses||t.add(5),n.showStructs||t.add(6),n.showInterfaces||t.add(7),n.showModules||t.add(8),n.showProperties||t.add(9),n.showEvents||t.add(10),n.showOperators||t.add(11),n.showUnits||t.add(12),n.showValues||t.add(13),n.showConstants||t.add(14),n.showEnums||t.add(15),n.showEnumMembers||t.add(16),n.showKeywords||t.add(17),n.showWords||t.add(18),n.showColors||t.add(19),n.showFiles||t.add(20),n.showReferences||t.add(21),n.showColors||t.add(22),n.showFolders||t.add(23),n.showTypeParameters||t.add(24),n.showSnippets||t.add(27),n.showUsers||t.add(25),n.showIssues||t.add(26),{itemKind:t,showDeprecated:n.showDeprecated}}_onNewContext(e){if(this._context){if(e.lineNumber!==this._context.lineNumber){this.cancel();return}if(Gt(e.leadingLineContent)!==Gt(this._context.leadingLineContent)){this.cancel();return}if(e.column<this._context.column){e.leadingWord.word?this.trigger({auto:this._context.triggerOptions.auto,retrigger:!0}):this.cancel();return}if(this._completionModel){if(e.leadingWord.word.length!==0&&e.leadingWord.startColumn>this._context.leadingWord.startColumn){if(FC.shouldAutoTrigger(this._editor)&&this._context){let e=this._completionModel.getItemsByProvider();this.trigger({auto:this._context.triggerOptions.auto,retrigger:!0,clipboardText:this._completionModel.clipboardText,completionOptions:{providerItemsToReuse:e}})}return}if(e.column>this._context.column&&this._completionModel.getIncompleteProvider().size>0&&e.leadingWord.word.length!==0){let e=new Map,t=new Set;for(let[n,r]of this._completionModel.getItemsByProvider())r.length>0&&r[0].container.incomplete?t.add(n):e.set(n,r);this.trigger({auto:this._context.triggerOptions.auto,triggerKind:2,retrigger:!0,clipboardText:this._completionModel.clipboardText,completionOptions:{providerFilter:t,providerItemsToReuse:e}})}else{let t=this._completionModel.lineContext,n=!1;if(this._completionModel.lineContext={leadingLineContent:e.leadingLineContent,characterCountDelta:e.column-this._context.column},this._completionModel.items.length===0){let r=FC.shouldAutoTrigger(this._editor);if(!this._context){this.cancel();return}if(r&&this._context.leadingWord.endColumn<e.leadingWord.startColumn){this.trigger({auto:this._context.triggerOptions.auto,retrigger:!0});return}if(this._context.triggerOptions.auto){this.cancel();return}else if(this._completionModel.lineContext=t,n=this._completionModel.items.length>0,n&&e.leadingWord.word.length===0){this.cancel();return}}this._onDidSuggest.fire({completionModel:this._completionModel,triggerOptions:e.triggerOptions,isFrozen:n})}}}}};RC=PC=MC([NC(1,pi),NC(2,_l),NC(3,Zi),NC(4,Fc),NC(5,W),NC(6,F),NC(7,V),NC(8,No)],RC);var zC=class e{static#e=this._maxSelectionLength=51200;constructor(t,r){this._disposables=new n,this._lastOvertyped=[],this._locked=!1,this._disposables.add(t.onWillType(()=>{if(this._locked||!t.hasModel())return;let n=t.getSelections(),r=n.length,i=!1;for(let e=0;e<r;e++)if(!n[e].isEmpty()){i=!0;break}if(!i){this._lastOvertyped.length!==0&&(this._lastOvertyped.length=0);return}this._lastOvertyped=[];let a=t.getModel();for(let t=0;t<r;t++){let r=n[t];if(a.getValueLengthInRange(r)>e._maxSelectionLength)return;this._lastOvertyped[t]={value:a.getValueInRange(r),multiline:r.startLineNumber!==r.endLineNumber}}})),this._disposables.add(r.onDidTrigger(e=>{this._locked=!0})),this._disposables.add(r.onDidCancel(e=>{this._locked=!1}))}getLastOvertypedInfo(e){if(e>=0&&e<this._lastOvertyped.length)return this._lastOvertyped[e]}dispose(){this._disposables.dispose()}},BC=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},VC=function(e,t){return function(n,r){t(n,r,e)}},HC=class{constructor(e,t,r,i,a){this._menuId=t,this._menuService=i,this._contextKeyService=a,this._menuDisposables=new n,this.element=M(e,O(`.suggest-status-bar`));let o=(e=>e instanceof Ra?r.createInstance(Ti,e,{useComma:!0}):void 0);this._leftActions=new hl(this.element,{actionViewItemProvider:o}),this._rightActions=new hl(this.element,{actionViewItemProvider:o}),this._leftActions.domNode.classList.add(`left`),this._rightActions.domNode.classList.add(`right`)}dispose(){this._menuDisposables.dispose(),this._leftActions.dispose(),this._rightActions.dispose(),this.element.remove()}show(){let e=this._menuService.createMenu(this._menuId,this._contextKeyService),t=()=>{let t=[],n=[];for(let[r,i]of e.getActions())r===`left`?t.push(...i):n.push(...i);this._leftActions.clear(),this._leftActions.push(t),this._rightActions.clear(),this._rightActions.push(n)};this._menuDisposables.add(e.onDidChange(()=>t())),this._menuDisposables.add(e)}hide(){this._menuDisposables.clear()}};HC=BC([VC(2,Y),VC(3,Eo),VC(4,W)],HC);var UC=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},WC=function(e,t){return function(n,r){t(n,r,e)}};function GC(e){return!!e&&!!(e.completion.documentation||e.completion.detail&&e.completion.detail!==e.completion.label)}var KC=class{constructor(e,t){this._editor=e,this._onDidClose=new g,this.onDidClose=this._onDidClose.event,this._onDidChangeContents=new g,this.onDidChangeContents=this._onDidChangeContents.event,this._disposables=new n,this._renderDisposeable=new n,this._borderWidth=1,this._size=new A(330,0),this.domNode=O(`.suggest-details`),this.domNode.classList.add(`no-docs`),this._markdownRenderer=t.createInstance(Hi,{editor:e}),this._body=O(`.body`),this._scrollbar=new ha(this._body,{alwaysConsumeMouseWheel:!0}),M(this.domNode,this._scrollbar.getDomNode()),this._disposables.add(this._scrollbar),this._header=M(this._body,O(`.header`)),this._close=M(this._header,O(`span`+J.asCSSSelector(i.close))),this._close.title=S(`details.close`,`Close`),this._type=M(this._header,O(`p.type`)),this._docs=M(this._body,O(`p.docs`)),this._configureFont(),this._disposables.add(this._editor.onDidChangeConfiguration(e=>{e.hasChanged(50)&&this._configureFont()}))}dispose(){this._disposables.dispose(),this._renderDisposeable.dispose()}_configureFont(){let e=this._editor.getOptions(),t=e.get(50),n=t.getMassagedFontFamily(),r=e.get(120)||t.fontSize,i=e.get(121)||t.lineHeight,a=t.fontWeight,o=`${r}px`,s=`${i}px`;this.domNode.style.fontSize=o,this.domNode.style.lineHeight=`${i/r}`,this.domNode.style.fontWeight=a,this.domNode.style.fontFeatureSettings=t.fontFeatureSettings,this._type.style.fontFamily=n,this._close.style.height=s,this._close.style.width=s}getLayoutInfo(){let e=this._editor.getOption(121)||this._editor.getOption(50).lineHeight,t=this._borderWidth;return{lineHeight:e,borderWidth:t,borderHeight:t*2,verticalPadding:22,horizontalPadding:14}}renderLoading(){this._type.textContent=S(`loading`,`Loading...`),this._docs.textContent=``,this.domNode.classList.remove(`no-docs`,`no-type`),this.layout(this.size.width,this.getLayoutInfo().lineHeight*2),this._onDidChangeContents.fire(this)}renderItem(e,t){this._renderDisposeable.clear();let{detail:n,documentation:r}=e.completion;if(t){let t=``;t+=`score: ${e.score[0]}\n`,t+=`prefix: ${e.word??`(no prefix)`}\n`,t+=`word: ${e.completion.filterText?e.completion.filterText+` (filterText)`:e.textLabel}\n`,t+=`distance: ${e.distance} (localityBonus-setting)\n`,t+=`index: ${e.idx}, based on ${e.completion.sortText&&`sortText: "${e.completion.sortText}"`||`label`}\n`,t+=`commit_chars: ${e.completion.commitCharacters?.join(``)}\n`,r=new Va().appendCodeblock(`empty`,t),n=`Provider: ${e.provider._debugDisplayName}`}if(!t&&!GC(e)){this.clearContents();return}if(this.domNode.classList.remove(`no-docs`,`no-type`),n){let e=n.length>1e5?`${n.substr(0,1e5)}`:n;this._type.textContent=e,this._type.title=e,Cn(this._type),this._type.classList.toggle(`auto-wrap`,!/\r?\n^\s+/gim.test(e))}else Fr(this._type),this._type.title=``,yr(this._type),this.domNode.classList.add(`no-type`);if(Fr(this._docs),typeof r==`string`)this._docs.classList.remove(`markdown-docs`),this._docs.textContent=r;else if(r){this._docs.classList.add(`markdown-docs`),Fr(this._docs);let e=this._markdownRenderer.render(r);this._docs.appendChild(e.element),this._renderDisposeable.add(e),this._renderDisposeable.add(this._markdownRenderer.onDidRenderAsync(()=>{this.layout(this._size.width,this._type.clientHeight+this._docs.clientHeight),this._onDidChangeContents.fire(this)}))}this.domNode.style.userSelect=`text`,this.domNode.tabIndex=-1,this._close.onmousedown=e=>{e.preventDefault(),e.stopPropagation()},this._close.onclick=e=>{e.preventDefault(),e.stopPropagation(),this._onDidClose.fire()},this._body.scrollTop=0,this.layout(this._size.width,this._type.clientHeight+this._docs.clientHeight),this._onDidChangeContents.fire(this)}clearContents(){this.domNode.classList.add(`no-docs`),this._type.textContent=``,this._docs.textContent=``}get isEmpty(){return this.domNode.classList.contains(`no-docs`)}get size(){return this._size}layout(e,t){let n=new A(e,t);A.equals(n,this._size)||(this._size=n,Pr(this.domNode,e,t)),this._scrollbar.scanDomNode()}scrollDown(e=8){this._body.scrollTop+=e}scrollUp(e=8){this._body.scrollTop-=e}scrollTop(){this._body.scrollTop=0}scrollBottom(){this._body.scrollTop=this._body.scrollHeight}pageDown(){this.scrollDown(80)}pageUp(){this.scrollUp(80)}set borderWidth(e){this._borderWidth=e}get borderWidth(){return this._borderWidth}};KC=UC([WC(1,Y)],KC);var qC=class{constructor(e,t){this.widget=e,this._editor=t,this.allowEditorOverflow=!0,this._disposables=new n,this._added=!1,this._preferAlignAtTop=!0,this._resizable=new Bm,this._resizable.domNode.classList.add(`suggest-details-container`),this._resizable.domNode.appendChild(e.domNode),this._resizable.enableSashes(!1,!0,!0,!1);let r,i,a=0,o=0;this._disposables.add(this._resizable.onDidWillResize(()=>{r=this._topLeft,i=this._resizable.size})),this._disposables.add(this._resizable.onDidResize(e=>{if(r&&i){this.widget.layout(e.dimension.width,e.dimension.height);let t=!1;e.west&&(o=i.width-e.dimension.width,t=!0),e.north&&(a=i.height-e.dimension.height,t=!0),t&&this._applyTopLeft({top:r.top+a,left:r.left+o})}e.done&&(r=void 0,i=void 0,a=0,o=0,this._userSize=e.dimension)})),this._disposables.add(this.widget.onDidChangeContents(()=>{this._anchorBox&&this._placeAtAnchor(this._anchorBox,this._userSize??this.widget.size,this._preferAlignAtTop)}))}dispose(){this._resizable.dispose(),this._disposables.dispose(),this.hide()}getId(){return`suggest.details`}getDomNode(){return this._resizable.domNode}getPosition(){return this._topLeft?{preference:this._topLeft}:null}show(){this._added||=(this._editor.addOverlayWidget(this),!0)}hide(e=!1){this._resizable.clearSashHoverState(),this._added&&(this._editor.removeOverlayWidget(this),this._added=!1,this._anchorBox=void 0,this._topLeft=void 0),e&&(this._userSize=void 0,this.widget.clearContents())}placeAtAnchor(e,t){this._anchorBox=e.getBoundingClientRect(),this._preferAlignAtTop=t,this._placeAtAnchor(this._anchorBox,this._userSize??this.widget.size,t)}_placeAtAnchor(e,t,n){let r=jt(this.getDomNode().ownerDocument.body),i=this.widget.getLayoutInfo(),a=new A(220,2*i.lineHeight),o=e.top,s=(function(){let n=r.width-(e.left+e.width+i.borderWidth+i.horizontalPadding),s=-i.borderWidth+e.left+e.width,c=new A(n,r.height-e.top-i.borderHeight-i.verticalPadding),l=c.with(void 0,e.top+e.height-i.borderHeight-i.verticalPadding);return{top:o,left:s,fit:n-t.width,maxSizeTop:c,maxSizeBottom:l,minSize:a.with(Math.min(n,a.width))}})(),c=[s,(function(){let n=e.left-i.borderWidth-i.horizontalPadding,s=Math.max(i.horizontalPadding,e.left-t.width-i.borderWidth),c=new A(n,r.height-e.top-i.borderHeight-i.verticalPadding),l=c.with(void 0,e.top+e.height-i.borderHeight-i.verticalPadding);return{top:o,left:s,fit:n-t.width,maxSizeTop:c,maxSizeBottom:l,minSize:a.with(Math.min(n,a.width))}})(),(function(){let n=e.left,o=-i.borderWidth+e.top+e.height,s=new A(e.width-i.borderHeight,r.height-e.top-e.height-i.verticalPadding);return{top:o,left:n,fit:s.height-t.height,maxSizeBottom:s,maxSizeTop:s,minSize:a.with(s.width)}})()],l=c.find(e=>e.fit>=0)??c.sort((e,t)=>t.fit-e.fit)[0],u=e.top+e.height-i.borderHeight,d,f=t.height,p=Math.max(l.maxSizeTop.height,l.maxSizeBottom.height);f>p&&(f=p);let m;n?f<=l.maxSizeTop.height?(d=!0,m=l.maxSizeTop):(d=!1,m=l.maxSizeBottom):f<=l.maxSizeBottom.height?(d=!1,m=l.maxSizeBottom):(d=!0,m=l.maxSizeTop);let{top:h,left:g}=l;!d&&f>e.height&&(h=u-f);let ee=this._editor.getDomNode();if(ee){let e=ee.getBoundingClientRect();h-=e.top,g-=e.left}this._applyTopLeft({left:g,top:h}),this._resizable.enableSashes(!d,l===s,d,l!==s),this._resizable.minSize=l.minSize,this._resizable.maxSize=m,this._resizable.layout(f,Math.min(m.width,t.width)),this.widget.layout(this._resizable.size.width,this._resizable.size.height)}_applyTopLeft(e){this._topLeft=e,this._editor.layoutOverlayWidget(this)}},JC;(function(e){e[e.FILE=0]=`FILE`,e[e.FOLDER=1]=`FOLDER`,e[e.ROOT_FOLDER=2]=`ROOT_FOLDER`})(JC||={});var YC=/(?:\/|^)(?:([^\/]+)\/)?([^\/]+)$/;function XC(e,t,n,r,i){if(J.isThemeIcon(i))return[`codicon-${i.id}`,`predefined-file-icon`];if(y.isUri(i))return[];let a=r===JC.ROOT_FOLDER?[`rootfolder-icon`]:r===JC.FOLDER?[`folder-icon`]:[`file-icon`];if(n){let i;if(n.scheme===Bt.data)i=Qc.parseMetaData(n).get(Qc.META_DATA_LABEL);else{let e=n.path.match(YC);e?(i=QC(e[2].toLowerCase()),e[1]&&a.push(`${QC(e[1].toLowerCase())}-name-dir-icon`)):i=QC(n.authority.toLowerCase())}if(r===JC.ROOT_FOLDER)a.push(`${i}-root-name-folder-icon`);else if(r===JC.FOLDER)a.push(`${i}-name-folder-icon`);else{if(i){if(a.push(`${i}-name-file-icon`),a.push(`name-file-icon`),i.length<=255){let e=i.split(`.`);for(let t=1;t<e.length;t++)a.push(`${e.slice(t).join(`.`)}-ext-file-icon`)}a.push(`ext-file-icon`)}let r=ZC(e,t,n);r&&a.push(`${QC(r)}-lang-file-icon`)}}return a}function ZC(e,t,n){if(!n)return null;let r=null;if(n.scheme===Bt.data){let e=Qc.parseMetaData(n).get(Qc.META_DATA_MIME);e&&(r=t.getLanguageIdByMimeType(e))}else{let t=e.getModel(n);t&&(r=t.getLanguageId())}return r&&r!==`plaintext`?r:t.guessLanguageIdByFilepathOrFirstLine(n)}function QC(e){return e.replace(/[\s]/g,`/`)}var $C=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},ew=function(e,t){return function(n,r){t(n,r,e)}};function tw(e){return`suggest-aria-id:${e}`}var nw=ri(`suggest-more-info`,i.chevronRight,S(`suggestMoreInfoIcon`,`Icon for more information in the suggest widget.`)),rw=new class e{static#e=this._regexRelaxed=/(#([\da-fA-F]{3}){1,2}|(rgb|hsl)a\(\s*(\d{1,3}%?\s*,\s*){3}(1|0?\.\d+)\)|(rgb|hsl)\(\s*\d{1,3}%?(\s*,\s*\d{1,3}%?){2}\s*\))/;static#t=this._regexStrict=RegExp(`^${e._regexRelaxed.source}$`,`i`);extract(t,n){if(t.textLabel.match(e._regexStrict))return n[0]=t.textLabel,!0;if(t.completion.detail&&t.completion.detail.match(e._regexStrict))return n[0]=t.completion.detail,!0;if(t.completion.documentation){let r=typeof t.completion.documentation==`string`?t.completion.documentation:t.completion.documentation.value,i=e._regexRelaxed.exec(r);if(i&&(i.index===0||i.index+i[0].length===r.length))return n[0]=i[0],!0}return!1}},iw=class{constructor(e,t,n,r){this._editor=e,this._modelService=t,this._languageService=n,this._themeService=r,this._onDidToggleDetails=new g,this.onDidToggleDetails=this._onDidToggleDetails.event,this.templateId=`suggestion`}dispose(){this._onDidToggleDetails.dispose()}renderTemplate(e){let t=new n,r=e;r.classList.add(`show-file-icons`);let i=M(e,O(`.icon`)),a=M(i,O(`span.colorspan`)),o=M(M(e,O(`.contents`)),O(`.main`)),s=M(o,O(`.icon-label.codicon`)),c=M(o,O(`span.left`)),l=M(o,O(`span.right`)),u=new Ia(c,{supportHighlights:!0,supportIcons:!0});t.add(u);let d=M(c,O(`span.signature-label`)),f=M(c,O(`span.qualifier-label`)),p=M(l,O(`span.details-label`)),m=M(l,O(`span.readMore`+J.asCSSSelector(nw)));return m.title=S(`readMore`,`Read More`),{root:r,left:c,right:l,icon:i,colorspan:a,iconLabel:u,iconContainer:s,parametersLabel:d,qualifierLabel:f,detailsLabel:p,readMore:m,disposables:t,configureFont:()=>{let e=this._editor.getOptions(),t=e.get(50),n=t.getMassagedFontFamily(),a=t.fontFeatureSettings,s=e.get(120)||t.fontSize,c=e.get(121)||t.lineHeight,l=t.fontWeight,u=t.letterSpacing,d=`${s}px`,f=`${c}px`,p=`${u}px`;r.style.fontSize=d,r.style.fontWeight=l,r.style.letterSpacing=p,o.style.fontFamily=n,o.style.fontFeatureSettings=a,o.style.lineHeight=f,i.style.height=f,i.style.width=f,m.style.height=f,m.style.width=f}}}renderElement(e,t,n){n.configureFont();let{completion:r}=e;n.root.id=tw(t),n.colorspan.style.backgroundColor=``;let i={labelEscapeNewLines:!0,matches:Rs(e.score)},a=[];if(r.kind===19&&rw.extract(e,a))n.icon.className=`icon customcolor`,n.iconContainer.className=`icon hide`,n.colorspan.style.backgroundColor=a[0];else if(r.kind===20&&this._themeService.getFileIconTheme().hasFileIcons){n.icon.className=`icon hide`,n.iconContainer.className=`icon hide`;let t=XC(this._modelService,this._languageService,y.from({scheme:`fake`,path:e.textLabel}),JC.FILE),a=XC(this._modelService,this._languageService,y.from({scheme:`fake`,path:r.detail}),JC.FILE);i.extraClasses=t.length>a.length?t:a}else r.kind===23&&this._themeService.getFileIconTheme().hasFolderIcons?(n.icon.className=`icon hide`,n.iconContainer.className=`icon hide`,i.extraClasses=[XC(this._modelService,this._languageService,y.from({scheme:`fake`,path:e.textLabel}),JC.FOLDER),XC(this._modelService,this._languageService,y.from({scheme:`fake`,path:r.detail}),JC.FOLDER)].flat()):(n.icon.className=`icon hide`,n.iconContainer.className=``,n.iconContainer.classList.add(`suggest-icon`,...J.asClassNameArray(Ae.toIcon(r.kind))));r.tags&&r.tags.indexOf(1)>=0&&(i.extraClasses=(i.extraClasses||[]).concat([`deprecated`]),i.matches=[]),n.iconLabel.setLabel(e.textLabel,void 0,i),typeof r.label==`string`?(n.parametersLabel.textContent=``,n.detailsLabel.textContent=aw(r.detail||``),n.root.classList.add(`string-label`)):(n.parametersLabel.textContent=aw(r.label.detail||``),n.detailsLabel.textContent=aw(r.label.description||``),n.root.classList.remove(`string-label`)),this._editor.getOption(119).showInlineDetails?Cn(n.detailsLabel):yr(n.detailsLabel),GC(e)?(n.right.classList.add(`can-expand-details`),Cn(n.readMore),n.readMore.onmousedown=e=>{e.stopPropagation(),e.preventDefault()},n.readMore.onclick=e=>{e.stopPropagation(),e.preventDefault(),this._onDidToggleDetails.fire()}):(n.right.classList.remove(`can-expand-details`),yr(n.readMore),n.readMore.onmousedown=null,n.readMore.onclick=null)}disposeTemplate(e){e.disposables.dispose()}};iw=$C([ew(1,Ps),ew(2,Ys),ew(3,Zc)],iw);function aw(e){return e.replace(/\r\n|\r|\n/g,``)}var ow=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},sw=function(e,t){return function(n,r){t(n,r,e)}},cw;k(`editorSuggestWidget.background`,zr,S(`editorSuggestWidgetBackground`,`Background color of the suggest widget.`)),k(`editorSuggestWidget.border`,kn,S(`editorSuggestWidgetBorder`,`Border color of the suggest widget.`));var lw=k(`editorSuggestWidget.foreground`,zn,S(`editorSuggestWidgetForeground`,`Foreground color of the suggest widget.`));k(`editorSuggestWidget.selectedForeground`,Yn,S(`editorSuggestWidgetSelectedForeground`,`Foreground color of the selected entry in the suggest widget.`)),k(`editorSuggestWidget.selectedIconForeground`,En,S(`editorSuggestWidgetSelectedIconForeground`,`Icon foreground color of the selected entry in the suggest widget.`));const uw=k(`editorSuggestWidget.selectedBackground`,Sr,S(`editorSuggestWidgetSelectedBackground`,`Background color of the selected entry in the suggest widget.`));k(`editorSuggestWidget.highlightForeground`,zt,S(`editorSuggestWidgetHighlightForeground`,`Color of the match highlights in the suggest widget.`)),k(`editorSuggestWidget.focusHighlightForeground`,st,S(`editorSuggestWidgetFocusHighlightForeground`,`Color of the match highlights in the suggest widget when an item is focused.`)),k(`editorSuggestWidgetStatus.foreground`,xt(lw,.5),S(`editorSuggestWidgetStatusForeground`,`Foreground color of the suggest widget status.`));var dw=class{constructor(e,t){this._service=e,this._key=`suggestWidget.size/${t.getEditorType()}/${t instanceof Ph}`}restore(){let e=this._service.get(this._key,0)??``;try{let t=JSON.parse(e);if(A.is(t))return A.lift(t)}catch{}}store(e){this._service.store(this._key,JSON.stringify(e),0,1)}reset(){this._service.remove(this._key,0)}},fw=class{static#e=cw=this;static#t=this.LOADING_MESSAGE=S(`suggestWidget.loading`,`Loading...`);static#n=this.NO_SUGGESTIONS_MESSAGE=S(`suggestWidget.noSuggestions`,`No suggestions.`);constructor(e,t,r,i,a){this.editor=e,this._storageService=t,this._state=0,this._isAuto=!1,this._pendingLayout=new l,this._pendingShowDetails=new l,this._ignoreFocusEvents=!1,this._forceRenderingAbove=!1,this._explainMode=!1,this._showTimeout=new Yt,this._disposables=new n,this._onDidSelect=new m,this._onDidFocus=new m,this._onDidHide=new g,this._onDidShow=new g,this.onDidSelect=this._onDidSelect.event,this.onDidFocus=this._onDidFocus.event,this.onDidHide=this._onDidHide.event,this.onDidShow=this._onDidShow.event,this._onDetailsKeydown=new g,this.onDetailsKeyDown=this._onDetailsKeydown.event,this.element=new Bm,this.element.domNode.classList.add(`editor-widget`,`suggest-widget`),this._contentWidget=new pw(this,e),this._persistedSize=new dw(t,e);class o{constructor(e,t,n=!1,r=!1){this.persistedSize=e,this.currentSize=t,this.persistHeight=n,this.persistWidth=r}}let s;this._disposables.add(this.element.onDidWillResize(()=>{this._contentWidget.lockPreference(),s=new o(this._persistedSize.restore(),this.element.size)})),this._disposables.add(this.element.onDidResize(e=>{if(this._resize(e.dimension.width,e.dimension.height),s&&(s.persistHeight=s.persistHeight||!!e.north||!!e.south,s.persistWidth=s.persistWidth||!!e.east||!!e.west),e.done){if(s){let{itemHeight:e,defaultSize:t}=this.getLayoutInfo(),n=Math.round(e/2),{width:r,height:i}=this.element.size;(!s.persistHeight||Math.abs(s.currentSize.height-i)<=n)&&(i=s.persistedSize?.height??t.height),(!s.persistWidth||Math.abs(s.currentSize.width-r)<=n)&&(r=s.persistedSize?.width??t.width),this._persistedSize.store(new A(r,i))}this._contentWidget.unlockPreference(),s=void 0}})),this._messageElement=M(this.element.domNode,O(`.message`)),this._listElement=M(this.element.domNode,O(`.tree`));let c=this._disposables.add(a.createInstance(KC,this.editor));c.onDidClose(this.toggleDetails,this,this._disposables),this._details=new qC(c,this.editor);let u=()=>this.element.domNode.classList.toggle(`no-icons`,!this.editor.getOption(119).showIcons);u();let d=a.createInstance(iw,this.editor);this._disposables.add(d),this._disposables.add(d.onDidToggleDetails(()=>this.toggleDetails())),this._list=new Ka(`SuggestWidget`,this._listElement,{getHeight:e=>this.getLayoutInfo().itemHeight,getTemplateId:e=>`suggestion`},[d],{alwaysConsumeMouseWheel:!0,useShadows:!1,mouseSupport:!1,multipleSelectionSupport:!1,accessibilityProvider:{getRole:()=>`option`,getWidgetAriaLabel:()=>S(`suggest`,`Suggest`),getWidgetRole:()=>`listbox`,getAriaLabel:e=>{let t=e.textLabel;if(typeof e.completion.label!=`string`){let{detail:n,description:r}=e.completion.label;n&&r?t=S(`label.full`,`{0} {1}, {2}`,t,n,r):n?t=S(`label.detail`,`{0} {1}`,t,n):r&&(t=S(`label.desc`,`{0}, {1}`,t,r))}if(!e.isResolved||!this._isDetailsVisible())return t;let{documentation:n,detail:r}=e.completion,i=dn(`{0}{1}`,r||``,n?typeof n==`string`?n:n.value:``);return S(`ariaCurrenttSuggestionReadDetails`,`{0}, docs: {1}`,t,i)}}}),this._list.style(Sa({listInactiveFocusBackground:uw,listInactiveFocusOutline:_t})),this._status=a.createInstance(HC,this.element.domNode,bS);let f=()=>this.element.domNode.classList.toggle(`with-status-bar`,this.editor.getOption(119).showStatusBar);f(),this._disposables.add(i.onDidColorThemeChange(e=>this._onThemeChange(e))),this._onThemeChange(i.getColorTheme()),this._disposables.add(this._list.onMouseDown(e=>this._onListMouseDownOrTap(e))),this._disposables.add(this._list.onTap(e=>this._onListMouseDownOrTap(e))),this._disposables.add(this._list.onDidChangeSelection(e=>this._onListSelection(e))),this._disposables.add(this._list.onDidChangeFocus(e=>this._onListFocus(e))),this._disposables.add(this.editor.onDidChangeCursorSelection(()=>this._onCursorSelectionChanged())),this._disposables.add(this.editor.onDidChangeConfiguration(e=>{e.hasChanged(119)&&(f(),u()),this._completionModel&&(e.hasChanged(50)||e.hasChanged(120)||e.hasChanged(121))&&this._list.splice(0,this._list.length,this._completionModel.items)})),this._ctxSuggestWidgetVisible=$.Visible.bindTo(r),this._ctxSuggestWidgetDetailsVisible=$.DetailsVisible.bindTo(r),this._ctxSuggestWidgetMultipleSuggestions=$.MultipleSuggestions.bindTo(r),this._ctxSuggestWidgetHasFocusedSuggestion=$.HasFocusedSuggestion.bindTo(r),this._disposables.add(Gn(this._details.widget.domNode,`keydown`,e=>{this._onDetailsKeydown.fire(e)})),this._disposables.add(this.editor.onMouseDown(e=>this._onEditorMouseDown(e)))}dispose(){this._details.widget.dispose(),this._details.dispose(),this._list.dispose(),this._status.dispose(),this._disposables.dispose(),this._loadingTimeout?.dispose(),this._pendingLayout.dispose(),this._pendingShowDetails.dispose(),this._showTimeout.dispose(),this._contentWidget.dispose(),this.element.dispose()}_onEditorMouseDown(e){this._details.widget.domNode.contains(e.target.element)?this._details.widget.domNode.focus():this.element.domNode.contains(e.target.element)&&this.editor.focus()}_onCursorSelectionChanged(){this._state!==0&&this._contentWidget.layout()}_onListMouseDownOrTap(e){e.element===void 0||e.index===void 0||(e.browserEvent.preventDefault(),e.browserEvent.stopPropagation(),this._select(e.element,e.index))}_onListSelection(e){e.elements.length&&this._select(e.elements[0],e.indexes[0])}_select(e,t){let n=this._completionModel;n&&(this._onDidSelect.fire({item:e,index:t,model:n}),this.editor.focus())}_onThemeChange(e){this._details.widget.borderWidth=Mn(e.type)?2:1}_onListFocus(e){if(this._ignoreFocusEvents)return;if(!e.elements.length){this._currentSuggestionDetails&&(this._currentSuggestionDetails.cancel(),this._currentSuggestionDetails=void 0,this._focusedItem=void 0),this.editor.setAriaOptions({activeDescendant:void 0}),this._ctxSuggestWidgetHasFocusedSuggestion.set(!1);return}if(!this._completionModel)return;this._ctxSuggestWidgetHasFocusedSuggestion.set(!0);let t=e.elements[0],n=e.indexes[0];t!==this._focusedItem&&(this._currentSuggestionDetails?.cancel(),this._currentSuggestionDetails=void 0,this._focusedItem=t,this._list.reveal(n),this._currentSuggestionDetails=et(async e=>{let n=on(()=>{this._isDetailsVisible()&&this.showDetails(!0)},250),r=e.onCancellationRequested(()=>n.dispose());try{return await t.resolve(e)}finally{n.dispose(),r.dispose()}}),this._currentSuggestionDetails.then(()=>{n>=this._list.length||t!==this._list.element(n)||(this._ignoreFocusEvents=!0,this._list.splice(n,1,[t]),this._list.setFocus([n]),this._ignoreFocusEvents=!1,this._isDetailsVisible()?this.showDetails(!1):this.element.domNode.classList.remove(`docs-side`),this.editor.setAriaOptions({activeDescendant:tw(n)}))}).catch(C)),this._onDidFocus.fire({item:t,index:n,model:this._completionModel})}_setState(e){if(this._state!==e)switch(this._state=e,this.element.domNode.classList.toggle(`frozen`,e===4),this.element.domNode.classList.remove(`message`),e){case 0:yr(this._messageElement,this._listElement,this._status.element),this._details.hide(!0),this._status.hide(),this._contentWidget.hide(),this._ctxSuggestWidgetVisible.reset(),this._ctxSuggestWidgetMultipleSuggestions.reset(),this._ctxSuggestWidgetHasFocusedSuggestion.reset(),this._showTimeout.cancel(),this.element.domNode.classList.remove(`visible`),this._list.splice(0,this._list.length),this._focusedItem=void 0,this._cappedHeight=void 0,this._explainMode=!1;break;case 1:this.element.domNode.classList.add(`message`),this._messageElement.textContent=cw.LOADING_MESSAGE,yr(this._listElement,this._status.element),Cn(this._messageElement),this._details.hide(),this._show(),this._focusedItem=void 0,Il(cw.LOADING_MESSAGE);break;case 2:this.element.domNode.classList.add(`message`),this._messageElement.textContent=cw.NO_SUGGESTIONS_MESSAGE,yr(this._listElement,this._status.element),Cn(this._messageElement),this._details.hide(),this._show(),this._focusedItem=void 0,Il(cw.NO_SUGGESTIONS_MESSAGE);break;case 3:yr(this._messageElement),Cn(this._listElement,this._status.element),this._show();break;case 4:yr(this._messageElement),Cn(this._listElement,this._status.element),this._show();break;case 5:yr(this._messageElement),Cn(this._listElement,this._status.element),this._details.show(),this._show();break}}_show(){this._status.show(),this._contentWidget.show(),this._layout(this._persistedSize.restore()),this._ctxSuggestWidgetVisible.set(!0),this._showTimeout.cancelAndSet(()=>{this.element.domNode.classList.add(`visible`),this._onDidShow.fire(this)},100)}showTriggered(e,t){this._state===0&&(this._contentWidget.setPosition(this.editor.getPosition()),this._isAuto=!!e,this._isAuto||(this._loadingTimeout=on(()=>this._setState(1),t)))}showSuggestions(e,t,n,r,i){if(this._contentWidget.setPosition(this.editor.getPosition()),this._loadingTimeout?.dispose(),this._currentSuggestionDetails?.cancel(),this._currentSuggestionDetails=void 0,this._completionModel!==e&&(this._completionModel=e),n&&this._state!==2&&this._state!==0){this._setState(4);return}let a=this._completionModel.items.length,o=a===0;if(this._ctxSuggestWidgetMultipleSuggestions.set(a>1),o){this._setState(r?0:2),this._completionModel=void 0;return}this._focusedItem=void 0,this._onDidFocus.pause(),this._onDidSelect.pause();try{this._list.splice(0,this._list.length,this._completionModel.items),this._setState(n?4:3),this._list.reveal(t,0),this._list.setFocus(i?[]:[t])}finally{this._onDidFocus.resume(),this._onDidSelect.resume()}this._pendingLayout.value=Wn(pt(this.element.domNode),()=>{this._pendingLayout.clear(),this._layout(this.element.size),this._details.widget.domNode.classList.remove(`focused`)})}focusSelected(){this._list.length>0&&this._list.setFocus([0])}selectNextPage(){switch(this._state){case 0:return!1;case 5:return this._details.widget.pageDown(),!0;case 1:return!this._isAuto;default:return this._list.focusNextPage(),!0}}selectNext(){switch(this._state){case 0:return!1;case 1:return!this._isAuto;default:return this._list.focusNext(1,!0),!0}}selectLast(){switch(this._state){case 0:return!1;case 5:return this._details.widget.scrollBottom(),!0;case 1:return!this._isAuto;default:return this._list.focusLast(),!0}}selectPreviousPage(){switch(this._state){case 0:return!1;case 5:return this._details.widget.pageUp(),!0;case 1:return!this._isAuto;default:return this._list.focusPreviousPage(),!0}}selectPrevious(){switch(this._state){case 0:return!1;case 1:return!this._isAuto;default:return this._list.focusPrevious(1,!0),!1}}selectFirst(){switch(this._state){case 0:return!1;case 5:return this._details.widget.scrollTop(),!0;case 1:return!this._isAuto;default:return this._list.focusFirst(),!0}}getFocusedItem(){if(this._state!==0&&this._state!==2&&this._state!==1&&this._completionModel&&this._list.getFocus().length>0)return{item:this._list.getFocusedElements()[0],index:this._list.getFocus()[0],model:this._completionModel}}toggleDetailsFocus(){this._state===5?(this._setState(3),this._details.widget.domNode.classList.remove(`focused`)):this._state===3&&this._isDetailsVisible()&&(this._setState(5),this._details.widget.domNode.classList.add(`focused`))}toggleDetails(){this._isDetailsVisible()?(this._pendingShowDetails.clear(),this._ctxSuggestWidgetDetailsVisible.set(!1),this._setDetailsVisible(!1),this._details.hide(),this.element.domNode.classList.remove(`shows-details`)):(GC(this._list.getFocusedElements()[0])||this._explainMode)&&(this._state===3||this._state===5||this._state===4)&&(this._ctxSuggestWidgetDetailsVisible.set(!0),this._setDetailsVisible(!0),this.showDetails(!1))}showDetails(e){this._pendingShowDetails.value=Wn(pt(this.element.domNode),()=>{this._pendingShowDetails.clear(),this._details.show(),e?this._details.widget.renderLoading():this._details.widget.renderItem(this._list.getFocusedElements()[0],this._explainMode),this._details.widget.isEmpty?this._details.hide():(this._positionDetails(),this.element.domNode.classList.add(`shows-details`)),this.editor.focus()})}toggleExplainMode(){this._list.getFocusedElements()[0]&&(this._explainMode=!this._explainMode,this._isDetailsVisible()?this.showDetails(!1):this.toggleDetails())}resetPersistedSize(){this._persistedSize.reset()}hideWidget(){this._pendingLayout.clear(),this._pendingShowDetails.clear(),this._loadingTimeout?.dispose(),this._setState(0),this._onDidHide.fire(this),this.element.clearSashHoverState();let e=this._persistedSize.restore(),t=Math.ceil(this.getLayoutInfo().itemHeight*4.3);e&&e.height<t&&this._persistedSize.store(e.with(void 0,t))}isFrozen(){return this._state===4}_afterRender(e){if(e===null){this._isDetailsVisible()&&this._details.hide();return}this._state===2||this._state===1||(this._isDetailsVisible()&&!this._details.widget.isEmpty&&this._details.show(),this._positionDetails())}_layout(e){if(!this.editor.hasModel()||!this.editor.getDomNode())return;let t=jt(this.element.domNode.ownerDocument.body),n=this.getLayoutInfo();e||=n.defaultSize;let r=e.height,i=e.width;if(this._status.element.style.height=`${n.itemHeight}px`,this._state===2||this._state===1)r=n.itemHeight+n.borderHeight,i=n.defaultSize.width/2,this.element.enableSashes(!1,!1,!1,!1),this.element.minSize=this.element.maxSize=new A(i,r),this._contentWidget.setPreference(2);else{let a=t.width-n.borderHeight-2*n.horizontalPadding;i>a&&(i=a);let o=this._completionModel?this._completionModel.stats.pLabelLen*n.typicalHalfwidthCharacterWidth:i,s=n.statusBarHeight+this._list.contentHeight+n.borderHeight,c=n.itemHeight+n.statusBarHeight,l=gt(this.editor.getDomNode()),u=this.editor.getScrolledVisiblePosition(this.editor.getPosition()),d=l.top+u.top+u.height,f=Math.min(t.height-d-n.verticalPadding,s),p=l.top+u.top-n.verticalPadding,m=Math.min(p,s),h=Math.min(Math.max(m,f)+n.borderHeight,s);r===this._cappedHeight?.capped&&(r=this._cappedHeight.wanted),r<c&&(r=c),r>h&&(r=h),r>f||this._forceRenderingAbove&&p>150?(this._contentWidget.setPreference(1),this.element.enableSashes(!0,!0,!1,!1),h=m):(this._contentWidget.setPreference(2),this.element.enableSashes(!1,!0,!0,!1),h=f),this.element.preferredSize=new A(o,n.defaultSize.height),this.element.maxSize=new A(a,h),this.element.minSize=new A(220,c),this._cappedHeight=r===s?{wanted:this._cappedHeight?.wanted??e.height,capped:r}:void 0}this._resize(i,r)}_resize(e,t){let{width:n,height:r}=this.element.maxSize;e=Math.min(n,e),t=Math.min(r,t);let{statusBarHeight:i}=this.getLayoutInfo();this._list.layout(t-i,e),this._listElement.style.height=`${t-i}px`,this.element.layout(t,e),this._contentWidget.layout(),this._positionDetails()}_positionDetails(){this._isDetailsVisible()&&this._details.placeAtAnchor(this.element.domNode,this._contentWidget.getPosition()?.preference[0]===2)}getLayoutInfo(){let e=this.editor.getOption(50),t=Do(this.editor.getOption(121)||e.lineHeight,8,1e3),n=!this.editor.getOption(119).showStatusBar||this._state===2||this._state===1?0:t,r=this._details.widget.borderWidth,i=2*r;return{itemHeight:t,statusBarHeight:n,borderWidth:r,borderHeight:i,typicalHalfwidthCharacterWidth:e.typicalHalfwidthCharacterWidth,verticalPadding:22,horizontalPadding:14,defaultSize:new A(430,n+12*t+i)}}_isDetailsVisible(){return this._storageService.getBoolean(`expandSuggestionDocs`,0,!1)}_setDetailsVisible(e){this._storageService.store(`expandSuggestionDocs`,e,0,0)}forceRenderingAbove(){this._forceRenderingAbove||(this._forceRenderingAbove=!0,this._layout(this._persistedSize.restore()))}stopForceRenderingAbove(){this._forceRenderingAbove=!1}};fw=cw=ow([sw(1,Pa),sw(2,W),sw(3,Zc),sw(4,Y)],fw);var pw=class{constructor(e,t){this._widget=e,this._editor=t,this.allowEditorOverflow=!0,this.suppressMouseDown=!1,this._preferenceLocked=!1,this._added=!1,this._hidden=!1}dispose(){this._added&&(this._added=!1,this._editor.removeContentWidget(this))}getId(){return`editor.widget.suggestWidget`}getDomNode(){return this._widget.element.domNode}show(){this._hidden=!1,this._added||(this._added=!0,this._editor.addContentWidget(this))}hide(){this._hidden||(this._hidden=!0,this.layout())}layout(){this._editor.layoutContentWidget(this)}getPosition(){return this._hidden||!this._position||!this._preference?null:{position:this._position,preference:[this._preference]}}beforeRender(){let{height:e,width:t}=this._widget.element.size,{borderWidth:n,horizontalPadding:r}=this._widget.getLayoutInfo();return new A(t+2*n+r,e+2*n)}afterRender(e){this._widget._afterRender(e)}setPreference(e){this._preferenceLocked||(this._preference=e)}lockPreference(){this._preferenceLocked=!0}unlockPreference(){this._preferenceLocked=!1}setPosition(e){this._position=e}},mw=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},hw=function(e,t){return function(n,r){t(n,r,e)}},gw,_w=class{constructor(e,t){if(this._model=e,this._position=t,this._decorationOptions=U.register({description:`suggest-line-suffix`,stickiness:1}),e.getLineMaxColumn(t.lineNumber)!==t.column){let n=e.getOffsetAt(t),r=e.getPositionAt(n+1);e.changeDecorations(e=>{this._marker&&e.removeDecoration(this._marker),this._marker=e.addDecoration(T.fromPositions(t,r),this._decorationOptions)})}}dispose(){this._marker&&!this._model.isDisposed()&&this._model.changeDecorations(e=>{e.removeDecoration(this._marker),this._marker=void 0})}delta(e){if(this._model.isDisposed()||this._position.lineNumber!==e.lineNumber)return 0;if(this._marker){let t=this._model.getDecorationRange(this._marker);return this._model.getOffsetAt(t.getStartPosition())-this._model.getOffsetAt(e)}else return this._model.getLineMaxColumn(e.lineNumber)-e.column}},vw=class{static#e=gw=this;static#t=this.ID=`editor.contrib.suggestController`;static get(e){return e.getContribution(gw.ID)}constructor(e,t,i,a,o,s,c){this._memoryService=t,this._commandService=i,this._contextKeyService=a,this._instantiationService=o,this._logService=s,this._telemetryService=c,this._lineSuffix=new l,this._toDispose=new n,this._selectors=new yw(e=>e.priority),this._onWillInsertSuggestItem=new g,this.onWillInsertSuggestItem=this._onWillInsertSuggestItem.event,this.editor=e,this.model=o.createInstance(RC,this.editor),this._selectors.register({priority:0,select:(e,t,n)=>this._memoryService.select(e,t,n)});let u=$.InsertMode.bindTo(a);u.set(e.getOption(119).insertMode),this._toDispose.add(this.model.onDidTrigger(()=>u.set(e.getOption(119).insertMode))),this.widget=this._toDispose.add(new Hn(pt(e.getDomNode()),()=>{let e=this._instantiationService.createInstance(fw,this.editor);this._toDispose.add(e),this._toDispose.add(e.onDidSelect(e=>this._insertSuggestion(e,0),this));let t=new DC(this.editor,e,this.model,e=>this._insertSuggestion(e,2));this._toDispose.add(t);let n=$.MakesTextEdit.bindTo(this._contextKeyService),i=$.HasInsertAndReplaceRange.bindTo(this._contextKeyService),a=$.CanResolve.bindTo(this._contextKeyService);return this._toDispose.add(b(()=>{n.reset(),i.reset(),a.reset()})),this._toDispose.add(e.onDidFocus(({item:e})=>{let t=this.editor.getPosition(),o=e.editStart.column,s=t.column,c=!0;this.editor.getOption(1)===`smart`&&this.model.state===2&&!e.completion.additionalTextEdits&&!(e.completion.insertTextRules&4)&&s-o===e.completion.insertText.length&&(c=this.editor.getModel().getValueInRange({startLineNumber:t.lineNumber,startColumn:o,endLineNumber:t.lineNumber,endColumn:s})!==e.completion.insertText),n.set(c),i.set(!r.equals(e.editInsertEnd,e.editReplaceEnd)),a.set(!!e.provider.resolveCompletionItem||!!e.completion.documentation||e.completion.detail!==e.completion.label)})),this._toDispose.add(e.onDetailsKeyDown(e=>{if(e.toKeyCodeChord().equals(new bn(!0,!1,!1,!1,33))||Le&&e.toKeyCodeChord().equals(new bn(!1,!1,!1,!0,33))){e.stopPropagation();return}e.toKeyCodeChord().isModifierKey()||this.editor.focus()})),e})),this._overtypingCapturer=this._toDispose.add(new Hn(pt(e.getDomNode()),()=>this._toDispose.add(new zC(this.editor,this.model)))),this._alternatives=this._toDispose.add(new Hn(pt(e.getDomNode()),()=>this._toDispose.add(new EC(this.editor,this._contextKeyService)))),this._toDispose.add(o.createInstance(SC,e)),this._toDispose.add(this.model.onDidTrigger(e=>{this.widget.value.showTriggered(e.auto,e.shy?250:50),this._lineSuffix.value=new _w(this.editor.getModel(),e.position)})),this._toDispose.add(this.model.onDidSuggest(e=>{if(e.triggerOptions.shy)return;let t=-1;for(let n of this._selectors.itemsOrderedByPriorityDesc)if(t=n.select(this.editor.getModel(),this.editor.getPosition(),e.completionModel.items),t!==-1)break;if(t===-1&&(t=0),this.model.state===0)return;let n=!1;if(e.triggerOptions.auto){let t=this.editor.getOption(119);t.selectionMode===`never`||t.selectionMode===`always`?n=t.selectionMode===`never`:t.selectionMode===`whenTriggerCharacter`?n=e.triggerOptions.triggerKind!==1:t.selectionMode===`whenQuickSuggestion`&&(n=e.triggerOptions.triggerKind===1&&!e.triggerOptions.refilter)}this.widget.value.showSuggestions(e.completionModel,t,e.isFrozen,e.triggerOptions.auto,n)})),this._toDispose.add(this.model.onDidCancel(e=>{e.retrigger||this.widget.value.hideWidget()})),this._toDispose.add(this.editor.onDidBlurEditorWidget(()=>{this.model.cancel(),this.model.clear()}));let d=$.AcceptSuggestionsOnEnter.bindTo(a),f=()=>{let e=this.editor.getOption(1);d.set(e===`on`||e===`smart`)};this._toDispose.add(this.editor.onDidChangeConfiguration(()=>f())),f()}dispose(){this._alternatives.dispose(),this._toDispose.dispose(),this.widget.dispose(),this.model.dispose(),this._lineSuffix.dispose(),this._onWillInsertSuggestItem.dispose()}_insertSuggestion(e,t){if(!e||!e.item){this._alternatives.value.reset(),this.model.cancel(),this.model.clear();return}if(!this.editor.hasModel())return;let n=tC.get(this.editor);if(!n)return;this._onWillInsertSuggestItem.fire({item:e.item});let i=this.editor.getModel(),a=i.getAlternativeVersionId(),{item:o}=e,s=[],c=new ie;t&1||this.editor.pushUndoStop();let l=this.getOverwriteInfo(o,!!(t&8));this._memoryService.memorize(i,this.editor.getPosition(),o);let d=o.isResolved,f=-1,p=-1;if(Array.isArray(o.completion.additionalTextEdits)){this.model.cancel();let e=Xi.capture(this.editor);this.editor.executeEdits(`suggestController.additionalTextEdits.sync`,o.completion.additionalTextEdits.map(e=>{let t=T.lift(e.range);if(t.startLineNumber===o.position.lineNumber&&t.startColumn>o.position.column){let e=this.editor.getPosition().column-o.position.column,n=e,r=T.spansMultipleLines(t)?0:e;t=new T(t.startLineNumber,t.startColumn+n,t.endLineNumber,t.endColumn+r)}return Fa.replaceMove(t,e.text)})),e.restoreRelativeVerticalPositionOfCursor(this.editor)}else if(!d){let e=new u,n,a=i.onDidChangeContent(e=>{if(e.isFlush){c.cancel(),a.dispose();return}for(let t of e.changes){let e=T.getEndPosition(t.range);(!n||r.isBefore(e,n))&&(n=e)}}),l=t;t|=2;let d=!1,f=this.editor.onWillType(()=>{f.dispose(),d=!0,l&2||this.editor.pushUndoStop()});s.push(o.resolve(c.token).then(()=>{if(!o.completion.additionalTextEdits||c.token.isCancellationRequested)return;if(n&&o.completion.additionalTextEdits.some(e=>r.isBefore(n,T.getStartPosition(e.range))))return!1;d&&this.editor.pushUndoStop();let e=Xi.capture(this.editor);return this.editor.executeEdits(`suggestController.additionalTextEdits.async`,o.completion.additionalTextEdits.map(e=>Fa.replaceMove(T.lift(e.range),e.text))),e.restoreRelativeVerticalPositionOfCursor(this.editor),(d||!(l&2))&&this.editor.pushUndoStop(),!0}).then(t=>{this._logService.trace(`[suggest] async resolving of edits DONE (ms, applied?)`,e.elapsed(),t),p=t===!0?1:t===!1?0:-2}).finally(()=>{a.dispose(),f.dispose()}))}let{insertText:m}=o.completion;if(o.completion.insertTextRules&4||(m=dd.escape(m)),this.model.cancel(),n.insert(m,{overwriteBefore:l.overwriteBefore,overwriteAfter:l.overwriteAfter,undoStopBefore:!1,undoStopAfter:!1,adjustWhitespace:!(o.completion.insertTextRules&1),clipboardText:e.model.clipboardText,overtypingCapturer:this._overtypingCapturer.value}),t&2||this.editor.pushUndoStop(),o.completion.command)if(o.completion.command.id===bw.id)this.model.trigger({auto:!0,retrigger:!0});else{let e=new u;s.push(this._commandService.executeCommand(o.completion.command.id,...o.completion.command.arguments?[...o.completion.command.arguments]:[]).catch(e=>{o.completion.extensionId?Re(e):C(e)}).finally(()=>{f=e.elapsed()}))}t&4&&this._alternatives.value.set(e,e=>{for(c.cancel();i.canUndo();){a!==i.getAlternativeVersionId()&&i.undo(),this._insertSuggestion(e,3|(t&8?8:0));break}}),this._alertCompletionItem(o),Promise.all(s).finally(()=>{this._reportSuggestionAcceptedTelemetry(o,i,d,f,p,e.index,e.model.items),this.model.clear(),c.dispose()})}_reportSuggestionAcceptedTelemetry(e,t,n,r,i,a,o){if(Math.floor(Math.random()*100)===0)return;let s=new Map;for(let e=0;e<Math.min(30,o.length);e++){let t=o[e].textLabel;s.has(t)?s.get(t).push(e):s.set(t,[e])}let c=s.get(e.textLabel),l=c&&c.length>1?c[0]:-1;this._telemetryService.publicLog2(`suggest.acceptedSuggestion`,{extensionId:e.extensionId?.value??`unknown`,providerId:e.provider._debugDisplayName??`unknown`,kind:e.completion.kind,basenameHash:Ir(bc(t.uri)).toString(16),languageId:t.getLanguageId(),fileExtension:Tc(t.uri),resolveInfo:e.provider.resolveCompletionItem?n?1:0:-1,resolveDuration:e.resolveDuration,commandDuration:r,additionalEditsAsync:i,index:a,firstIndex:l})}getOverwriteInfo(e,t){o(this.editor.hasModel());let n=this.editor.getOption(119).insertMode===`replace`;t&&(n=!n);let r=e.position.column-e.editStart.column,i=(n?e.editReplaceEnd.column:e.editInsertEnd.column)-e.position.column,a=this.editor.getPosition().column-e.position.column,s=this._lineSuffix.value?this._lineSuffix.value.delta(this.editor.getPosition()):0;return{overwriteBefore:r+a,overwriteAfter:i+s}}_alertCompletionItem(e){On(e.completion.additionalTextEdits)&&qa(S(`aria.alert.snippet`,`Accepting '{0}' made {1} additional edits`,e.textLabel,e.completion.additionalTextEdits.length))}triggerSuggest(e,t,n){this.editor.hasModel()&&(this.model.trigger({auto:t??!1,completionOptions:{providerFilter:e,kindFilter:n?new Set:void 0}}),this.editor.revealPosition(this.editor.getPosition(),0),this.editor.focus())}triggerSuggestAndAcceptBest(e){if(!this.editor.hasModel())return;let t=this.editor.getPosition(),n=()=>{t.equals(this.editor.getPosition())&&this._commandService.executeCommand(e.fallback)},r=e=>{if(e.completion.insertTextRules&4||e.completion.additionalTextEdits)return!0;let t=this.editor.getPosition(),n=e.editStart.column,r=t.column;return r-n===e.completion.insertText.length?this.editor.getModel().getValueInRange({startLineNumber:t.lineNumber,startColumn:n,endLineNumber:t.lineNumber,endColumn:r})!==e.completion.insertText:!0};we.once(this.model.onDidTrigger)(e=>{let t=[];we.any(this.model.onDidTrigger,this.model.onDidCancel)(()=>{c(t),n()},void 0,t),this.model.onDidSuggest(({completionModel:e})=>{if(c(t),e.items.length===0){n();return}let i=this._memoryService.select(this.editor.getModel(),this.editor.getPosition(),e.items),a=e.items[i];if(!r(a)){n();return}this.editor.pushUndoStop(),this._insertSuggestion({index:i,item:a,model:e},7)},void 0,t)}),this.model.trigger({auto:!1,shy:!0}),this.editor.revealPosition(t,0),this.editor.focus()}acceptSelectedSuggestion(e,t){let n=this.widget.value.getFocusedItem(),r=0;e&&(r|=4),t&&(r|=8),this._insertSuggestion(n,r)}acceptNextSuggestion(){this._alternatives.value.next()}acceptPrevSuggestion(){this._alternatives.value.prev()}cancelSuggestWidget(){this.model.cancel(),this.model.clear(),this.widget.value.hideWidget()}focusSuggestion(){this.widget.value.focusSelected()}selectNextSuggestion(){this.widget.value.selectNext()}selectNextPageSuggestion(){this.widget.value.selectNextPage()}selectLastSuggestion(){this.widget.value.selectLast()}selectPrevSuggestion(){this.widget.value.selectPrevious()}selectPrevPageSuggestion(){this.widget.value.selectPreviousPage()}selectFirstSuggestion(){this.widget.value.selectFirst()}toggleSuggestionDetails(){this.widget.value.toggleDetails()}toggleExplainMode(){this.widget.value.toggleExplainMode()}toggleSuggestionFocus(){this.widget.value.toggleDetailsFocus()}resetWidgetSize(){this.widget.value.resetPersistedSize()}forceRenderingAbove(){this.widget.value.forceRenderingAbove()}stopForceRenderingAbove(){this.widget.isInitialized&&this.widget.value.stopForceRenderingAbove()}registerSelector(e){return this._selectors.register(e)}};vw=gw=mw([hw(1,vC),hw(2,lc),hw(3,W),hw(4,Y),hw(5,Fc),hw(6,Zi)],vw);var yw=class{constructor(e){this.prioritySelector=e,this._items=[]}register(e){if(this._items.indexOf(e)!==-1)throw Error(`Value is already registered`);return this._items.push(e),this._items.sort((e,t)=>this.prioritySelector(t)-this.prioritySelector(e)),{dispose:()=>{let t=this._items.indexOf(e);t>=0&&this._items.splice(t,1)}}}get itemsOrderedByPriorityDesc(){return this._items}},bw=class e extends N{static#e=this.id=`editor.action.triggerSuggest`;constructor(){super({id:e.id,label:S(`suggest.trigger.label`,`Trigger Suggest`),alias:`Trigger Suggest`,precondition:z.and(q.writable,q.hasCompletionItemProvider,$.Visible.toNegated()),kbOpts:{kbExpr:q.textInputFocus,primary:2058,secondary:[2087],mac:{primary:266,secondary:[521,2087]},weight:100}})}run(e,t,n){let r=vw.get(t);if(!r)return;let i;n&&typeof n==`object`&&n.auto===!0&&(i=!0),r.triggerSuggest(void 0,i,void 0)}};I(vw.ID,vw,2),L(bw);var xw=190,Sw=la.bindToContribution(vw.get);P(new Sw({id:`acceptSelectedSuggestion`,precondition:z.and($.Visible,$.HasFocusedSuggestion),handler(e){e.acceptSelectedSuggestion(!0,!1)},kbOpts:[{primary:2,kbExpr:z.and($.Visible,q.textInputFocus),weight:xw},{primary:3,kbExpr:z.and($.Visible,q.textInputFocus,$.AcceptSuggestionsOnEnter,$.MakesTextEdit),weight:xw}],menuOpts:[{menuId:bS,title:S(`accept.insert`,`Insert`),group:`left`,order:1,when:$.HasInsertAndReplaceRange.toNegated()},{menuId:bS,title:S(`accept.insert`,`Insert`),group:`left`,order:1,when:z.and($.HasInsertAndReplaceRange,$.InsertMode.isEqualTo(`insert`))},{menuId:bS,title:S(`accept.replace`,`Replace`),group:`left`,order:1,when:z.and($.HasInsertAndReplaceRange,$.InsertMode.isEqualTo(`replace`))}]})),P(new Sw({id:`acceptAlternativeSelectedSuggestion`,precondition:z.and($.Visible,q.textInputFocus,$.HasFocusedSuggestion),kbOpts:{weight:xw,kbExpr:q.textInputFocus,primary:1027,secondary:[1026]},handler(e){e.acceptSelectedSuggestion(!1,!0)},menuOpts:[{menuId:bS,group:`left`,order:2,when:z.and($.HasInsertAndReplaceRange,$.InsertMode.isEqualTo(`insert`)),title:S(`accept.replace`,`Replace`)},{menuId:bS,group:`left`,order:2,when:z.and($.HasInsertAndReplaceRange,$.InsertMode.isEqualTo(`replace`)),title:S(`accept.insert`,`Insert`)}]})),B.registerCommandAlias(`acceptSelectedSuggestionOnEnter`,`acceptSelectedSuggestion`),P(new Sw({id:`hideSuggestWidget`,precondition:$.Visible,handler:e=>e.cancelSuggestWidget(),kbOpts:{weight:xw,kbExpr:q.textInputFocus,primary:9,secondary:[1033]}})),P(new Sw({id:`selectNextSuggestion`,precondition:z.and($.Visible,z.or($.MultipleSuggestions,$.HasFocusedSuggestion.negate())),handler:e=>e.selectNextSuggestion(),kbOpts:{weight:xw,kbExpr:q.textInputFocus,primary:18,secondary:[2066],mac:{primary:18,secondary:[2066,300]}}})),P(new Sw({id:`selectNextPageSuggestion`,precondition:z.and($.Visible,z.or($.MultipleSuggestions,$.HasFocusedSuggestion.negate())),handler:e=>e.selectNextPageSuggestion(),kbOpts:{weight:xw,kbExpr:q.textInputFocus,primary:12,secondary:[2060]}})),P(new Sw({id:`selectLastSuggestion`,precondition:z.and($.Visible,z.or($.MultipleSuggestions,$.HasFocusedSuggestion.negate())),handler:e=>e.selectLastSuggestion()})),P(new Sw({id:`selectPrevSuggestion`,precondition:z.and($.Visible,z.or($.MultipleSuggestions,$.HasFocusedSuggestion.negate())),handler:e=>e.selectPrevSuggestion(),kbOpts:{weight:xw,kbExpr:q.textInputFocus,primary:16,secondary:[2064],mac:{primary:16,secondary:[2064,302]}}})),P(new Sw({id:`selectPrevPageSuggestion`,precondition:z.and($.Visible,z.or($.MultipleSuggestions,$.HasFocusedSuggestion.negate())),handler:e=>e.selectPrevPageSuggestion(),kbOpts:{weight:xw,kbExpr:q.textInputFocus,primary:11,secondary:[2059]}})),P(new Sw({id:`selectFirstSuggestion`,precondition:z.and($.Visible,z.or($.MultipleSuggestions,$.HasFocusedSuggestion.negate())),handler:e=>e.selectFirstSuggestion()})),P(new Sw({id:`focusSuggestion`,precondition:z.and($.Visible,$.HasFocusedSuggestion.negate()),handler:e=>e.focusSuggestion(),kbOpts:{weight:xw,kbExpr:q.textInputFocus,primary:2058,secondary:[2087],mac:{primary:266,secondary:[2087]}}})),P(new Sw({id:`focusAndAcceptSuggestion`,precondition:z.and($.Visible,$.HasFocusedSuggestion.negate()),handler:e=>{e.focusSuggestion(),e.acceptSelectedSuggestion(!0,!1)}})),P(new Sw({id:`toggleSuggestionDetails`,precondition:z.and($.Visible,$.HasFocusedSuggestion),handler:e=>e.toggleSuggestionDetails(),kbOpts:{weight:xw,kbExpr:q.textInputFocus,primary:2058,secondary:[2087],mac:{primary:266,secondary:[2087]}},menuOpts:[{menuId:bS,group:`right`,order:1,when:z.and($.DetailsVisible,$.CanResolve),title:S(`detail.more`,`Show Less`)},{menuId:bS,group:`right`,order:1,when:z.and($.DetailsVisible.toNegated(),$.CanResolve),title:S(`detail.less`,`Show More`)}]})),P(new Sw({id:`toggleExplainMode`,precondition:$.Visible,handler:e=>e.toggleExplainMode(),kbOpts:{weight:100,primary:2138}})),P(new Sw({id:`toggleSuggestionFocus`,precondition:$.Visible,handler:e=>e.toggleSuggestionFocus(),kbOpts:{weight:xw,kbExpr:q.textInputFocus,primary:2570,mac:{primary:778}}})),P(new Sw({id:`insertBestCompletion`,precondition:z.and(q.textInputFocus,z.equals(`config.editor.tabCompletion`,`on`),SC.AtEnd,$.Visible.toNegated(),EC.OtherSuggestions.toNegated(),tC.InSnippetMode.toNegated()),handler:(e,t)=>{e.triggerSuggestAndAcceptBest(p(t)?{fallback:`tab`,...t}:{fallback:`tab`})},kbOpts:{weight:xw,primary:2}})),P(new Sw({id:`insertNextSuggestion`,precondition:z.and(q.textInputFocus,z.equals(`config.editor.tabCompletion`,`on`),EC.OtherSuggestions,$.Visible.toNegated(),tC.InSnippetMode.toNegated()),handler:e=>e.acceptNextSuggestion(),kbOpts:{weight:xw,kbExpr:q.textInputFocus,primary:2}})),P(new Sw({id:`insertPrevSuggestion`,precondition:z.and(q.textInputFocus,z.equals(`config.editor.tabCompletion`,`on`),EC.OtherSuggestions,$.Visible.toNegated(),tC.InSnippetMode.toNegated()),handler:e=>e.acceptPrevSuggestion(),kbOpts:{weight:xw,kbExpr:q.textInputFocus,primary:1026}})),L(class extends N{constructor(){super({id:`editor.action.resetSuggestSize`,label:S(`suggest.reset.label`,`Reset Suggest Widget Size`),alias:`Reset Suggest Widget Size`,precondition:void 0})}run(e,t){vw.get(t)?.resetWidgetSize()}});var Cw=class extends _{get selectedItem(){return this._currentSuggestItemInfo}constructor(e,t,n){super(),this.editor=e,this.suggestControllerPreselector=t,this.onWillAccept=n,this.isSuggestWidgetVisible=!1,this.isShiftKeyPressed=!1,this._isActive=!1,this._currentSuggestItemInfo=void 0,this._onDidSelectedItemChange=this._register(new g),this.onDidSelectedItemChange=this._onDidSelectedItemChange.event,this._register(e.onKeyDown(e=>{e.shiftKey&&!this.isShiftKeyPressed&&(this.isShiftKeyPressed=!0,this.update(this._isActive))})),this._register(e.onKeyUp(e=>{e.shiftKey&&this.isShiftKeyPressed&&(this.isShiftKeyPressed=!1,this.update(this._isActive))}));let i=vw.get(this.editor);if(i){this._register(i.registerSelector({priority:100,select:(e,t,n)=>{let a=this.editor.getModel();if(!a)return-1;let o=this.suggestControllerPreselector(),s=o?rS(o,a):void 0;if(!s)return-1;let c=r.lift(t),l=fs(n.map((e,t)=>{let n=rS(ww.fromSuggestion(i,a,c,e,this.isShiftKeyPressed).toSingleTextEdit(),a);return{index:t,valid:iS(s,n),prefixLength:n.text.length,suggestItem:e}}).filter(e=>e&&e.valid&&e.prefixLength>0),cn(e=>e.prefixLength,mr));return l?l.index:-1}}));let e=!1,t=()=>{e||(e=!0,this._register(i.widget.value.onDidShow(()=>{this.isSuggestWidgetVisible=!0,this.update(!0)})),this._register(i.widget.value.onDidHide(()=>{this.isSuggestWidgetVisible=!1,this.update(!1)})),this._register(i.widget.value.onDidFocus(()=>{this.isSuggestWidgetVisible=!0,this.update(!0)})))};this._register(we.once(i.model.onDidTrigger)(e=>{t()})),this._register(i.onWillInsertSuggestItem(e=>{let t=this.editor.getPosition(),n=this.editor.getModel();if(!t||!n)return;let r=ww.fromSuggestion(i,n,t,e.item,this.isShiftKeyPressed);this.onWillAccept(r)}))}this.update(this._isActive)}update(e){let t=this.getSuggestItemInfo();(this._isActive!==e||!Tw(this._currentSuggestItemInfo,t))&&(this._isActive=e,this._currentSuggestItemInfo=t,this._onDidSelectedItemChange.fire())}getSuggestItemInfo(){let e=vw.get(this.editor);if(!e||!this.isSuggestWidgetVisible)return;let t=e.widget.value.getFocusedItem(),n=this.editor.getPosition(),r=this.editor.getModel();if(!(!t||!n||!r))return ww.fromSuggestion(e,r,n,t.item,this.isShiftKeyPressed)}stopForceRenderingAbove(){vw.get(this.editor)?.stopForceRenderingAbove()}forceRenderingAbove(){vw.get(this.editor)?.forceRenderingAbove()}},ww=class e{static fromSuggestion(t,n,r,i,a){let{insertText:o}=i.completion,s=!1;if(i.completion.insertTextRules&4){let e=new dd().parse(o);e.children.length<100&&XS.adjustWhitespace(n,r,!0,e),o=e.toString(),s=!0}let c=t.getOverwriteInfo(i,a);return new e(T.fromPositions(r.delta(0,-c.overwriteBefore),r.delta(0,Math.max(c.overwriteAfter,0))),o,i.completion.kind,s)}constructor(e,t,n,r){this.range=e,this.insertText=t,this.completionItemKind=n,this.isSnippetText=r}equals(e){return this.range.equalsRange(e.range)&&this.insertText===e.insertText&&this.completionItemKind===e.completionItemKind&&this.isSnippetText===e.isSnippetText}toSelectedSuggestionInfo(){return new ke(this.range,this.insertText,this.completionItemKind,this.isSnippetText)}toSingleTextEdit(){return new wc(this.range,this.insertText)}};function Tw(e,t){return e===t?!0:!e||!t?!1:e.equals(t)}var Ew=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Dw=function(e,t){return function(n,r){t(n,r,e)}},Ow,kw=class extends _{static#e=Ow=this;static#t=this.ID=`editor.contrib.inlineCompletionsController`;static get(e){return e.getContribution(Ow.ID)}constructor(e,t,n,i,o,c,l,u,d,f){super(),this.editor=e,this._instantiationService=t,this._contextKeyService=n,this._configurationService=i,this._commandService=o,this._debounceService=c,this._languageFeaturesService=l,this._accessibilitySignalService=u,this._keybindingService=d,this._accessibilityService=f,this._editorObs=Qr(this.editor),this._positions=K(this,e=>this._editorObs.selections.read(e)?.map(e=>e.getEndPosition())??[new r(1,1)]),this._suggestWidgetAdaptor=this._register(new Cw(this.editor,()=>(this._editorObs.forceUpdate(),this.model.get()?.selectedInlineCompletion.get()?.toSingleTextEdit(void 0)),e=>this._editorObs.forceUpdate(t=>{this.model.get()?.handleSuggestAccepted(e)}))),this._suggestWidgetSelectedItem=$i(this,e=>this._suggestWidgetAdaptor.onDidSelectedItemChange(()=>{this._editorObs.forceUpdate(t=>e(void 0))}),()=>this._suggestWidgetAdaptor.selectedItem),this._enabledInConfig=$i(this,this.editor.onDidChangeConfiguration,()=>this.editor.getOption(62).enabled),this._isScreenReaderEnabled=$i(this,this._accessibilityService.onDidChangeScreenReaderOptimized,()=>this._accessibilityService.isScreenReaderOptimized()),this._editorDictationInProgress=$i(this,this._contextKeyService.onDidChangeContext,()=>this._contextKeyService.getContext(this.editor.getDomNode()).getValue(`editorDictation.inProgress`)===!0),this._enabled=K(this,e=>this._enabledInConfig.read(e)&&(!this._isScreenReaderEnabled.read(e)||!this._editorDictationInProgress.read(e))),this._debounceValue=this._debounceService.for(this._languageFeaturesService.inlineCompletionsProvider,`InlineCompletionsDebounce`,{min:50,max:50}),this.model=Sc(this,e=>{if(this._editorObs.isReadonly.read(e))return;let t=this._editorObs.model.read(e);if(t)return this._instantiationService.createInstance(aC,t,this._suggestWidgetSelectedItem,this._editorObs.versionId,this._positions,this._debounceValue,$i(this.editor.onDidChangeConfiguration,()=>this.editor.getOption(119).preview),$i(this.editor.onDidChangeConfiguration,()=>this.editor.getOption(119).previewMode),$i(this.editor.onDidChangeConfiguration,()=>this.editor.getOption(62).mode),this._enabled)}).recomputeInitiallyAndOnChange(this._store),this._ghostTexts=K(this,e=>this.model.read(e)?.ghostTexts.read(e)??[]),this._stablizedGhostTexts=Aw(this._ghostTexts,this._store),this._ghostTextWidgets=Lc(this,this._stablizedGhostTexts,(e,t)=>t.add(this._instantiationService.createInstance(Gx,this.editor,{ghostText:e,minReservedLineCount:Ii(0),targetTextModel:this.model.map(e=>e?.textModel)}))).recomputeInitiallyAndOnChange(this._store),this._playAccessibilitySignal=Po(this),this._fontFamily=$i(this,this.editor.onDidChangeConfiguration,()=>this.editor.getOption(62).fontFamily),this._register(new kx(this._contextKeyService,this.model)),this._register(Js(this._editorObs.onDidType,(e,t)=>{this._enabled.get()&&this.model.get()?.trigger()})),this._register(this._commandService.onDidExecuteCommand(t=>{new Set([Cs.Tab.id,Cs.DeleteLeft.id,Cs.DeleteRight.id,`editor.action.inlineSuggest.commit`,`acceptSelectedSuggestion`]).has(t.commandId)&&e.hasTextFocus()&&this._enabled.get()&&this._editorObs.forceUpdate(e=>{this.model.get()?.trigger(e)})})),this._register(Js(this._editorObs.selections,(e,t)=>{t.some(e=>e.reason===3||e.source===`api`)&&this.model.get()?.stop()})),this._register(this.editor.onDidBlurEditorWidget(()=>{this._contextKeyService.getContextKeyValue(`accessibleViewIsShown`)||this._configurationService.getValue(`editor.inlineSuggest.keepOnBlur`)||e.getOption(62).keepOnBlur||Nm.dropDownVisible||gs(e=>{this.model.get()?.stop(e)})})),this._register(Ba(e=>{let t=this.model.read(e)?.state.read(e);t?.suggestItem?t.primaryGhostText.lineCount>=2&&this._suggestWidgetAdaptor.forceRenderingAbove():this._suggestWidgetAdaptor.stopForceRenderingAbove()})),this._register(b(()=>{this._suggestWidgetAdaptor.stopForceRenderingAbove()}));let p=aa(this,(e,t)=>{let n=this.model.read(e)?.state.read(e);return this._suggestWidgetSelectedItem.get()?t:n?.inlineCompletion?.semanticId});this._register(ma(K(e=>(this._playAccessibilitySignal.read(e),p.read(e),{})),async(e,t,n)=>{let r=this.model.get(),i=r?.state.get();if(!i||!r)return;let o=r.textModel.getLineContent(i.primaryGhostText.lineNumber);await Ot(50,a(n)),await So(this._suggestWidgetSelectedItem,s,()=>!1,a(n)),await this._accessibilitySignalService.playSignal(to.inlineSuggestion),this.editor.getOption(8)&&this._provideScreenReaderUpdate(i.primaryGhostText.renderForScreenReader(o))})),this._register(new Am(this.editor,this.model,this._instantiationService)),this._register(Ax(K(e=>{let t=this._fontFamily.read(e);return t===``||t===`default`?``:`
.monaco-editor .ghost-text-decoration,
.monaco-editor .ghost-text-decoration-preview,
.monaco-editor .ghost-text {
	font-family: ${t};
}`}))),this._register(this._configurationService.onDidChangeConfiguration(e=>{e.affectsConfiguration(`accessibility.verbosity.inlineCompletions`)&&this.editor.updateOptions({inlineCompletionsAccessibilityVerbose:this._configurationService.getValue(`accessibility.verbosity.inlineCompletions`)})})),this.editor.updateOptions({inlineCompletionsAccessibilityVerbose:this._configurationService.getValue(`accessibility.verbosity.inlineCompletions`)})}playAccessibilitySignal(e){this._playAccessibilitySignal.trigger(e)}_provideScreenReaderUpdate(e){let t=this._contextKeyService.getContextKeyValue(`accessibleViewIsShown`),n=this._keybindingService.lookupKeybinding(`editor.action.accessibleView`),r;!t&&n&&this.editor.getOption(150)&&(r=S(`showAccessibleViewHint`,`Inspect this in the accessible view ({0})`,n.getAriaLabel())),qa(r?e+`, `+r:e)}shouldShowHoverAt(e){let t=this.model.get()?.primaryGhostText.get();return t?t.parts.some(n=>e.containsPosition(new r(t.lineNumber,n.column))):!1}shouldShowHoverAtViewZone(e){return this._ghostTextWidgets.get()[0]?.ownsViewZone(e)??!1}};kw=Ow=Ew([Dw(1,Y),Dw(2,W),Dw(3,F),Dw(4,lc),Dw(5,Qi),Dw(6,V),Dw(7,hi),Dw(8,ua),Dw(9,_o)],kw);function Aw(e,t){let n=uc(`result`,[]),r=[];return t.add(Ba(t=>{let i=e.read(t);gs(e=>{if(i.length!==r.length){r.length=i.length;for(let e=0;e<r.length;e++)r[e]||(r[e]=uc(`item`,i[e]));n.set([...r],e)}r.forEach((t,n)=>t.set(i[n],e))})})),n}var jw=class e extends N{static#e=this.ID=Em;constructor(){super({id:e.ID,label:S(`action.inlineSuggest.showNext`,`Show Next Inline Suggestion`),alias:`Show Next Inline Suggestion`,precondition:z.and(q.writable,kx.inlineSuggestionVisible),kbOpts:{weight:100,primary:606}})}async run(e,t){kw.get(t)?.model.get()?.next()}},Mw=class e extends N{static#e=this.ID=Tm;constructor(){super({id:e.ID,label:S(`action.inlineSuggest.showPrevious`,`Show Previous Inline Suggestion`),alias:`Show Previous Inline Suggestion`,precondition:z.and(q.writable,kx.inlineSuggestionVisible),kbOpts:{weight:100,primary:604}})}async run(e,t){kw.get(t)?.model.get()?.previous()}},Nw=class extends N{constructor(){super({id:`editor.action.inlineSuggest.trigger`,label:S(`action.inlineSuggest.trigger`,`Trigger Inline Suggestion`),alias:`Trigger Inline Suggestion`,precondition:q.writable})}async run(e,t){let n=kw.get(t);await Yc(async e=>{await n?.model.get()?.triggerExplicitly(e),n?.playAccessibilitySignal(e)})}},Pw=class extends N{constructor(){super({id:`editor.action.inlineSuggest.acceptNextWord`,label:S(`action.inlineSuggest.acceptNextWord`,`Accept Next Word Of Inline Suggestion`),alias:`Accept Next Word Of Inline Suggestion`,precondition:z.and(q.writable,kx.inlineSuggestionVisible),kbOpts:{weight:101,primary:2065,kbExpr:z.and(q.writable,kx.inlineSuggestionVisible)},menuOpts:[{menuId:R.InlineSuggestionToolbar,title:S(`acceptWord`,`Accept Word`),group:`primary`,order:2}]})}async run(e,t){let n=kw.get(t);await n?.model.get()?.acceptNextWord(n.editor)}},Fw=class extends N{constructor(){super({id:`editor.action.inlineSuggest.acceptNextLine`,label:S(`action.inlineSuggest.acceptNextLine`,`Accept Next Line Of Inline Suggestion`),alias:`Accept Next Line Of Inline Suggestion`,precondition:z.and(q.writable,kx.inlineSuggestionVisible),kbOpts:{weight:101},menuOpts:[{menuId:R.InlineSuggestionToolbar,title:S(`acceptLine`,`Accept Line`),group:`secondary`,order:2}]})}async run(e,t){let n=kw.get(t);await n?.model.get()?.acceptNextLine(n.editor)}},Iw=class extends N{constructor(){super({id:`editor.action.inlineSuggest.commit`,label:S(`action.inlineSuggest.accept`,`Accept Inline Suggestion`),alias:`Accept Inline Suggestion`,precondition:kx.inlineSuggestionVisible,menuOpts:[{menuId:R.InlineSuggestionToolbar,title:S(`accept`,`Accept`),group:`primary`,order:1}],kbOpts:{primary:2,weight:200,kbExpr:z.and(kx.inlineSuggestionVisible,q.tabMovesFocus.toNegated(),kx.inlineSuggestionHasIndentationLessThanTabSize,$.Visible.toNegated(),q.hoverFocused.toNegated())}})}async run(e,t){let n=kw.get(t);n&&(n.model.get()?.accept(n.editor),n.editor.focus())}},Lw=class e extends N{static#e=this.ID=`editor.action.inlineSuggest.hide`;constructor(){super({id:e.ID,label:S(`action.inlineSuggest.hide`,`Hide Inline Suggestion`),alias:`Hide Inline Suggestion`,precondition:kx.inlineSuggestionVisible,kbOpts:{weight:100,primary:9}})}async run(e,t){let n=kw.get(t);gs(e=>{n?.model.get()?.stop(e)})}},Rw=class e extends Mo{static#e=this.ID=`editor.action.inlineSuggest.toggleAlwaysShowToolbar`;constructor(){super({id:e.ID,title:S(`action.inlineSuggest.alwaysShowToolbar`,`Always Show Toolbar`),f1:!1,precondition:void 0,menu:[{id:R.InlineSuggestionToolbar,group:`secondary`,order:10}],toggled:z.equals(`config.editor.inlineSuggest.showToolbar`,`always`)})}async run(e,t){let n=e.get(F),r=n.getValue(`editor.inlineSuggest.showToolbar`)===`always`?`onHover`:`always`;n.updateValue(`editor.inlineSuggest.showToolbar`,r)}},zw=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Bw=function(e,t){return function(n,r){t(n,r,e)}},Vw=class{constructor(e,t,n){this.owner=e,this.range=t,this.controller=n}isValidForHoverAnchor(e){return e.type===1&&this.range.startColumn<=e.range.startColumn&&this.range.endColumn>=e.range.endColumn}},Hw=class{constructor(e,t,n,r,i,a){this._editor=e,this._languageService=t,this._openerService=n,this.accessibilityService=r,this._instantiationService=i,this._telemetryService=a,this.hoverOrdinal=4}suggestHoverAnchor(e){let t=kw.get(this._editor);if(!t)return null;let n=e.target;if(n.type===8){let r=n.detail;if(t.shouldShowHoverAtViewZone(r.viewZoneId))return new cm(1e3,this,T.fromPositions(this._editor.getModel().validatePosition(r.positionBefore||r.position)),e.event.posx,e.event.posy,!1)}return n.type===7&&t.shouldShowHoverAt(n.range)||n.type===6&&n.detail.mightBeForeignElement&&t.shouldShowHoverAt(n.range)?new cm(1e3,this,n.range,e.event.posx,e.event.posy,!1):null}computeSync(e,t){if(this._editor.getOption(62).showToolbar!==`onHover`)return[];let n=kw.get(this._editor);return n&&n.shouldShowHoverAt(e.range)?[new Vw(this,e.range,n)]:[]}renderHoverParts(e,t){let r=new n,i=t[0];this._telemetryService.publicLog2(`inlineCompletionHover.shown`),this.accessibilityService.isScreenReaderOptimized()&&!this._editor.getOption(8)&&r.add(this.renderScreenReaderText(e,i));let a=i.controller.model.get(),o=this._instantiationService.createInstance(Nm,this._editor,!1,Ii(null),a.selectedInlineCompletionIndex,a.inlineCompletionsCount,a.activeCommands),s=o.getDomNode();return e.fragment.appendChild(s),a.triggerExplicitly(),r.add(o),new lm([{hoverPart:i,hoverElement:s,dispose(){r.dispose()}}])}renderScreenReaderText(e,t){let r=new n,i=O,a=i(`div.hover-row.markdown-hover`),o=M(a,i(`div.hover-contents`,{"aria-live":`assertive`})),s=r.add(new Hi({editor:this._editor},this._languageService,this._openerService)),c=t=>{r.add(s.onDidRenderAsync(()=>{o.className=`hover-contents code-hover-contents`,e.onContentsChanged()}));let n=S(`inlineSuggestionFollows`,`Suggestion:`),i=r.add(s.render(new Va().appendText(n).appendCodeblock(`text`,t)));o.replaceChildren(i.element)};return r.add(Ba(e=>{let n=t.controller.model.read(e)?.primaryGhostText.read(e);if(n){let e=this._editor.getModel().getLineContent(n.lineNumber);c(n.renderForScreenReader(e))}else Ar(o)})),e.fragment.appendChild(a),r}};Hw=zw([Bw(1,Ys),Bw(2,wi),Bw(3,_o),Bw(4,Y),Bw(5,Zi)],Hw);var Uw=class{};const Ww=new class{constructor(){this._implementations=[]}register(e){return this._implementations.push(e),{dispose:()=>{let t=this._implementations.indexOf(e);t!==-1&&this._implementations.splice(t,1)}}}getImplementations(){return this._implementations}};I(kw.ID,kw,3),L(Nw),L(jw),L(Mw),L(Pw),L(Fw),L(Iw),L(Lw),H(Rw),um.register(Hw),Ww.register(new Uw);var Gw=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Kw=function(e,t){return function(n,r){t(n,r,e)}},qw,Jw=class{static#e=qw=this;static#t=this.ID=`editor.contrib.gotodefinitionatposition`;static#n=this.MAX_SOURCE_PREVIEW_LINES=8;constructor(e,t,r,i){this.textModelResolverService=t,this.languageService=r,this.languageFeaturesService=i,this.toUnhook=new n,this.toUnhookForKeyboard=new n,this.currentWordAtPosition=null,this.previousPromise=null,this.editor=e,this.linkDecorations=this.editor.createDecorationsCollection();let a=new Dh(e);this.toUnhook.add(a),this.toUnhook.add(a.onMouseMoveOrRelevantKeyDown(([e,t])=>{this.startFindDefinitionFromMouse(e,t??void 0)})),this.toUnhook.add(a.onExecute(e=>{this.isEnabled(e)&&this.gotoDefinition(e.target.position,e.hasSideBySideModifier).catch(e=>{C(e)}).finally(()=>{this.removeLinkDecorations()})})),this.toUnhook.add(a.onCancel(()=>{this.removeLinkDecorations(),this.currentWordAtPosition=null}))}static get(e){return e.getContribution(qw.ID)}async startFindDefinitionFromCursor(e){await this.startFindDefinition(e),this.toUnhookForKeyboard.add(this.editor.onDidChangeCursorPosition(()=>{this.currentWordAtPosition=null,this.removeLinkDecorations(),this.toUnhookForKeyboard.clear()})),this.toUnhookForKeyboard.add(this.editor.onKeyDown(e=>{e&&(this.currentWordAtPosition=null,this.removeLinkDecorations(),this.toUnhookForKeyboard.clear())}))}startFindDefinitionFromMouse(e,t){if(e.target.type===9&&this.linkDecorations.length>0)return;if(!this.editor.hasModel()||!this.isEnabled(e,t)){this.currentWordAtPosition=null,this.removeLinkDecorations();return}let n=e.target.position;this.startFindDefinition(n)}async startFindDefinition(e){this.toUnhookForKeyboard.clear();let t=e?this.editor.getModel()?.getWordAtPosition(e):null;if(!t){this.currentWordAtPosition=null,this.removeLinkDecorations();return}if(this.currentWordAtPosition&&this.currentWordAtPosition.startColumn===t.startColumn&&this.currentWordAtPosition.endColumn===t.endColumn&&this.currentWordAtPosition.word===t.word)return;this.currentWordAtPosition=t;let n=new ui(this.editor,15);this.previousPromise&&=(this.previousPromise.cancel(),null),this.previousPromise=et(t=>this.findDefinition(e,t));let r;try{r=await this.previousPromise}catch(e){C(e);return}if(!r||!r.length||!n.validate(this.editor)){this.removeLinkDecorations();return}let i=r[0].originSelectionRange?T.lift(r[0].originSelectionRange):new T(e.lineNumber,t.startColumn,e.lineNumber,t.endColumn);if(r.length>1){let e=i;for(let{originSelectionRange:t}of r)t&&(e=T.plusRange(e,t));this.addDecoration(e,new Va().appendText(S(`multipleResults`,`Click to show {0} definitions.`,r.length)))}else{let e=r[0];if(!e.uri)return;this.textModelResolverService.createModelReference(e.uri).then(t=>{if(!t.object||!t.object.textEditorModel){t.dispose();return}let{object:{textEditorModel:n}}=t,{startLineNumber:r}=e.range;if(r<1||r>n.getLineCount()){t.dispose();return}let a=this.getPreviewValue(n,r,e),o=this.languageService.guessLanguageIdByFilepathOrFirstLine(n.uri);this.addDecoration(i,a?new Va().appendCodeblock(o||``,a):void 0),t.dispose()})}}getPreviewValue(e,t,n){let r=n.range;return r.endLineNumber-r.startLineNumber>=qw.MAX_SOURCE_PREVIEW_LINES&&(r=this.getPreviewRangeBasedOnIndentation(e,t)),this.stripIndentationFromPreviewRange(e,t,r)}stripIndentationFromPreviewRange(e,t,n){let r=e.getLineFirstNonWhitespaceColumn(t);for(let i=t+1;i<n.endLineNumber;i++){let t=e.getLineFirstNonWhitespaceColumn(i);r=Math.min(r,t)}return e.getValueInRange(n).replace(RegExp(`^\\s{${r-1}}`,`gm`),``).trim()}getPreviewRangeBasedOnIndentation(e,t){let n=e.getLineFirstNonWhitespaceColumn(t),r=Math.min(e.getLineCount(),t+qw.MAX_SOURCE_PREVIEW_LINES),i=t+1;for(;i<r&&n!==e.getLineFirstNonWhitespaceColumn(i);i++);return new T(t,1,i+1,1)}addDecoration(e,t){let n={range:e,options:{description:`goto-definition-link`,inlineClassName:`goto-definition-link`,hoverMessage:t}};this.linkDecorations.set([n])}removeLinkDecorations(){this.linkDecorations.clear()}isEnabled(e,t){return this.editor.hasModel()&&e.isLeftClick&&e.isNoneOrSingleMouseDown&&e.target.type===6&&!(e.target.detail.injectedText?.options instanceof Zo)&&(e.hasTriggerModifier||(t?t.keyCodeIsTriggerKey:!1))&&this.languageFeaturesService.definitionProvider.has(this.editor.getModel())}findDefinition(e,t){let n=this.editor.getModel();return n?Rg(this.languageFeaturesService.definitionProvider,n,e,!1,t):Promise.resolve(null)}gotoDefinition(e,t){return this.editor.setPosition(e),this.editor.invokeWithinContext(e=>new Kg({openToSide:t,openInPeek:!t&&this.editor.getOption(89)&&!this.isInPeekEditor(e),muteMessage:!0},{title:{value:``,original:``},id:``,precondition:void 0}).run(e))}isInPeekEditor(e){let t=e.get(W);return Gh.inPeekEditor.getValue(t)}dispose(){this.toUnhook.dispose(),this.toUnhookForKeyboard.dispose()}};Jw=qw=Gw([Kw(1,Bs),Kw(2,Ys),Kw(3,V)],Jw),I(Jw.ID,Jw,2);var Yw=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Xw=function(e,t){return function(n,r){t(n,r,e)}},Zw=class{constructor(e,t,n){this.marker=e,this.index=t,this.total=n}},Qw=class{constructor(e,t,r){this._markerService=t,this._configService=r,this._onDidChange=new g,this.onDidChange=this._onDidChange.event,this._dispoables=new n,this._markers=[],this._nextIdx=-1,y.isUri(e)?this._resourceFilter=t=>t.toString()===e.toString():e&&(this._resourceFilter=e);let i=this._configService.getValue(`problems.sortOrder`),a=(e,t)=>{let n=At(e.resource.toString(),t.resource.toString());return n===0&&(n=i===`position`?T.compareRangesUsingStarts(e,t)||Qa.compare(e.severity,t.severity):Qa.compare(e.severity,t.severity)||T.compareRangesUsingStarts(e,t)),n},o=()=>{this._markers=this._markerService.read({resource:y.isUri(e)?e:void 0,severities:Qa.Error|Qa.Warning|Qa.Info}),typeof e==`function`&&(this._markers=this._markers.filter(e=>this._resourceFilter(e.resource))),this._markers.sort(a)};o(),this._dispoables.add(t.onMarkerChanged(e=>{(!this._resourceFilter||e.some(e=>this._resourceFilter(e)))&&(o(),this._nextIdx=-1,this._onDidChange.fire())}))}dispose(){this._dispoables.dispose(),this._onDidChange.dispose()}matches(e){return!this._resourceFilter&&!e?!0:!this._resourceFilter||!e?!1:this._resourceFilter(e)}get selected(){let e=this._markers[this._nextIdx];return e&&new Zw(e,this._nextIdx+1,this._markers.length)}_initIdx(e,t,n){let r=!1,i=this._markers.findIndex(t=>t.resource.toString()===e.uri.toString());i<0&&(i=Tt(this._markers,{resource:e.uri},(e,t)=>At(e.resource.toString(),t.resource.toString())),i<0&&(i=~i));for(let n=i;n<this._markers.length;n++){let i=T.lift(this._markers[n]);if(i.isEmpty()){let t=e.getWordAtPosition(i.getStartPosition());t&&(i=new T(i.startLineNumber,t.startColumn,i.startLineNumber,t.endColumn))}if(t&&(i.containsPosition(t)||t.isBeforeOrEqual(i.getStartPosition()))){this._nextIdx=n,r=!0;break}if(this._markers[n].resource.toString()!==e.uri.toString())break}r||(this._nextIdx=n?0:this._markers.length-1),this._nextIdx<0&&(this._nextIdx=this._markers.length-1)}resetIndex(){this._nextIdx=-1}move(e,t,n){if(this._markers.length===0)return!1;let r=this._nextIdx;return this._nextIdx===-1?this._initIdx(t,n,e):e?this._nextIdx=(this._nextIdx+1)%this._markers.length:e||(this._nextIdx=(this._nextIdx-1+this._markers.length)%this._markers.length),r!==this._nextIdx}find(e,t){let n=this._markers.findIndex(t=>t.resource.toString()===e.toString());if(!(n<0)){for(;n<this._markers.length;n++)if(T.containsPosition(this._markers[n],t))return new Zw(this._markers[n],n+1,this._markers.length)}}};Qw=Yw([Xw(1,xl),Xw(2,F)],Qw);const $w=kl(`IMarkerNavigationService`);var eT=class{constructor(e,t){this._markerService=e,this._configService=t,this._provider=new f}getMarkerList(e){for(let t of this._provider){let n=t.getMarkerList(e);if(n)return n}return new Qw(e,this._markerService,this._configService)}};eT=Yw([Xw(0,xl),Xw(1,F)],eT),$r($w,eT,1);var tT;(function(e){function t(e){switch(e){case vs.Ignore:return`severity-ignore `+J.asClassName(i.info);case vs.Info:return J.asClassName(i.info);case vs.Warning:return J.asClassName(i.warning);case vs.Error:return J.asClassName(i.error);default:return``}}e.className=t})(tT||={});var nT=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},rT=function(e,t){return function(n,r){t(n,r,e)}},iT,aT=class{constructor(e,t,r,i,a){this._openerService=i,this._labelService=a,this._lines=0,this._longestLineLength=0,this._relatedDiagnostics=new WeakMap,this._disposables=new n,this._editor=t;let o=document.createElement(`div`);o.className=`descriptioncontainer`,this._messageBlock=document.createElement(`div`),this._messageBlock.classList.add(`message`),this._messageBlock.setAttribute(`aria-live`,`assertive`),this._messageBlock.setAttribute(`role`,`alert`),o.appendChild(this._messageBlock),this._relatedBlock=document.createElement(`div`),o.appendChild(this._relatedBlock),this._disposables.add(Gn(this._relatedBlock,`click`,e=>{e.preventDefault();let t=this._relatedDiagnostics.get(e.target);t&&r(t)})),this._scrollable=new xa(o,{horizontal:1,vertical:1,useShadows:!1,horizontalScrollbarSize:6,verticalScrollbarSize:6}),e.appendChild(this._scrollable.getDomNode()),this._disposables.add(this._scrollable.onScroll(e=>{o.style.left=`-${e.scrollLeft}px`,o.style.top=`-${e.scrollTop}px`})),this._disposables.add(this._scrollable)}dispose(){c(this._disposables)}update(e){let{source:t,message:n,relatedInformation:r,code:i}=e,a=(t?.length||0)+2;i&&(typeof i==`string`?a+=i.length:a+=i.value.length);let o=Vr(n);this._lines=o.length,this._longestLineLength=0;for(let e of o)this._longestLineLength=Math.max(e.length+a,this._longestLineLength);Fr(this._messageBlock),this._messageBlock.setAttribute(`aria-label`,this.getAriaLabel(e)),this._editor.applyFontInfo(this._messageBlock);let s=this._messageBlock;for(let e of o)s=document.createElement(`div`),s.innerText=e,e===``&&(s.style.height=this._messageBlock.style.lineHeight),this._messageBlock.appendChild(s);if(t||i){let e=document.createElement(`span`);if(e.classList.add(`details`),s.appendChild(e),t){let n=document.createElement(`span`);n.innerText=t,n.classList.add(`source`),e.appendChild(n)}if(i)if(typeof i==`string`){let t=document.createElement(`span`);t.innerText=`(${i})`,t.classList.add(`code`),e.appendChild(t)}else{this._codeLink=O(`a.code-link`),this._codeLink.setAttribute(`href`,`${i.target.toString()}`),this._codeLink.onclick=e=>{this._openerService.open(i.target,{allowCommands:!0}),e.preventDefault(),e.stopPropagation()};let t=M(this._codeLink,O(`span`));t.innerText=i.value,e.appendChild(this._codeLink)}}if(Fr(this._relatedBlock),this._editor.applyFontInfo(this._relatedBlock),On(r)){let e=this._relatedBlock.appendChild(document.createElement(`div`));e.style.paddingTop=`${Math.floor(this._editor.getOption(67)*.66)}px`,this._lines+=1;for(let t of r){let n=document.createElement(`div`),r=document.createElement(`a`);r.classList.add(`filename`),r.innerText=`${this._labelService.getUriBasenameLabel(t.resource)}(${t.startLineNumber}, ${t.startColumn}): `,r.title=this._labelService.getUriLabel(t.resource),this._relatedDiagnostics.set(r,t);let i=document.createElement(`span`);i.innerText=t.message,n.appendChild(r),n.appendChild(i),this._lines+=1,e.appendChild(n)}}let c=this._editor.getOption(50),l=Math.ceil(c.typicalFullwidthCharacterWidth*this._longestLineLength*.75),u=c.lineHeight*this._lines;this._scrollable.setScrollDimensions({scrollWidth:l,scrollHeight:u})}layout(e,t){this._scrollable.getDomNode().style.height=`${e}px`,this._scrollable.getDomNode().style.width=`${t}px`,this._scrollable.setScrollDimensions({width:t,height:e})}getHeightInLines(){return Math.min(17,this._lines)}getAriaLabel(e){let t=``;switch(e.severity){case Qa.Error:t=S(`Error`,`Error`);break;case Qa.Warning:t=S(`Warning`,`Warning`);break;case Qa.Info:t=S(`Info`,`Info`);break;case Qa.Hint:t=S(`Hint`,`Hint`);break}let n=S(`marker aria`,`{0} at {1}. `,t,e.startLineNumber+`:`+e.startColumn),r=this._editor.getModel();return r&&e.startLineNumber<=r.getLineCount()&&e.startLineNumber>=1&&(n=`${r.getLineContent(e.startLineNumber)}, ${n}`),n}},oT=class extends Yh{static#e=iT=this;static#t=this.TitleMenu=new R(`gotoErrorTitleMenu`);constructor(e,t,r,i,a,o,s){super(e,{showArrow:!0,showFrame:!0,isAccessible:!0,frameWidth:1},a),this._themeService=t,this._openerService=r,this._menuService=i,this._contextKeyService=o,this._labelService=s,this._callOnDispose=new n,this._onDidSelectRelatedInformation=new g,this.onDidSelectRelatedInformation=this._onDidSelectRelatedInformation.event,this._severity=Qa.Warning,this._backgroundColor=E.white,this._applyTheme(t.getColorTheme()),this._callOnDispose.add(t.onDidColorThemeChange(this._applyTheme.bind(this))),this.create()}_applyTheme(e){this._backgroundColor=e.getColor(gT);let t=uT,n=dT;this._severity===Qa.Warning?(t=fT,n=pT):this._severity===Qa.Info&&(t=mT,n=hT);let r=e.getColor(t),i=e.getColor(n);this.style({arrowColor:r,frameColor:r,headerBackgroundColor:i,primaryHeadingColor:e.getColor(Zh),secondaryHeadingColor:e.getColor(Qh)})}_applyStyles(){this._parentContainer&&(this._parentContainer.style.backgroundColor=this._backgroundColor?this._backgroundColor.toString():``),super._applyStyles()}dispose(){this._callOnDispose.dispose(),super.dispose()}_fillHead(e){super._fillHead(e),this._disposables.add(this._actionbarWidget.actionRunner.onWillRun(e=>this.editor.focus()));let t=[];Oa(this._menuService.getMenuActions(iT.TitleMenu,this._contextKeyService),t),this._actionbarWidget.push(t,{label:!1,icon:!0,index:0})}_fillTitleIcon(e){this._icon=M(e,O(``))}_fillBody(e){this._parentContainer=e,e.classList.add(`marker-widget`),this._parentContainer.tabIndex=0,this._parentContainer.setAttribute(`role`,`tooltip`),this._container=document.createElement(`div`),e.appendChild(this._container),this._message=new aT(this._container,this.editor,e=>this._onDidSelectRelatedInformation.fire(e),this._openerService,this._labelService),this._disposables.add(this._message)}show(){throw Error(`call showAtMarker`)}showAtMarker(e,t,n){this._container.classList.remove(`stale`),this._message.update(e),this._severity=e.severity,this._applyTheme(this._themeService.getColorTheme());let r=T.lift(e),i=this.editor.getPosition(),a=i&&r.containsPosition(i)?i:r.getStartPosition();super.show(a,this.computeRequiredHeight());let o=this.editor.getModel();if(o){let e=n>1?S(`problems`,`{0} of {1} problems`,t,n):S(`change`,`{0} of {1} problem`,t,n);this.setTitle(bc(o.uri),e)}this._icon.className=`codicon ${tT.className(Qa.toSeverity(this._severity))}`,this.editor.revealPositionNearTop(a,0),this.editor.focus()}updateMarker(e){this._container.classList.remove(`stale`),this._message.update(e)}showStale(){this._container.classList.add(`stale`),this._relayout()}_doLayoutBody(e,t){super._doLayoutBody(e,t),this._heightInPixel=e,this._message.layout(e,t),this._container.style.height=`${e}px`}_onWidth(e){this._message.layout(this._heightInPixel,e)}_relayout(){super._relayout(this.computeRequiredHeight())}computeRequiredHeight(){return 3+this._message.getHeightInLines()}};oT=iT=nT([rT(1,Zc),rT(2,wi),rT(3,Eo),rT(4,Y),rT(5,W),rT(6,Ca)],oT);var sT=Et(Ct,br),cT=Et(Nr,Sn),lT=Et(pr,Tn),uT=k(`editorMarkerNavigationError.background`,{dark:sT,light:sT,hcDark:kt,hcLight:kt},S(`editorMarkerNavigationError`,`Editor marker navigation widget error color.`)),dT=k(`editorMarkerNavigationError.headerBackground`,{dark:xt(uT,.1),light:xt(uT,.1),hcDark:null,hcLight:null},S(`editorMarkerNavigationErrorHeaderBackground`,`Editor marker navigation widget error heading background.`)),fT=k(`editorMarkerNavigationWarning.background`,{dark:cT,light:cT,hcDark:kt,hcLight:kt},S(`editorMarkerNavigationWarning`,`Editor marker navigation widget warning color.`)),pT=k(`editorMarkerNavigationWarning.headerBackground`,{dark:xt(fT,.1),light:xt(fT,.1),hcDark:`#0C141F`,hcLight:xt(fT,.2)},S(`editorMarkerNavigationWarningBackground`,`Editor marker navigation widget warning heading background.`)),mT=k(`editorMarkerNavigationInfo.background`,{dark:lT,light:lT,hcDark:kt,hcLight:kt},S(`editorMarkerNavigationInfo`,`Editor marker navigation widget info color.`)),hT=k(`editorMarkerNavigationInfo.headerBackground`,{dark:xt(mT,.1),light:xt(mT,.1),hcDark:null,hcLight:null},S(`editorMarkerNavigationInfoHeaderBackground`,`Editor marker navigation widget info heading background.`)),gT=k(`editorMarkerNavigation.background`,Dt,S(`editorMarkerNavigationBackground`,`Editor marker navigation widget background.`)),_T=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},vT=function(e,t){return function(n,r){t(n,r,e)}},yT,bT=class{static#e=yT=this;static#t=this.ID=`editor.contrib.markerController`;static get(e){return e.getContribution(yT.ID)}constructor(e,t,r,i,a){this._markerNavigationService=t,this._contextKeyService=r,this._editorService=i,this._instantiationService=a,this._sessionDispoables=new n,this._editor=e,this._widgetVisible=ET.bindTo(this._contextKeyService)}dispose(){this._cleanUp(),this._sessionDispoables.dispose()}_cleanUp(){this._widgetVisible.reset(),this._sessionDispoables.clear(),this._widget=void 0,this._model=void 0}_getOrCreateModel(e){if(this._model&&this._model.matches(e))return this._model;let t=!1;return this._model&&(t=!0,this._cleanUp()),this._model=this._markerNavigationService.getMarkerList(e),t&&this._model.move(!0,this._editor.getModel(),this._editor.getPosition()),this._widget=this._instantiationService.createInstance(oT,this._editor),this._widget.onDidClose(()=>this.close(),this,this._sessionDispoables),this._widgetVisible.set(!0),this._sessionDispoables.add(this._model),this._sessionDispoables.add(this._widget),this._sessionDispoables.add(this._editor.onDidChangeCursorPosition(e=>{(!this._model?.selected||!T.containsPosition(this._model?.selected.marker,e.position))&&this._model?.resetIndex()})),this._sessionDispoables.add(this._model.onDidChange(()=>{if(!this._widget||!this._widget.position||!this._model)return;let e=this._model.find(this._editor.getModel().uri,this._widget.position);e?this._widget.updateMarker(e.marker):this._widget.showStale()})),this._sessionDispoables.add(this._widget.onDidSelectRelatedInformation(e=>{this._editorService.openCodeEditor({resource:e.resource,options:{pinned:!0,revealIfOpened:!0,selection:T.lift(e).collapseToStart()}},this._editor),this.close(!1)})),this._sessionDispoables.add(this._editor.onDidChangeModel(()=>this._cleanUp())),this._model}close(e=!0){this._cleanUp(),e&&this._editor.focus()}showAtMarker(e){if(this._editor.hasModel()){let t=this._getOrCreateModel(this._editor.getModel().uri);t.resetIndex(),t.move(!0,this._editor.getModel(),new r(e.startLineNumber,e.startColumn)),t.selected&&this._widget.showAtMarker(t.selected.marker,t.selected.index,t.selected.total)}}async nagivate(e,t){if(this._editor.hasModel()){let n=this._getOrCreateModel(t?void 0:this._editor.getModel().uri);if(n.move(e,this._editor.getModel(),this._editor.getPosition()),!n.selected)return;if(n.selected.marker.resource.toString()!==this._editor.getModel().uri.toString()){this._cleanUp();let r=await this._editorService.openCodeEditor({resource:n.selected.marker.resource,options:{pinned:!1,revealIfOpened:!0,selectionRevealType:2,selection:n.selected.marker}},this._editor);r&&(yT.get(r)?.close(),yT.get(r)?.nagivate(e,t))}else this._widget.showAtMarker(n.selected.marker,n.selected.index,n.selected.total)}}};bT=yT=_T([vT(1,$w),vT(2,W),vT(3,Ko),vT(4,Y)],bT);var xT=class extends N{constructor(e,t,n){super(n),this._next=e,this._multiFile=t}async run(e,t){t.hasModel()&&bT.get(t)?.nagivate(this._next,this._multiFile)}},ST=class e extends xT{static#e=this.ID=`editor.action.marker.next`;static#t=this.LABEL=S(`markerAction.next.label`,`Go to Next Problem (Error, Warning, Info)`);constructor(){super(!0,!1,{id:e.ID,label:e.LABEL,alias:`Go to Next Problem (Error, Warning, Info)`,precondition:void 0,kbOpts:{kbExpr:q.focus,primary:578,weight:100},menuOpts:{menuId:oT.TitleMenu,title:e.LABEL,icon:ri(`marker-navigation-next`,i.arrowDown,S(`nextMarkerIcon`,`Icon for goto next marker.`)),group:`navigation`,order:1}})}},CT=class e extends xT{static#e=this.ID=`editor.action.marker.prev`;static#t=this.LABEL=S(`markerAction.previous.label`,`Go to Previous Problem (Error, Warning, Info)`);constructor(){super(!1,!1,{id:e.ID,label:e.LABEL,alias:`Go to Previous Problem (Error, Warning, Info)`,precondition:void 0,kbOpts:{kbExpr:q.focus,primary:1602,weight:100},menuOpts:{menuId:oT.TitleMenu,title:e.LABEL,icon:ri(`marker-navigation-previous`,i.arrowUp,S(`previousMarkerIcon`,`Icon for goto previous marker.`)),group:`navigation`,order:2}})}},wT=class extends xT{constructor(){super(!0,!0,{id:`editor.action.marker.nextInFiles`,label:S(`markerAction.nextInFiles.label`,`Go to Next Problem in Files (Error, Warning, Info)`),alias:`Go to Next Problem in Files (Error, Warning, Info)`,precondition:void 0,kbOpts:{kbExpr:q.focus,primary:66,weight:100},menuOpts:{menuId:R.MenubarGoMenu,title:S({key:`miGotoNextProblem`,comment:[`&& denotes a mnemonic`]},`Next &&Problem`),group:`6_problem_nav`,order:1}})}},TT=class extends xT{constructor(){super(!1,!0,{id:`editor.action.marker.prevInFiles`,label:S(`markerAction.previousInFiles.label`,`Go to Previous Problem in Files (Error, Warning, Info)`),alias:`Go to Previous Problem in Files (Error, Warning, Info)`,precondition:void 0,kbOpts:{kbExpr:q.focus,primary:1090,weight:100},menuOpts:{menuId:R.MenubarGoMenu,title:S({key:`miGotoPreviousProblem`,comment:[`&& denotes a mnemonic`]},`Previous &&Problem`),group:`6_problem_nav`,order:2}})}};I(bT.ID,bT,4),L(ST),L(CT),L(wT),L(TT);var ET=new G(`markersNavigationVisible`,!1);P(new(la.bindToContribution(bT.get))({id:`closeMarkersNavigation`,precondition:ET,handler:e=>e.close(),kbOpts:{weight:150,kbExpr:q.focus,primary:9,secondary:[1033]}}));var DT;(function(e){e.NoAutoFocus=`noAutoFocus`,e.FocusIfVisible=`focusIfVisible`,e.AutoFocusImmediately=`autoFocusImmediately`})(DT||={});var OT=class extends N{constructor(){super({id:`editor.action.showHover`,label:S({key:`showOrFocusHover`,comment:[`Label for action that will trigger the showing/focusing of a hover in the editor.`,`If the hover is not visible, it will show the hover.`,`This allows for users to show the hover without using the mouse.`]},`Show or Focus Hover`),metadata:{description:x(`showOrFocusHoverDescription`,`Show or focus the editor hover which shows documentation, references, and other content for a symbol at the current cursor position.`),args:[{name:`args`,schema:{type:`object`,properties:{focus:{description:`Controls if and when the hover should take focus upon being triggered by this action.`,enum:[DT.NoAutoFocus,DT.FocusIfVisible,DT.AutoFocusImmediately],enumDescriptions:[S(`showOrFocusHover.focus.noAutoFocus`,`The hover will not automatically take focus.`),S(`showOrFocusHover.focus.focusIfVisible`,`The hover will take focus only if it is already visible.`),S(`showOrFocusHover.focus.autoFocusImmediately`,`The hover will automatically take focus when it appears.`)],default:DT.FocusIfVisible}}}}]},alias:`Show or Focus Hover`,precondition:void 0,kbOpts:{kbExpr:q.editorTextFocus,primary:ne(2089,2087),weight:100}})}run(e,t,n){if(!t.hasModel())return;let r=S_.get(t);if(!r)return;let i=n?.focus,a=DT.FocusIfVisible;Object.values(DT).includes(i)?a=i:typeof i==`boolean`&&i&&(a=DT.AutoFocusImmediately);let o=e=>{let n=t.getPosition(),i=new T(n.lineNumber,n.column,n.lineNumber,n.column);r.showContentHover(i,1,1,e)},s=t.getOption(2)===2;r.isHoverVisible?a===DT.NoAutoFocus?o(s):r.focus():o(s||a===DT.AutoFocusImmediately)}},kT=class extends N{constructor(){super({id:`editor.action.showDefinitionPreviewHover`,label:S({key:`showDefinitionPreviewHover`,comment:[`Label for action that will trigger the showing of definition preview hover in the editor.`,`This allows for users to show the definition preview hover without using the mouse.`]},`Show Definition Preview Hover`),alias:`Show Definition Preview Hover`,precondition:void 0,metadata:{description:x(`showDefinitionPreviewHoverDescription`,`Show the definition preview hover in the editor.`)}})}run(e,t){let n=S_.get(t);if(!n)return;let r=t.getPosition();if(!r)return;let i=new T(r.lineNumber,r.column,r.lineNumber,r.column),a=Jw.get(t);a&&a.startFindDefinitionFromCursor(r).then(()=>{n.showContentHover(i,1,1,!0)})}},AT=class extends N{constructor(){super({id:`editor.action.scrollUpHover`,label:S({key:`scrollUpHover`,comment:[`Action that allows to scroll up in the hover widget with the up arrow when the hover widget is focused.`]},`Scroll Up Hover`),alias:`Scroll Up Hover`,precondition:q.hoverFocused,kbOpts:{kbExpr:q.hoverFocused,primary:16,weight:100},metadata:{description:x(`scrollUpHoverDescription`,`Scroll up the editor hover.`)}})}run(e,t){let n=S_.get(t);n&&n.scrollUp()}},jT=class extends N{constructor(){super({id:`editor.action.scrollDownHover`,label:S({key:`scrollDownHover`,comment:[`Action that allows to scroll down in the hover widget with the up arrow when the hover widget is focused.`]},`Scroll Down Hover`),alias:`Scroll Down Hover`,precondition:q.hoverFocused,kbOpts:{kbExpr:q.hoverFocused,primary:18,weight:100},metadata:{description:x(`scrollDownHoverDescription`,`Scroll down the editor hover.`)}})}run(e,t){let n=S_.get(t);n&&n.scrollDown()}},MT=class extends N{constructor(){super({id:`editor.action.scrollLeftHover`,label:S({key:`scrollLeftHover`,comment:[`Action that allows to scroll left in the hover widget with the left arrow when the hover widget is focused.`]},`Scroll Left Hover`),alias:`Scroll Left Hover`,precondition:q.hoverFocused,kbOpts:{kbExpr:q.hoverFocused,primary:15,weight:100},metadata:{description:x(`scrollLeftHoverDescription`,`Scroll left the editor hover.`)}})}run(e,t){let n=S_.get(t);n&&n.scrollLeft()}},NT=class extends N{constructor(){super({id:`editor.action.scrollRightHover`,label:S({key:`scrollRightHover`,comment:[`Action that allows to scroll right in the hover widget with the right arrow when the hover widget is focused.`]},`Scroll Right Hover`),alias:`Scroll Right Hover`,precondition:q.hoverFocused,kbOpts:{kbExpr:q.hoverFocused,primary:17,weight:100},metadata:{description:x(`scrollRightHoverDescription`,`Scroll right the editor hover.`)}})}run(e,t){let n=S_.get(t);n&&n.scrollRight()}},PT=class extends N{constructor(){super({id:`editor.action.pageUpHover`,label:S({key:`pageUpHover`,comment:[`Action that allows to page up in the hover widget with the page up command when the hover widget is focused.`]},`Page Up Hover`),alias:`Page Up Hover`,precondition:q.hoverFocused,kbOpts:{kbExpr:q.hoverFocused,primary:11,secondary:[528],weight:100},metadata:{description:x(`pageUpHoverDescription`,`Page up the editor hover.`)}})}run(e,t){let n=S_.get(t);n&&n.pageUp()}},FT=class extends N{constructor(){super({id:`editor.action.pageDownHover`,label:S({key:`pageDownHover`,comment:[`Action that allows to page down in the hover widget with the page down command when the hover widget is focused.`]},`Page Down Hover`),alias:`Page Down Hover`,precondition:q.hoverFocused,kbOpts:{kbExpr:q.hoverFocused,primary:12,secondary:[530],weight:100},metadata:{description:x(`pageDownHoverDescription`,`Page down the editor hover.`)}})}run(e,t){let n=S_.get(t);n&&n.pageDown()}},IT=class extends N{constructor(){super({id:`editor.action.goToTopHover`,label:S({key:`goToTopHover`,comment:[`Action that allows to go to the top of the hover widget with the home command when the hover widget is focused.`]},`Go To Top Hover`),alias:`Go To Bottom Hover`,precondition:q.hoverFocused,kbOpts:{kbExpr:q.hoverFocused,primary:14,secondary:[2064],weight:100},metadata:{description:x(`goToTopHoverDescription`,`Go to the top of the editor hover.`)}})}run(e,t){let n=S_.get(t);n&&n.goToTop()}},LT=class extends N{constructor(){super({id:`editor.action.goToBottomHover`,label:S({key:`goToBottomHover`,comment:[`Action that allows to go to the bottom in the hover widget with the end command when the hover widget is focused.`]},`Go To Bottom Hover`),alias:`Go To Bottom Hover`,precondition:q.hoverFocused,kbOpts:{kbExpr:q.hoverFocused,primary:13,secondary:[2066],weight:100},metadata:{description:x(`goToBottomHoverDescription`,`Go to the bottom of the editor hover.`)}})}run(e,t){let n=S_.get(t);n&&n.goToBottom()}},RT=class extends N{constructor(){super({id:xm,label:Sm,alias:`Increase Hover Verbosity Level`,precondition:q.hoverVisible})}run(e,t,n){let r=S_.get(t);if(!r)return;let i=n?.index===void 0?r.focusedHoverPartIndex():n.index;r.updateHoverVerbosityLevel(ze.Increase,i,n?.focus)}},zT=class extends N{constructor(){super({id:Cm,label:wm,alias:`Decrease Hover Verbosity Level`,precondition:q.hoverVisible})}run(e,t,n){let r=S_.get(t);if(!r)return;let i=n?.index===void 0?r.focusedHoverPartIndex():n.index;S_.get(t)?.updateHoverVerbosityLevel(ze.Decrease,i,n?.focus)}},BT=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},VT=function(e,t){return function(n,r){t(n,r,e)}},HT=O,UT=class{constructor(e,t,n){this.owner=e,this.range=t,this.marker=n}isValidForHoverAnchor(e){return e.type===1&&this.range.startColumn<=e.range.startColumn&&this.range.endColumn>=e.range.endColumn}},WT={type:1,filter:{include:Z.QuickFix},triggerAction:Xd.QuickFixHover},GT=class{constructor(e,t,n,r){this._editor=e,this._markerDecorationsService=t,this._openerService=n,this._languageFeaturesService=r,this.hoverOrdinal=1,this.recentMarkerCodeActionsInfo=void 0}computeSync(e,t){if(!this._editor.hasModel()||e.type!==1&&!e.supportsMarkerHover)return[];let n=this._editor.getModel(),r=e.range.startLineNumber,i=n.getLineMaxColumn(r),a=[];for(let o of t){let t=o.range.startLineNumber===r?o.range.startColumn:1,s=o.range.endLineNumber===r?o.range.endColumn:i,c=this._markerDecorationsService.getMarker(n.uri,o);if(!c)continue;let l=new T(e.range.startLineNumber,t,e.range.startLineNumber,s);a.push(new UT(this,l,c))}return a}renderHoverParts(e,t){if(!t.length)return new lm([]);let r=new n,i=[];t.forEach(t=>{let n=this._renderMarkerHover(t);e.fragment.appendChild(n.hoverElement),i.push(n)});let a=t.length===1?t[0]:t.sort((e,t)=>Qa.compare(e.marker.severity,t.marker.severity))[0];return this.renderMarkerStatusbar(e,a,r),new lm(i)}_renderMarkerHover(e){let t=new n,r=HT(`div.hover-row`),i=M(r,HT(`div.marker.hover-contents`)),{source:a,message:o,code:s,relatedInformation:c}=e.marker;this._editor.applyFontInfo(i);let l=M(i,HT(`span`));if(l.style.whiteSpace=`pre-wrap`,l.innerText=o,a||s)if(s&&typeof s!=`string`){let e=HT(`span`);if(a){let t=M(e,HT(`span`));t.innerText=a}let n=M(e,HT(`a.code-link`));n.setAttribute(`href`,s.target.toString()),t.add(D(n,`click`,e=>{this._openerService.open(s.target,{allowCommands:!0}),e.preventDefault(),e.stopPropagation()}));let r=M(n,HT(`span`));r.innerText=s.value;let o=M(i,e);o.style.opacity=`0.6`,o.style.paddingLeft=`6px`}else{let e=M(i,HT(`span`));e.style.opacity=`0.6`,e.style.paddingLeft=`6px`,e.innerText=a&&s?`${a}(${s})`:a||`(${s})`}if(On(c))for(let{message:e,resource:n,startLineNumber:r,startColumn:a}of c){let o=M(i,HT(`div`));o.style.marginTop=`8px`;let s=M(o,HT(`a`));s.innerText=`${bc(n)}(${r}, ${a}): `,s.style.cursor=`pointer`,t.add(D(s,`click`,e=>{if(e.stopPropagation(),e.preventDefault(),this._openerService){let e={selection:{startLineNumber:r,startColumn:a}};this._openerService.open(n,{fromUserGesture:!0,editorOptions:e}).catch(C)}}));let c=M(o,HT(`span`));c.innerText=e,this._editor.applyFontInfo(c)}return{hoverPart:e,hoverElement:r,dispose:()=>t.dispose()}}renderMarkerStatusbar(e,t,n){if(t.marker.severity===Qa.Error||t.marker.severity===Qa.Warning||t.marker.severity===Qa.Info){let n=bT.get(this._editor);n&&e.statusBar.addAction({label:S(`view problem`,`View Problem`),commandId:ST.ID,run:()=>{e.hide(),n.showAtMarker(t.marker),this._editor.focus()}})}if(!this._editor.getOption(92)){let r=e.statusBar.append(HT(`div`));this.recentMarkerCodeActionsInfo&&(rs.makeKey(this.recentMarkerCodeActionsInfo.marker)===rs.makeKey(t.marker)?this.recentMarkerCodeActionsInfo.hasCodeActions||(r.textContent=S(`noQuickFixes`,`No quick fixes available`)):this.recentMarkerCodeActionsInfo=void 0);let i=this.recentMarkerCodeActionsInfo&&!this.recentMarkerCodeActionsInfo.hasCodeActions?_.None:on(()=>r.textContent=S(`checkingForQuickFixes`,`Checking for quick fixes...`),200,n);r.textContent||=`\xA0`;let a=this.getCodeActions(t.marker);n.add(b(()=>a.cancel())),a.then(a=>{if(i.dispose(),this.recentMarkerCodeActionsInfo={marker:t.marker,hasCodeActions:a.validActions.length>0},!this.recentMarkerCodeActionsInfo.hasCodeActions){a.dispose(),r.textContent=S(`noQuickFixes`,`No quick fixes available`);return}r.style.display=`none`;let o=!1;n.add(b(()=>{o||a.dispose()})),e.statusBar.addAction({label:S(`quick fixes`,`Quick Fix...`),commandId:rf,run:t=>{o=!0;let n=sp.get(this._editor),r=gt(t);e.hide(),n?.showCodeActions(WT,a,{x:r.left,y:r.top,width:r.width,height:r.height})}})},C)}}getCodeActions(e){return et(t=>df(this._languageFeaturesService.codeActionProvider,this._editor.getModel(),new T(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn),WT,_a.None,t))}};GT=BT([VT(1,Go),VT(2,wi),VT(3,V)],GT);var KT=class{get lineNumber(){return this._lineNumber}set lineNumber(e){this._lineNumber=e}get lane(){return this._laneOrLine}set lane(e){this._laneOrLine=e}constructor(e){this._editor=e,this._lineNumber=-1,this._laneOrLine=js.Center}computeSync(){let e=e=>({value:e}),t=this._editor.getLineDecorations(this._lineNumber),n=[],r=this._laneOrLine===`lineNo`;if(!t)return n;for(let i of t){let t=i.options.glyphMargin?.position??js.Center;if(!r&&t!==this._laneOrLine)continue;let a=r?i.options.lineNumberHoverMessage:i.options.glyphMarginHoverMessage;!a||Xr(a)||n.push(...lt(a).map(e))}return n}},qT=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},JT=function(e,t){return function(n,r){t(n,r,e)}},YT,XT=O,ZT=class extends _{static#e=YT=this;static#t=this.ID=`editor.contrib.modesGlyphHoverWidget`;constructor(e,t,r){super(),this._renderDisposeables=this._register(new n),this._editor=e,this._isVisible=!1,this._messages=[],this._hover=this._register(new nc),this._hover.containerDomNode.classList.toggle(`hidden`,!this._isVisible),this._markdownRenderer=this._register(new Hi({editor:this._editor},t,r)),this._computer=new KT(this._editor),this._hoverOperation=this._register(new zm(this._editor,this._computer)),this._register(this._hoverOperation.onResult(e=>{this._withResult(e.value)})),this._register(this._editor.onDidChangeModelDecorations(()=>this._onModelDecorationsChanged())),this._register(this._editor.onDidChangeConfiguration(e=>{e.hasChanged(50)&&this._updateFont()})),this._register(Gn(this._hover.containerDomNode,`mouseleave`,e=>{this._onMouseLeave(e)})),this._editor.addOverlayWidget(this)}dispose(){this._editor.removeOverlayWidget(this),super.dispose()}getId(){return YT.ID}getDomNode(){return this._hover.containerDomNode}getPosition(){return null}_updateFont(){Array.prototype.slice.call(this._hover.contentsDomNode.getElementsByClassName(`code`)).forEach(e=>this._editor.applyFontInfo(e))}_onModelDecorationsChanged(){this._isVisible&&(this._hoverOperation.cancel(),this._hoverOperation.start(0))}showsOrWillShow(e){let t=e.target;return t.type===2&&t.detail.glyphMarginLane?(this._startShowingAt(t.position.lineNumber,t.detail.glyphMarginLane),!0):t.type===3?(this._startShowingAt(t.position.lineNumber,`lineNo`),!0):!1}_startShowingAt(e,t){this._computer.lineNumber===e&&this._computer.lane===t||(this._hoverOperation.cancel(),this.hide(),this._computer.lineNumber=e,this._computer.lane=t,this._hoverOperation.start(0))}hide(){this._computer.lineNumber=-1,this._hoverOperation.cancel(),this._isVisible&&(this._isVisible=!1,this._hover.containerDomNode.classList.toggle(`hidden`,!this._isVisible))}_withResult(e){this._messages=e,this._messages.length>0?this._renderMessages(this._computer.lineNumber,this._messages):this.hide()}_renderMessages(e,t){this._renderDisposeables.clear();let n=document.createDocumentFragment();for(let e of t){let t=XT(`div.hover-row.markdown-hover`),r=M(t,XT(`div.hover-contents`)),i=this._renderDisposeables.add(this._markdownRenderer.render(e.value));r.appendChild(i.element),n.appendChild(t)}this._updateContents(n),this._showAt(e)}_updateContents(e){this._hover.contentsDomNode.textContent=``,this._hover.contentsDomNode.appendChild(e),this._updateFont()}_showAt(e){this._isVisible||(this._isVisible=!0,this._hover.containerDomNode.classList.toggle(`hidden`,!this._isVisible));let t=this._editor.getLayoutInfo(),n=this._editor.getTopForLineNumber(e),r=this._editor.getScrollTop(),i=this._editor.getOption(67),a=this._hover.containerDomNode.clientHeight,o=n-r-(a-i)/2,s=t.glyphMarginLeft+t.glyphMarginWidth+(this._computer.lane===`lineNo`?t.lineNumbersWidth:0);this._hover.containerDomNode.style.left=`${s}px`,this._hover.containerDomNode.style.top=`${Math.max(Math.round(o),0)}px`}_onMouseLeave(e){let t=this._editor.getDomNode();(!t||!Lm(t,e.x,e.y))&&this.hide()}};ZT=YT=qT([JT(1,Ys),JT(2,wi)],ZT);var QT=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},$T=function(e,t){return function(n,r){t(n,r,e)}},eE=class extends _{static#e=this.ID=`editor.contrib.marginHover`;constructor(e,t){super(),this._editor=e,this._instantiationService=t,this.shouldKeepOpenOnEditorMouseMoveOrLeave=!1,this._listenersStore=new n,this._hoverState={mouseDown:!1},this._reactToEditorMouseMoveRunner=this._register(new yt(()=>this._reactToEditorMouseMove(this._mouseMoveEvent),0)),this._hookListeners(),this._register(this._editor.onDidChangeConfiguration(e=>{e.hasChanged(60)&&(this._unhookListeners(),this._hookListeners())}))}_hookListeners(){let e=this._editor.getOption(60);this._hoverSettings={enabled:e.enabled,sticky:e.sticky,hidingDelay:e.hidingDelay},e.enabled?(this._listenersStore.add(this._editor.onMouseDown(e=>this._onEditorMouseDown(e))),this._listenersStore.add(this._editor.onMouseUp(()=>this._onEditorMouseUp())),this._listenersStore.add(this._editor.onMouseMove(e=>this._onEditorMouseMove(e))),this._listenersStore.add(this._editor.onKeyDown(e=>this._onKeyDown(e)))):(this._listenersStore.add(this._editor.onMouseMove(e=>this._onEditorMouseMove(e))),this._listenersStore.add(this._editor.onKeyDown(e=>this._onKeyDown(e)))),this._listenersStore.add(this._editor.onMouseLeave(e=>this._onEditorMouseLeave(e))),this._listenersStore.add(this._editor.onDidChangeModel(()=>{this._cancelScheduler(),this._hideWidgets()})),this._listenersStore.add(this._editor.onDidChangeModelContent(()=>this._cancelScheduler())),this._listenersStore.add(this._editor.onDidScrollChange(e=>this._onEditorScrollChanged(e)))}_unhookListeners(){this._listenersStore.clear()}_cancelScheduler(){this._mouseMoveEvent=void 0,this._reactToEditorMouseMoveRunner.cancel()}_onEditorScrollChanged(e){(e.scrollTopChanged||e.scrollLeftChanged)&&this._hideWidgets()}_onEditorMouseDown(e){this._hoverState.mouseDown=!0,!this._isMouseOnMarginHoverWidget(e)&&this._hideWidgets()}_isMouseOnMarginHoverWidget(e){let t=this._glyphWidget?.getDomNode();return t?Lm(t,e.event.posx,e.event.posy):!1}_onEditorMouseUp(){this._hoverState.mouseDown=!1}_onEditorMouseLeave(e){this.shouldKeepOpenOnEditorMouseMoveOrLeave||(this._cancelScheduler(),!this._isMouseOnMarginHoverWidget(e)&&this._hideWidgets())}_shouldNotRecomputeCurrentHoverWidget(e){let t=this._hoverSettings.sticky,n=this._isMouseOnMarginHoverWidget(e);return t&&n}_onEditorMouseMove(e){if(!this.shouldKeepOpenOnEditorMouseMoveOrLeave){if(this._mouseMoveEvent=e,this._shouldNotRecomputeCurrentHoverWidget(e)){this._reactToEditorMouseMoveRunner.cancel();return}this._reactToEditorMouseMove(e)}}_reactToEditorMouseMove(e){e&&(this._tryShowHoverWidget(e)||this._hideWidgets())}_tryShowHoverWidget(e){return this._getOrCreateGlyphWidget().showsOrWillShow(e)}_onKeyDown(e){this._editor.hasModel()&&(e.keyCode===5||e.keyCode===6||e.keyCode===57||e.keyCode===4||this._hideWidgets())}_hideWidgets(){this._glyphWidget?.hide()}_getOrCreateGlyphWidget(){return this._glyphWidget||=this._instantiationService.createInstance(ZT,this._editor),this._glyphWidget}dispose(){super.dispose(),this._unhookListeners(),this._listenersStore.dispose(),this._glyphWidget?.dispose()}};eE=QT([$T(1,Y)],eE);var tE=class{},nE=class{},rE=class{};I(S_.ID,S_,2),I(eE.ID,eE,2),L(OT),L(kT),L(AT),L(jT),L(MT),L(NT),L(PT),L(FT),L(IT),L(LT),L(RT),L(zT),um.register(gh),um.register(GT),yc((e,t)=>{let n=e.getColor(xr);n&&(t.addRule(`.monaco-editor .monaco-hover .hover-row:not(:first-child):not(:empty) { border-top: 1px solid ${n.transparent(.5)}; }`),t.addRule(`.monaco-editor .monaco-hover hr { border-top: 1px solid ${n.transparent(.5)}; }`),t.addRule(`.monaco-editor .monaco-hover hr { border-bottom: 0px solid ${n.transparent(.5)}; }`))}),Ww.register(new tE),Ww.register(new nE),Ww.register(new rE);function iE(e,t){let n=0;for(let r=0;r<e.length;r++)e.charAt(r)===`	`?n+=t:n++;return n}function aE(e,t,n){e=e<0?0:e;let r=``;if(!n){let n=Math.floor(e/t);e%=t;for(let e=0;e<n;e++)r+=`	`}for(let t=0;t<e;t++)r+=` `;return r}function oE(e,t,n,r){if(e.getLineCount()===1&&e.getLineMaxColumn(1)===1)return[];let i=t.getLanguageConfiguration(e.getLanguageId()).indentRulesSupport;if(!i)return[];let a=new ds(e,i,t);for(r=Math.min(r,e.getLineCount());n<=r&&a.shouldIgnore(n);)n++;if(n>r-1)return[];let{tabSize:o,indentSize:s,insertSpaces:c}=e.getOptions(),l=(e,t)=>(t||=1,Dc.shiftIndent(e,e.length+t,o,s,c)),u=(e,t)=>(t||=1,Dc.unshiftIndent(e,e.length+t,o,s,c)),d=[],f=Gt(e.getLineContent(n)),p=f;a.shouldIncrease(n)?(p=l(p),f=l(f)):a.shouldIndentNextLine(n)&&(p=l(p)),n++;for(let t=n;t<=r;t++){if(sE(e,t))continue;let n=Gt(e.getLineContent(t)),r=p;a.shouldDecrease(t,r)&&(p=u(p),f=u(f)),n!==p&&d.push(Fa.replaceMove(new v(t,1,t,n.length+1),Ns(p,s,c))),!a.shouldIgnore(t)&&(a.shouldIncrease(t,r)?(f=l(f),p=f):p=a.shouldIndentNextLine(t,r)?l(p):f)}return d}function sE(e,t){return e.tokenization.isCheapToTokenize(t)?e.tokenization.getLineTokens(t).getStandardTokenType(0)===2:!1}var cE=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},lE=function(e,t){return function(n,r){t(n,r,e)}},uE=class e extends N{static#e=this.ID=`editor.action.indentationToSpaces`;constructor(){super({id:e.ID,label:S(`indentationToSpaces`,`Convert Indentation to Spaces`),alias:`Convert Indentation to Spaces`,precondition:q.writable,metadata:{description:x(`indentationToSpacesDescription`,`Convert the tab indentation to spaces.`)}})}run(e,t){let n=t.getModel();if(!n)return;let r=n.getOptions(),i=t.getSelection();if(!i)return;let a=new CE(i,r.tabSize);t.pushUndoStop(),t.executeCommands(this.id,[a]),t.pushUndoStop(),n.updateOptions({insertSpaces:!0})}},dE=class e extends N{static#e=this.ID=`editor.action.indentationToTabs`;constructor(){super({id:e.ID,label:S(`indentationToTabs`,`Convert Indentation to Tabs`),alias:`Convert Indentation to Tabs`,precondition:q.writable,metadata:{description:x(`indentationToTabsDescription`,`Convert the spaces indentation to tabs.`)}})}run(e,t){let n=t.getModel();if(!n)return;let r=n.getOptions(),i=t.getSelection();if(!i)return;let a=new wE(i,r.tabSize);t.pushUndoStop(),t.executeCommands(this.id,[a]),t.pushUndoStop(),n.updateOptions({insertSpaces:!1})}},fE=class extends N{constructor(e,t,n){super(n),this.insertSpaces=e,this.displaySizeOnly=t}run(e,t){let n=e.get(xc),r=e.get(Ps),i=t.getModel();if(!i)return;let a=r.getCreationOptions(i.getLanguageId(),i.uri,i.isForSimpleWidget),o=i.getOptions(),s=[1,2,3,4,5,6,7,8].map(e=>({id:e.toString(),label:e.toString(),description:e===a.tabSize&&e===o.tabSize?S(`configuredTabSize`,`Configured Tab Size`):e===a.tabSize?S(`defaultTabSize`,`Default Tab Size`):e===o.tabSize?S(`currentTabSize`,`Current Tab Size`):void 0})),c=Math.min(i.getOptions().tabSize-1,7);setTimeout(()=>{n.pick(s,{placeHolder:S({key:`selectTabWidth`,comment:[`Tab corresponds to the tab key`]},`Select Tab Size for Current File`),activeItem:s[c]}).then(e=>{if(e&&i&&!i.isDisposed()){let t=parseInt(e.label,10);this.displaySizeOnly?i.updateOptions({tabSize:t}):i.updateOptions({tabSize:t,indentSize:t,insertSpaces:this.insertSpaces})}})},50)}},pE=class e extends fE{static#e=this.ID=`editor.action.indentUsingTabs`;constructor(){super(!1,!1,{id:e.ID,label:S(`indentUsingTabs`,`Indent Using Tabs`),alias:`Indent Using Tabs`,precondition:void 0,metadata:{description:x(`indentUsingTabsDescription`,`Use indentation with tabs.`)}})}},mE=class e extends fE{static#e=this.ID=`editor.action.indentUsingSpaces`;constructor(){super(!0,!1,{id:e.ID,label:S(`indentUsingSpaces`,`Indent Using Spaces`),alias:`Indent Using Spaces`,precondition:void 0,metadata:{description:x(`indentUsingSpacesDescription`,`Use indentation with spaces.`)}})}},hE=class e extends fE{static#e=this.ID=`editor.action.changeTabDisplaySize`;constructor(){super(!0,!0,{id:e.ID,label:S(`changeTabDisplaySize`,`Change Tab Display Size`),alias:`Change Tab Display Size`,precondition:void 0,metadata:{description:x(`changeTabDisplaySizeDescription`,`Change the space size equivalent of the tab.`)}})}},gE=class e extends N{static#e=this.ID=`editor.action.detectIndentation`;constructor(){super({id:e.ID,label:S(`detectIndentation`,`Detect Indentation from Content`),alias:`Detect Indentation from Content`,precondition:void 0,metadata:{description:x(`detectIndentationDescription`,`Detect the indentation from content.`)}})}run(e,t){let n=e.get(Ps),r=t.getModel();if(!r)return;let i=n.getCreationOptions(r.getLanguageId(),r.uri,r.isForSimpleWidget);r.detectIndentation(i.insertSpaces,i.tabSize)}},_E=class extends N{constructor(){super({id:`editor.action.reindentlines`,label:S(`editor.reindentlines`,`Reindent Lines`),alias:`Reindent Lines`,precondition:q.writable,metadata:{description:x(`editor.reindentlinesDescription`,`Reindent the lines of the editor.`)}})}run(e,t){let n=e.get(Ci),r=t.getModel();if(!r)return;let i=oE(r,n,1,r.getLineCount());i.length>0&&(t.pushUndoStop(),t.executeEdits(this.id,i),t.pushUndoStop())}},vE=class extends N{constructor(){super({id:`editor.action.reindentselectedlines`,label:S(`editor.reindentselectedlines`,`Reindent Selected Lines`),alias:`Reindent Selected Lines`,precondition:q.writable,metadata:{description:x(`editor.reindentselectedlinesDescription`,`Reindent the selected lines of the editor.`)}})}run(e,t){let n=e.get(Ci),r=t.getModel();if(!r)return;let i=t.getSelections();if(i===null)return;let a=[];for(let e of i){let t=e.startLineNumber,i=e.endLineNumber;if(t!==i&&e.endColumn===1&&i--,t===1){if(t===i)continue}else t--;let o=oE(r,n,t,i);a.push(...o)}a.length>0&&(t.pushUndoStop(),t.executeEdits(this.id,a),t.pushUndoStop())}},yE=class{constructor(e,t){this._initialSelection=t,this._edits=[],this._selectionId=null;for(let t of e)t.range&&typeof t.text==`string`&&this._edits.push(t)}getEditOperations(e,t){for(let e of this._edits)t.addEditOperation(T.lift(e.range),e.text);let n=!1;Array.isArray(this._edits)&&this._edits.length===1&&this._initialSelection.isEmpty()&&(this._edits[0].range.startColumn===this._initialSelection.endColumn&&this._edits[0].range.startLineNumber===this._initialSelection.endLineNumber?(n=!0,this._selectionId=t.trackSelection(this._initialSelection,!0)):this._edits[0].range.endColumn===this._initialSelection.startColumn&&this._edits[0].range.endLineNumber===this._initialSelection.startLineNumber&&(n=!0,this._selectionId=t.trackSelection(this._initialSelection,!1))),n||(this._selectionId=t.trackSelection(this._initialSelection))}computeCursorState(e,t){return t.getTrackedSelection(this._selectionId)}},bE=class{static#e=this.ID=`editor.contrib.autoIndentOnPaste`;constructor(e,t){this.editor=e,this._languageConfigurationService=t,this.callOnDispose=new n,this.callOnModel=new n,this.callOnDispose.add(e.onDidChangeConfiguration(()=>this.update())),this.callOnDispose.add(e.onDidChangeModel(()=>this.update())),this.callOnDispose.add(e.onDidChangeModelLanguage(()=>this.update()))}update(){this.callOnModel.clear(),!(this.editor.getOption(12)<4||this.editor.getOption(55))&&this.editor.hasModel()&&this.callOnModel.add(this.editor.onDidPaste(({range:e})=>{this.trigger(e)}))}trigger(e){let t=this.editor.getSelections();if(t===null||t.length>1)return;let n=this.editor.getModel();if(!n||this.rangeContainsOnlyWhitespaceCharacters(n,e)||xE(n,e)||!n.tokenization.isCheapToTokenize(e.getStartPosition().lineNumber))return;let r=this.editor.getOption(12),{tabSize:i,indentSize:a,insertSpaces:o}=n.getOptions(),s=[],c={shiftIndent:e=>Dc.shiftIndent(e,e.length+1,i,a,o),unshiftIndent:e=>Dc.unshiftIndent(e,e.length+1,i,a,o)},l=e.startLineNumber;for(;l<=e.endLineNumber;){if(this.shouldIgnoreLine(n,l)){l++;continue}break}if(l>e.endLineNumber)return;let u=n.getLineContent(l);if(!/\S/.test(u.substring(0,e.startColumn-1))){let e=qs(r,n,n.getLanguageId(),l,c,this._languageConfigurationService);if(e!==null){let t=Gt(u),r=iE(e,i);if(r!==iE(t,i)){let e=aE(r,i,o);s.push({range:new T(l,1,l,t.length+1),text:e}),u=e+u.substring(t.length)}else{let e=$o(n,l,this._languageConfigurationService);if(e===0||e===8)return}}}let d=l;for(;l<e.endLineNumber;){if(!/\S/.test(n.getLineContent(l+1))){l++;continue}break}if(l!==e.endLineNumber){let t=qs(r,{tokenization:{getLineTokens:e=>n.tokenization.getLineTokens(e),getLanguageId:()=>n.getLanguageId(),getLanguageIdAtPosition:(e,t)=>n.getLanguageIdAtPosition(e,t)},getLineContent:e=>e===d?u:n.getLineContent(e)},n.getLanguageId(),l+1,c,this._languageConfigurationService);if(t!==null){let r=iE(t,i),a=iE(Gt(n.getLineContent(l+1)),i);if(r!==a){let t=r-a;for(let r=l+1;r<=e.endLineNumber;r++){let e=Gt(n.getLineContent(r)),a=aE(iE(e,i)+t,i,o);a!==e&&s.push({range:new T(r,1,r,e.length+1),text:a})}}}}if(s.length>0){this.editor.pushUndoStop();let e=new yE(s,this.editor.getSelection());this.editor.executeCommand(`autoIndentOnPaste`,e),this.editor.pushUndoStop()}}rangeContainsOnlyWhitespaceCharacters(e,t){let n=e=>e.trim().length===0,r=!0;if(t.startLineNumber===t.endLineNumber)r=n(e.getLineContent(t.startLineNumber).substring(t.startColumn-1,t.endColumn-1));else for(let i=t.startLineNumber;i<=t.endLineNumber;i++){let a=e.getLineContent(i);if(r=i===t.startLineNumber?n(a.substring(t.startColumn-1)):i===t.endLineNumber?n(a.substring(0,t.endColumn-1)):e.getLineFirstNonWhitespaceColumn(i)===0,!r)break}return r}shouldIgnoreLine(e,t){e.tokenization.forceTokenization(t);let n=e.getLineFirstNonWhitespaceColumn(t);if(n===0)return!0;let r=e.tokenization.getLineTokens(t);if(r.getCount()>0){let e=r.findTokenIndexAtOffset(n);if(e>=0&&r.getStandardTokenType(e)===1)return!0}return!1}dispose(){this.callOnDispose.dispose(),this.callOnModel.dispose()}};bE=cE([lE(1,Ci)],bE);function xE(e,t){let n=t=>ea(e,t)===2;return n(t.getStartPosition())||n(t.getEndPosition())}function SE(e,t,n,r){if(e.getLineCount()===1&&e.getLineMaxColumn(1)===1)return;let i=``;for(let e=0;e<n;e++)i+=` `;let a=new RegExp(i,`gi`);for(let n=1,o=e.getLineCount();n<=o;n++){let o=e.getLineFirstNonWhitespaceColumn(n);if(o===0&&(o=e.getLineMaxColumn(n)),o===1)continue;let s=new T(n,1,n,o),c=e.getValueInRange(s),l=r?c.replace(/\t/gi,i):c.replace(a,`	`);t.addEditOperation(s,l)}}var CE=class{constructor(e,t){this.selection=e,this.tabSize=t,this.selectionId=null}getEditOperations(e,t){this.selectionId=t.trackSelection(this.selection),SE(e,t,this.tabSize,!0)}computeCursorState(e,t){return t.getTrackedSelection(this.selectionId)}},wE=class{constructor(e,t){this.selection=e,this.tabSize=t,this.selectionId=null}getEditOperations(e,t){this.selectionId=t.trackSelection(this.selection),SE(e,t,this.tabSize,!1)}computeCursorState(e,t){return t.getTrackedSelection(this.selectionId)}};I(bE.ID,bE,2),L(uE),L(dE),L(pE),L(mE),L(hE),L(gE),L(_E),L(vE),I(s_.ID,s_,1),um.register(f_);var TE=class{constructor(e,t,n){this._editRange=e,this._originalSelection=t,this._text=n}getEditOperations(e,t){t.addTrackedEditOperation(this._editRange,this._text)}computeCursorState(e,t){let n=t.getInverseEditOperations()[0].range;return this._originalSelection.isEmpty()?new v(n.endLineNumber,Math.min(this._originalSelection.positionColumn,n.endColumn),n.endLineNumber,Math.min(this._originalSelection.positionColumn,n.endColumn)):new v(n.endLineNumber,n.endColumn-this._text.length,n.endLineNumber,n.endColumn)}},EE=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},DE=function(e,t){return function(n,r){t(n,r,e)}},OE,kE=class{static#e=OE=this;static#t=this.ID=`editor.contrib.inPlaceReplaceController`;static get(e){return e.getContribution(OE.ID)}static#n=this.DECORATION=U.register({description:`in-place-replace`,className:`valueSetReplacement`});constructor(e,t){this.editor=e,this.editorWorkerService=t,this.decorations=this.editor.createDecorationsCollection()}dispose(){}run(e,t){this.currentRequest?.cancel();let n=this.editor.getSelection(),r=this.editor.getModel();if(!r||!n)return;let i=n;if(i.startLineNumber!==i.endLineNumber)return;let a=new ui(this.editor,5),o=r.uri;return this.editorWorkerService.canNavigateValueSet(o)?(this.currentRequest=et(e=>this.editorWorkerService.navigateValueSet(o,i,t)),this.currentRequest.then(t=>{if(!t||!t.range||!t.value||!a.validate(this.editor))return;let n=T.lift(t.range),r=t.range,o=t.value.length-(i.endColumn-i.startColumn);r={startLineNumber:r.startLineNumber,startColumn:r.startColumn,endLineNumber:r.endLineNumber,endColumn:r.startColumn+t.value.length},o>1&&(i=new v(i.startLineNumber,i.startColumn,i.endLineNumber,i.endColumn+o-1));let s=new TE(n,i,t.value);this.editor.pushUndoStop(),this.editor.executeCommand(e,s),this.editor.pushUndoStop(),this.decorations.set([{range:r,options:OE.DECORATION}]),this.decorationRemover?.cancel(),this.decorationRemover=Ot(350),this.decorationRemover.then(()=>this.decorations.clear()).catch(C)}).catch(C)):Promise.resolve(void 0)}};kE=OE=EE([DE(1,pi)],kE);var AE=class extends N{constructor(){super({id:`editor.action.inPlaceReplace.up`,label:S(`InPlaceReplaceAction.previous.label`,`Replace with Previous Value`),alias:`Replace with Previous Value`,precondition:q.writable,kbOpts:{kbExpr:q.editorTextFocus,primary:3159,weight:100}})}run(e,t){let n=kE.get(t);return n?n.run(this.id,!1):Promise.resolve(void 0)}},jE=class extends N{constructor(){super({id:`editor.action.inPlaceReplace.down`,label:S(`InPlaceReplaceAction.next.label`,`Replace with Next Value`),alias:`Replace with Next Value`,precondition:q.writable,kbOpts:{kbExpr:q.editorTextFocus,primary:3161,weight:100}})}run(e,t){let n=kE.get(t);return n?n.run(this.id,!0):Promise.resolve(void 0)}};I(kE.ID,kE,4),L(AE),L(jE),L(class extends N{constructor(){super({id:`expandLineSelection`,label:S(`expandLineSelection`,`Expand Line Selection`),alias:`Expand Line Selection`,precondition:void 0,kbOpts:{weight:0,kbExpr:q.textInputFocus,primary:2090}})}run(e,t,n){if(n||={},!t.hasModel())return;let r=t._getViewModel();r.model.pushStackElement(),r.setCursorStates(n.source,3,dc.expandLineSelection(r,r.getCursorStates())),r.revealAllCursors(n.source,!0)}});var ME=class{constructor(e,t,n){this._selection=e,this._cursors=t,this._selectionId=null,this._trimInRegexesAndStrings=n}getEditOperations(e,t){let n=NE(e,this._cursors,this._trimInRegexesAndStrings);for(let e=0,r=n.length;e<r;e++){let r=n[e];t.addEditOperation(r.range,r.text)}this._selectionId=t.trackSelection(this._selection)}computeCursorState(e,t){return t.getTrackedSelection(this._selectionId)}};function NE(e,t,n){t.sort((e,t)=>e.lineNumber===t.lineNumber?e.column-t.column:e.lineNumber-t.lineNumber);for(let e=t.length-2;e>=0;e--)t[e].lineNumber===t[e+1].lineNumber&&t.splice(e,1);let r=[],i=0,a=0,o=t.length;for(let s=1,c=e.getLineCount();s<=c;s++){let c=e.getLineContent(s),l=c.length+1,u=0;if(a<o&&t[a].lineNumber===s&&(u=t[a].column,a++,u===l)||c.length===0)continue;let d=Ln(c),f=0;if(d===-1)f=1;else if(d!==c.length-1)f=d+2;else continue;if(!n){if(!e.tokenization.hasAccurateTokensForLine(s))continue;let t=e.tokenization.getLineTokens(s),n=t.getStandardTokenType(t.findTokenIndexAtOffset(f));if(n===2||n===3)continue}f=Math.max(u,f),r[i++]=Fa.delete(new T(s,f,s,l))}return r}var PE=class{constructor(e,t,n){this._selection=e,this._isCopyingDown=t,this._noop=n||!1,this._selectionDirection=0,this._selectionId=null,this._startLineNumberDelta=0,this._endLineNumberDelta=0}getEditOperations(e,t){let n=this._selection;this._startLineNumberDelta=0,this._endLineNumberDelta=0,n.startLineNumber<n.endLineNumber&&n.endColumn===1&&(this._endLineNumberDelta=1,n=n.setEndPosition(n.endLineNumber-1,e.getLineMaxColumn(n.endLineNumber-1)));let r=[];for(let t=n.startLineNumber;t<=n.endLineNumber;t++)r.push(e.getLineContent(t));let i=r.join(`
`);i===``&&this._isCopyingDown&&(this._startLineNumberDelta++,this._endLineNumberDelta++),this._noop?t.addEditOperation(new T(n.endLineNumber,e.getLineMaxColumn(n.endLineNumber),n.endLineNumber+1,1),n.endLineNumber===e.getLineCount()?``:`
`):this._isCopyingDown?t.addEditOperation(new T(n.startLineNumber,1,n.startLineNumber,1),i+`
`):t.addEditOperation(new T(n.endLineNumber,e.getLineMaxColumn(n.endLineNumber),n.endLineNumber,e.getLineMaxColumn(n.endLineNumber)),`
`+i),this._selectionId=t.trackSelection(n),this._selectionDirection=this._selection.getDirection()}computeCursorState(e,t){let n=t.getTrackedSelection(this._selectionId);if(this._startLineNumberDelta!==0||this._endLineNumberDelta!==0){let e=n.startLineNumber,t=n.startColumn,r=n.endLineNumber,i=n.endColumn;this._startLineNumberDelta!==0&&(e+=this._startLineNumberDelta,t=1),this._endLineNumberDelta!==0&&(r+=this._endLineNumberDelta,i=1),n=v.createWithDirection(e,t,r,i,this._selectionDirection)}return n}},FE=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},IE=function(e,t){return function(n,r){t(n,r,e)}},LE=class{constructor(e,t,n,r){this._languageConfigurationService=r,this._selection=e,this._isMovingDown=t,this._autoIndent=n,this._selectionId=null,this._moveEndLineSelectionShrink=!1}getEditOperations(e,t){let n=()=>e.getLanguageId(),r=(t,n)=>e.getLanguageIdAtPosition(t,n),i=e.getLineCount();if(this._isMovingDown&&this._selection.endLineNumber===i){this._selectionId=t.trackSelection(this._selection);return}if(!this._isMovingDown&&this._selection.startLineNumber===1){this._selectionId=t.trackSelection(this._selection);return}this._moveEndPositionDown=!1;let a=this._selection;a.startLineNumber<a.endLineNumber&&a.endColumn===1&&(this._moveEndPositionDown=!0,a=a.setEndPosition(a.endLineNumber-1,e.getLineMaxColumn(a.endLineNumber-1)));let{tabSize:o,indentSize:s,insertSpaces:c}=e.getOptions(),l=this.buildIndentConverter(o,s,c);if(a.startLineNumber===a.endLineNumber&&e.getLineMaxColumn(a.startLineNumber)===1){let n=a.startLineNumber,r=this._isMovingDown?n+1:n-1;e.getLineMaxColumn(r)===1?t.addEditOperation(new T(1,1,1,1),null):(t.addEditOperation(new T(n,1,n,1),e.getLineContent(r)),t.addEditOperation(new T(r,1,r,e.getLineMaxColumn(r)),null)),a=new v(r,1,r,1)}else{let i,s;if(this._isMovingDown){i=a.endLineNumber+1,s=e.getLineContent(i),t.addEditOperation(new T(i-1,e.getLineMaxColumn(i-1),i,e.getLineMaxColumn(i)),null);let u=s;if(this.shouldAutoIndent(e,a)){let d=this.matchEnterRule(e,l,o,i,a.startLineNumber-1);if(d!==null)u=aE(d+iE(Gt(e.getLineContent(i)),o),o,c)+this.trimStart(s);else{let t={tokenization:{getLineTokens:t=>t===a.startLineNumber?e.tokenization.getLineTokens(i):e.tokenization.getLineTokens(t),getLanguageId:n,getLanguageIdAtPosition:r},getLineContent:t=>t===a.startLineNumber?e.getLineContent(i):e.getLineContent(t)},d=qs(this._autoIndent,t,e.getLanguageIdAtPosition(i,1),a.startLineNumber,l,this._languageConfigurationService);if(d!==null){let t=Gt(e.getLineContent(i)),n=iE(d,o);n!==iE(t,o)&&(u=aE(n,o,c)+this.trimStart(s))}}t.addEditOperation(new T(a.startLineNumber,1,a.startLineNumber,1),u+`
`);let f=this.matchEnterRuleMovingDown(e,l,o,a.startLineNumber,i,u);if(f!==null)f!==0&&this.getIndentEditsOfMovingBlock(e,t,a,o,c,f);else{let s={tokenization:{getLineTokens:t=>t===a.startLineNumber?e.tokenization.getLineTokens(i):t>=a.startLineNumber+1&&t<=a.endLineNumber+1?e.tokenization.getLineTokens(t-1):e.tokenization.getLineTokens(t),getLanguageId:n,getLanguageIdAtPosition:r},getLineContent:t=>t===a.startLineNumber?u:t>=a.startLineNumber+1&&t<=a.endLineNumber+1?e.getLineContent(t-1):e.getLineContent(t)},d=qs(this._autoIndent,s,e.getLanguageIdAtPosition(i,1),a.startLineNumber+1,l,this._languageConfigurationService);if(d!==null){let n=Gt(e.getLineContent(a.startLineNumber)),r=iE(d,o),i=iE(n,o);if(r!==i){let n=r-i;this.getIndentEditsOfMovingBlock(e,t,a,o,c,n)}}}}else t.addEditOperation(new T(a.startLineNumber,1,a.startLineNumber,1),u+`
`)}else if(i=a.startLineNumber-1,s=e.getLineContent(i),t.addEditOperation(new T(i,1,i+1,1),null),t.addEditOperation(new T(a.endLineNumber,e.getLineMaxColumn(a.endLineNumber),a.endLineNumber,e.getLineMaxColumn(a.endLineNumber)),`
`+s),this.shouldAutoIndent(e,a)){let s={tokenization:{getLineTokens:t=>t===i?e.tokenization.getLineTokens(a.startLineNumber):e.tokenization.getLineTokens(t),getLanguageId:n,getLanguageIdAtPosition:r},getLineContent:t=>t===i?e.getLineContent(a.startLineNumber):e.getLineContent(t)},u=this.matchEnterRule(e,l,o,a.startLineNumber,a.startLineNumber-2);if(u!==null)u!==0&&this.getIndentEditsOfMovingBlock(e,t,a,o,c,u);else{let n=qs(this._autoIndent,s,e.getLanguageIdAtPosition(a.startLineNumber,1),i,l,this._languageConfigurationService);if(n!==null){let r=Gt(e.getLineContent(a.startLineNumber)),i=iE(n,o),s=iE(r,o);if(i!==s){let n=i-s;this.getIndentEditsOfMovingBlock(e,t,a,o,c,n)}}}}}this._selectionId=t.trackSelection(a)}buildIndentConverter(e,t,n){return{shiftIndent:r=>Dc.shiftIndent(r,r.length+1,e,t,n),unshiftIndent:r=>Dc.unshiftIndent(r,r.length+1,e,t,n)}}parseEnterResult(e,t,n,r,i){if(i){let a=i.indentation;i.indentAction===ba.None||i.indentAction===ba.Indent?a=i.indentation+i.appendText:i.indentAction===ba.IndentOutdent?a=i.indentation:i.indentAction===ba.Outdent&&(a=t.unshiftIndent(i.indentation)+i.appendText);let o=e.getLineContent(r);if(this.trimStart(o).indexOf(this.trimStart(a))>=0){let i=Gt(e.getLineContent(r)),o=Gt(a),s=$o(e,r,this._languageConfigurationService);return s!==null&&s&2&&(o=t.unshiftIndent(o)),iE(o,n)-iE(i,n)}}return null}matchEnterRuleMovingDown(e,t,n,r,i,a){if(Ln(a)>=0){let a=e.getLineMaxColumn(i),o=Xc(this._autoIndent,e,new T(i,a,i,a),this._languageConfigurationService);return this.parseEnterResult(e,t,n,r,o)}else{let i=r-1;for(;i>=1&&!(Ln(e.getLineContent(i))>=0);)i--;if(i<1||r>e.getLineCount())return null;let a=e.getLineMaxColumn(i),o=Xc(this._autoIndent,e,new T(i,a,i,a),this._languageConfigurationService);return this.parseEnterResult(e,t,n,r,o)}}matchEnterRule(e,t,n,r,i,a){let o=i;for(;o>=1;){let t;if(t=o===i&&a!==void 0?a:e.getLineContent(o),Ln(t)>=0)break;o--}if(o<1||r>e.getLineCount())return null;let s=e.getLineMaxColumn(o),c=Xc(this._autoIndent,e,new T(o,s,o,s),this._languageConfigurationService);return this.parseEnterResult(e,t,n,r,c)}trimStart(e){return e.replace(/^\s+/,``)}shouldAutoIndent(e,t){if(this._autoIndent<4||!e.tokenization.isCheapToTokenize(t.startLineNumber))return!1;let n=e.getLanguageIdAtPosition(t.startLineNumber,1);return!(n!==e.getLanguageIdAtPosition(t.endLineNumber,1)||this._languageConfigurationService.getLanguageConfiguration(n).indentRulesSupport===null)}getIndentEditsOfMovingBlock(e,t,n,r,i,a){for(let o=n.startLineNumber;o<=n.endLineNumber;o++){let s=Gt(e.getLineContent(o)),c=aE(iE(s,r)+a,r,i);c!==s&&(t.addEditOperation(new T(o,1,o,s.length+1),c),o===n.endLineNumber&&n.endColumn<=s.length+1&&c===``&&(this._moveEndLineSelectionShrink=!0))}}computeCursorState(e,t){let n=t.getTrackedSelection(this._selectionId);return this._moveEndPositionDown&&(n=n.setEndPosition(n.endLineNumber+1,1)),this._moveEndLineSelectionShrink&&n.startLineNumber<n.endLineNumber&&(n=n.setEndPosition(n.endLineNumber,2)),n}};LE=FE([IE(3,Ci)],LE);var RE=class e{static#e=this._COLLATOR=null;static getCollator(){return e._COLLATOR||=new Intl.Collator,e._COLLATOR}constructor(e,t){this.selection=e,this.descending=t,this.selectionId=null}getEditOperations(e,t){let n=BE(e,this.selection,this.descending);n&&t.addEditOperation(n.range,n.text),this.selectionId=t.trackSelection(this.selection)}computeCursorState(e,t){return t.getTrackedSelection(this.selectionId)}static canRun(e,t,n){if(e===null)return!1;let r=zE(e,t,n);if(!r)return!1;for(let e=0,t=r.before.length;e<t;e++)if(r.before[e]!==r.after[e])return!0;return!1}};function zE(e,t,n){let r=t.startLineNumber,i=t.endLineNumber;if(t.endColumn===1&&i--,r>=i)return null;let a=[];for(let t=r;t<=i;t++)a.push(e.getLineContent(t));let o=a.slice(0);return o.sort(RE.getCollator().compare),n===!0&&(o=o.reverse()),{startLineNumber:r,endLineNumber:i,before:a,after:o}}function BE(e,t,n){let r=zE(e,t,n);return r?Fa.replace(new T(r.startLineNumber,1,r.endLineNumber,e.getLineMaxColumn(r.endLineNumber)),r.after.join(`
`)):null}var VE=class extends N{constructor(e,t){super(t),this.down=e}run(e,t){if(!t.hasModel())return;let n=t.getSelections().map((e,t)=>({selection:e,index:t,ignore:!1}));n.sort((e,t)=>T.compareRangesUsingStarts(e.selection,t.selection));let r=n[0];for(let e=1;e<n.length;e++){let t=n[e];r.selection.endLineNumber===t.selection.startLineNumber&&(r.index<t.index?t.ignore=!0:(r.ignore=!0,r=t))}let i=[];for(let e of n)i.push(new PE(e.selection,this.down,e.ignore));t.pushUndoStop(),t.executeCommands(this.id,i),t.pushUndoStop()}},HE=class extends VE{constructor(){super(!1,{id:`editor.action.copyLinesUpAction`,label:S(`lines.copyUp`,`Copy Line Up`),alias:`Copy Line Up`,precondition:q.writable,kbOpts:{kbExpr:q.editorTextFocus,primary:1552,linux:{primary:3600},weight:100},menuOpts:{menuId:R.MenubarSelectionMenu,group:`2_line`,title:S({key:`miCopyLinesUp`,comment:[`&& denotes a mnemonic`]},`&&Copy Line Up`),order:1}})}},UE=class extends VE{constructor(){super(!0,{id:`editor.action.copyLinesDownAction`,label:S(`lines.copyDown`,`Copy Line Down`),alias:`Copy Line Down`,precondition:q.writable,kbOpts:{kbExpr:q.editorTextFocus,primary:1554,linux:{primary:3602},weight:100},menuOpts:{menuId:R.MenubarSelectionMenu,group:`2_line`,title:S({key:`miCopyLinesDown`,comment:[`&& denotes a mnemonic`]},`Co&&py Line Down`),order:2}})}},WE=class extends N{constructor(){super({id:`editor.action.duplicateSelection`,label:S(`duplicateSelection`,`Duplicate Selection`),alias:`Duplicate Selection`,precondition:q.writable,menuOpts:{menuId:R.MenubarSelectionMenu,group:`2_line`,title:S({key:`miDuplicateSelection`,comment:[`&& denotes a mnemonic`]},`&&Duplicate Selection`),order:5}})}run(e,t,n){if(!t.hasModel())return;let r=[],i=t.getSelections(),a=t.getModel();for(let e of i)if(e.isEmpty())r.push(new PE(e,!0));else{let t=new v(e.endLineNumber,e.endColumn,e.endLineNumber,e.endColumn);r.push(new Hs(t,a.getValueInRange(e)))}t.pushUndoStop(),t.executeCommands(this.id,r),t.pushUndoStop()}},GE=class extends N{constructor(e,t){super(t),this.down=e}run(e,t){let n=e.get(Ci),r=[],i=t.getSelections()||[],a=t.getOption(12);for(let e of i)r.push(new LE(e,this.down,a,n));t.pushUndoStop(),t.executeCommands(this.id,r),t.pushUndoStop()}},KE=class extends GE{constructor(){super(!1,{id:`editor.action.moveLinesUpAction`,label:S(`lines.moveUp`,`Move Line Up`),alias:`Move Line Up`,precondition:q.writable,kbOpts:{kbExpr:q.editorTextFocus,primary:528,linux:{primary:528},weight:100},menuOpts:{menuId:R.MenubarSelectionMenu,group:`2_line`,title:S({key:`miMoveLinesUp`,comment:[`&& denotes a mnemonic`]},`Mo&&ve Line Up`),order:3}})}},qE=class extends GE{constructor(){super(!0,{id:`editor.action.moveLinesDownAction`,label:S(`lines.moveDown`,`Move Line Down`),alias:`Move Line Down`,precondition:q.writable,kbOpts:{kbExpr:q.editorTextFocus,primary:530,linux:{primary:530},weight:100},menuOpts:{menuId:R.MenubarSelectionMenu,group:`2_line`,title:S({key:`miMoveLinesDown`,comment:[`&& denotes a mnemonic`]},`Move &&Line Down`),order:4}})}},JE=class extends N{constructor(e,t){super(t),this.descending=e}run(e,t){if(!t.hasModel())return;let n=t.getModel(),r=t.getSelections();r.length===1&&r[0].isEmpty()&&(r=[new v(1,1,n.getLineCount(),n.getLineMaxColumn(n.getLineCount()))]);for(let e of r)if(!RE.canRun(t.getModel(),e,this.descending))return;let i=[];for(let e=0,t=r.length;e<t;e++)i[e]=new RE(r[e],this.descending);t.pushUndoStop(),t.executeCommands(this.id,i),t.pushUndoStop()}},YE=class extends JE{constructor(){super(!1,{id:`editor.action.sortLinesAscending`,label:S(`lines.sortAscending`,`Sort Lines Ascending`),alias:`Sort Lines Ascending`,precondition:q.writable})}},XE=class extends JE{constructor(){super(!0,{id:`editor.action.sortLinesDescending`,label:S(`lines.sortDescending`,`Sort Lines Descending`),alias:`Sort Lines Descending`,precondition:q.writable})}},ZE=class extends N{constructor(){super({id:`editor.action.removeDuplicateLines`,label:S(`lines.deleteDuplicates`,`Delete Duplicate Lines`),alias:`Delete Duplicate Lines`,precondition:q.writable})}run(e,t){if(!t.hasModel())return;let n=t.getModel();if(n.getLineCount()===1&&n.getLineMaxColumn(1)===1)return;let r=[],i=[],a=0,o=!0,s=t.getSelections();s.length===1&&s[0].isEmpty()&&(s=[new v(1,1,n.getLineCount(),n.getLineMaxColumn(n.getLineCount()))],o=!1);for(let e of s){let t=new Set,o=[];for(let r=e.startLineNumber;r<=e.endLineNumber;r++){let e=n.getLineContent(r);t.has(e)||(o.push(e),t.add(e))}let s=new v(e.startLineNumber,1,e.endLineNumber,n.getLineMaxColumn(e.endLineNumber)),c=e.startLineNumber-a,l=new v(c,1,c+o.length-1,o[o.length-1].length);r.push(Fa.replace(s,o.join(`
`))),i.push(l),a+=e.endLineNumber-e.startLineNumber+1-o.length}t.pushUndoStop(),t.executeEdits(this.id,r,o?i:void 0),t.pushUndoStop()}},QE=class e extends N{static#e=this.ID=`editor.action.trimTrailingWhitespace`;constructor(){super({id:e.ID,label:S(`lines.trimTrailingWhitespace`,`Trim Trailing Whitespace`),alias:`Trim Trailing Whitespace`,precondition:q.writable,kbOpts:{kbExpr:q.editorTextFocus,primary:ne(2089,2102),weight:100}})}run(e,t,n){let i=[];n.reason===`auto-save`&&(i=(t.getSelections()||[]).map(e=>new r(e.positionLineNumber,e.positionColumn)));let a=t.getSelection();if(a===null)return;let o=e.get(F),s=t.getModel(),c=o.getValue(`files.trimTrailingWhitespaceInRegexAndStrings`,{overrideIdentifier:s?.getLanguageId(),resource:s?.uri}),l=new ME(a,i,c);t.pushUndoStop(),t.executeCommands(this.id,[l]),t.pushUndoStop()}},$E=class extends N{constructor(){super({id:`editor.action.deleteLines`,label:S(`lines.delete`,`Delete Line`),alias:`Delete Line`,precondition:q.writable,kbOpts:{kbExpr:q.textInputFocus,primary:3113,weight:100}})}run(e,t){if(!t.hasModel())return;let n=this._getLinesToRemove(t),r=t.getModel();if(r.getLineCount()===1&&r.getLineMaxColumn(1)===1)return;let i=0,a=[],o=[];for(let e=0,t=n.length;e<t;e++){let t=n[e],s=t.startLineNumber,c=t.endLineNumber,l=1,u=r.getLineMaxColumn(c);c<r.getLineCount()?(c+=1,u=1):s>1&&(--s,l=r.getLineMaxColumn(s)),a.push(Fa.replace(new v(s,l,c,u),``)),o.push(new v(s-i,t.positionColumn,s-i,t.positionColumn)),i+=t.endLineNumber-t.startLineNumber+1}t.pushUndoStop(),t.executeEdits(this.id,a,o),t.pushUndoStop()}_getLinesToRemove(e){let t=e.getSelections().map(e=>{let t=e.endLineNumber;return e.startLineNumber<e.endLineNumber&&e.endColumn===1&&--t,{startLineNumber:e.startLineNumber,selectionStartColumn:e.selectionStartColumn,endLineNumber:t,positionColumn:e.positionColumn}});t.sort((e,t)=>e.startLineNumber===t.startLineNumber?e.endLineNumber-t.endLineNumber:e.startLineNumber-t.startLineNumber);let n=[],r=t[0];for(let e=1;e<t.length;e++)r.endLineNumber+1>=t[e].startLineNumber?r.endLineNumber=t[e].endLineNumber:(n.push(r),r=t[e]);return n.push(r),n}},eD=class extends N{constructor(){super({id:`editor.action.indentLines`,label:S(`lines.indent`,`Indent Line`),alias:`Indent Line`,precondition:q.writable,kbOpts:{kbExpr:q.editorTextFocus,primary:2142,weight:100}})}run(e,t){let n=t._getViewModel();n&&(t.pushUndoStop(),t.executeCommands(this.id,Cc.indent(n.cursorConfig,t.getModel(),t.getSelections())),t.pushUndoStop())}},tD=class extends N{constructor(){super({id:`editor.action.outdentLines`,label:S(`lines.outdent`,`Outdent Line`),alias:`Outdent Line`,precondition:q.writable,kbOpts:{kbExpr:q.editorTextFocus,primary:2140,weight:100}})}run(e,t){Cs.Outdent.runEditorCommand(e,t,null)}},nD=class extends N{constructor(){super({id:`editor.action.insertLineBefore`,label:S(`lines.insertBefore`,`Insert Line Above`),alias:`Insert Line Above`,precondition:q.writable,kbOpts:{kbExpr:q.editorTextFocus,primary:3075,weight:100}})}run(e,t){let n=t._getViewModel();n&&(t.pushUndoStop(),t.executeCommands(this.id,Gc.lineInsertBefore(n.cursorConfig,t.getModel(),t.getSelections())))}},rD=class extends N{constructor(){super({id:`editor.action.insertLineAfter`,label:S(`lines.insertAfter`,`Insert Line Below`),alias:`Insert Line Below`,precondition:q.writable,kbOpts:{kbExpr:q.editorTextFocus,primary:2051,weight:100}})}run(e,t){let n=t._getViewModel();n&&(t.pushUndoStop(),t.executeCommands(this.id,Gc.lineInsertAfter(n.cursorConfig,t.getModel(),t.getSelections())))}},iD=class extends N{run(e,t){if(!t.hasModel())return;let n=t.getSelection(),r=this._getRangesToDelete(t),i=[];for(let e=0,t=r.length-1;e<t;e++){let t=r[e],n=r[e+1];T.intersectRanges(t,n)===null?i.push(t):r[e+1]=T.plusRange(t,n)}i.push(r[r.length-1]);let a=this._getEndCursorState(n,i),o=i.map(e=>Fa.replace(e,``));t.pushUndoStop(),t.executeEdits(this.id,o,a),t.pushUndoStop()}},aD=class extends iD{constructor(){super({id:`deleteAllLeft`,label:S(`lines.deleteAllLeft`,`Delete All Left`),alias:`Delete All Left`,precondition:q.writable,kbOpts:{kbExpr:q.textInputFocus,primary:0,mac:{primary:2049},weight:100}})}_getEndCursorState(e,t){let n=null,r=[],i=0;return t.forEach(t=>{let a;if(t.endColumn===1&&i>0){let e=t.startLineNumber-i;a=new v(e,t.startColumn,e,t.startColumn)}else a=new v(t.startLineNumber,t.startColumn,t.startLineNumber,t.startColumn);i+=t.endLineNumber-t.startLineNumber,t.intersectRanges(e)?n=a:r.push(a)}),n&&r.unshift(n),r}_getRangesToDelete(e){let t=e.getSelections();if(t===null)return[];let n=t,r=e.getModel();return r===null?[]:(n.sort(T.compareRangesUsingStarts),n=n.map(e=>{if(e.isEmpty())if(e.startColumn===1){let t=Math.max(1,e.startLineNumber-1);return new T(t,e.startLineNumber===1?1:r.getLineLength(t)+1,e.startLineNumber,1)}else return new T(e.startLineNumber,1,e.startLineNumber,e.startColumn);else return new T(e.startLineNumber,1,e.endLineNumber,e.endColumn)}),n)}},oD=class extends iD{constructor(){super({id:`deleteAllRight`,label:S(`lines.deleteAllRight`,`Delete All Right`),alias:`Delete All Right`,precondition:q.writable,kbOpts:{kbExpr:q.textInputFocus,primary:0,mac:{primary:297,secondary:[2068]},weight:100}})}_getEndCursorState(e,t){let n=null,r=[];for(let i=0,a=t.length;i<a;i++){let a=t[i],o=new v(a.startLineNumber-0,a.startColumn,a.startLineNumber-0,a.startColumn);a.intersectRanges(e)?n=o:r.push(o)}return n&&r.unshift(n),r}_getRangesToDelete(e){let t=e.getModel();if(t===null)return[];let n=e.getSelections();if(n===null)return[];let r=n.map(e=>{if(e.isEmpty()){let n=t.getLineMaxColumn(e.startLineNumber);return e.startColumn===n?new T(e.startLineNumber,e.startColumn,e.startLineNumber+1,1):new T(e.startLineNumber,e.startColumn,e.startLineNumber,n)}return e});return r.sort(T.compareRangesUsingStarts),r}},sD=class extends N{constructor(){super({id:`editor.action.joinLines`,label:S(`lines.joinLines`,`Join Lines`),alias:`Join Lines`,precondition:q.writable,kbOpts:{kbExpr:q.editorTextFocus,primary:0,mac:{primary:296},weight:100}})}run(e,t){let n=t.getSelections();if(n===null)return;let r=t.getSelection();if(r===null)return;n.sort(T.compareRangesUsingStarts);let i=[],a=n.reduce((e,t)=>e.isEmpty()?e.endLineNumber===t.startLineNumber?(r.equalsSelection(e)&&(r=t),t):t.startLineNumber>e.endLineNumber+1?(i.push(e),t):new v(e.startLineNumber,e.startColumn,t.endLineNumber,t.endColumn):t.startLineNumber>e.endLineNumber?(i.push(e),t):new v(e.startLineNumber,e.startColumn,t.endLineNumber,t.endColumn));i.push(a);let o=t.getModel();if(o===null)return;let s=[],c=[],l=r,u=0;for(let e=0,t=i.length;e<t;e++){let t=i[e],n=t.startLineNumber,a=0,d,f,p=o.getLineLength(t.endLineNumber)-t.endColumn;if(t.isEmpty()||t.startLineNumber===t.endLineNumber){let e=t.getStartPosition();e.lineNumber<o.getLineCount()?(d=n+1,f=o.getLineMaxColumn(d)):(d=e.lineNumber,f=o.getLineMaxColumn(e.lineNumber))}else d=t.endLineNumber,f=o.getLineMaxColumn(d);let m=o.getLineContent(n);for(let e=n+1;e<=d;e++){let t=o.getLineContent(e),n=o.getLineFirstNonWhitespaceColumn(e);if(n>=1){let e=!0;m===``&&(e=!1),e&&(m.charAt(m.length-1)===` `||m.charAt(m.length-1)===`	`)&&(e=!1,m=m.replace(/[\s\uFEFF\xA0]+$/g,` `));let r=t.substr(n-1);m+=(e?` `:``)+r,a=e?r.length+1:r.length}else a=0}let h=new T(n,1,d,f);if(!h.isEmpty()){let e;t.isEmpty()?(s.push(Fa.replace(h,m)),e=new v(h.startLineNumber-u,m.length-a+1,n-u,m.length-a+1)):t.startLineNumber===t.endLineNumber?(s.push(Fa.replace(h,m)),e=new v(t.startLineNumber-u,t.startColumn,t.endLineNumber-u,t.endColumn)):(s.push(Fa.replace(h,m)),e=new v(t.startLineNumber-u,t.startColumn,t.startLineNumber-u,m.length-p)),T.intersectRanges(h,r)===null?c.push(e):l=e}u+=h.endLineNumber-h.startLineNumber}c.unshift(l),t.pushUndoStop(),t.executeEdits(this.id,s,c),t.pushUndoStop()}},cD=class extends N{constructor(){super({id:`editor.action.transpose`,label:S(`editor.transpose`,`Transpose Characters around the Cursor`),alias:`Transpose Characters around the Cursor`,precondition:q.writable})}run(e,t){let n=t.getSelections();if(n===null)return;let r=t.getModel();if(r===null)return;let i=[];for(let e=0,t=n.length;e<t;e++){let t=n[e];if(!t.isEmpty())continue;let a=t.getStartPosition(),o=r.getLineMaxColumn(a.lineNumber);if(a.column>=o){if(a.lineNumber===r.getLineCount())continue;let e=new T(a.lineNumber,Math.max(1,a.column-1),a.lineNumber+1,1),t=r.getValueInRange(e).split(``).reverse().join(``);i.push(new Nc(new v(a.lineNumber,Math.max(1,a.column-1),a.lineNumber+1,1),t))}else{let e=new T(a.lineNumber,Math.max(1,a.column-1),a.lineNumber,a.column+1),t=r.getValueInRange(e).split(``).reverse().join(``);i.push(new vc(e,t,new v(a.lineNumber,a.column+1,a.lineNumber,a.column+1)))}}t.pushUndoStop(),t.executeCommands(this.id,i),t.pushUndoStop()}},lD=class extends N{run(e,t){let n=t.getSelections();if(n===null)return;let r=t.getModel();if(r===null)return;let i=t.getOption(132),a=[];for(let e of n)if(e.isEmpty()){let n=e.getStartPosition(),o=t.getConfiguredWordAtPosition(n);if(!o)continue;let s=new T(n.lineNumber,o.startColumn,n.lineNumber,o.endColumn),c=r.getValueInRange(s);a.push(Fa.replace(s,this._modifyText(c,i)))}else{let t=r.getValueInRange(e);a.push(Fa.replace(e,this._modifyText(t,i)))}t.pushUndoStop(),t.executeEdits(this.id,a),t.pushUndoStop()}},uD=class extends lD{constructor(){super({id:`editor.action.transformToUppercase`,label:S(`editor.transformToUppercase`,`Transform to Uppercase`),alias:`Transform to Uppercase`,precondition:q.writable})}_modifyText(e,t){return e.toLocaleUpperCase()}},dD=class extends lD{constructor(){super({id:`editor.action.transformToLowercase`,label:S(`editor.transformToLowercase`,`Transform to Lowercase`),alias:`Transform to Lowercase`,precondition:q.writable})}_modifyText(e,t){return e.toLocaleLowerCase()}},fD=class{constructor(e,t){this._pattern=e,this._flags=t,this._actual=null,this._evaluated=!1}get(){if(!this._evaluated){this._evaluated=!0;try{this._actual=new RegExp(this._pattern,this._flags)}catch{}}return this._actual}isSupported(){return this.get()!==null}},pD=class e extends lD{static#e=this.titleBoundary=new fD(`(^|[^\\p{L}\\p{N}']|((^|\\P{L})'))\\p{L}`,`gmu`);constructor(){super({id:`editor.action.transformToTitlecase`,label:S(`editor.transformToTitlecase`,`Transform to Title Case`),alias:`Transform to Title Case`,precondition:q.writable})}_modifyText(t,n){let r=e.titleBoundary.get();return r?t.toLocaleLowerCase().replace(r,e=>e.toLocaleUpperCase()):t}},mD=class e extends lD{static#e=this.caseBoundary=new fD(`(\\p{Ll})(\\p{Lu})`,`gmu`);static#t=this.singleLetters=new fD(`(\\p{Lu}|\\p{N})(\\p{Lu})(\\p{Ll})`,`gmu`);constructor(){super({id:`editor.action.transformToSnakecase`,label:S(`editor.transformToSnakecase`,`Transform to Snake Case`),alias:`Transform to Snake Case`,precondition:q.writable})}_modifyText(t,n){let r=e.caseBoundary.get(),i=e.singleLetters.get();return!r||!i?t:t.replace(r,`$1_$2`).replace(i,`$1_$2$3`).toLocaleLowerCase()}},hD=class e extends lD{static#e=this.wordBoundary=new fD(`[_\\s-]`,`gm`);constructor(){super({id:`editor.action.transformToCamelcase`,label:S(`editor.transformToCamelcase`,`Transform to Camel Case`),alias:`Transform to Camel Case`,precondition:q.writable})}_modifyText(t,n){let r=e.wordBoundary.get();if(!r)return t;let i=t.split(r);return i.shift()+i.map(e=>e.substring(0,1).toLocaleUpperCase()+e.substring(1)).join(``)}},gD=class e extends lD{static#e=this.wordBoundary=new fD(`[_\\s-]`,`gm`);static#t=this.wordBoundaryToMaintain=new fD(`(?<=\\.)`,`gm`);constructor(){super({id:`editor.action.transformToPascalcase`,label:S(`editor.transformToPascalcase`,`Transform to Pascal Case`),alias:`Transform to Pascal Case`,precondition:q.writable})}_modifyText(t,n){let r=e.wordBoundary.get(),i=e.wordBoundaryToMaintain.get();return!r||!i?t:t.split(i).map(e=>e.split(r)).flat().map(e=>e.substring(0,1).toLocaleUpperCase()+e.substring(1)).join(``)}},_D=class e extends lD{static isSupported(){return[this.caseBoundary,this.singleLetters,this.underscoreBoundary].every(e=>e.isSupported())}static#e=this.caseBoundary=new fD(`(\\p{Ll})(\\p{Lu})`,`gmu`);static#t=this.singleLetters=new fD(`(\\p{Lu}|\\p{N})(\\p{Lu}\\p{Ll})`,`gmu`);static#n=this.underscoreBoundary=new fD(`(\\S)(_)(\\S)`,`gm`);constructor(){super({id:`editor.action.transformToKebabcase`,label:S(`editor.transformToKebabcase`,`Transform to Kebab Case`),alias:`Transform to Kebab Case`,precondition:q.writable})}_modifyText(t,n){let r=e.caseBoundary.get(),i=e.singleLetters.get(),a=e.underscoreBoundary.get();return!r||!i||!a?t:t.replace(a,`$1-$3`).replace(r,`$1-$2`).replace(i,`$1-$2`).toLocaleLowerCase()}};L(HE),L(UE),L(WE),L(KE),L(qE),L(YE),L(XE),L(ZE),L(QE),L($E),L(eD),L(tD),L(nD),L(rD),L(aD),L(oD),L(sD),L(cD),L(uD),L(dD),mD.caseBoundary.isSupported()&&mD.singleLetters.isSupported()&&L(mD),hD.wordBoundary.isSupported()&&L(hD),gD.wordBoundary.isSupported()&&L(gD),pD.titleBoundary.isSupported()&&L(pD),_D.isSupported()&&L(_D);var vD=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},yD=function(e,t){return function(n,r){t(n,r,e)}},bD;const xD=new G(`LinkedEditingInputVisible`,!1);var SD=`linked-editing-decoration`,CD=class extends _{static#e=bD=this;static#t=this.ID=`editor.contrib.linkedEditing`;static#n=this.DECORATION=U.register({description:`linked-editing`,stickiness:0,className:SD});static get(e){return e.getContribution(bD.ID)}constructor(e,t,r,i,a){super(),this.languageConfigurationService=i,this._syncRangesToken=0,this._localToDispose=this._register(new n),this._editor=e,this._providers=r.linkedEditingRangeProvider,this._enabled=!1,this._visibleContextKey=xD.bindTo(t),this._debounceInformation=a.for(this._providers,`Linked Editing`,{max:200}),this._currentDecorations=this._editor.createDecorationsCollection(),this._languageWordPattern=null,this._currentWordPattern=null,this._ignoreChangeEvent=!1,this._localToDispose=this._register(new n),this._rangeUpdateTriggerPromise=null,this._rangeSyncTriggerPromise=null,this._currentRequestCts=null,this._currentRequestPosition=null,this._currentRequestModelVersion=null,this._register(this._editor.onDidChangeModel(()=>this.reinitialize(!0))),this._register(this._editor.onDidChangeConfiguration(e=>{(e.hasChanged(70)||e.hasChanged(94))&&this.reinitialize(!1)})),this._register(this._providers.onDidChange(()=>this.reinitialize(!1))),this._register(this._editor.onDidChangeModelLanguage(()=>this.reinitialize(!0))),this.reinitialize(!0)}reinitialize(e){let t=this._editor.getModel(),n=t!==null&&(this._editor.getOption(70)||this._editor.getOption(94))&&this._providers.has(t);if(n===this._enabled&&!e||(this._enabled=n,this.clearRanges(),this._localToDispose.clear(),!n||t===null))return;this._localToDispose.add(we.runAndSubscribe(t.onDidChangeLanguageConfiguration,()=>{this._languageWordPattern=this.languageConfigurationService.getLanguageConfiguration(t.getLanguageId()).getWordDefinition()}));let r=new Nt(this._debounceInformation.get(t)),i=()=>{this._rangeUpdateTriggerPromise=r.trigger(()=>this.updateRanges(),this._debounceDuration??this._debounceInformation.get(t))},a=new Nt(0),o=e=>{this._rangeSyncTriggerPromise=a.trigger(()=>this._syncRanges(e))};this._localToDispose.add(this._editor.onDidChangeCursorPosition(()=>{i()})),this._localToDispose.add(this._editor.onDidChangeModelContent(e=>{if(!this._ignoreChangeEvent&&this._currentDecorations.length>0){let t=this._currentDecorations.getRange(0);if(t&&e.changes.every(e=>t.intersectRanges(e.range))){o(this._syncRangesToken);return}}i()})),this._localToDispose.add({dispose:()=>{r.dispose(),a.dispose()}}),this.updateRanges()}_syncRanges(e){if(!this._editor.hasModel()||e!==this._syncRangesToken||this._currentDecorations.length===0)return;let t=this._editor.getModel(),n=this._currentDecorations.getRange(0);if(!n||n.startLineNumber!==n.endLineNumber)return this.clearRanges();let r=t.getValueInRange(n);if(this._currentWordPattern){let e=r.match(this._currentWordPattern);if((e?e[0].length:0)!==r.length)return this.clearRanges()}let i=[];for(let e=1,n=this._currentDecorations.length;e<n;e++){let n=this._currentDecorations.getRange(e);if(n)if(n.startLineNumber!==n.endLineNumber)i.push({range:n,text:r});else{let e=t.getValueInRange(n),a=r,o=n.startColumn,s=n.endColumn,c=ct(e,a);o+=c,e=e.substr(c),a=a.substr(c);let l=vt(e,a);s-=l,e=e.substr(0,e.length-l),a=a.substr(0,a.length-l),(o!==s||a.length!==0)&&i.push({range:new T(n.startLineNumber,o,n.endLineNumber,s),text:a})}}if(i.length!==0)try{this._editor.popUndoStop(),this._ignoreChangeEvent=!0;let e=this._editor._getViewModel().getPrevEditOperationType();this._editor.executeEdits(`linkedEditing`,i),this._editor._getViewModel().setPrevEditOperationType(e)}finally{this._ignoreChangeEvent=!1}}dispose(){this.clearRanges(),super.dispose()}clearRanges(){this._visibleContextKey.set(!1),this._currentDecorations.clear(),this._currentRequestCts&&(this._currentRequestCts.cancel(),this._currentRequestCts=null,this._currentRequestPosition=null)}async updateRanges(e=!1){if(!this._editor.hasModel()){this.clearRanges();return}let t=this._editor.getPosition();if(!this._enabled&&!e||this._editor.getSelections().length>1){this.clearRanges();return}let n=this._editor.getModel(),r=n.getVersionId();if(this._currentRequestPosition&&this._currentRequestModelVersion===r){if(t.equals(this._currentRequestPosition))return;if(this._currentDecorations.length>0){let e=this._currentDecorations.getRange(0);if(e&&e.containsPosition(t))return}}this.clearRanges(),this._currentRequestPosition=t,this._currentRequestModelVersion=r;let i=this._currentRequestCts=new ie;try{let e=new u(!1),a=await TD(this._providers,n,t,i.token);if(this._debounceInformation.update(n,e.elapsed()),i!==this._currentRequestCts||(this._currentRequestCts=null,r!==n.getVersionId()))return;let o=[];a?.ranges&&(o=a.ranges),this._currentWordPattern=a?.wordPattern||this._languageWordPattern;let s=!1;for(let e=0,n=o.length;e<n;e++)if(T.containsPosition(o[e],t)){if(s=!0,e!==0){let t=o[e];o.splice(e,1),o.unshift(t)}break}if(!s){this.clearRanges();return}let c=o.map(e=>({range:e,options:bD.DECORATION}));this._visibleContextKey.set(!0),this._currentDecorations.set(c),this._syncRangesToken++}catch(e){pe(e)||C(e),(this._currentRequestCts===i||!this._currentRequestCts)&&this.clearRanges()}}};CD=bD=vD([yD(1,W),yD(2,V),yD(3,Ci),yD(4,Qi)],CD);var wD=class extends N{constructor(){super({id:`editor.action.linkedEditing`,label:S(`linkedEditing.label`,`Start Linked Editing`),alias:`Start Linked Editing`,precondition:z.and(q.writable,q.hasRenameProvider),kbOpts:{kbExpr:q.editorTextFocus,primary:3132,weight:100}})}runCommand(e,t){let n=e.get(Ko),[i,a]=Array.isArray(t)&&t||[void 0,void 0];return y.isUri(i)&&r.isIPosition(a)?n.openCodeEditor({resource:i},n.getActiveCodeEditor()).then(e=>{e&&(e.setPosition(a),e.invokeWithinContext(t=>(this.reportTelemetry(t,e),this.run(t,e))))},C):super.runCommand(e,t)}run(e,t){let n=CD.get(t);return n?Promise.resolve(n.updateRanges(!0)):Promise.resolve()}};P(new(la.bindToContribution(CD.get))({id:`cancelLinkedEditingInput`,precondition:xD,handler:e=>e.clearRanges(),kbOpts:{kbExpr:q.editorTextFocus,weight:199,primary:9,secondary:[1033]}}));function TD(e,t,n,r){return mt(e.ordered(t).map(e=>async()=>{try{return await e.provideLinkedEditingRanges(t,n,r)}catch(e){Re(e);return}}),e=>!!e&&On(e?.ranges))}k(`editor.linkedEditingBackground`,{dark:E.fromHex(`#f00`).transparent(.3),light:E.fromHex(`#f00`).transparent(.3),hcDark:E.fromHex(`#f00`).transparent(.3),hcLight:E.white},S(`editorLinkedEditingBackground`,`Background color when the editor auto renames on type.`)),Pi(`_executeLinkedEditingProvider`,(e,t,n)=>{let{linkedEditingRangeProvider:r}=e.get(V);return TD(r,t,n,w.None)}),I(CD.ID,CD,1),L(wD);var ED=class{constructor(e,t){this._link=e,this._provider=t}toJSON(){return{range:this.range,url:this.url,tooltip:this.tooltip}}get range(){return this._link.range}get url(){return this._link.url}get tooltip(){return this._link.tooltip}async resolve(e){return this._link.url?this._link.url:typeof this._provider.resolveLink==`function`?Promise.resolve(this._provider.resolveLink(this._link,e)).then(t=>(this._link=t||this._link,this._link.url?this.resolve(e):Promise.reject(Error(`missing`)))):Promise.reject(Error(`missing`))}},DD=class e{constructor(t){this._disposables=new n;let r=[];for(let[n,i]of t){let t=n.links.map(e=>new ED(e,i));r=e._union(r,t),d(n)&&this._disposables.add(n)}this.links=r}dispose(){this._disposables.dispose(),this.links.length=0}static _union(e,t){let n=[],r,i,a,o;for(r=0,a=0,i=e.length,o=t.length;r<i&&a<o;){let i=e[r],o=t[a];if(T.areIntersectingOrTouching(i.range,o.range)){r++;continue}T.compareRangesUsingStarts(i.range,o.range)<0?(n.push(i),r++):(n.push(o),a++)}for(;r<i;r++)n.push(e[r]);for(;a<o;a++)n.push(t[a]);return n}};function OD(e,t,n){let r=[],i=e.ordered(t).reverse().map((e,i)=>Promise.resolve(e.provideLinks(t,n)).then(t=>{t&&(r[i]=[t,e])},Re));return Promise.all(i).then(()=>{let e=new DD(bt(r));return n.isCancellationRequested?(e.dispose(),new DD([])):e})}B.registerCommand(`_executeLinkProvider`,async(e,...t)=>{let[n,r]=t;o(n instanceof y),typeof r!=`number`&&(r=0);let{linkProvider:i}=e.get(V),a=e.get(Ps).getModel(n);if(!a)return[];let s=await OD(i,a,w.None);if(!s)return[];for(let e=0;e<Math.min(r,s.links.length);e++)await s.links[e].resolve(w.None);let c=s.links.slice(0);return s.dispose(),c});var kD=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},AD=function(e,t){return function(n,r){t(n,r,e)}},jD,MD=class extends _{static#e=jD=this;static#t=this.ID=`editor.linkDetector`;static get(e){return e.getContribution(jD.ID)}constructor(e,t,n,r,i){super(),this.editor=e,this.openerService=t,this.notificationService=n,this.languageFeaturesService=r,this.providers=this.languageFeaturesService.linkProvider,this.debounceInformation=i.for(this.providers,`Links`,{min:1e3,max:4e3}),this.computeLinks=this._register(new yt(()=>this.computeLinksNow(),1e3)),this.computePromise=null,this.activeLinksList=null,this.currentOccurrences={},this.activeLinkDecorationId=null;let a=this._register(new Dh(e));this._register(a.onMouseMoveOrRelevantKeyDown(([e,t])=>{this._onEditorMouseMove(e,t)})),this._register(a.onExecute(e=>{this.onEditorMouseUp(e)})),this._register(a.onCancel(e=>{this.cleanUpActiveLinkDecoration()})),this._register(e.onDidChangeConfiguration(e=>{e.hasChanged(71)&&(this.updateDecorations([]),this.stop(),this.computeLinks.schedule(0))})),this._register(e.onDidChangeModelContent(e=>{this.editor.hasModel()&&this.computeLinks.schedule(this.debounceInformation.get(this.editor.getModel()))})),this._register(e.onDidChangeModel(e=>{this.currentOccurrences={},this.activeLinkDecorationId=null,this.stop(),this.computeLinks.schedule(0)})),this._register(e.onDidChangeModelLanguage(e=>{this.stop(),this.computeLinks.schedule(0)})),this._register(this.providers.onDidChange(e=>{this.stop(),this.computeLinks.schedule(0)})),this.computeLinks.schedule(0)}async computeLinksNow(){if(!this.editor.hasModel()||!this.editor.getOption(71))return;let e=this.editor.getModel();if(!e.isTooLargeForSyncing()&&this.providers.has(e)){this.activeLinksList&&=(this.activeLinksList.dispose(),null),this.computePromise=et(t=>OD(this.providers,e,t));try{let t=new u(!1);if(this.activeLinksList=await this.computePromise,this.debounceInformation.update(e,t.elapsed()),e.isDisposed())return;this.updateDecorations(this.activeLinksList.links)}catch(e){C(e)}finally{this.computePromise=null}}}updateDecorations(e){let t=this.editor.getOption(78)===`altKey`,n=[],r=Object.keys(this.currentOccurrences);for(let e of r){let t=this.currentOccurrences[e];n.push(t.decorationId)}let i=[];if(e)for(let n of e)i.push(PD.decoration(n,t));this.editor.changeDecorations(t=>{let r=t.deltaDecorations(n,i);this.currentOccurrences={},this.activeLinkDecorationId=null;for(let t=0,n=r.length;t<n;t++){let n=new PD(e[t],r[t]);this.currentOccurrences[n.decorationId]=n}})}_onEditorMouseMove(e,t){let n=this.editor.getOption(78)===`altKey`;if(this.isEnabled(e,t)){this.cleanUpActiveLinkDecoration();let t=this.getLinkOccurrence(e.target.position);t&&this.editor.changeDecorations(e=>{t.activate(e,n),this.activeLinkDecorationId=t.decorationId})}else this.cleanUpActiveLinkDecoration()}cleanUpActiveLinkDecoration(){let e=this.editor.getOption(78)===`altKey`;if(this.activeLinkDecorationId){let t=this.currentOccurrences[this.activeLinkDecorationId];t&&this.editor.changeDecorations(n=>{t.deactivate(n,e)}),this.activeLinkDecorationId=null}}onEditorMouseUp(e){if(!this.isEnabled(e))return;let t=this.getLinkOccurrence(e.target.position);t&&this.openLinkOccurrence(t,e.hasSideBySideModifier,!0)}openLinkOccurrence(e,t,n=!1){if(!this.openerService)return;let{link:r}=e;r.resolve(w.None).then(e=>{if(typeof e==`string`&&this.editor.hasModel()){let t=this.editor.getModel().uri;if(t.scheme===Bt.file&&e.startsWith(`${Bt.file}:`)){let n=y.parse(e);if(n.scheme===Bt.file){let r=sc(n),i=null;r.startsWith(`/./`)||r.startsWith(`\\.\\`)?i=`.${r.substr(1)}`:(r.startsWith(`//./`)||r.startsWith(`\\\\.\\`))&&(i=`.${r.substr(2)}`),i&&(e=cs(t,i))}}}return this.openerService.open(e,{openToSide:t,fromUserGesture:n,allowContributedOpeners:!0,allowCommands:!0,fromWorkspace:!0})},e=>{let t=e instanceof Error?e.message:e;t===`invalid`?this.notificationService.warn(S(`invalid.url`,`Failed to open this link because it is not well-formed: {0}`,r.url.toString())):t===`missing`?this.notificationService.warn(S(`missing.url`,`Failed to open this link because its target is missing.`)):C(e)})}getLinkOccurrence(e){if(!this.editor.hasModel()||!e)return null;let t=this.editor.getModel().getDecorationsInRange({startLineNumber:e.lineNumber,startColumn:e.column,endLineNumber:e.lineNumber,endColumn:e.column},0,!0);for(let e of t){let t=this.currentOccurrences[e.id];if(t)return t}return null}isEnabled(e,t){return!!(e.target.type===6&&(e.hasTriggerModifier||t&&t.keyCodeIsTriggerKey))}stop(){this.computeLinks.cancel(),this.activeLinksList&&=(this.activeLinksList?.dispose(),null),this.computePromise&&=(this.computePromise.cancel(),null)}dispose(){super.dispose(),this.stop()}};MD=jD=kD([AD(1,wi),AD(2,Ro),AD(3,V),AD(4,Qi)],MD);var ND={general:U.register({description:`detected-link`,stickiness:1,collapseOnReplaceEdit:!0,inlineClassName:`detected-link`}),active:U.register({description:`detected-link-active`,stickiness:1,collapseOnReplaceEdit:!0,inlineClassName:`detected-link-active`})},PD=class e{static decoration(t,n){return{range:t.range,options:e._getOptions(t,n,!1)}}static _getOptions(e,t,n){let r={...n?ND.active:ND.general};return r.hoverMessage=FD(e,t),r}constructor(e,t){this.link=e,this.decorationId=t}activate(t,n){t.changeDecorationOptions(this.decorationId,e._getOptions(this.link,n,!0))}deactivate(t,n){t.changeDecorationOptions(this.decorationId,e._getOptions(this.link,n,!1))}};function FD(e,t){let n=e.url&&/^command:/i.test(e.url.toString()),r=e.tooltip?e.tooltip:n?S(`links.navigate.executeCmd`,`Execute command`):S(`links.navigate.follow`,`Follow link`),i=t?Le?S(`links.navigate.kb.meta.mac`,`cmd + click`):S(`links.navigate.kb.meta`,`ctrl + click`):Le?S(`links.navigate.kb.alt.mac`,`option + click`):S(`links.navigate.kb.alt`,`alt + click`);if(e.url){let t=``;if(/^command:/i.test(e.url.toString())){let n=e.url.toString().match(/^command:([^?#]+)/);if(n){let e=n[1];t=S(`tooltip.explanation`,`Execute command {0}`,e)}}return new Va(``,!0).appendLink(e.url.toString(!0).replace(/ /g,`%20`),r,t).appendMarkdown(` (${i})`)}else return new Va().appendText(`${r} (${i})`)}var ID=class extends N{constructor(){super({id:`editor.action.openLink`,label:S(`label`,`Open Link`),alias:`Open Link`,precondition:void 0})}run(e,t){let n=MD.get(t);if(!n||!t.hasModel())return;let r=t.getSelections();for(let e of r){let t=n.getLinkOccurrence(e.getEndPosition());t&&n.openLinkOccurrence(t,!1)}}};I(MD.ID,MD,1),L(ID);var LD=class extends _{static#e=this.ID=`editor.contrib.longLinesHelper`;constructor(e){super(),this._editor=e,this._register(this._editor.onMouseDown(e=>{let t=this._editor.getOption(118);t>=0&&e.target.type===6&&e.target.position.column>=t&&this._editor.updateOptions({stopRenderingLineAfter:-1})}))}};I(LD.ID,LD,2);var RD=k(`editor.wordHighlightBackground`,{dark:`#575757B8`,light:`#57575740`,hcDark:null,hcLight:null},S(`wordHighlight`,`Background color of a symbol during read-access, like reading a variable. The color must not be opaque so as not to hide underlying decorations.`),!0);k(`editor.wordHighlightStrongBackground`,{dark:`#004972B8`,light:`#0e639c40`,hcDark:null,hcLight:null},S(`wordHighlightStrong`,`Background color of a symbol during write-access, like writing to a variable. The color must not be opaque so as not to hide underlying decorations.`),!0),k(`editor.wordHighlightTextBackground`,RD,S(`wordHighlightText`,`Background color of a textual occurrence for a symbol. The color must not be opaque so as not to hide underlying decorations.`),!0);var zD=k(`editor.wordHighlightBorder`,{light:null,dark:null,hcDark:_t,hcLight:_t},S(`wordHighlightBorder`,`Border color of a symbol during read-access, like reading a variable.`));k(`editor.wordHighlightStrongBorder`,{light:null,dark:null,hcDark:_t,hcLight:_t},S(`wordHighlightStrongBorder`,`Border color of a symbol during write-access, like writing to a variable.`)),k(`editor.wordHighlightTextBorder`,zD,S(`wordHighlightTextBorder`,`Border color of a textual occurrence for a symbol.`));var BD=k(`editorOverviewRuler.wordHighlightForeground`,`#A0A0A0CC`,S(`overviewRulerWordHighlightForeground`,`Overview ruler marker color for symbol highlights. The color must not be opaque so as not to hide underlying decorations.`),!0),VD=k(`editorOverviewRuler.wordHighlightStrongForeground`,`#C0A0C0CC`,S(`overviewRulerWordHighlightStrongForeground`,`Overview ruler marker color for write-access symbol highlights. The color must not be opaque so as not to hide underlying decorations.`),!0),HD=k(`editorOverviewRuler.wordHighlightTextForeground`,tt,S(`overviewRulerWordHighlightTextForeground`,`Overview ruler marker color of a textual occurrence for a symbol. The color must not be opaque so as not to hide underlying decorations.`),!0),UD=U.register({description:`word-highlight-strong`,stickiness:1,className:`wordHighlightStrong`,overviewRuler:{color:Bc(VD),position:sl.Center},minimap:{color:Bc(Ft),position:1}}),WD=U.register({description:`word-highlight-text`,stickiness:1,className:`wordHighlightText`,overviewRuler:{color:Bc(HD),position:sl.Center},minimap:{color:Bc(Ft),position:1}}),GD=U.register({description:`selection-highlight-overview`,stickiness:1,className:`selectionHighlight`,overviewRuler:{color:Bc(tt),position:sl.Center},minimap:{color:Bc(Ft),position:1}}),KD=U.register({description:`selection-highlight`,stickiness:1,className:`selectionHighlight`}),qD=U.register({description:`word-highlight`,stickiness:1,className:`wordHighlight`,overviewRuler:{color:Bc(BD),position:sl.Center},minimap:{color:Bc(Ft),position:1}});function JD(e){return e===Ie.Write?UD:e===Ie.Text?WD:qD}function YD(e){return e?KD:GD}yc((e,t)=>{let n=e.getColor(Jn);n&&t.addRule(`.monaco-editor .selectionHighlight { background-color: ${n.transparent(.5)}; }`)});var XD=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},ZD=function(e,t){return function(n,r){t(n,r,e)}},QD;function $D(e,t){let n=t.filter(t=>!e.find(e=>e.equals(t)));if(n.length>=1){let e=n.map(e=>`line ${e.viewState.position.lineNumber} column ${e.viewState.position.column}`).join(`, `);Il(n.length===1?S(`cursorAdded`,`Cursor added: {0}`,e):S(`cursorsAdded`,`Cursors added: {0}`,e))}}var eO=class extends N{constructor(){super({id:`editor.action.insertCursorAbove`,label:S(`mutlicursor.insertAbove`,`Add Cursor Above`),alias:`Add Cursor Above`,precondition:void 0,kbOpts:{kbExpr:q.editorTextFocus,primary:2576,linux:{primary:1552,secondary:[3088]},weight:100},menuOpts:{menuId:R.MenubarSelectionMenu,group:`3_multi`,title:S({key:`miInsertCursorAbove`,comment:[`&& denotes a mnemonic`]},`&&Add Cursor Above`),order:2}})}run(e,t,n){if(!t.hasModel())return;let r=!0;n&&n.logicalLine===!1&&(r=!1);let i=t._getViewModel();if(i.cursorConfig.readOnly)return;i.model.pushStackElement();let a=i.getCursorStates();i.setCursorStates(n.source,3,dc.addCursorUp(i,a,r)),i.revealTopMostCursor(n.source),$D(a,i.getCursorStates())}},tO=class extends N{constructor(){super({id:`editor.action.insertCursorBelow`,label:S(`mutlicursor.insertBelow`,`Add Cursor Below`),alias:`Add Cursor Below`,precondition:void 0,kbOpts:{kbExpr:q.editorTextFocus,primary:2578,linux:{primary:1554,secondary:[3090]},weight:100},menuOpts:{menuId:R.MenubarSelectionMenu,group:`3_multi`,title:S({key:`miInsertCursorBelow`,comment:[`&& denotes a mnemonic`]},`A&&dd Cursor Below`),order:3}})}run(e,t,n){if(!t.hasModel())return;let r=!0;n&&n.logicalLine===!1&&(r=!1);let i=t._getViewModel();if(i.cursorConfig.readOnly)return;i.model.pushStackElement();let a=i.getCursorStates();i.setCursorStates(n.source,3,dc.addCursorDown(i,a,r)),i.revealBottomMostCursor(n.source),$D(a,i.getCursorStates())}},nO=class extends N{constructor(){super({id:`editor.action.insertCursorAtEndOfEachLineSelected`,label:S(`mutlicursor.insertAtEndOfEachLineSelected`,`Add Cursors to Line Ends`),alias:`Add Cursors to Line Ends`,precondition:void 0,kbOpts:{kbExpr:q.editorTextFocus,primary:1575,weight:100},menuOpts:{menuId:R.MenubarSelectionMenu,group:`3_multi`,title:S({key:`miInsertCursorAtEndOfEachLineSelected`,comment:[`&& denotes a mnemonic`]},`Add C&&ursors to Line Ends`),order:4}})}getCursorsForSelection(e,t,n){if(!e.isEmpty()){for(let r=e.startLineNumber;r<e.endLineNumber;r++){let e=t.getLineMaxColumn(r);n.push(new v(r,e,r,e))}e.endColumn>1&&n.push(new v(e.endLineNumber,e.endColumn,e.endLineNumber,e.endColumn))}}run(e,t){if(!t.hasModel())return;let n=t.getModel(),r=t.getSelections(),i=t._getViewModel(),a=i.getCursorStates(),o=[];r.forEach(e=>this.getCursorsForSelection(e,n,o)),o.length>0&&t.setSelections(o),$D(a,i.getCursorStates())}},rO=class extends N{constructor(){super({id:`editor.action.addCursorsToBottom`,label:S(`mutlicursor.addCursorsToBottom`,`Add Cursors To Bottom`),alias:`Add Cursors To Bottom`,precondition:void 0})}run(e,t){if(!t.hasModel())return;let n=t.getSelections(),r=t.getModel().getLineCount(),i=[];for(let e=n[0].startLineNumber;e<=r;e++)i.push(new v(e,n[0].startColumn,e,n[0].endColumn));let a=t._getViewModel(),o=a.getCursorStates();i.length>0&&t.setSelections(i),$D(o,a.getCursorStates())}},iO=class extends N{constructor(){super({id:`editor.action.addCursorsToTop`,label:S(`mutlicursor.addCursorsToTop`,`Add Cursors To Top`),alias:`Add Cursors To Top`,precondition:void 0})}run(e,t){if(!t.hasModel())return;let n=t.getSelections(),r=[];for(let e=n[0].startLineNumber;e>=1;e--)r.push(new v(e,n[0].startColumn,e,n[0].endColumn));let i=t._getViewModel(),a=i.getCursorStates();r.length>0&&t.setSelections(r),$D(a,i.getCursorStates())}},aO=class{constructor(e,t,n){this.selections=e,this.revealRange=t,this.revealScrollType=n}},oO=class e{static create(t,n){if(!t.hasModel())return null;let r=n.getState();if(!t.hasTextFocus()&&r.isRevealed&&r.searchString.length>0)return new e(t,n,!1,r.searchString,r.wholeWord,r.matchCase,null);let i=!1,a,o,s=t.getSelections();s.length===1&&s[0].isEmpty()?(i=!0,a=!0,o=!0):(a=r.wholeWord,o=r.matchCase);let c=t.getSelection(),l,u=null;if(c.isEmpty()){let e=t.getConfiguredWordAtPosition(c.getStartPosition());if(!e)return null;l=e.word,u=new v(c.startLineNumber,e.startColumn,c.startLineNumber,e.endColumn)}else l=t.getModel().getValueInRange(c).replace(/\r\n/g,`
`);return new e(t,n,i,l,a,o,u)}constructor(e,t,n,r,i,a,o){this._editor=e,this.findController=t,this.isDisconnectedFromFindController=n,this.searchText=r,this.wholeWord=i,this.matchCase=a,this.currentMatch=o}addSelectionToNextFindMatch(){if(!this._editor.hasModel())return null;let e=this._getNextMatch();return e?new aO(this._editor.getSelections().concat(e),e,0):null}moveSelectionToNextFindMatch(){if(!this._editor.hasModel())return null;let e=this._getNextMatch();if(!e)return null;let t=this._editor.getSelections();return new aO(t.slice(0,t.length-1).concat(e),e,0)}_getNextMatch(){if(!this._editor.hasModel())return null;if(this.currentMatch){let e=this.currentMatch;return this.currentMatch=null,e}this.findController.highlightFindOptions();let e=this._editor.getSelections(),t=e[e.length-1],n=this._editor.getModel().findNextMatch(this.searchText,t.getEndPosition(),!1,this.matchCase,this.wholeWord?this._editor.getOption(132):null,!1);return n?new v(n.range.startLineNumber,n.range.startColumn,n.range.endLineNumber,n.range.endColumn):null}addSelectionToPreviousFindMatch(){if(!this._editor.hasModel())return null;let e=this._getPreviousMatch();return e?new aO(this._editor.getSelections().concat(e),e,0):null}moveSelectionToPreviousFindMatch(){if(!this._editor.hasModel())return null;let e=this._getPreviousMatch();if(!e)return null;let t=this._editor.getSelections();return new aO(t.slice(0,t.length-1).concat(e),e,0)}_getPreviousMatch(){if(!this._editor.hasModel())return null;if(this.currentMatch){let e=this.currentMatch;return this.currentMatch=null,e}this.findController.highlightFindOptions();let e=this._editor.getSelections(),t=e[e.length-1],n=this._editor.getModel().findPreviousMatch(this.searchText,t.getStartPosition(),!1,this.matchCase,this.wholeWord?this._editor.getOption(132):null,!1);return n?new v(n.range.startLineNumber,n.range.startColumn,n.range.endLineNumber,n.range.endColumn):null}selectAll(e){if(!this._editor.hasModel())return[];this.findController.highlightFindOptions();let t=this._editor.getModel();return e?t.findMatches(this.searchText,e,!1,this.matchCase,this.wholeWord?this._editor.getOption(132):null,!1,1073741824):t.findMatches(this.searchText,!0,!1,this.matchCase,this.wholeWord?this._editor.getOption(132):null,!1,1073741824)}},sO=class e extends _{static#e=this.ID=`editor.contrib.multiCursorController`;static get(t){return t.getContribution(e.ID)}constructor(e){super(),this._sessionDispose=this._register(new n),this._editor=e,this._ignoreSelectionChange=!1,this._session=null}dispose(){this._endSession(),super.dispose()}_beginSessionIfNeeded(e){if(!this._session){let t=oO.create(this._editor,e);if(!t)return;this._session=t;let n={searchString:this._session.searchText};this._session.isDisconnectedFromFindController&&(n.wholeWordOverride=1,n.matchCaseOverride=1,n.isRegexOverride=2),e.getState().change(n,!1),this._sessionDispose.add(this._editor.onDidChangeCursorSelection(e=>{this._ignoreSelectionChange||this._endSession()})),this._sessionDispose.add(this._editor.onDidBlurEditorText(()=>{this._endSession()})),this._sessionDispose.add(e.getState().onFindReplaceStateChange(e=>{(e.matchCase||e.wholeWord)&&this._endSession()}))}}_endSession(){this._sessionDispose.clear(),this._session&&this._session.isDisconnectedFromFindController&&this._session.findController.getState().change({wholeWordOverride:0,matchCaseOverride:0,isRegexOverride:0},!1),this._session=null}_setSelections(e){this._ignoreSelectionChange=!0,this._editor.setSelections(e),this._ignoreSelectionChange=!1}_expandEmptyToWord(e,t){if(!t.isEmpty())return t;let n=this._editor.getConfiguredWordAtPosition(t.getStartPosition());return n?new v(t.startLineNumber,n.startColumn,t.startLineNumber,n.endColumn):t}_applySessionResult(e){e&&(this._setSelections(e.selections),e.revealRange&&this._editor.revealRangeInCenterIfOutsideViewport(e.revealRange,e.revealScrollType))}getSession(e){return this._session}addSelectionToNextFindMatch(e){if(this._editor.hasModel()){if(!this._session){let t=this._editor.getSelections();if(t.length>1){let n=e.getState().matchCase;if(!_O(this._editor.getModel(),t,n)){let e=this._editor.getModel(),n=[];for(let r=0,i=t.length;r<i;r++)n[r]=this._expandEmptyToWord(e,t[r]);this._editor.setSelections(n);return}}}this._beginSessionIfNeeded(e),this._session&&this._applySessionResult(this._session.addSelectionToNextFindMatch())}}addSelectionToPreviousFindMatch(e){this._beginSessionIfNeeded(e),this._session&&this._applySessionResult(this._session.addSelectionToPreviousFindMatch())}moveSelectionToNextFindMatch(e){this._beginSessionIfNeeded(e),this._session&&this._applySessionResult(this._session.moveSelectionToNextFindMatch())}moveSelectionToPreviousFindMatch(e){this._beginSessionIfNeeded(e),this._session&&this._applySessionResult(this._session.moveSelectionToPreviousFindMatch())}selectAll(e){if(!this._editor.hasModel())return;let t=null,n=e.getState();if(n.isRevealed&&n.searchString.length>0&&n.isRegex){let e=this._editor.getModel();t=n.searchScope?e.findMatches(n.searchString,n.searchScope,n.isRegex,n.matchCase,n.wholeWord?this._editor.getOption(132):null,!1,1073741824):e.findMatches(n.searchString,!0,n.isRegex,n.matchCase,n.wholeWord?this._editor.getOption(132):null,!1,1073741824)}else{if(this._beginSessionIfNeeded(e),!this._session)return;t=this._session.selectAll(n.searchScope)}if(t.length>0){let e=this._editor.getSelection();for(let n=0,r=t.length;n<r;n++){let r=t[n];if(r.range.intersectRanges(e)){t[n]=t[0],t[0]=r;break}}this._setSelections(t.map(e=>new v(e.range.startLineNumber,e.range.startColumn,e.range.endLineNumber,e.range.endColumn)))}}},cO=class extends N{run(e,t){let n=sO.get(t);if(!n)return;let r=t._getViewModel();if(r){let i=r.getCursorStates(),a=Ly.get(t);if(a)this._run(n,a);else{let r=e.get(Y).createInstance(Ly,t);this._run(n,r),r.dispose()}$D(i,r.getCursorStates())}}},lO=class extends cO{constructor(){super({id:`editor.action.addSelectionToNextFindMatch`,label:S(`addSelectionToNextFindMatch`,`Add Selection To Next Find Match`),alias:`Add Selection To Next Find Match`,precondition:void 0,kbOpts:{kbExpr:q.focus,primary:2082,weight:100},menuOpts:{menuId:R.MenubarSelectionMenu,group:`3_multi`,title:S({key:`miAddSelectionToNextFindMatch`,comment:[`&& denotes a mnemonic`]},`Add &&Next Occurrence`),order:5}})}_run(e,t){e.addSelectionToNextFindMatch(t)}},uO=class extends cO{constructor(){super({id:`editor.action.addSelectionToPreviousFindMatch`,label:S(`addSelectionToPreviousFindMatch`,`Add Selection To Previous Find Match`),alias:`Add Selection To Previous Find Match`,precondition:void 0,menuOpts:{menuId:R.MenubarSelectionMenu,group:`3_multi`,title:S({key:`miAddSelectionToPreviousFindMatch`,comment:[`&& denotes a mnemonic`]},`Add P&&revious Occurrence`),order:6}})}_run(e,t){e.addSelectionToPreviousFindMatch(t)}},dO=class extends cO{constructor(){super({id:`editor.action.moveSelectionToNextFindMatch`,label:S(`moveSelectionToNextFindMatch`,`Move Last Selection To Next Find Match`),alias:`Move Last Selection To Next Find Match`,precondition:void 0,kbOpts:{kbExpr:q.focus,primary:ne(2089,2082),weight:100}})}_run(e,t){e.moveSelectionToNextFindMatch(t)}},fO=class extends cO{constructor(){super({id:`editor.action.moveSelectionToPreviousFindMatch`,label:S(`moveSelectionToPreviousFindMatch`,`Move Last Selection To Previous Find Match`),alias:`Move Last Selection To Previous Find Match`,precondition:void 0})}_run(e,t){e.moveSelectionToPreviousFindMatch(t)}},pO=class extends cO{constructor(){super({id:`editor.action.selectHighlights`,label:S(`selectAllOccurrencesOfFindMatch`,`Select All Occurrences of Find Match`),alias:`Select All Occurrences of Find Match`,precondition:void 0,kbOpts:{kbExpr:q.focus,primary:3114,weight:100},menuOpts:{menuId:R.MenubarSelectionMenu,group:`3_multi`,title:S({key:`miSelectHighlights`,comment:[`&& denotes a mnemonic`]},`Select All &&Occurrences`),order:7}})}_run(e,t){e.selectAll(t)}},mO=class extends cO{constructor(){super({id:`editor.action.changeAll`,label:S(`changeAll.label`,`Change All Occurrences`),alias:`Change All Occurrences`,precondition:z.and(q.writable,q.editorTextFocus),kbOpts:{kbExpr:q.editorTextFocus,primary:2108,weight:100},contextMenuOpts:{group:`1_modification`,order:1.2}})}_run(e,t){e.selectAll(t)}},hO=class{constructor(e,t,n,r,i){this._model=e,this._searchText=t,this._matchCase=n,this._wordSeparators=r,this._modelVersionId=this._model.getVersionId(),this._cachedFindMatches=null,i&&this._model===i._model&&this._searchText===i._searchText&&this._matchCase===i._matchCase&&this._wordSeparators===i._wordSeparators&&this._modelVersionId===i._modelVersionId&&(this._cachedFindMatches=i._cachedFindMatches)}findMatches(){return this._cachedFindMatches===null&&(this._cachedFindMatches=this._model.findMatches(this._searchText,!0,!1,this._matchCase,this._wordSeparators,!1).map(e=>e.range),this._cachedFindMatches.sort(T.compareRangesUsingStarts)),this._cachedFindMatches}},gO=class extends _{static#e=QD=this;static#t=this.ID=`editor.contrib.selectionHighlighter`;constructor(e,t){super(),this._languageFeaturesService=t,this.editor=e,this._isEnabled=e.getOption(109),this._decorations=e.createDecorationsCollection(),this.updateSoon=this._register(new yt(()=>this._update(),300)),this.state=null,this._register(e.onDidChangeConfiguration(t=>{this._isEnabled=e.getOption(109)})),this._register(e.onDidChangeCursorSelection(e=>{this._isEnabled&&(e.selection.isEmpty()?e.reason===3?(this.state&&this._setState(null),this.updateSoon.schedule()):this._setState(null):this._update())})),this._register(e.onDidChangeModel(e=>{this._setState(null)})),this._register(e.onDidChangeModelContent(e=>{this._isEnabled&&this.updateSoon.schedule()}));let n=Ly.get(e);n&&this._register(n.getState().onFindReplaceStateChange(e=>{this._update()})),this.updateSoon.schedule()}_update(){this._setState(QD._createState(this.state,this._isEnabled,this.editor))}static _createState(e,t,n){if(!t||!n.hasModel())return null;let r=n.getSelection();if(r.startLineNumber!==r.endLineNumber)return null;let i=sO.get(n);if(!i)return null;let a=Ly.get(n);if(!a)return null;let o=i.getSession(a);if(!o){let e=n.getSelections();if(e.length>1){let t=a.getState().matchCase;if(!_O(n.getModel(),e,t))return null}o=oO.create(n,a)}if(!o||o.currentMatch||/^[ \t]+$/.test(o.searchText)||o.searchText.length>200)return null;let s=a.getState(),c=s.matchCase;if(s.isRevealed){let e=s.searchString;c||(e=e.toLowerCase());let t=o.searchText;if(c||(t=t.toLowerCase()),e===t&&o.matchCase===s.matchCase&&o.wholeWord===s.wholeWord&&!s.isRegex)return null}return new hO(n.getModel(),o.searchText,o.matchCase,o.wholeWord?n.getOption(132):null,e)}_setState(e){if(this.state=e,!this.state){this._decorations.clear();return}if(!this.editor.hasModel())return;let t=this.editor.getModel();if(t.isTooLargeForTokenization())return;let n=this.state.findMatches(),r=this.editor.getSelections();r.sort(T.compareRangesUsingStarts);let i=[];for(let e=0,t=0,a=n.length,o=r.length;e<a;){let a=n[e];if(t>=o)i.push(a),e++;else{let n=T.compareRangesUsingStarts(a,r[t]);n<0?((r[t].isEmpty()||!T.areIntersecting(a,r[t]))&&i.push(a),e++):(n>0||e++,t++)}}let a=this.editor.getOption(81)!==`off`,o=this._languageFeaturesService.documentHighlightProvider.has(t)&&a,s=i.map(e=>({range:e,options:YD(o)}));this._decorations.set(s)}dispose(){this._setState(null),super.dispose()}};gO=QD=XD([ZD(1,V)],gO);function _O(e,t,n){let r=vO(e,t[0],!n);for(let i=1,a=t.length;i<a;i++){let a=t[i];if(a.isEmpty()||r!==vO(e,a,!n))return!1}return!0}function vO(e,t,n){let r=e.getValueInRange(t);return n?r.toLowerCase():r}var yO=class extends N{constructor(){super({id:`editor.action.focusNextCursor`,label:S(`mutlicursor.focusNextCursor`,`Focus Next Cursor`),metadata:{description:S(`mutlicursor.focusNextCursor.description`,`Focuses the next cursor`),args:[]},alias:`Focus Next Cursor`,precondition:void 0})}run(e,t,n){if(!t.hasModel())return;let r=t._getViewModel();if(r.cursorConfig.readOnly)return;r.model.pushStackElement();let i=Array.from(r.getCursorStates()),a=i.shift();a&&(i.push(a),r.setCursorStates(n.source,3,i),r.revealPrimaryCursor(n.source,!0),$D(i,r.getCursorStates()))}},bO=class extends N{constructor(){super({id:`editor.action.focusPreviousCursor`,label:S(`mutlicursor.focusPreviousCursor`,`Focus Previous Cursor`),metadata:{description:S(`mutlicursor.focusPreviousCursor.description`,`Focuses the previous cursor`),args:[]},alias:`Focus Previous Cursor`,precondition:void 0})}run(e,t,n){if(!t.hasModel())return;let r=t._getViewModel();if(r.cursorConfig.readOnly)return;r.model.pushStackElement();let i=Array.from(r.getCursorStates()),a=i.pop();a&&(i.unshift(a),r.setCursorStates(n.source,3,i),r.revealPrimaryCursor(n.source,!0),$D(i,r.getCursorStates()))}};I(sO.ID,sO,4),I(gO.ID,gO,1),L(eO),L(tO),L(nO),L(lO),L(uO),L(dO),L(fO),L(pO),L(mO),L(rO),L(iO),L(yO),L(bO);var xO=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},SO=function(e,t){return function(n,r){t(n,r,e)}};const CO=`inline-edit`;var wO=class extends _{constructor(e,t,n){super(),this.editor=e,this.model=t,this.languageService=n,this.isDisposed=uc(this,!1),this.currentTextModel=$i(this,this.editor.onDidChangeModel,()=>this.editor.getModel()),this.uiState=K(this,e=>{if(this.isDisposed.read(e))return;let t=this.currentTextModel.read(e);if(t!==this.model.targetTextModel.read(e))return;let n=this.model.ghostText.read(e);if(!n)return;let r=this.model.range?.read(e);r&&r.startLineNumber===r.endLineNumber&&r.startColumn===r.endColumn&&(r=void 0);let i=(r?r.startLineNumber===r.endLineNumber:!0)&&n.parts.length===1&&n.parts[0].lines.length===1,a=n.parts.length===1&&n.parts[0].lines.every(e=>e.length===0),o=[],s=[];function c(e,t){if(s.length>0){let n=s[s.length-1];t&&n.decorations.push(new Ht(n.content.length+1,n.content.length+1+e[0].length,t,0)),n.content+=e[0],e=e.slice(1)}for(let n of e)s.push({content:n,decorations:t?[new Ht(1,n.length+1,t,0)]:[]})}let l=t.getLineContent(n.lineNumber),u,d=0;if(!a&&(i||!r)){for(let e of n.parts){let t=e.lines;r&&!i&&(c(t,CO),t=[]),u===void 0?(o.push({column:e.column,text:t[0],preview:e.preview}),t=t.slice(1)):c([l.substring(d,e.column-1)],void 0),t.length>0&&(c(t,CO),u===void 0&&e.column<=l.length&&(u=e.column)),d=e.column-1}u!==void 0&&c([l.substring(d)],void 0)}return{inlineTexts:o,additionalLines:s,hiddenRange:u===void 0?void 0:new Rx(u,l.length+1),lineNumber:i||!r?n.lineNumber:r.endLineNumber-1,additionalReservedLineCount:this.model.minReservedLineCount.read(e),targetTextModel:t,range:r,isSingleLine:i,isPureRemove:a}}),this.decorations=K(this,e=>{let t=this.uiState.read(e);if(!t)return[];let n=[];if(t.hiddenRange&&n.push({range:t.hiddenRange.toRange(t.lineNumber),options:{inlineClassName:`inline-edit-hidden`,description:`inline-edit-hidden`}}),t.range){let e=[];if(t.isSingleLine)e.push(t.range);else if(!t.isPureRemove){let n=t.range.endLineNumber-t.range.startLineNumber;for(let r=0;r<n;r++){let n=t.range.startLineNumber+r,i=new T(n,t.targetTextModel.getLineFirstNonWhitespaceColumn(n),n,t.targetTextModel.getLineLastNonWhitespaceColumn(n));e.push(i)}}for(let t of e)n.push({range:t,options:Ml})}if(t.range&&!t.isSingleLine&&t.isPureRemove){let e=new T(t.range.startLineNumber,1,t.range.endLineNumber-1,1);n.push({range:e,options:zi})}for(let e of t.inlineTexts)n.push({range:T.fromPositions(new r(t.lineNumber,e.column)),options:{description:CO,after:{content:e.text,inlineClassName:e.preview?`inline-edit-decoration-preview`:`inline-edit-decoration`,cursorStops:Uo.Left},showIfCollapsed:!0}});return n}),this._register(b(()=>{this.isDisposed.set(!0,void 0)})),this._register(zx(this.editor,this.decorations))}};wO=xO([SO(2,Ys)],wO);var TO=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},EO=function(e,t){return function(n,r){t(n,r,e)}},DO,OO=class extends _{constructor(e,t,n){super(),this.editor=e,this.model=t,this.instantiationService=n,this.alwaysShowToolbar=$i(this,this.editor.onDidChangeConfiguration,()=>this.editor.getOption(63).showToolbar===`always`),this.sessionPosition=void 0,this.position=K(this,e=>{let t=this.model.read(e)?.model.ghostText.read(e);if(!this.alwaysShowToolbar.read(e)||!t||t.parts.length===0)return this.sessionPosition=void 0,null;let n=t.parts[0].column;this.sessionPosition&&this.sessionPosition.lineNumber!==t.lineNumber&&(this.sessionPosition=void 0);let i=new r(t.lineNumber,Math.min(n,this.sessionPosition?.column??2**53-1));return this.sessionPosition=i,i}),this._register(Ss((t,n)=>{if(!this.model.read(t)||!this.alwaysShowToolbar.read(t))return;let r=n.add(this.instantiationService.createInstance(kO,this.editor,!0,this.position));e.addContentWidget(r),n.add(b(()=>e.removeContentWidget(r)))}))}};OO=TO([EO(2,Y)],OO);var kO=class extends _{static#e=DO=this;static#t=this._dropDownVisible=!1;static#n=this.id=0;constructor(e,t,n,r,i,a){super(),this.editor=e,this.withBorder=t,this._position=n,this._contextKeyService=i,this._menuService=a,this.id=`InlineEditHintsContentWidget${DO.id++}`,this.allowEditorOverflow=!0,this.suppressMouseDown=!1,this.nodes=ut(`div.inlineEditHints`,{className:this.withBorder?`.withBorder`:``},[ut(`div@toolBar`)]),this.inlineCompletionsActionsMenus=this._register(this._menuService.createMenu(R.InlineEditActions,this._contextKeyService)),this.toolBar=this._register(r.createInstance(jO,this.nodes.toolBar,this.editor,R.InlineEditToolbar,{menuOptions:{renderShortTitle:!0},toolbarOptions:{primaryGroup:e=>e.startsWith(`primary`)},actionViewItemProvider:(e,t)=>{if(e instanceof Ra)return r.createInstance(AO,e,void 0)},telemetrySource:`InlineEditToolbar`})),this._register(this.toolBar.onDidChangeDropdownVisibility(e=>{DO._dropDownVisible=e})),this._register(Ba(e=>{this._position.read(e),this.editor.layoutContentWidget(this)})),this._register(Ba(e=>{let t=[];for(let[e,n]of this.inlineCompletionsActionsMenus.getActions())for(let e of n)e instanceof Ra&&t.push(e);t.length>0&&t.unshift(new Ds),this.toolBar.setAdditionalSecondaryActions(t)}))}getId(){return this.id}getDomNode(){return this.nodes.root}getPosition(){return{position:this._position.get(),preference:[1,2],positionAffinity:3}}};kO=DO=TO([EO(3,Y),EO(4,W),EO(5,Eo)],kO);var AO=class extends ao{updateLabel(){let e=this._keybindingService.lookupKeybinding(this._action.id,this._contextKeyService);if(!e)return super.updateLabel();if(this.label){let n=ut(`div.keybinding`).root;this._register(new va(n,t,{disableTitle:!0,...wa})).set(e),this.label.textContent=this._action.label,this.label.appendChild(n),this.label.classList.add(`inlineEditStatusBarItemLabel`)}}updateTooltip(){}},jO=class extends ya{constructor(e,t,n,r,i,a,o,s,c,l){super(e,{resetMenu:n,...r},i,a,o,s,c,l),this.editor=t,this.menuId=n,this.options2=r,this.menuService=i,this.contextKeyService=a,this.menu=this._store.add(this.menuService.createMenu(this.menuId,this.contextKeyService,{emitEventsForSubmenuChanges:!0})),this.additionalActions=[],this.prependedPrimaryActions=[],this._store.add(this.menu.onDidChange(()=>this.updateToolbar())),this._store.add(this.editor.onDidChangeCursorPosition(()=>this.updateToolbar())),this.updateToolbar()}updateToolbar(){let e=[],t=[];Oa(this.menu,this.options2?.menuOptions,{primary:e,secondary:t},this.options2?.toolbarOptions?.primaryGroup,this.options2?.toolbarOptions?.shouldInlineSubmenu,this.options2?.toolbarOptions?.useSeparatorsInPrimaryActions),t.push(...this.additionalActions),e.unshift(...this.prependedPrimaryActions),this.setActions(e,t)}setAdditionalSecondaryActions(e){Ut(this.additionalActions,e,(e,t)=>e===t)||(this.additionalActions=e,this.updateToolbar())}};jO=TO([EO(4,Eo),EO(5,W),EO(6,Ga),EO(7,ua),EO(8,lc),EO(9,Zi)],jO);var MO=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},NO=function(e,t){return function(n,r){t(n,r,e)}},PO,FO;function*IO(e,t,n=1){t===void 0&&([t,e]=[e,0]);for(let r=e;r<t;r+=n)yield r}function LO(e){let t=e[0].match(/^\s*/)?.[0]??``,n=t.length;return{text:e.map(e=>e.replace(RegExp(`^`+t),``)),shift:n}}var RO=class extends _{static#e=PO=this;static#t=this._modelId=0;static _createUniqueUri(){return y.from({scheme:`inline-edit-widget`,path:new Date().toString()+String(PO._modelId++)})}constructor(e,t,n,i,a){super(),this._editor=e,this._model=t,this._instantiationService=n,this._diffProviderFactoryService=i,this._modelService=a,this._position=K(this,e=>{let t=this._model.read(e);if(!t||t.text.length===0||t.range.startLineNumber===t.range.endLineNumber&&!(t.range.startColumn===t.range.endColumn&&t.range.startColumn===1))return null;let n=this._editor.getModel();if(!n)return null;let i=Array.from(IO(t.range.startLineNumber,t.range.endLineNumber+1)),a=i.map(e=>n.getLineLastNonWhitespaceColumn(e)),o=Math.max(...a),s=i[a.indexOf(o)],c=new r(s,o);return{top:t.range.startLineNumber,left:c}}),this._text=K(this,e=>{let t=this._model.read(e);if(!t)return{text:``,shift:0};let n=LO(t.text.split(`
`));return{text:n.text.join(`
`),shift:n.shift}}),this._originalModel=Sc(()=>this._modelService.createModel(``,null,PO._createUniqueUri())).keepObserved(this._store),this._modifiedModel=Sc(()=>this._modelService.createModel(``,null,PO._createUniqueUri())).keepObserved(this._store),this._diff=K(this,e=>this._diffPromise.read(e)?.promiseResult.read(e)?.data),this._diffPromise=K(this,e=>{let t=this._model.read(e);if(!t)return;let n=this._editor.getModel();if(!n)return;let r=LO(n.getValueInRange(t.range).split(`
`)).text.join(`
`),i=LO(t.text.split(`
`)).text.join(`
`);this._originalModel.get().setValue(r),this._modifiedModel.get().setValue(i);let a=this._diffProviderFactoryService.createDiffProvider({diffAlgorithm:`advanced`});return uo.fromFn(async()=>{let e=await a.computeDiff(this._originalModel.get(),this._modifiedModel.get(),{computeMoves:!1,ignoreTrimWhitespace:!1,maxComputationTimeMs:1e3},w.None);if(!e.identical)return e.changes})}),this._register(Ss((t,n)=>{if(!this._model.read(t)||this._position.get()===null)return;let r=n.add(this._instantiationService.createInstance(zO,this._editor,this._position,this._text.map(e=>e.text),this._text.map(e=>e.shift),this._diff));e.addOverlayWidget(r),n.add(b(()=>e.removeOverlayWidget(r)))}))}};RO=PO=MO([NO(2,Y),NO(3,Wi),NO(4,Ps)],RO);var zO=class extends _{static#e=FO=this;static#t=this.id=0;constructor(e,t,n,r,i,a){super(),this._editor=e,this._position=t,this._text=n,this._shift=r,this._diff=i,this._instantiationService=a,this.id=`InlineEditSideBySideContentWidget${FO.id++}`,this.allowEditorOverflow=!1,this._nodes=O(`div.inlineEditSideBySide`,void 0),this._scrollChanged=Oo(`editor.onDidScrollChange`,this._editor.onDidScrollChange),this._previewEditor=this._register(this._instantiationService.createInstance(Ph,this._nodes,{glyphMargin:!1,lineNumbers:`off`,minimap:{enabled:!1},guides:{indentation:!1,bracketPairs:!1,bracketPairsHorizontal:!1,highlightActiveIndentation:!1},folding:!1,selectOnLineNumbers:!1,selectionHighlight:!1,columnSelection:!1,overviewRulerBorder:!1,overviewRulerLanes:0,lineDecorationsWidth:0,lineNumbersMinChars:0,scrollbar:{vertical:`hidden`,horizontal:`hidden`,alwaysConsumeMouseWheel:!1,handleMouseWheel:!1},readOnly:!0,wordWrap:`off`,wordWrapOverride1:`off`,wordWrapOverride2:`off`,wrappingIndent:`none`,wrappingStrategy:void 0},{contributions:[],isSimpleWidget:!0},this._editor)),this._previewEditorObs=Qr(this._previewEditor),this._editorObs=Qr(this._editor),this._previewTextModel=this._register(this._instantiationService.createInstance(Jc,``,this._editor.getModel()?.getLanguageId()??`plaintext`,Jc.DEFAULT_CREATION_OPTIONS,null)),this._setText=K(e=>{let t=this._text.read(e);t&&this._previewTextModel.setValue(t)}).recomputeInitiallyAndOnChange(this._store),this._decorations=K(this,e=>{this._setText.read(e);let t=this._position.read(e);if(!t)return{org:[],mod:[]};let n=this._diff.read(e);if(!n)return{org:[],mod:[]};let r=[],i=[];if(n.length===1&&n[0].innerChanges[0].modifiedRange.equalsRange(this._previewTextModel.getFullModelRange()))return{org:[],mod:[]};let a=this._shift.get(),o=e=>new T(e.startLineNumber+t.top-1,e.startColumn+a,e.endLineNumber+t.top-1,e.endColumn+a);for(let e of n)if(e.original.isEmpty||r.push({range:o(e.original.toInclusiveRange()),options:zi}),e.modified.isEmpty||i.push({range:e.modified.toInclusiveRange(),options:mo}),e.modified.isEmpty||e.original.isEmpty)e.original.isEmpty||r.push({range:o(e.original.toInclusiveRange()),options:yo}),e.modified.isEmpty||i.push({range:e.modified.toInclusiveRange(),options:co});else for(let t of e.innerChanges||[])e.original.contains(t.originalRange.startLineNumber)&&r.push({range:o(t.originalRange),options:t.originalRange.isEmpty()?ii:Ml}),e.modified.contains(t.modifiedRange.startLineNumber)&&i.push({range:t.modifiedRange,options:t.modifiedRange.isEmpty()?Ua:ca});return{org:r,mod:i}}),this._originalDecorations=K(this,e=>this._decorations.read(e).org),this._modifiedDecorations=K(this,e=>this._decorations.read(e).mod),this._previewEditor.setModel(this._previewTextModel),this._register(this._editorObs.setDecorations(this._originalDecorations)),this._register(this._previewEditorObs.setDecorations(this._modifiedDecorations)),this._register(Ba(e=>{let t=this._previewEditorObs.contentWidth.read(e),n=this._text.read(e).split(`
`).length-1,r=this._editor.getOption(67)*n;t<=0||this._previewEditor.layout({height:r,width:t})})),this._register(Ba(e=>{this._position.read(e),this._editor.layoutOverlayWidget(this)})),this._register(Ba(e=>{this._scrollChanged.read(e),this._position.read(e)&&this._editor.layoutOverlayWidget(this)}))}getId(){return this.id}getDomNode(){return this._nodes}getPosition(){let e=this._position.get();if(!e)return null;let t=this._editor.getLayoutInfo(),n=this._editor.getScrolledVisiblePosition(new r(e.top,1));if(!n)return null;let i=n.top-1,a=this._editor.getOffsetForColumn(e.left.lineNumber,e.left.column);return{preference:{left:t.contentLeft+a+10,top:i}}}};zO=FO=MO([NO(5,Y)],zO);var BO=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},VO=function(e,t){return function(n,r){t(n,r,e)}},HO,UO=class extends _{static#e=HO=this;static#t=this.ID=`editor.contrib.inlineEditController`;static#n=this.inlineEditVisibleKey=`inlineEditVisible`;static#r=this.inlineEditVisibleContext=new G(this.inlineEditVisibleKey,!1);static#i=this.cursorAtInlineEditKey=`cursorAtInlineEdit`;static#a=this.cursorAtInlineEditContext=new G(this.cursorAtInlineEditKey,!1);static get(e){return e.getContribution(HO.ID)}constructor(e,t,n,r,i,a,o,s){super(),this.editor=e,this.instantiationService=t,this.contextKeyService=n,this.languageFeaturesService=r,this._commandService=i,this._configurationService=a,this._diffProviderFactoryService=o,this._modelService=s,this._isVisibleContext=HO.inlineEditVisibleContext.bindTo(this.contextKeyService),this._isCursorAtInlineEditContext=HO.cursorAtInlineEditContext.bindTo(this.contextKeyService),this._currentEdit=uc(this,void 0),this._currentWidget=Sc(this._currentEdit,e=>{let t=this._currentEdit.read(e);if(!t)return;let n=t.range.endLineNumber,r=t.range.endColumn,i=new jx(n,[new Mx(r,t.text.endsWith(`
`)&&!(t.range.startLineNumber===t.range.endLineNumber&&t.range.startColumn===t.range.endColumn)?t.text.slice(0,-1):t.text,!1)]),a=t.range.startLineNumber===t.range.endLineNumber&&i.parts.length===1&&i.parts[0].lines.length===1,o=t.text===``;if(!(!a&&!o))return this.instantiationService.createInstance(wO,this.editor,{ghostText:Ii(i),minReservedLineCount:Ii(0),targetTextModel:Ii(this.editor.getModel()??void 0),range:Ii(t.range)})}),this._isAccepting=uc(this,!1),this._enabled=$i(this,this.editor.onDidChangeConfiguration,()=>this.editor.getOption(63).enabled),this._fontFamily=$i(this,this.editor.onDidChangeConfiguration,()=>this.editor.getOption(63).fontFamily);let c=Oo(`InlineEditController.modelContentChangedSignal`,e.onDidChangeModelContent);this._register(Ba(t=>{this._enabled.read(t)&&(c.read(t),!this._isAccepting.read(t)&&this.getInlineEdit(e,!0))}));let l=$i(this,e.onDidChangeCursorPosition,()=>e.getPosition());this._register(Ba(e=>{if(!this._enabled.read(e))return;let t=l.read(e);t&&this.checkCursorPosition(t)})),this._register(Ba(t=>{let n=this._currentEdit.read(t);if(this._isCursorAtInlineEditContext.set(!1),!n){this._isVisibleContext.set(!1);return}this._isVisibleContext.set(!0);let r=e.getPosition();r&&this.checkCursorPosition(r)}));let u=Oo(`InlineEditController.editorBlurSignal`,e.onDidBlurEditorWidget);this._register(Ba(async t=>{this._enabled.read(t)&&(u.read(t),!(this._configurationService.getValue(`editor.experimentalInlineEdit.keepOnBlur`)||e.getOption(63).keepOnBlur)&&(this._currentRequestCts?.dispose(!0),this._currentRequestCts=void 0,await this.clear(!1)))}));let d=Oo(`InlineEditController.editorFocusSignal`,e.onDidFocusEditorText);this._register(Ba(t=>{this._enabled.read(t)&&(d.read(t),this.getInlineEdit(e,!0))}));let f=this._register(Lt());this._register(Ba(e=>{let t=this._fontFamily.read(e);f.setStyle(t===``||t===`default`?``:`
.monaco-editor .inline-edit-decoration,
.monaco-editor .inline-edit-decoration-preview,
.monaco-editor .inline-edit {
	font-family: ${t};
}`)})),this._register(new OO(this.editor,this._currentWidget,this.instantiationService)),this._register(new RO(this.editor,this._currentEdit,this.instantiationService,this._diffProviderFactoryService,this._modelService))}checkCursorPosition(e){if(!this._currentEdit){this._isCursorAtInlineEditContext.set(!1);return}let t=this._currentEdit.get();if(!t){this._isCursorAtInlineEditContext.set(!1);return}this._isCursorAtInlineEditContext.set(T.containsPosition(t.range,e))}validateInlineEdit(e,t){if(t.text.includes(`
`)&&t.range.startLineNumber!==t.range.endLineNumber&&t.range.startColumn!==t.range.endColumn){if(t.range.startColumn!==1)return!1;let n=t.range.endLineNumber;if(t.range.endColumn!==(e.getModel()?.getLineLength(n)??0)+1)return!1}return!0}async fetchInlineEdit(e,t){this._currentRequestCts&&this._currentRequestCts.dispose(!0);let n=e.getModel();if(!n)return;let r=n.getVersionId(),i=this.languageFeaturesService.inlineEditProvider.all(n);if(i.length===0)return;let a=i[0];this._currentRequestCts=new ie;let o=this._currentRequestCts.token,s=t?Ve.Automatic:Ve.Invoke;if(t&&await WO(50,o),o.isCancellationRequested||n.isDisposed()||n.getVersionId()!==r)return;let c=await a.provideInlineEdit(n,{triggerKind:s},o);if(c&&!(o.isCancellationRequested||n.isDisposed()||n.getVersionId()!==r)&&this.validateInlineEdit(e,c))return c}async getInlineEdit(e,t){this._isCursorAtInlineEditContext.set(!1),await this.clear();let n=await this.fetchInlineEdit(e,t);n&&this._currentEdit.set(n,void 0)}async trigger(){await this.getInlineEdit(this.editor,!1)}async jumpBack(){this._jumpBackPosition&&(this.editor.setPosition(this._jumpBackPosition),this.editor.revealPositionInCenterIfOutsideViewport(this._jumpBackPosition))}async accept(){this._isAccepting.set(!0,void 0);let e=this._currentEdit.get();if(!e)return;let t=e.text;e.text.startsWith(`
`)&&(t=e.text.substring(1)),this.editor.pushUndoStop(),this.editor.executeEdits(`acceptCurrent`,[Fa.replace(T.lift(e.range),t)]),e.accepted&&await this._commandService.executeCommand(e.accepted.id,...e.accepted.arguments||[]).then(void 0,Re),this.freeEdit(e),gs(e=>{this._currentEdit.set(void 0,e),this._isAccepting.set(!1,e)})}jumpToCurrent(){this._jumpBackPosition=this.editor.getSelection()?.getStartPosition();let e=this._currentEdit.get();if(!e)return;let t=r.lift({lineNumber:e.range.startLineNumber,column:e.range.startColumn});this.editor.setPosition(t),this.editor.revealPositionInCenterIfOutsideViewport(t)}async clear(e=!0){let t=this._currentEdit.get();t&&t?.rejected&&e&&await this._commandService.executeCommand(t.rejected.id,...t.rejected.arguments||[]).then(void 0,Re),t&&this.freeEdit(t),this._currentEdit.set(void 0,void 0)}freeEdit(e){let t=this.editor.getModel();if(!t)return;let n=this.languageFeaturesService.inlineEditProvider.all(t);n.length!==0&&n[0].freeInlineEdit(e)}};UO=HO=BO([VO(1,Y),VO(2,W),VO(3,V),VO(4,lc),VO(5,F),VO(6,Wi),VO(7,Ps)],UO);function WO(e,t){return new Promise(n=>{let r,i=setTimeout(()=>{r&&r.dispose(),n()},e);t&&(r=t.onCancellationRequested(()=>{clearTimeout(i),r&&r.dispose(),n()}))})}var GO=class extends N{constructor(){super({id:`editor.action.inlineEdit.accept`,label:`Accept Inline Edit`,alias:`Accept Inline Edit`,precondition:z.and(q.writable,UO.inlineEditVisibleContext),kbOpts:[{weight:101,primary:2,kbExpr:z.and(q.writable,UO.inlineEditVisibleContext,UO.cursorAtInlineEditContext)}],menuOpts:[{menuId:R.InlineEditToolbar,title:`Accept`,group:`primary`,order:1}]})}async run(e,t){await UO.get(t)?.accept()}},KO=class extends N{constructor(){let e=z.and(q.writable,z.not(UO.inlineEditVisibleKey));super({id:`editor.action.inlineEdit.trigger`,label:`Trigger Inline Edit`,alias:`Trigger Inline Edit`,precondition:e,kbOpts:{weight:101,primary:2646,kbExpr:e}})}async run(e,t){UO.get(t)?.trigger()}},qO=class extends N{constructor(){let e=z.and(q.writable,UO.inlineEditVisibleContext,z.not(UO.cursorAtInlineEditKey));super({id:`editor.action.inlineEdit.jumpTo`,label:`Jump to Inline Edit`,alias:`Jump to Inline Edit`,precondition:e,kbOpts:{weight:101,primary:2646,kbExpr:e},menuOpts:[{menuId:R.InlineEditToolbar,title:`Jump To Edit`,group:`primary`,order:3,when:e}]})}async run(e,t){UO.get(t)?.jumpToCurrent()}},JO=class extends N{constructor(){let e=z.and(q.writable,UO.cursorAtInlineEditContext);super({id:`editor.action.inlineEdit.jumpBack`,label:`Jump Back from Inline Edit`,alias:`Jump Back from Inline Edit`,precondition:e,kbOpts:{weight:110,primary:2646,kbExpr:e},menuOpts:[{menuId:R.InlineEditToolbar,title:`Jump Back`,group:`primary`,order:3,when:e}]})}async run(e,t){UO.get(t)?.jumpBack()}},YO=class extends N{constructor(){let e=z.and(q.writable,UO.inlineEditVisibleContext);super({id:`editor.action.inlineEdit.reject`,label:`Reject Inline Edit`,alias:`Reject Inline Edit`,precondition:e,kbOpts:{weight:100,primary:9,kbExpr:e},menuOpts:[{menuId:R.InlineEditToolbar,title:`Reject`,group:`secondary`,order:2}]})}async run(e,t){await UO.get(t)?.clear()}};L(GO),L(YO),L(qO),L(JO),L(KO),I(UO.ID,UO,3);const XO=new G(`inlineEditsVisible`,!1,S(`inlineEditsVisible`,`Whether an inline edit is visible`)),ZO=new G(`inlineEditsIsPinned`,!1,S(`isPinned`,`Whether an inline edit is visible`));var QO=class extends _{static#e=this.ID=`editor.contrib.placeholderText`;constructor(e){super(),this._editor=e,this._editorObs=Qr(this._editor),this._placeholderText=this._editorObs.getOption(88),this._state=Ks({owner:this,equalsFn:Vs},e=>{let t=this._placeholderText.read(e);if(t&&this._editorObs.valueIsEmpty.read(e))return{placeholder:t}}),this._shouldViewBeAlive=$O(this,e=>this._state.read(e)?.placeholder!==void 0),this._view=Ec((e,t)=>{if(!this._shouldViewBeAlive.read(e))return;let n=ut(`div.editorPlaceholder`);t.add(Ba(e=>{let t=this._state.read(e),r=t?.placeholder!==void 0;n.root.style.display=r?`block`:`none`,n.root.innerText=t?.placeholder??``})),t.add(Ba(e=>{let t=this._editorObs.layoutInfo.read(e);n.root.style.left=`${t.contentLeft}px`,n.root.style.width=t.contentWidth-t.verticalScrollbarWidth+`px`,n.root.style.top=`${this._editor.getTopForLineNumber(0)}px`})),t.add(Ba(e=>{n.root.style.fontFamily=this._editorObs.getOption(49).read(e),n.root.style.fontSize=this._editorObs.getOption(52).read(e)+`px`,n.root.style.lineHeight=this._editorObs.getOption(67).read(e)+`px`})),t.add(this._editorObs.createOverlayWidget({allowEditorOverflow:!1,minContentWidthInPx:Ii(0),position:Ii(null),domNode:n.root}))}),this._view.recomputeInitiallyAndOnChange(this._store)}};function $O(e,t){return aa(e,(e,n)=>n===!0?!0:t(e))}var ek=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},tk=function(e,t){return function(n,r){t(n,r,e)}},nk=class{constructor(e,t,n){this.range=e,this.newLines=t,this.changes=n}},rk=class extends _{constructor(e,t,n,r){super(),this._editor=e,this._edit=t,this._userPrompt=n,this._instantiationService=r,this._editorObs=Qr(this._editor),this._elements=ut(`div.inline-edits-widget`,{style:{position:`absolute`,overflow:`visible`,top:`0px`,left:`0px`}},[ut(`div@editorContainer`,{style:{position:`absolute`,top:`0px`,left:`0px`,width:`500px`,height:`500px`}},[ut(`div.toolbar@toolbar`,{style:{position:`absolute`,top:`-25px`,left:`0px`}}),ut(`div.promptEditor@promptEditor`,{style:{position:`absolute`,top:`-25px`,left:`80px`,width:`300px`,height:`22px`}}),ut(`div.preview@editor`,{style:{position:`absolute`,top:`0px`,left:`0px`}})]),Br(`svg`,{style:{overflow:`visible`,pointerEvents:`none`}},[Br(`defs`,[Br(`linearGradient`,{id:`Gradient2`,x1:`0`,y1:`0`,x2:`1`,y2:`0`},[Br(`stop`,{offset:`0%`,class:`gradient-stop`}),Br(`stop`,{offset:`100%`,class:`gradient-stop`})])]),Br(`path@path`,{d:``,fill:`url(#Gradient2)`})])]),this._previewTextModel=this._register(this._instantiationService.createInstance(Jc,``,_i,Jc.DEFAULT_CREATION_OPTIONS,null)),this._setText=K(e=>{let t=this._edit.read(e);t&&this._previewTextModel.setValue(t.newLines.join(`
`))}).recomputeInitiallyAndOnChange(this._store),this._promptTextModel=this._register(this._instantiationService.createInstance(Jc,``,_i,Jc.DEFAULT_CREATION_OPTIONS,null)),this._promptEditor=this._register(this._instantiationService.createInstance(Ph,this._elements.promptEditor,{glyphMargin:!1,lineNumbers:`off`,minimap:{enabled:!1},guides:{indentation:!1,bracketPairs:!1,bracketPairsHorizontal:!1,highlightActiveIndentation:!1},folding:!1,selectOnLineNumbers:!1,selectionHighlight:!1,columnSelection:!1,overviewRulerBorder:!1,overviewRulerLanes:0,lineDecorationsWidth:0,lineNumbersMinChars:0,placeholder:`Describe the change you want...`,fontFamily:Kr},{contributions:Wa.getSomeEditorContributions([vw.ID,QO.ID,K_.ID]),isSimpleWidget:!0},this._editor)),this._previewEditor=this._register(this._instantiationService.createInstance(Ph,this._elements.editor,{glyphMargin:!1,lineNumbers:`off`,minimap:{enabled:!1},guides:{indentation:!1,bracketPairs:!1,bracketPairsHorizontal:!1,highlightActiveIndentation:!1},folding:!1,selectOnLineNumbers:!1,selectionHighlight:!1,columnSelection:!1,overviewRulerBorder:!1,overviewRulerLanes:0,lineDecorationsWidth:0,lineNumbersMinChars:0},{contributions:[]},this._editor)),this._previewEditorObs=Qr(this._previewEditor),this._decorations=K(this,e=>{this._setText.read(e);let t=this._edit.read(e)?.changes;if(!t)return[];let n=[],r=[];if(t.length===1&&t[0].innerChanges[0].modifiedRange.equalsRange(this._previewTextModel.getFullModelRange()))return[];for(let e of t)if(e.original.isEmpty||n.push({range:e.original.toInclusiveRange(),options:zi}),e.modified.isEmpty||r.push({range:e.modified.toInclusiveRange(),options:mo}),e.modified.isEmpty||e.original.isEmpty)e.original.isEmpty||n.push({range:e.original.toInclusiveRange(),options:yo}),e.modified.isEmpty||r.push({range:e.modified.toInclusiveRange(),options:co});else for(let t of e.innerChanges||[])e.original.contains(t.originalRange.startLineNumber)&&n.push({range:t.originalRange,options:t.originalRange.isEmpty()?ii:Ml}),e.modified.contains(t.modifiedRange.startLineNumber)&&r.push({range:t.modifiedRange,options:t.modifiedRange.isEmpty()?Ua:ca});return r}),this._layout1=K(this,e=>{let t=this._editor.getModel(),n=this._edit.read(e);if(!n)return null;let r=n.range,i=0;for(let e=r.startLineNumber;e<r.endLineNumberExclusive;e++){let n=t.getLineMaxColumn(e),r=this._editor.getOffsetForColumn(e,n);i=Math.max(i,r)}return{left:this._editor.getLayoutInfo().contentLeft+i}}),this._layout=K(this,e=>{let t=this._edit.read(e);if(!t)return null;let n=t.range,r=this._editorObs.scrollLeft.read(e),i=this._layout1.read(e).left+20-r,a=this._editor.getTopForLineNumber(n.startLineNumber)-this._editorObs.scrollTop.read(e),o=this._editor.getTopForLineNumber(n.endLineNumberExclusive)-this._editorObs.scrollTop.read(e),s=new ak(i,a),c=new ak(i,o),l=o-a,u=this._editor.getOption(67)*t.newLines.length,d=l-u;return{topCode:s,bottomCode:c,codeHeight:l,topEdit:new ak(i+50,a+d/2),bottomEdit:new ak(i+50,o-d/2),editHeight:u}});let i=K(this,e=>this._edit.read(e)!==void 0||this._userPrompt.read(e)!==void 0);this._register(Pc(this._elements.root,{display:K(this,e=>i.read(e)?`block`:`none`)})),this._register(na(this._editor.getDomNode(),this._elements.root)),this._register(Qr(e).createOverlayWidget({domNode:this._elements.root,position:Ii(null),allowEditorOverflow:!1,minContentWidthInPx:K(e=>{let t=this._layout1.read(e)?.left;return t===void 0?0:t+this._previewEditorObs.contentWidth.read(e)})})),this._previewEditor.setModel(this._previewTextModel),this._register(this._previewEditorObs.setDecorations(this._decorations)),this._register(Ba(e=>{let t=this._layout.read(e);if(!t)return;let{topCode:n,bottomCode:r,topEdit:i,bottomEdit:a,editHeight:o}=t,s=new ok().moveTo(n).lineTo(n.deltaX(10)).curveTo(n.deltaX(50),i.deltaX(-40),i.deltaX(-0)).lineTo(i).lineTo(a).lineTo(a.deltaX(-0)).curveTo(a.deltaX(-40),r.deltaX(50),r.deltaX(10)).lineTo(r).build();this._elements.path.setAttribute(`d`,s),this._elements.editorContainer.style.top=`${i.y}px`,this._elements.editorContainer.style.left=`${i.x}px`,this._elements.editorContainer.style.height=`${o}px`;let c=this._previewEditorObs.contentWidth.read(e);this._previewEditor.layout({height:o,width:c})})),this._promptEditor.setModel(this._promptTextModel),this._promptEditor.layout(),this._register(sk(ik(this._userPrompt,e=>e??``,e=>e),Qr(this._promptEditor).value)),this._register(Ba(e=>{let t=Qr(this._promptEditor).isFocused.read(e);this._elements.root.classList.toggle(`focused`,t)}))}};rk=ek([tk(3,Y)],rk);function ik(e,t,n){return Qo(void 0,n=>t(e.read(n)),(t,r)=>e.set(n(t),r))}var ak=class e{constructor(e,t){this.x=e,this.y=t}deltaX(t){return new e(this.x+t,this.y)}},ok=class{constructor(){this._data=``}moveTo(e){return this._data+=`M ${e.x} ${e.y} `,this}lineTo(e){return this._data+=`L ${e.x} ${e.y} `,this}curveTo(e,t,n){return this._data+=`C ${e.x} ${e.y} ${t.x} ${t.y} ${n.x} ${n.y} `,this}build(){return this._data}};function sk(e,t){let r=new n;return r.add(Ba(n=>{let r=e.read(n);t.set(r,void 0)})),r.add(Ba(n=>{let r=t.read(n);e.set(r,void 0)})),r}var ck=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},lk=function(e,t){return function(n,r){t(n,r,e)}},uk,dk=class extends _{static#e=uk=this;static#t=this._modelId=0;static _createUniqueUri(){return y.from({scheme:`inline-edits`,path:new Date().toString()+String(uk._modelId++)})}constructor(e,t,r,i,o,s,c){super(),this.textModel=e,this._textModelVersionId=t,this._selection=r,this._debounceValue=i,this.languageFeaturesService=o,this._diffProviderFactoryService=s,this._modelService=c,this._forceUpdateExplicitlySignal=Po(this),this._selectedInlineCompletionId=uc(this,void 0),this._isActive=uc(this,!1),this._originalModel=Sc(()=>this._modelService.createModel(``,null,uk._createUniqueUri())).keepObserved(this._store),this._modifiedModel=Sc(()=>this._modelService.createModel(``,null,uk._createUniqueUri())).keepObserved(this._store),this._pinnedRange=new pk(this.textModel,this._textModelVersionId),this.isPinned=this._pinnedRange.range.map(e=>!!e),this.userPrompt=uc(this,void 0),this.inlineEdit=K(this,e=>this._inlineEdit.read(e)?.promiseResult.read(e)?.data),this._inlineEdit=K(this,e=>{let t=this.selectedInlineEdit.read(e);if(!t)return;let n=t.inlineCompletion.range;if(t.inlineCompletion.insertText.trim()===``)return;let r=t.inlineCompletion.insertText.split(/\r\n|\r|\n/);function i(e){let t=e[0].match(/^\s*/)?.[0]??``;return e.map(e=>e.replace(RegExp(`^`+t),``))}r=i(r);let a=this.textModel.getValueInRange(n).split(/\r\n|\r|\n/);a=i(a),this._originalModel.get().setValue(a.join(`
`)),this._modifiedModel.get().setValue(r.join(`
`));let o=this._diffProviderFactoryService.createDiffProvider({diffAlgorithm:`advanced`});return uo.fromFn(async()=>{let e=await o.computeDiff(this._originalModel.get(),this._modifiedModel.get(),{computeMoves:!1,ignoreTrimWhitespace:!1,maxComputationTimeMs:1e3},w.None);if(!e.identical)return new nk(oc.fromRangeInclusive(n),i(r),e.changes)})}),this._fetchStore=this._register(new n),this._inlineEditsFetchResult=us(this,void 0),this._inlineEdits=Ks({owner:this,equalsFn:Vs},e=>this._inlineEditsFetchResult.read(e)?.completions.map(e=>new fk(e))??[]),this._fetchInlineEditsPromise=Wc({owner:this,createEmptyChangeSummary:()=>({inlineCompletionTriggerKind:Oe.Automatic}),handleChange:(e,t)=>(e.didChange(this._forceUpdateExplicitlySignal)&&(t.inlineCompletionTriggerKind=Oe.Explicit),!0)},async(e,t)=>{this._fetchStore.clear(),this._forceUpdateExplicitlySignal.read(e),this._textModelVersionId.read(e);function n(e,t){return t(e)}let r=this._pinnedRange.range.read(e)??n(this._selection.read(e),e=>e.isEmpty()?void 0:e);if(!r){this._inlineEditsFetchResult.set(void 0,void 0),this.userPrompt.set(void 0,void 0);return}let i={triggerKind:t.inlineCompletionTriggerKind,selectedSuggestionInfo:void 0,userPrompt:this.userPrompt.read(e)},o=a(this._fetchStore);await Ot(200,o);let s=await Zx(this.languageFeaturesService.inlineCompletionsProvider,r,this.textModel,i,o);o.isCancellationRequested||this._inlineEditsFetchResult.set(s,void 0)}),this._filteredInlineEditItems=Ks({owner:this,equalsFn:_c()},e=>this._inlineEdits.read(e)),this.selectedInlineCompletionIndex=K(this,e=>{let t=this._selectedInlineCompletionId.read(e),n=this._filteredInlineEditItems.read(e),r=this._selectedInlineCompletionId===void 0?-1:n.findIndex(e=>e.semanticId===t);return r===-1?(this._selectedInlineCompletionId.set(void 0,void 0),0):r}),this.selectedInlineEdit=K(this,e=>this._filteredInlineEditItems.read(e)[this.selectedInlineCompletionIndex.read(e)]),this._register(zo(this._fetchInlineEditsPromise))}async triggerExplicitly(e){il(e,e=>{this._isActive.set(!0,e),this._forceUpdateExplicitlySignal.trigger(e)}),await this._fetchInlineEditsPromise.get()}stop(e){il(e,e=>{this.userPrompt.set(void 0,e),this._isActive.set(!1,e),this._inlineEditsFetchResult.set(void 0,e),this._pinnedRange.setRange(void 0,e)})}async _deltaSelectedInlineCompletionIndex(e){await this.triggerExplicitly();let t=this._filteredInlineEditItems.get()||[];if(t.length>0){let n=(this.selectedInlineCompletionIndex.get()+e+t.length)%t.length;this._selectedInlineCompletionId.set(t[n].semanticId,void 0)}else this._selectedInlineCompletionId.set(void 0,void 0)}async next(){await this._deltaSelectedInlineCompletionIndex(1)}async previous(){await this._deltaSelectedInlineCompletionIndex(-1)}async accept(t){if(t.getModel()!==this.textModel)throw new e;let n=this.selectedInlineEdit.get();n&&(t.pushUndoStop(),t.executeEdits(`inlineSuggestion.accept`,[n.inlineCompletion.toSingleTextEdit().toSingleEditOperation()]),this.stop())}};dk=uk=ck([lk(4,V),lk(5,Wi),lk(6,Ps)],dk);var fk=class{constructor(e){this.inlineCompletion=e,this.semanticId=this.inlineCompletion.hash()}},pk=class extends _{constructor(e,t){super(),this._textModel=e,this._versionId=t,this._decorations=uc(this,[]),this.range=K(this,e=>{this._versionId.read(e);let t=this._decorations.read(e)[0];return t?this._textModel.getDecorationRange(t)??null:null}),this._register(b(()=>{this._textModel.deltaDecorations(this._decorations.get(),[])}))}setRange(e,t){this._decorations.set(this._textModel.deltaDecorations(this._decorations.get(),e?[{range:e,options:{description:`trackedRange`}}]:[]),t)}},mk=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},hk=function(e,t){return function(n,r){t(n,r,e)}},gk,_k=class extends _{static#e=gk=this;static#t=this.ID=`editor.contrib.inlineEditsController`;static get(e){return e.getContribution(gk.ID)}constructor(e,t,n,r,i,a){super(),this.editor=e,this._instantiationService=t,this._contextKeyService=n,this._debounceService=r,this._languageFeaturesService=i,this._configurationService=a,this._enabled=Ta(`editor.inlineEdits.enabled`,!1,this._configurationService),this._editorObs=Qr(this.editor),this._selection=K(this,e=>this._editorObs.cursorSelection.read(e)??new v(1,1,1,1)),this._debounceValue=this._debounceService.for(this._languageFeaturesService.inlineCompletionsProvider,`InlineEditsDebounce`,{min:50,max:50}),this.model=Sc(this,e=>{if(!this._enabled.read(e)||this._editorObs.isReadonly.read(e))return;let t=this._editorObs.model.read(e);if(t)return this._instantiationService.createInstance(ja(dk,e),t,this._editorObs.versionId,this._selection,this._debounceValue)}),this._hadInlineEdit=aa(this,(e,t)=>t||this.model.read(e)?.inlineEdit.read(e)!==void 0),this._widget=Sc(this,e=>{if(this._hadInlineEdit.read(e))return this._instantiationService.createInstance(ja(rk,e),this.editor,this.model.map((e,t)=>e?.inlineEdit.read(t)),vk(e=>this.model.read(e)?.userPrompt??uc(`empty`,``)))}),this._register(gi(XO,this._contextKeyService,e=>!!this.model.read(e)?.inlineEdit.read(e))),this._register(gi(ZO,this._contextKeyService,e=>!!this.model.read(e)?.isPinned.read(e))),this.model.recomputeInitiallyAndOnChange(this._store),this._widget.recomputeInitiallyAndOnChange(this._store)}};_k=gk=mk([hk(1,Y),hk(2,W),hk(3,Qi),hk(4,V),hk(5,F)],_k);function vk(e){return Qo(void 0,t=>e(t).read(t),(t,n)=>{e(void 0).set(t,n)})}function yk(e){return{label:e.value,alias:e.original}}var bk=class e extends N{static#e=this.ID=`editor.action.inlineEdits.showNext`;constructor(){super({id:e.ID,...yk(x(`action.inlineEdits.showNext`,`Show Next Inline Edit`)),precondition:z.and(q.writable,XO),kbOpts:{weight:100,primary:606}})}async run(e,t){_k.get(t)?.model.get()?.next()}},xk=class e extends N{static#e=this.ID=`editor.action.inlineEdits.showPrevious`;constructor(){super({id:e.ID,...yk(x(`action.inlineEdits.showPrevious`,`Show Previous Inline Edit`)),precondition:z.and(q.writable,XO),kbOpts:{weight:100,primary:604}})}async run(e,t){_k.get(t)?.model.get()?.previous()}},Sk=class extends N{constructor(){super({id:`editor.action.inlineEdits.trigger`,...yk(x(`action.inlineEdits.trigger`,`Trigger Inline Edit`)),precondition:q.writable})}async run(e,t){let n=_k.get(t);await Yc(async e=>{await n?.model.get()?.triggerExplicitly(e)})}},Ck=class extends N{constructor(){super({id:`editor.action.inlineEdits.accept`,...yk(x(`action.inlineEdits.accept`,`Accept Inline Edit`)),precondition:XO,menuOpts:{menuId:R.InlineEditsActions,title:S(`inlineEditsActions`,`Accept Inline Edit`),group:`primary`,order:1,icon:i.check},kbOpts:{primary:2058,weight:2e4,kbExpr:XO}})}async run(e,t){t instanceof Ph&&(t=t.getParentEditor());let n=_k.get(t);n&&(n.model.get()?.accept(n.editor),n.editor.focus())}},wk=class e extends N{static#e=this.ID=`editor.action.inlineEdits.hide`;constructor(){super({id:e.ID,...yk(x(`action.inlineEdits.hide`,`Hide Inline Edit`)),precondition:XO,kbOpts:{weight:100,primary:9}})}async run(e,t){let n=_k.get(t);gs(e=>{n?.model.get()?.stop(e)})}};I(_k.ID,_k,3),L(Sk),L(bk),L(xk),L(Ck),L(wk);const Tk={Visible:new G(`parameterHintsVisible`,!1),MultipleSignatures:new G(`parameterHintsMultipleSignatures`,!1)};async function Ek(e,t,n,r,i){let a=e.ordered(t);for(let e of a)try{let a=await e.provideSignatureHelp(t,n,i,r);if(a)return a}catch(e){Re(e)}}B.registerCommand(`_executeSignatureHelpProvider`,async(e,...t)=>{let[n,i,a]=t;o(y.isUri(n)),o(r.isIPosition(i)),o(typeof a==`string`||!a);let s=e.get(V),c=await e.get(Bs).createModelReference(n);try{let e=await Ek(s.signatureHelpProvider,c.object.textEditorModel,r.lift(i),{triggerKind:be.Invoke,isRetrigger:!1,triggerCharacter:a},w.None);return e?(setTimeout(()=>e.dispose(),0),e.value):void 0}finally{c.dispose()}});var Dk;(function(e){e.Default={type:0};class t{constructor(e,t){this.request=e,this.previouslyActiveHints=t,this.type=2}}e.Pending=t;class n{constructor(e){this.hints=e,this.type=1}}e.Active=n})(Dk||={});var Ok=class e extends _{static#e=this.DEFAULT_DELAY=120;constructor(t,n,r=e.DEFAULT_DELAY){super(),this._onChangedHints=this._register(new g),this.onChangedHints=this._onChangedHints.event,this.triggerOnType=!1,this._state=Dk.Default,this._pendingTriggers=[],this._lastSignatureHelpResult=this._register(new l),this.triggerChars=new pl,this.retriggerChars=new pl,this.triggerId=0,this.editor=t,this.providers=n,this.throttledDelayer=new Nt(r),this._register(this.editor.onDidBlurEditorWidget(()=>this.cancel())),this._register(this.editor.onDidChangeConfiguration(()=>this.onEditorConfigurationChange())),this._register(this.editor.onDidChangeModel(e=>this.onModelChanged())),this._register(this.editor.onDidChangeModelLanguage(e=>this.onModelChanged())),this._register(this.editor.onDidChangeCursorSelection(e=>this.onCursorChange(e))),this._register(this.editor.onDidChangeModelContent(e=>this.onModelContentChange())),this._register(this.providers.onDidChange(this.onModelChanged,this)),this._register(this.editor.onDidType(e=>this.onDidType(e))),this.onEditorConfigurationChange(),this.onModelChanged()}get state(){return this._state}set state(e){this._state.type===2&&this._state.request.cancel(),this._state=e}cancel(e=!1){this.state=Dk.Default,this.throttledDelayer.cancel(),e||this._onChangedHints.fire(void 0)}trigger(e,t){let n=this.editor.getModel();if(!n||!this.providers.has(n))return;let r=++this.triggerId;this._pendingTriggers.push(e),this.throttledDelayer.trigger(()=>this.doTrigger(r),t).catch(C)}next(){if(this.state.type!==1)return;let e=this.state.hints.signatures.length,t=this.state.hints.activeSignature,n=t%e===e-1,r=this.editor.getOption(86).cycle;if((e<2||n)&&!r){this.cancel();return}this.updateActiveSignature(n&&r?0:t+1)}previous(){if(this.state.type!==1)return;let e=this.state.hints.signatures.length,t=this.state.hints.activeSignature,n=t===0,r=this.editor.getOption(86).cycle;if((e<2||n)&&!r){this.cancel();return}this.updateActiveSignature(n&&r?e-1:t-1)}updateActiveSignature(e){this.state.type===1&&(this.state=new Dk.Active({...this.state.hints,activeSignature:e}),this._onChangedHints.fire(this.state.hints))}async doTrigger(e){let t=this.state.type===1||this.state.type===2,n=this.getLastActiveHints();if(this.cancel(!0),this._pendingTriggers.length===0)return!1;let r=this._pendingTriggers.reduce(kk);this._pendingTriggers=[];let i={triggerKind:r.triggerKind,triggerCharacter:r.triggerCharacter,isRetrigger:t,activeSignatureHelp:n};if(!this.editor.hasModel())return!1;let a=this.editor.getModel(),o=this.editor.getPosition();this.state=new Dk.Pending(et(e=>Ek(this.providers,a,o,i,e)),n);try{let t=await this.state.request;return e===this.triggerId?!t||!t.value.signatures||t.value.signatures.length===0?(t?.dispose(),this._lastSignatureHelpResult.clear(),this.cancel(),!1):(this.state=new Dk.Active(t.value),this._lastSignatureHelpResult.value=t,this._onChangedHints.fire(this.state.hints),!0):(t?.dispose(),!1)}catch(t){return e===this.triggerId&&(this.state=Dk.Default),C(t),!1}}getLastActiveHints(){switch(this.state.type){case 1:return this.state.hints;case 2:return this.state.previouslyActiveHints;default:return}}get isTriggered(){return this.state.type===1||this.state.type===2||this.throttledDelayer.isTriggered()}onModelChanged(){this.cancel(),this.triggerChars.clear(),this.retriggerChars.clear();let e=this.editor.getModel();if(e)for(let t of this.providers.ordered(e)){for(let e of t.signatureHelpTriggerCharacters||[])if(e.length){let t=e.charCodeAt(0);this.triggerChars.add(t),this.retriggerChars.add(t)}for(let e of t.signatureHelpRetriggerCharacters||[])e.length&&this.retriggerChars.add(e.charCodeAt(0))}}onDidType(e){if(!this.triggerOnType)return;let t=e.length-1,n=e.charCodeAt(t);(this.triggerChars.has(n)||this.isTriggered&&this.retriggerChars.has(n))&&this.trigger({triggerKind:be.TriggerCharacter,triggerCharacter:e.charAt(t)})}onCursorChange(e){e.source===`mouse`?this.cancel():this.isTriggered&&this.trigger({triggerKind:be.ContentChange})}onModelContentChange(){this.isTriggered&&this.trigger({triggerKind:be.ContentChange})}onEditorConfigurationChange(){this.triggerOnType=this.editor.getOption(86).enabled,this.triggerOnType||this.cancel()}dispose(){this.cancel(!0),super.dispose()}};function kk(e,t){switch(t.triggerKind){case be.Invoke:return t;case be.ContentChange:return e;case be.TriggerCharacter:default:return t}}var Ak=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},jk=function(e,t){return function(n,r){t(n,r,e)}},Mk,Nk=O,Pk=ri(`parameter-hints-next`,i.chevronDown,S(`parameterHintsNextIcon`,`Icon for show next parameter hint.`)),Fk=ri(`parameter-hints-previous`,i.chevronUp,S(`parameterHintsPreviousIcon`,`Icon for show previous parameter hint.`)),Ik=class extends _{static#e=Mk=this;static#t=this.ID=`editor.widget.parameterHintsWidget`;constructor(e,t,r,i,a,o){super(),this.editor=e,this.model=t,this.telemetryService=o,this.renderDisposeables=this._register(new n),this.visible=!1,this.announcedLabel=null,this.allowEditorOverflow=!0,this.markdownRenderer=this._register(new Hi({editor:e},a,i)),this.keyVisible=Tk.Visible.bindTo(r),this.keyMultipleSignatures=Tk.MultipleSignatures.bindTo(r)}createParameterHintDOMNodes(){let e=Nk(`.editor-widget.parameter-hints-widget`),t=M(e,Nk(`.phwrapper`));t.tabIndex=-1;let n=M(t,Nk(`.controls`)),r=M(n,Nk(`.button`+J.asCSSSelector(Fk))),i=M(n,Nk(`.overloads`)),a=M(n,Nk(`.button`+J.asCSSSelector(Pk)));this._register(D(r,`click`,e=>{nr.stop(e),this.previous()})),this._register(D(a,`click`,e=>{nr.stop(e),this.next()}));let o=Nk(`.body`),s=new ha(o,{alwaysConsumeMouseWheel:!0});this._register(s),t.appendChild(s.getDomNode());let c=M(o,Nk(`.signature`)),l=M(o,Nk(`.docs`));e.style.userSelect=`text`,this.domNodes={element:e,signature:c,overloads:i,docs:l,scrollbar:s},this.editor.addContentWidget(this),this.hide(),this._register(this.editor.onDidChangeCursorSelection(e=>{this.visible&&this.editor.layoutContentWidget(this)}));let u=()=>{if(!this.domNodes)return;let e=this.editor.getOption(50),t=this.domNodes.element;t.style.fontSize=`${e.fontSize}px`,t.style.lineHeight=`${e.lineHeight/e.fontSize}`,t.style.setProperty(`--vscode-parameterHintsWidget-editorFontFamily`,e.fontFamily),t.style.setProperty(`--vscode-parameterHintsWidget-editorFontFamilyDefault`,hr.fontFamily)};u(),this._register(we.chain(this.editor.onDidChangeConfiguration.bind(this.editor),e=>e.filter(e=>e.hasChanged(50)))(u)),this._register(this.editor.onDidLayoutChange(e=>this.updateMaxHeight())),this.updateMaxHeight()}show(){this.visible||(this.domNodes||this.createParameterHintDOMNodes(),this.keyVisible.set(!0),this.visible=!0,setTimeout(()=>{this.domNodes?.element.classList.add(`visible`)},100),this.editor.layoutContentWidget(this))}hide(){this.renderDisposeables.clear(),this.visible&&(this.keyVisible.reset(),this.visible=!1,this.announcedLabel=null,this.domNodes?.element.classList.remove(`visible`),this.editor.layoutContentWidget(this))}getPosition(){return this.visible?{position:this.editor.getPosition(),preference:[1,2]}:null}render(e){if(this.renderDisposeables.clear(),!this.domNodes)return;let t=e.signatures.length>1;this.domNodes.element.classList.toggle(`multiple`,t),this.keyMultipleSignatures.set(t),this.domNodes.signature.innerText=``,this.domNodes.docs.innerText=``;let n=e.signatures[e.activeSignature];if(!n)return;let r=M(this.domNodes.signature,Nk(`.code`)),i=n.parameters.length>0,a=n.activeParameter??e.activeParameter;if(i)this.renderParameters(r,n,a);else{let e=M(r,Nk(`span`));e.textContent=n.label}let o=n.parameters[a];if(o?.documentation){let e=Nk(`span.documentation`);if(typeof o.documentation==`string`)e.textContent=o.documentation;else{let t=this.renderMarkdownDocs(o.documentation);e.appendChild(t.element)}M(this.domNodes.docs,Nk(`p`,{},e))}if(n.documentation!==void 0)if(typeof n.documentation==`string`)M(this.domNodes.docs,Nk(`p`,{},n.documentation));else{let e=this.renderMarkdownDocs(n.documentation);M(this.domNodes.docs,e.element)}let s=this.hasDocs(n,o);if(this.domNodes.signature.classList.toggle(`has-docs`,s),this.domNodes.docs.classList.toggle(`empty`,!s),this.domNodes.overloads.textContent=String(e.activeSignature+1).padStart(e.signatures.length.toString().length,`0`)+`/`+e.signatures.length,o){let e=``,t=n.parameters[a];e=Array.isArray(t.label)?n.label.substring(t.label[0],t.label[1]):t.label,t.documentation&&(e+=typeof t.documentation==`string`?`, ${t.documentation}`:`, ${t.documentation.value}`),n.documentation&&(e+=typeof n.documentation==`string`?`, ${n.documentation}`:`, ${n.documentation.value}`),this.announcedLabel!==e&&(qa(S(`hint`,`{0}, hint`,e)),this.announcedLabel=e)}this.editor.layoutContentWidget(this),this.domNodes.scrollbar.scanDomNode()}renderMarkdownDocs(e){let t=new u,n=this.renderDisposeables.add(this.markdownRenderer.render(e,{asyncRenderCallback:()=>{this.domNodes?.scrollbar.scanDomNode()}}));n.element.classList.add(`markdown-docs`);let r=t.elapsed();return r>300&&this.telemetryService.publicLog2(`parameterHints.parseMarkdown`,{renderDuration:r}),n}hasDocs(e,t){return!!(t&&typeof t.documentation==`string`&&ae(t.documentation).length>0||t&&typeof t.documentation==`object`&&ae(t.documentation).value.length>0||e.documentation&&typeof e.documentation==`string`&&ae(e.documentation).length>0||e.documentation&&typeof e.documentation==`object`&&ae(e.documentation.value).length>0)}renderParameters(e,t,n){let[r,i]=this.getParameterLabelOffsets(t,n),a=document.createElement(`span`);a.textContent=t.label.substring(0,r);let o=document.createElement(`span`);o.textContent=t.label.substring(r,i),o.className=`parameter active`;let s=document.createElement(`span`);s.textContent=t.label.substring(i),M(e,a,o,s)}getParameterLabelOffsets(e,t){let n=e.parameters[t];if(n){if(Array.isArray(n.label))return n.label;if(n.label.length){let t=RegExp(`(\\W|^)${St(n.label)}(?=\\W|$)`,`g`);t.test(e.label);let r=t.lastIndex-n.label.length;return r>=0?[r,t.lastIndex]:[0,0]}else return[0,0]}else return[0,0]}next(){this.editor.focus(),this.model.next()}previous(){this.editor.focus(),this.model.previous()}getDomNode(){return this.domNodes||this.createParameterHintDOMNodes(),this.domNodes.element}getId(){return Mk.ID}updateMaxHeight(){if(!this.domNodes)return;let e=`${Math.max(this.editor.getLayoutInfo().height/4,250)}px`;this.domNodes.element.style.maxHeight=e;let t=this.domNodes.element.getElementsByClassName(`phwrapper`);t.length&&(t[0].style.maxHeight=e)}};Ik=Mk=Ak([jk(2,W),jk(3,wi),jk(4,Ys),jk(5,Zi)],Ik),k(`editorHoverWidget.highlightForeground`,zt,S(`editorHoverWidgetHighlightForeground`,`Foreground color of the active item in the parameter hint.`));var Lk=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Rk=function(e,t){return function(n,r){t(n,r,e)}},zk,Bk=class extends _{static#e=zk=this;static#t=this.ID=`editor.controller.parameterHints`;static get(e){return e.getContribution(zk.ID)}constructor(e,t,n){super(),this.editor=e,this.model=this._register(new Ok(e,n.signatureHelpProvider)),this._register(this.model.onChangedHints(e=>{e?(this.widget.value.show(),this.widget.value.render(e)):this.widget.rawValue?.hide()})),this.widget=new Qt(()=>this._register(t.createInstance(Ik,this.editor,this.model)))}cancel(){this.model.cancel()}previous(){this.widget.rawValue?.previous()}next(){this.widget.rawValue?.next()}trigger(e){this.model.trigger(e,0)}};Bk=zk=Lk([Rk(1,Y),Rk(2,V)],Bk);var Vk=class extends N{constructor(){super({id:`editor.action.triggerParameterHints`,label:S(`parameterHints.trigger.label`,`Trigger Parameter Hints`),alias:`Trigger Parameter Hints`,precondition:q.hasSignatureHelpProvider,kbOpts:{kbExpr:q.editorTextFocus,primary:3082,weight:100}})}run(e,t){Bk.get(t)?.trigger({triggerKind:be.Invoke})}};I(Bk.ID,Bk,2),L(Vk);var Hk=175,Uk=la.bindToContribution(Bk.get);P(new Uk({id:`closeParameterHints`,precondition:Tk.Visible,handler:e=>e.cancel(),kbOpts:{weight:Hk,kbExpr:q.focus,primary:9,secondary:[1033]}})),P(new Uk({id:`showPrevParameterHint`,precondition:z.and(Tk.Visible,Tk.MultipleSignatures),handler:e=>e.previous(),kbOpts:{weight:Hk,kbExpr:q.focus,primary:16,secondary:[528],mac:{primary:16,secondary:[528,302]}}})),P(new Uk({id:`showNextParameterHint`,precondition:z.and(Tk.Visible,Tk.MultipleSignatures),handler:e=>e.next(),kbOpts:{weight:Hk,kbExpr:q.focus,primary:18,secondary:[530],mac:{primary:18,secondary:[530,300]}}}));var Wk=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Gk=function(e,t){return function(n,r){t(n,r,e)}},Kk=class{constructor(e){this.instantiationService=e}init(...e){}};function qk(e,t){return class extends t{constructor(){super(...arguments),this._autorun=void 0}init(...t){this._autorun=Ss((n,r)=>{let i=ja(e(),n);r.add(this.instantiationService.createInstance(i,...t))})}dispose(){this._autorun?.dispose()}}}function Jk(e){return Oi()?qk(e,Yk):e()}var Yk=class extends Kk{constructor(e,t){super(t),this.init(e)}};Yk=Wk([Gk(1,Y)],Yk),I(QO.ID,Jk(()=>QO),0),k(`editor.placeholder.foreground`,ll,S(`placeholderForeground`,`Foreground color of the placeholder text in the editor.`));var Xk=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Zk=function(e,t){return function(n,r){t(n,r,e)}};const Qk=new G(`renameInputVisible`,!1,S(`renameInputVisible`,`Whether the rename input widget is visible`));new G(`renameInputFocused`,!1,S(`renameInputFocused`,`Whether the rename input widget is focused`));var $k=class{constructor(e,t,r,i,a,o){this._editor=e,this._acceptKeybindings=t,this._themeService=r,this._keybindingService=i,this._logService=o,this.allowEditorOverflow=!0,this._disposables=new n,this._visibleContextKey=Qk.bindTo(a),this._isEditingRenameCandidate=!1,this._nRenameSuggestionsInvocations=0,this._hadAutomaticRenameSuggestionsInvocation=!1,this._candidates=new Set,this._beforeFirstInputFieldEditSW=new u,this._inputWithButton=new tA,this._disposables.add(this._inputWithButton),this._editor.addContentWidget(this),this._disposables.add(this._editor.onDidChangeConfiguration(e=>{e.hasChanged(50)&&this._updateFont()})),this._disposables.add(r.onDidColorThemeChange(this._updateStyles,this))}dispose(){this._disposables.dispose(),this._editor.removeContentWidget(this)}getId(){return`__renameInputWidget`}getDomNode(){return this._domNode||(this._domNode=document.createElement(`div`),this._domNode.className=`monaco-editor rename-box`,this._domNode.appendChild(this._inputWithButton.domNode),this._renameCandidateListView=this._disposables.add(new eA(this._domNode,{fontInfo:this._editor.getOption(50),onFocusChange:e=>{this._inputWithButton.input.value=e,this._isEditingRenameCandidate=!1},onSelectionChange:()=>{this._isEditingRenameCandidate=!1,this.acceptInput(!1)}})),this._disposables.add(this._inputWithButton.onDidInputChange(()=>{this._renameCandidateListView?.focusedCandidate!==void 0&&(this._isEditingRenameCandidate=!0),this._timeBeforeFirstInputFieldEdit??=this._beforeFirstInputFieldEditSW.elapsed(),this._renameCandidateProvidersCts?.token.isCancellationRequested===!1&&this._renameCandidateProvidersCts.cancel(),this._renameCandidateListView?.clearFocus()})),this._label=document.createElement(`div`),this._label.className=`rename-label`,this._domNode.appendChild(this._label),this._updateFont(),this._updateStyles(this._themeService.getColorTheme())),this._domNode}_updateStyles(e){if(!this._domNode)return;let t=e.getColor(Rt),n=e.getColor(it);this._domNode.style.backgroundColor=String(e.getColor(zr)??``),this._domNode.style.boxShadow=t?` 0 0 8px 2px ${t}`:``,this._domNode.style.border=n?`1px solid ${n}`:``,this._domNode.style.color=String(e.getColor(ur)??``);let r=e.getColor(Dr);this._inputWithButton.domNode.style.backgroundColor=String(e.getColor(Vn)??``),this._inputWithButton.input.style.backgroundColor=String(e.getColor(Vn)??``),this._inputWithButton.domNode.style.borderWidth=r?`1px`:`0px`,this._inputWithButton.domNode.style.borderStyle=r?`solid`:`none`,this._inputWithButton.domNode.style.borderColor=r?.toString()??`none`}_updateFont(){if(this._domNode===void 0)return;o(this._label!==void 0,`RenameWidget#_updateFont: _label must not be undefined given _domNode is defined`),this._editor.applyFontInfo(this._inputWithButton.input);let e=this._editor.getOption(50);this._label.style.fontSize=`${this._computeLabelFontSize(e.fontSize)}px`}_computeLabelFontSize(e){return e*.8}getPosition(){if(!this._visible||!this._editor.hasModel()||!this._editor.getDomNode())return null;let e=jt(this.getDomNode().ownerDocument.body),t=gt(this._editor.getDomNode());this._nPxAvailableAbove=this._getTopForPosition()+t.top,this._nPxAvailableBelow=e.height-this._nPxAvailableAbove;let n=this._editor.getOption(67),{totalHeight:r}=nA.getLayoutInfo({lineHeight:n}),i=this._nPxAvailableBelow>r*6?[2,1]:[1,2];return{position:this._position,preference:i}}beforeRender(){let[e,t]=this._acceptKeybindings;return this._label.innerText=S({key:`label`,comment:[`placeholders are keybindings, e.g "F2 to Rename, Shift+F2 to Preview"`]},`{0} to Rename, {1} to Preview`,this._keybindingService.lookupKeybinding(e)?.getLabel(),this._keybindingService.lookupKeybinding(t)?.getLabel()),this._domNode.style.minWidth=`200px`,null}afterRender(e){if(e===null){this.cancelInput(!0,`afterRender (because position is null)`);return}if(!this._editor.hasModel()||!this._editor.getDomNode())return;o(this._renameCandidateListView),o(this._nPxAvailableAbove!==void 0),o(this._nPxAvailableBelow!==void 0);let t=Qe(this._inputWithButton.domNode),n=Qe(this._label),r;r=e===2?this._nPxAvailableBelow:this._nPxAvailableAbove,this._renameCandidateListView.layout({height:r-n-t,width:rn(this._inputWithButton.domNode)})}acceptInput(e){this._trace(`invoking acceptInput`),this._currentAcceptInput?.(e)}cancelInput(e,t){this._currentCancelInput?.(e)}focusNextRenameSuggestion(){this._renameCandidateListView?.focusNext()||(this._inputWithButton.input.value=this._currentName)}focusPreviousRenameSuggestion(){this._renameCandidateListView?.focusPrevious()||(this._inputWithButton.input.value=this._currentName)}getInput(e,t,i,a,s){let{start:c,end:l}=this._getSelection(e,t);this._renameCts=s;let u=new n;this._nRenameSuggestionsInvocations=0,this._hadAutomaticRenameSuggestionsInvocation=!1,a===void 0?this._inputWithButton.button.style.display=`none`:(this._inputWithButton.button.style.display=`flex`,this._requestRenameCandidatesOnce=a,this._requestRenameCandidates(t,!1),u.add(D(this._inputWithButton.button,`click`,()=>this._requestRenameCandidates(t,!0))),u.add(D(this._inputWithButton.button,j.KEY_DOWN,e=>{let n=new pn(e);(n.equals(3)||n.equals(10))&&(n.stopPropagation(),n.preventDefault(),this._requestRenameCandidates(t,!0))}))),this._isEditingRenameCandidate=!1,this._domNode.classList.toggle(`preview`,i),this._position=new r(e.startLineNumber,e.startColumn),this._currentName=t,this._inputWithButton.input.value=t,this._inputWithButton.input.setAttribute(`selectionStart`,c.toString()),this._inputWithButton.input.setAttribute(`selectionEnd`,l.toString()),this._inputWithButton.input.size=Math.max((e.endColumn-e.startColumn)*1.1,20),this._beforeFirstInputFieldEditSW.reset(),u.add(b(()=>{this._renameCts=void 0,s.dispose(!0)})),u.add(b(()=>{this._renameCandidateProvidersCts!==void 0&&(this._renameCandidateProvidersCts.dispose(!0),this._renameCandidateProvidersCts=void 0)})),u.add(b(()=>this._candidates.clear()));let d=new Zn;return d.p.finally(()=>{u.dispose(),this._hide()}),this._currentCancelInput=e=>(this._trace(`invoking _currentCancelInput`),this._currentAcceptInput=void 0,this._currentCancelInput=void 0,this._renameCandidateListView?.clearCandidates(),d.complete(e),!0),this._currentAcceptInput=e=>{this._trace(`invoking _currentAcceptInput`),o(this._renameCandidateListView!==void 0);let n=this._renameCandidateListView.nCandidates,r,a,s=this._renameCandidateListView.focusedCandidate;if(s===void 0?(this._trace(`using new name from inputField`),r=this._inputWithButton.input.value,a=this._isEditingRenameCandidate?{k:`userEditedRenameSuggestion`}:{k:`inputField`}):(this._trace(`using new name from renameSuggestion`),r=s,a={k:`renameSuggestion`}),r===t||r.trim().length===0){this.cancelInput(!0,`_currentAcceptInput (because newName === value || newName.trim().length === 0)`);return}this._currentAcceptInput=void 0,this._currentCancelInput=void 0,this._renameCandidateListView.clearCandidates(),d.complete({newName:r,wantsPreview:i&&e,stats:{source:a,nRenameSuggestions:n,timeBeforeFirstInputFieldEdit:this._timeBeforeFirstInputFieldEdit,nRenameSuggestionsInvocations:this._nRenameSuggestionsInvocations,hadAutomaticRenameSuggestionsInvocation:this._hadAutomaticRenameSuggestionsInvocation}})},u.add(s.token.onCancellationRequested(()=>this.cancelInput(!0,`cts.token.onCancellationRequested`))),u.add(this._editor.onDidBlurEditorWidget(()=>this.cancelInput(!this._domNode?.ownerDocument.hasFocus(),`editor.onDidBlurEditorWidget`))),this._show(),d.p}_requestRenameCandidates(e,t){if(this._requestRenameCandidatesOnce!==void 0&&(this._renameCandidateProvidersCts!==void 0&&this._renameCandidateProvidersCts.dispose(!0),o(this._renameCts),this._inputWithButton.buttonState!==`stop`)){this._renameCandidateProvidersCts=new ie;let n=t?Pe.Invoke:Pe.Automatic,r=this._requestRenameCandidatesOnce(n,this._renameCandidateProvidersCts.token);if(r.length===0){this._inputWithButton.setSparkleButton();return}t||(this._hadAutomaticRenameSuggestionsInvocation=!0),this._nRenameSuggestionsInvocations+=1,this._inputWithButton.setStopButton(),this._updateRenameCandidates(r,e,this._renameCts.token)}}_getSelection(e,t){o(this._editor.hasModel());let n=this._editor.getSelection(),r=0,i=t.length;return!T.isEmpty(n)&&!T.spansMultipleLines(n)&&T.containsRange(e,n)&&(r=Math.max(0,n.startColumn-e.startColumn),i=Math.min(e.endColumn,n.endColumn)-e.startColumn),{start:r,end:i}}_show(){this._trace(`invoking _show`),this._editor.revealLineInCenterIfOutsideViewport(this._position.lineNumber,0),this._visible=!0,this._visibleContextKey.set(!0),this._editor.layoutContentWidget(this),setTimeout(()=>{this._inputWithButton.input.focus(),this._inputWithButton.input.setSelectionRange(parseInt(this._inputWithButton.input.getAttribute(`selectionStart`)),parseInt(this._inputWithButton.input.getAttribute(`selectionEnd`)))},100)}async _updateRenameCandidates(e,t,n){let r=(...e)=>this._trace(`_updateRenameCandidates`,...e);r(`start`);let i=await sn(Promise.allSettled(e),n);if(this._inputWithButton.setSparkleButton(),i===void 0){r(`returning early - received updateRenameCandidates results - undefined`);return}let a=i.flatMap(e=>e.status===`fulfilled`&&ee(e.value)?e.value:[]);r(`received updateRenameCandidates results - total (unfiltered) ${a.length} candidates.`);let o=_n(a,e=>e.newSymbolName);r(`distinct candidates - ${o.length} candidates.`);let s=o.filter(({newSymbolName:e})=>e.trim().length>0&&e!==this._inputWithButton.input.value&&e!==t&&!this._candidates.has(e));if(r(`valid distinct candidates - ${a.length} candidates.`),s.forEach(e=>this._candidates.add(e.newSymbolName)),s.length<1){r(`returning early - no valid distinct candidates`);return}r(`setting candidates`),this._renameCandidateListView.setCandidates(s),r(`asking editor to re-layout`),this._editor.layoutContentWidget(this)}_hide(){this._trace(`invoked _hide`),this._visible=!1,this._visibleContextKey.reset(),this._editor.layoutContentWidget(this)}_getTopForPosition(){let e=this._editor.getVisibleRanges(),t;return e.length>0?t=e[0].startLineNumber:(this._logService.warn(`RenameWidget#_getTopForPosition: this should not happen - visibleRanges is empty`),t=Math.max(1,this._position.lineNumber-5)),this._editor.getTopForLineNumber(this._position.lineNumber)-this._editor.getTopForLineNumber(t)}_trace(...e){this._logService.trace(`RenameWidget`,...e)}};$k=Xk([Zk(2,Zc),Zk(3,ua),Zk(4,W),Zk(5,Fc)],$k);var eA=class e{constructor(t,r){this._disposables=new n,this._availableHeight=0,this._minimumWidth=0,this._lineHeight=r.fontInfo.lineHeight,this._typicalHalfwidthCharacterWidth=r.fontInfo.typicalHalfwidthCharacterWidth,this._listContainer=document.createElement(`div`),this._listContainer.className=`rename-box rename-candidate-list-container`,t.appendChild(this._listContainer),this._listWidget=e._createListWidget(this._listContainer,this._candidateViewHeight,r.fontInfo),this._listWidget.onDidChangeFocus(e=>{e.elements.length===1&&r.onFocusChange(e.elements[0].newSymbolName)},this._disposables),this._listWidget.onDidChangeSelection(e=>{e.elements.length===1&&r.onSelectionChange()},this._disposables),this._disposables.add(this._listWidget.onDidBlur(e=>{this._listWidget.setFocus([])})),this._listWidget.style(Sa({listInactiveFocusForeground:Yn,listInactiveFocusBackground:Sr}))}dispose(){this._listWidget.dispose(),this._disposables.dispose()}layout({height:e,width:t}){this._availableHeight=e,this._minimumWidth=t}setCandidates(e){this._listWidget.splice(0,0,e);let t=this._pickListHeight(this._listWidget.length),n=this._pickListWidth(e);this._listWidget.layout(t,n),this._listContainer.style.height=`${t}px`,this._listContainer.style.width=`${n}px`,Il(S(`renameSuggestionsReceivedAria`,`Received {0} rename suggestions`,e.length))}clearCandidates(){this._listContainer.style.height=`0px`,this._listContainer.style.width=`0px`,this._listWidget.splice(0,this._listWidget.length,[])}get nCandidates(){return this._listWidget.length}get focusedCandidate(){if(this._listWidget.length===0)return;let e=this._listWidget.getSelectedElements()[0];if(e!==void 0)return e.newSymbolName;let t=this._listWidget.getFocusedElements()[0];if(t!==void 0)return t.newSymbolName}focusNext(){if(this._listWidget.length===0)return!1;let e=this._listWidget.getFocus();if(e.length===0)return this._listWidget.focusFirst(),this._listWidget.reveal(0),!0;if(e[0]===this._listWidget.length-1)return this._listWidget.setFocus([]),this._listWidget.reveal(0),!1;{this._listWidget.focusNext();let e=this._listWidget.getFocus()[0];return this._listWidget.reveal(e),!0}}focusPrevious(){if(this._listWidget.length===0)return!1;let e=this._listWidget.getFocus();if(e.length===0){this._listWidget.focusLast();let e=this._listWidget.getFocus()[0];return this._listWidget.reveal(e),!0}else if(e[0]===0)return this._listWidget.setFocus([]),!1;else{this._listWidget.focusPrevious();let e=this._listWidget.getFocus()[0];return this._listWidget.reveal(e),!0}}clearFocus(){this._listWidget.setFocus([])}get _candidateViewHeight(){let{totalHeight:e}=nA.getLayoutInfo({lineHeight:this._lineHeight});return e}_pickListHeight(e){let t=this._candidateViewHeight*e;return Math.min(t,this._availableHeight,this._candidateViewHeight*7)}_pickListWidth(e){let t=Math.ceil(Math.max(...e.map(e=>e.newSymbolName.length))*this._typicalHalfwidthCharacterWidth);return Math.max(this._minimumWidth,25+t+10)}static _createListWidget(e,t,n){return new Ka(`NewSymbolNameCandidates`,e,new class{getTemplateId(e){return`candidate`}getHeight(e){return t}},[new class{constructor(){this.templateId=`candidate`}renderTemplate(e){return new nA(e,n)}renderElement(e,t,n){n.populate(e)}disposeTemplate(e){e.dispose()}}],{keyboardSupport:!1,mouseSupport:!0,multipleSelectionSupport:!1})}},tA=class{constructor(){this._onDidInputChange=new g,this.onDidInputChange=this._onDidInputChange.event,this._disposables=new n}get domNode(){return this._domNode||(this._domNode=document.createElement(`div`),this._domNode.className=`rename-input-with-button`,this._domNode.style.display=`flex`,this._domNode.style.flexDirection=`row`,this._domNode.style.alignItems=`center`,this._inputNode=document.createElement(`input`),this._inputNode.className=`rename-input`,this._inputNode.type=`text`,this._inputNode.style.border=`none`,this._inputNode.setAttribute(`aria-label`,S(`renameAriaLabel`,`Rename input. Type new name and press Enter to commit.`)),this._domNode.appendChild(this._inputNode),this._buttonNode=document.createElement(`div`),this._buttonNode.className=`rename-suggestions-button`,this._buttonNode.setAttribute(`tabindex`,`0`),this._buttonGenHoverText=S(`generateRenameSuggestionsButton`,`Generate new name suggestions`),this._buttonCancelHoverText=S(`cancelRenameSuggestionsButton`,`Cancel`),this._buttonHover=Fl().setupManagedHover(go(`element`),this._buttonNode,this._buttonGenHoverText),this._disposables.add(this._buttonHover),this._domNode.appendChild(this._buttonNode),this._disposables.add(D(this.input,j.INPUT,()=>this._onDidInputChange.fire())),this._disposables.add(D(this.input,j.KEY_DOWN,e=>{let t=new pn(e);(t.keyCode===15||t.keyCode===17)&&this._onDidInputChange.fire()})),this._disposables.add(D(this.input,j.CLICK,()=>this._onDidInputChange.fire())),this._disposables.add(D(this.input,j.FOCUS,()=>{this.domNode.style.outlineWidth=`1px`,this.domNode.style.outlineStyle=`solid`,this.domNode.style.outlineOffset=`-1px`,this.domNode.style.outlineColor=`var(--vscode-focusBorder)`})),this._disposables.add(D(this.input,j.BLUR,()=>{this.domNode.style.outline=`none`}))),this._domNode}get input(){return o(this._inputNode),this._inputNode}get button(){return o(this._buttonNode),this._buttonNode}get buttonState(){return this._buttonState}setSparkleButton(){this._buttonState=`sparkle`,this._sparkleIcon??=fi(i.sparkle),Fr(this.button),this.button.appendChild(this._sparkleIcon),this.button.setAttribute(`aria-label`,`Generating new name suggestions`),this._buttonHover?.update(this._buttonGenHoverText),this.input.focus()}setStopButton(){this._buttonState=`stop`,this._stopIcon??=fi(i.primitiveSquare),Fr(this.button),this.button.appendChild(this._stopIcon),this.button.setAttribute(`aria-label`,`Cancel generating new name suggestions`),this._buttonHover?.update(this._buttonCancelHoverText),this.input.focus()}dispose(){this._disposables.dispose()}},nA=class e{static#e=this._PADDING=2;constructor(t,n){this._domNode=document.createElement(`div`),this._domNode.className=`rename-box rename-candidate`,this._domNode.style.display=`flex`,this._domNode.style.columnGap=`5px`,this._domNode.style.alignItems=`center`,this._domNode.style.height=`${n.lineHeight}px`,this._domNode.style.padding=`${e._PADDING}px`;let r=document.createElement(`div`);r.style.display=`flex`,r.style.alignItems=`center`,r.style.width=r.style.height=`${n.lineHeight*.8}px`,this._domNode.appendChild(r),this._icon=fi(i.sparkle),this._icon.style.display=`none`,r.appendChild(this._icon),this._label=document.createElement(`div`),Sl(this._label,n),this._domNode.appendChild(this._label),t.appendChild(this._domNode)}populate(e){this._updateIcon(e),this._updateLabel(e)}_updateIcon(e){let t=!!e.tags?.includes(ve.AIGenerated);this._icon.style.display=t?`inherit`:`none`}_updateLabel(e){this._label.innerText=e.newSymbolName}static getLayoutInfo({lineHeight:t}){return{totalHeight:t+e._PADDING*2}}dispose(){}},rA=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},iA=function(e,t){return function(n,r){t(n,r,e)}},aA,oA=class{constructor(e,t,n){this.model=e,this.position=t,this._providerRenameIdx=0,this._providers=n.ordered(e)}hasProvider(){return this._providers.length>0}async resolveRenameLocation(e){let t=[];for(this._providerRenameIdx=0;this._providerRenameIdx<this._providers.length;this._providerRenameIdx++){let n=this._providers[this._providerRenameIdx];if(!n.resolveRenameLocation)break;let r=await n.resolveRenameLocation(this.model,this.position,e);if(r){if(r.rejectReason){t.push(r.rejectReason);continue}return r}}this._providerRenameIdx=0;let n=this.model.getWordAtPosition(this.position);return n?{range:new T(this.position.lineNumber,n.startColumn,this.position.lineNumber,n.endColumn),text:n.word,rejectReason:t.length>0?t.join(`
`):void 0}:{range:T.fromPositions(this.position),text:``,rejectReason:t.length>0?t.join(`
`):void 0}}async provideRenameEdits(e,t){return this._provideRenameEdits(e,this._providerRenameIdx,[],t)}async _provideRenameEdits(e,t,n,r){let i=this._providers[t];if(!i)return{edits:[],rejectReason:n.join(`
`)};let a=await i.provideRenameEdits(this.model,this.position,e,r);if(a){if(a.rejectReason)return this._provideRenameEdits(e,t+1,n.concat(a.rejectReason),r)}else return this._provideRenameEdits(e,t+1,n.concat(S(`no result`,`No result.`)),r);return a}};async function sA(e,t,n,r){let i=new oA(t,n,e),a=await i.resolveRenameLocation(w.None);return a?.rejectReason?{edits:[],rejectReason:a.rejectReason}:i.provideRenameEdits(r,w.None)}var cA=class{static#e=aA=this;static#t=this.ID=`editor.contrib.renameController`;static get(e){return e.getContribution(aA.ID)}constructor(e,t,r,i,a,o,s,c,l){this.editor=e,this._instaService=t,this._notificationService=r,this._bulkEditService=i,this._progressService=a,this._logService=o,this._configService=s,this._languageFeaturesService=c,this._telemetryService=l,this._disposableStore=new n,this._cts=new ie,this._renameWidget=this._disposableStore.add(this._instaService.createInstance($k,this.editor,[`acceptRenameInput`,`acceptRenameInputWithPreview`]))}dispose(){this._disposableStore.dispose(),this._cts.dispose(!0)}async run(){let e=this._logService.trace.bind(this._logService,`[rename]`);if(this._cts.dispose(!0),this._cts=new ie,!this.editor.hasModel()){e(`editor has no model`);return}let t=this.editor.getPosition(),n=new oA(this.editor.getModel(),t,this._languageFeaturesService.renameProvider);if(!n.hasProvider()){e(`skeleton has no provider`);return}let r=new fl(this.editor,5,void 0,this._cts.token),i;try{e(`resolving rename location`);let t=n.resolveRenameLocation(r.token);this._progressService.showWhile(t,250),i=await t,e(`resolved rename location`)}catch(n){n instanceof ge?e(`resolve rename location cancelled`,JSON.stringify(n,null,`	`)):(e(`resolve rename location failed`,n instanceof Error?n:JSON.stringify(n,null,`	`)),(typeof n==`string`||ys(n))&&Sd.get(this.editor)?.showMessage(n||S(`resolveRenameLocationFailed`,`An unknown error occurred while resolving rename location`),t));return}finally{r.dispose()}if(!i){e(`returning early - no loc`);return}if(i.rejectReason){e(`returning early - rejected with reason: ${i.rejectReason}`,i.rejectReason),Sd.get(this.editor)?.showMessage(i.rejectReason,t);return}if(r.token.isCancellationRequested){e(`returning early - cts1 cancelled`);return}let a=new fl(this.editor,5,i.range,this._cts.token),o=this.editor.getModel(),s=this._languageFeaturesService.newSymbolNamesProvider.all(o),c=await Promise.all(s.map(async e=>[e,await e.supportsAutomaticNewSymbolNamesTriggerKind??!1])),l=(e,t)=>{let n=c.slice();return e===Pe.Automatic&&(n=n.filter(([e,t])=>t)),n.map(([n])=>n.provideNewSymbolNames(o,i.range,e,t))};e(`creating rename input field and awaiting its result`);let u=this._bulkEditService.hasPreviewHandler()&&this._configService.getValue(this.editor.getModel().uri,`editor.rename.enablePreview`),d=await this._renameWidget.getInput(i.range,i.text,u,s.length>0?l:void 0,a);if(e(`received response from rename input field`),s.length>0&&this._reportTelemetry(s.length,o.getLanguageId(),d),typeof d==`boolean`){e(`returning early - rename input field response - ${d}`),d&&this.editor.focus(),a.dispose();return}this.editor.focus(),e(`requesting rename edits`);let f=sn(n.provideRenameEdits(d.newName,a.token),a.token).then(async t=>{if(!t){e(`returning early - no rename edits result`);return}if(!this.editor.hasModel()){e(`returning early - no model after rename edits are provided`);return}if(t.rejectReason){e(`returning early - rejected with reason: ${t.rejectReason}`),this._notificationService.info(t.rejectReason);return}this.editor.setSelection(T.fromPositions(this.editor.getSelection().getPosition())),e(`applying edits`),this._bulkEditService.apply(t,{editor:this.editor,showPreview:d.wantsPreview,label:S(`label`,`Renaming '{0}' to '{1}'`,i?.text,d.newName),code:`undoredo.rename`,quotableLabel:S(`quotableLabel`,`Renaming {0} to {1}`,i?.text,d.newName),respectAutoSaveConfig:!0}).then(t=>{e(`edits applied`),t.ariaSummary&&qa(S(`aria`,`Successfully renamed '{0}' to '{1}'. Summary: {2}`,i.text,d.newName,t.ariaSummary))}).catch(t=>{e(`error when applying edits ${JSON.stringify(t,null,`	`)}`),this._notificationService.error(S(`rename.failedApply`,`Rename failed to apply edits`)),this._logService.error(t)})},t=>{e(`error when providing rename edits`,JSON.stringify(t,null,`	`)),this._notificationService.error(S(`rename.failed`,`Rename failed to compute edits`)),this._logService.error(t)}).finally(()=>{a.dispose()});return e(`returning rename operation`),this._progressService.showWhile(f,250),f}acceptRenameInput(e){this._renameWidget.acceptInput(e)}cancelRenameInput(){this._renameWidget.cancelInput(!0,`cancelRenameInput command`)}focusNextRenameSuggestion(){this._renameWidget.focusNextRenameSuggestion()}focusPreviousRenameSuggestion(){this._renameWidget.focusPreviousRenameSuggestion()}_reportTelemetry(e,t,n){let r=typeof n==`boolean`?{kind:`cancelled`,languageId:t,nRenameSuggestionProviders:e}:{kind:`accepted`,languageId:t,nRenameSuggestionProviders:e,source:n.stats.source.k,nRenameSuggestions:n.stats.nRenameSuggestions,timeBeforeFirstInputFieldEdit:n.stats.timeBeforeFirstInputFieldEdit,wantsPreview:n.wantsPreview,nRenameSuggestionsInvocations:n.stats.nRenameSuggestionsInvocations,hadAutomaticRenameSuggestionsInvocation:n.stats.hadAutomaticRenameSuggestionsInvocation};this._telemetryService.publicLog2(`renameInvokedEvent`,r)}};cA=aA=rA([iA(1,Y),iA(2,Ro),iA(3,Ji),iA(4,ni),iA(5,Fc),iA(6,Yo),iA(7,V),iA(8,Zi)],cA);var lA=class extends N{constructor(){super({id:`editor.action.rename`,label:S(`rename.label`,`Rename Symbol`),alias:`Rename Symbol`,precondition:z.and(q.writable,q.hasRenameProvider),kbOpts:{kbExpr:q.editorTextFocus,primary:60,weight:100},contextMenuOpts:{group:`1_modification`,order:1.1}})}runCommand(e,t){let n=e.get(Ko),[i,a]=Array.isArray(t)&&t||[void 0,void 0];return y.isUri(i)&&r.isIPosition(a)?n.openCodeEditor({resource:i},n.getActiveCodeEditor()).then(e=>{e&&(e.setPosition(a),e.invokeWithinContext(t=>(this.reportTelemetry(t,e),this.run(t,e))))},C):super.runCommand(e,t)}run(e,t){let n=e.get(Fc),r=cA.get(t);return r?(n.trace(`[RenameAction] got controller, running...`),r.run()):(n.trace(`[RenameAction] returning early - controller missing`),Promise.resolve())}};I(cA.ID,cA,4),L(lA);var uA=la.bindToContribution(cA.get);P(new uA({id:`acceptRenameInput`,precondition:Qk,handler:e=>e.acceptRenameInput(!1),kbOpts:{weight:199,kbExpr:z.and(q.focus,z.not(`isComposing`)),primary:3}})),P(new uA({id:`acceptRenameInputWithPreview`,precondition:z.and(Qk,z.has(`config.editor.rename.enablePreview`)),handler:e=>e.acceptRenameInput(!0),kbOpts:{weight:199,kbExpr:z.and(q.focus,z.not(`isComposing`)),primary:2051}})),P(new uA({id:`cancelRenameInput`,precondition:Qk,handler:e=>e.cancelRenameInput(),kbOpts:{weight:199,kbExpr:q.focus,primary:9,secondary:[1033]}})),H(class extends Mo{constructor(){super({id:`focusNextRenameSuggestion`,title:{...x(`focusNextRenameSuggestion`,`Focus Next Rename Suggestion`)},precondition:Qk,keybinding:[{primary:18,weight:199}]})}run(e){let t=e.get(Ko).getFocusedCodeEditor();if(!t)return;let n=cA.get(t);n&&n.focusNextRenameSuggestion()}}),H(class extends Mo{constructor(){super({id:`focusPreviousRenameSuggestion`,title:{...x(`focusPreviousRenameSuggestion`,`Focus Previous Rename Suggestion`)},precondition:Qk,keybinding:[{primary:16,weight:199}]})}run(e){let t=e.get(Ko).getFocusedCodeEditor();if(!t)return;let n=cA.get(t);n&&n.focusPreviousRenameSuggestion()}}),Pi(`_executeDocumentRenameProvider`,function(e,t,n,...r){let[i]=r;o(typeof i==`string`);let{renameProvider:a}=e.get(V);return sA(a,t,n,i)}),Pi(`_executePrepareRename`,async function(e,t,n){let{renameProvider:r}=e.get(V),i=await new oA(t,n,r).resolveRenameLocation(w.None);if(i?.rejectReason)throw Error(i.rejectReason);return i}),un.as(Ea.Configuration).registerConfiguration({id:`editor`,properties:{"editor.rename.enablePreview":{scope:5,description:S(`enablePreview`,`Enable/disable the ability to preview changes before renaming`),default:!0,type:`boolean`}}});var dA=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},fA=function(e,t){return function(n,r){t(n,r,e)}},pA=class extends _{static#e=this.ID=`editor.sectionHeaderDetector`;constructor(e,t,n){super(),this.editor=e,this.languageConfigurationService=t,this.editorWorkerService=n,this.decorations=this.editor.createDecorationsCollection(),this.options=this.createOptions(e.getOption(73)),this.computePromise=null,this.currentOccurrences={},this._register(e.onDidChangeModel(t=>{this.currentOccurrences={},this.options=this.createOptions(e.getOption(73)),this.stop(),this.computeSectionHeaders.schedule(0)})),this._register(e.onDidChangeModelLanguage(t=>{this.currentOccurrences={},this.options=this.createOptions(e.getOption(73)),this.stop(),this.computeSectionHeaders.schedule(0)})),this._register(t.onDidChange(t=>{let n=this.editor.getModel()?.getLanguageId();n&&t.affects(n)&&(this.currentOccurrences={},this.options=this.createOptions(e.getOption(73)),this.stop(),this.computeSectionHeaders.schedule(0))})),this._register(e.onDidChangeConfiguration(t=>{this.options&&!t.hasChanged(73)||(this.options=this.createOptions(e.getOption(73)),this.updateDecorations([]),this.stop(),this.computeSectionHeaders.schedule(0))})),this._register(this.editor.onDidChangeModelContent(e=>{this.computeSectionHeaders.schedule()})),this._register(e.onDidChangeModelTokens(e=>{this.computeSectionHeaders.isScheduled()||this.computeSectionHeaders.schedule(1e3)})),this.computeSectionHeaders=this._register(new yt(()=>{this.findSectionHeaders()},250)),this.computeSectionHeaders.schedule(0)}createOptions(e){if(!e||!this.editor.hasModel())return;let t=this.editor.getModel().getLanguageId();if(!t)return;let n=this.languageConfigurationService.getLanguageConfiguration(t).comments,r=this.languageConfigurationService.getLanguageConfiguration(t).foldingRules;if(!(!n&&!r?.markers))return{foldingRules:r,findMarkSectionHeaders:e.showMarkSectionHeaders,findRegionSectionHeaders:e.showRegionSectionHeaders}}findSectionHeaders(){if(!this.editor.hasModel()||!this.options?.findMarkSectionHeaders&&!this.options?.findRegionSectionHeaders)return;let e=this.editor.getModel();if(e.isDisposed()||e.isTooLargeForSyncing())return;let t=e.getVersionId();this.editorWorkerService.findSectionHeaders(e.uri,this.options).then(n=>{e.isDisposed()||e.getVersionId()!==t||this.updateDecorations(n)})}updateDecorations(e){let t=this.editor.getModel();t&&(e=e.filter(e=>{if(!e.shouldBeInComments)return!0;let n=t.validateRange(e.range),r=t.tokenization.getLineTokens(n.startLineNumber),i=r.findTokenIndexAtOffset(n.startColumn-1),a=r.getStandardTokenType(i);return r.getLanguageId(i)===t.getLanguageId()&&a===1}));let n=Object.values(this.currentOccurrences).map(e=>e.decorationId),r=e.map(e=>mA(e));this.editor.changeDecorations(t=>{let i=t.deltaDecorations(n,r);this.currentOccurrences={};for(let t=0,n=i.length;t<n;t++){let n={sectionHeader:e[t],decorationId:i[t]};this.currentOccurrences[n.decorationId]=n}})}stop(){this.computeSectionHeaders.cancel(),this.computePromise&&=(this.computePromise.cancel(),null)}dispose(){super.dispose(),this.stop(),this.decorations.clear()}};pA=dA([fA(1,Ci),fA(2,pi)],pA);function mA(e){return{range:e.range,options:U.createDynamic({description:`section-header`,stickiness:3,collapseOnReplaceEdit:!0,minimap:{color:void 0,position:1,sectionHeaderStyle:e.hasSeparatorLine?2:1,sectionHeaderText:e.text}})}}I(pA.ID,pA,1);function hA(e){for(let t=0,n=e.length;t<n;t+=4){let n=e[t+0],r=e[t+1],i=e[t+2],a=e[t+3];e[t+0]=a,e[t+1]=i,e[t+2]=r,e[t+3]=n}}function gA(e){let t=new Uint8Array(e.buffer,e.byteOffset,e.length*4);return je()||hA(t),Vt.wrap(t)}function _A(e){let t=new Uint32Array(vA(e)),n=0;if(t[n++]=e.id,e.type===`full`)t[n++]=1,t[n++]=e.data.length,t.set(e.data,n),n+=e.data.length;else{t[n++]=2,t[n++]=e.deltas.length;for(let r of e.deltas)t[n++]=r.start,t[n++]=r.deleteCount,r.data?(t[n++]=r.data.length,t.set(r.data,n),n+=r.data.length):t[n++]=0}return gA(t)}function vA(e){let t=0;if(t+=2,e.type===`full`)t+=1+e.data.length;else{t+=1,t+=3*e.deltas.length;for(let n of e.deltas)n.data&&(t+=n.data.length)}return t}function yA(e){return e&&!!e.data}function bA(e){return e&&Array.isArray(e.edits)}var xA=class{constructor(e,t,n){this.provider=e,this.tokens=t,this.error=n}};function SA(e,t){return e.has(t)}function CA(e,t){let n=e.orderedGroups(t);return n.length>0?n[0]:[]}async function wA(e,t,n,r,i){let a=CA(e,t),o=await Promise.all(a.map(async e=>{let a,o=null;try{a=await e.provideDocumentSemanticTokens(t,e===n?r:null,i)}catch(e){o=e,a=null}return(!a||!yA(a)&&!bA(a))&&(a=null),new xA(e,a,o)}));for(let e of o){if(e.error)throw e.error;if(e.tokens)return e}return o.length>0?o[0]:null}function TA(e,t){let n=e.orderedGroups(t);return n.length>0?n[0]:null}var EA=class{constructor(e,t){this.provider=e,this.tokens=t}};function DA(e,t){return e.has(t)}function OA(e,t){let n=e.orderedGroups(t);return n.length>0?n[0]:[]}async function kA(e,t,n,r){let i=OA(e,t),a=await Promise.all(i.map(async e=>{let i;try{i=await e.provideDocumentRangeSemanticTokens(t,n,r)}catch(e){Re(e),i=null}return(!i||!yA(i))&&(i=null),new EA(e,i)}));for(let e of a)if(e.tokens)return e;return a.length>0?a[0]:null}B.registerCommand(`_provideDocumentSemanticTokensLegend`,async(e,...t)=>{let[n]=t;o(n instanceof y);let r=e.get(Ps).getModel(n);if(!r)return;let{documentSemanticTokensProvider:i}=e.get(V),a=TA(i,r);return a?a[0].getLegend():e.get(lc).executeCommand(`_provideDocumentRangeSemanticTokensLegend`,n)}),B.registerCommand(`_provideDocumentSemanticTokens`,async(e,...t)=>{let[n]=t;o(n instanceof y);let r=e.get(Ps).getModel(n);if(!r)return;let{documentSemanticTokensProvider:i}=e.get(V);if(!SA(i,r))return e.get(lc).executeCommand(`_provideDocumentRangeSemanticTokens`,n,r.getFullModelRange());let a=await wA(i,r,null,null,w.None);if(!a)return;let{provider:s,tokens:c}=a;if(!c||!yA(c))return;let l=_A({id:0,type:`full`,data:c.data});return c.resultId&&s.releaseDocumentSemanticTokens(c.resultId),l}),B.registerCommand(`_provideDocumentRangeSemanticTokensLegend`,async(e,...t)=>{let[n,r]=t;o(n instanceof y);let i=e.get(Ps).getModel(n);if(!i)return;let{documentRangeSemanticTokensProvider:a}=e.get(V),s=OA(a,i);if(s.length===0)return;if(s.length===1)return s[0].getLegend();if(!r||!T.isIRange(r))return console.warn(`provideDocumentRangeSemanticTokensLegend might be out-of-sync with provideDocumentRangeSemanticTokens unless a range argument is passed in`),s[0].getLegend();let c=await kA(a,i,T.lift(r),w.None);if(c)return c.provider.getLegend()}),B.registerCommand(`_provideDocumentRangeSemanticTokens`,async(e,...t)=>{let[n,r]=t;o(n instanceof y),o(T.isIRange(r));let i=e.get(Ps).getModel(n);if(!i)return;let{documentRangeSemanticTokensProvider:a}=e.get(V),s=await kA(a,i,T.lift(r),w.None);if(!(!s||!s.tokens))return _A({id:0,type:`full`,data:s.tokens.data})});function AA(e,t,n){let r=n.getValue(`editor.semanticHighlighting`,{overrideIdentifier:e.getLanguageId(),resource:e.uri})?.enabled;return typeof r==`boolean`?r:t.getColorTheme().semanticHighlighting}var jA=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},MA=function(e,t){return function(n,r){t(n,r,e)}},NA,PA=class extends _{constructor(e,t,n,r,i,a){super(),this._watchers=Object.create(null);let o=t=>{this._watchers[t.uri.toString()]=new FA(t,e,n,i,a)},s=(e,t)=>{t.dispose(),delete this._watchers[e.uri.toString()]},c=()=>{for(let e of t.getModels()){let t=this._watchers[e.uri.toString()];AA(e,n,r)?t||o(e):t&&s(e,t)}};t.getModels().forEach(e=>{AA(e,n,r)&&o(e)}),this._register(t.onModelAdded(e=>{AA(e,n,r)&&o(e)})),this._register(t.onModelRemoved(e=>{let t=this._watchers[e.uri.toString()];t&&s(e,t)})),this._register(r.onDidChangeConfiguration(e=>{e.affectsConfiguration(`editor.semanticHighlighting`)&&c()})),this._register(n.onDidColorThemeChange(c))}dispose(){for(let e of Object.values(this._watchers))e.dispose();super.dispose()}};PA=jA([MA(0,xo),MA(1,Ps),MA(2,Zc),MA(3,F),MA(4,Qi),MA(5,V)],PA);var FA=class extends _{static#e=NA=this;static#t=this.REQUEST_MIN_DELAY=300;static#n=this.REQUEST_MAX_DELAY=2e3;constructor(e,t,n,r,i){super(),this._semanticTokensStylingService=t,this._isDisposed=!1,this._model=e,this._provider=i.documentSemanticTokensProvider,this._debounceInformation=r.for(this._provider,`DocumentSemanticTokens`,{min:NA.REQUEST_MIN_DELAY,max:NA.REQUEST_MAX_DELAY}),this._fetchDocumentSemanticTokens=this._register(new yt(()=>this._fetchDocumentSemanticTokensNow(),NA.REQUEST_MIN_DELAY)),this._currentDocumentResponse=null,this._currentDocumentRequestCancellationTokenSource=null,this._documentProvidersChangeListeners=[],this._providersChangedDuringRequest=!1,this._register(this._model.onDidChangeContent(()=>{this._fetchDocumentSemanticTokens.isScheduled()||this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))})),this._register(this._model.onDidChangeAttached(()=>{this._fetchDocumentSemanticTokens.isScheduled()||this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))})),this._register(this._model.onDidChangeLanguage(()=>{this._currentDocumentResponse&&=(this._currentDocumentResponse.dispose(),null),this._currentDocumentRequestCancellationTokenSource&&=(this._currentDocumentRequestCancellationTokenSource.cancel(),null),this._setDocumentSemanticTokens(null,null,null,[]),this._fetchDocumentSemanticTokens.schedule(0)}));let a=()=>{c(this._documentProvidersChangeListeners),this._documentProvidersChangeListeners=[];for(let t of this._provider.all(e))typeof t.onDidChange==`function`&&this._documentProvidersChangeListeners.push(t.onDidChange(()=>{if(this._currentDocumentRequestCancellationTokenSource){this._providersChangedDuringRequest=!0;return}this._fetchDocumentSemanticTokens.schedule(0)}))};a(),this._register(this._provider.onDidChange(()=>{a(),this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))})),this._register(n.onDidColorThemeChange(e=>{this._setDocumentSemanticTokens(null,null,null,[]),this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))})),this._fetchDocumentSemanticTokens.schedule(0)}dispose(){this._currentDocumentResponse&&=(this._currentDocumentResponse.dispose(),null),this._currentDocumentRequestCancellationTokenSource&&=(this._currentDocumentRequestCancellationTokenSource.cancel(),null),c(this._documentProvidersChangeListeners),this._documentProvidersChangeListeners=[],this._setDocumentSemanticTokens(null,null,null,[]),this._isDisposed=!0,super.dispose()}_fetchDocumentSemanticTokensNow(){if(this._currentDocumentRequestCancellationTokenSource)return;if(!SA(this._provider,this._model)){this._currentDocumentResponse&&this._model.tokenization.setSemanticTokens(null,!1);return}if(!this._model.isAttachedToEditor())return;let e=new ie,t=this._currentDocumentResponse?this._currentDocumentResponse.provider:null,n=this._currentDocumentResponse&&this._currentDocumentResponse.resultId||null,r=wA(this._provider,this._model,t,n,e.token);this._currentDocumentRequestCancellationTokenSource=e,this._providersChangedDuringRequest=!1;let i=[],a=this._model.onDidChangeContent(e=>{i.push(e)}),o=new u(!1);r.then(e=>{if(this._debounceInformation.update(this._model,o.elapsed()),this._currentDocumentRequestCancellationTokenSource=null,a.dispose(),!e)this._setDocumentSemanticTokens(null,null,null,i);else{let{provider:t,tokens:n}=e,r=this._semanticTokensStylingService.getStyling(t);this._setDocumentSemanticTokens(t,n||null,r,i)}},e=>{e&&(pe(e)||typeof e.message==`string`&&e.message.indexOf(`busy`)!==-1)||C(e),this._currentDocumentRequestCancellationTokenSource=null,a.dispose(),(i.length>0||this._providersChangedDuringRequest)&&(this._fetchDocumentSemanticTokens.isScheduled()||this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model)))})}static _copy(e,t,n,r,i){i=Math.min(i,n.length-r,e.length-t);for(let a=0;a<i;a++)n[r+a]=e[t+a]}_setDocumentSemanticTokens(e,t,n,r){let i=this._currentDocumentResponse,a=()=>{(r.length>0||this._providersChangedDuringRequest)&&!this._fetchDocumentSemanticTokens.isScheduled()&&this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))};if(this._currentDocumentResponse&&=(this._currentDocumentResponse.dispose(),null),this._isDisposed){e&&t&&e.releaseDocumentSemanticTokens(t.resultId);return}if(!e||!n){this._model.tokenization.setSemanticTokens(null,!1);return}if(!t){this._model.tokenization.setSemanticTokens(null,!0),a();return}if(bA(t)){if(!i){this._model.tokenization.setSemanticTokens(null,!0);return}if(t.edits.length===0)t={resultId:t.resultId,data:i.data};else{let e=0;for(let n of t.edits)e+=(n.data?n.data.length:0)-n.deleteCount;let r=i.data,a=new Uint32Array(r.length+e),o=r.length,s=a.length;for(let e=t.edits.length-1;e>=0;e--){let c=t.edits[e];if(c.start>r.length){n.warnInvalidEditStart(i.resultId,t.resultId,e,c.start,r.length),this._model.tokenization.setSemanticTokens(null,!0);return}let l=o-(c.start+c.deleteCount);l>0&&(NA._copy(r,o-l,a,s-l,l),s-=l),c.data&&(NA._copy(c.data,0,a,s-c.data.length,c.data.length),s-=c.data.length),o=c.start}o>0&&NA._copy(r,0,a,0,o),t={resultId:t.resultId,data:a}}}if(yA(t)){this._currentDocumentResponse=new IA(e,t.resultId,t.data);let i=Fi(t,n,this._model.getLanguageId());if(r.length>0)for(let e of r)for(let t of i)for(let n of e.changes)t.applyEdit(n.range,n.text);this._model.tokenization.setSemanticTokens(i,!0)}else this._model.tokenization.setSemanticTokens(null,!0);a()}};FA=NA=jA([MA(1,xo),MA(2,Zc),MA(3,Qi),MA(4,V)],FA);var IA=class{constructor(e,t,n){this.provider=e,this.resultId=t,this.data=n}dispose(){this.provider.releaseDocumentSemanticTokens(this.resultId)}};wl(PA);var LA=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},RA=function(e,t){return function(n,r){t(n,r,e)}},zA=class extends _{static#e=this.ID=`editor.contrib.viewportSemanticTokens`;constructor(e,t,n,r,i,a){super(),this._semanticTokensStylingService=t,this._themeService=n,this._configurationService=r,this._editor=e,this._provider=a.documentRangeSemanticTokensProvider,this._debounceInformation=i.for(this._provider,`DocumentRangeSemanticTokens`,{min:100,max:500}),this._tokenizeViewport=this._register(new yt(()=>this._tokenizeViewportNow(),100)),this._outstandingRequests=[];let o=()=>{this._editor.hasModel()&&this._tokenizeViewport.schedule(this._debounceInformation.get(this._editor.getModel()))};this._register(this._editor.onDidScrollChange(()=>{o()})),this._register(this._editor.onDidChangeModel(()=>{this._cancelAll(),o()})),this._register(this._editor.onDidChangeModelContent(e=>{this._cancelAll(),o()})),this._register(this._provider.onDidChange(()=>{this._cancelAll(),o()})),this._register(this._configurationService.onDidChangeConfiguration(e=>{e.affectsConfiguration(`editor.semanticHighlighting`)&&(this._cancelAll(),o())})),this._register(this._themeService.onDidColorThemeChange(()=>{this._cancelAll(),o()})),o()}_cancelAll(){for(let e of this._outstandingRequests)e.cancel();this._outstandingRequests=[]}_removeOutstandingRequest(e){for(let t=0,n=this._outstandingRequests.length;t<n;t++)if(this._outstandingRequests[t]===e){this._outstandingRequests.splice(t,1);return}}_tokenizeViewportNow(){if(!this._editor.hasModel())return;let e=this._editor.getModel();if(e.tokenization.hasCompleteSemanticTokens())return;if(!AA(e,this._themeService,this._configurationService)){e.tokenization.hasSomeSemanticTokens()&&e.tokenization.setSemanticTokens(null,!1);return}if(!DA(this._provider,e)){e.tokenization.hasSomeSemanticTokens()&&e.tokenization.setSemanticTokens(null,!1);return}let t=this._editor.getVisibleRangesPlusViewportAboveBelow();this._outstandingRequests=this._outstandingRequests.concat(t.map(t=>this._requestRange(e,t)))}_requestRange(e,t){let n=e.getVersionId(),r=et(n=>Promise.resolve(kA(this._provider,e,t,n))),i=new u(!1);return r.then(r=>{if(this._debounceInformation.update(e,i.elapsed()),!r||!r.tokens||e.isDisposed()||e.getVersionId()!==n)return;let{provider:a,tokens:o}=r,s=this._semanticTokensStylingService.getStyling(a);e.tokenization.setPartialSemanticTokens(t,Fi(o,s,e.getLanguageId()))}).then(()=>this._removeOutstandingRequest(r),()=>this._removeOutstandingRequest(r)),r}};zA=LA([RA(1,xo),RA(2,Zc),RA(3,F),RA(4,Qi),RA(5,V)],zA),I(zA.ID,zA,1);var BA=class{constructor(e=!0){this.selectSubwords=e}provideSelectionRanges(e,t){let n=[];for(let r of t){let t=[];n.push(t),this.selectSubwords&&this._addInWordRanges(t,e,r),this._addWordRanges(t,e,r),this._addWhitespaceLine(t,e,r),t.push({range:e.getFullModelRange()})}return n}_addInWordRanges(e,t,n){let r=t.getWordAtPosition(n);if(!r)return;let{word:i,startColumn:a}=r,o=n.column-a,s=o,c=o,l=0;for(;s>=0;s--){let e=i.charCodeAt(s);if(s!==o&&(e===95||e===45)||ar(e)&&jr(l))break;l=e}for(s+=1;c<i.length;c++){let e=i.charCodeAt(c);if(jr(e)&&ar(l)||e===95||e===45)break;l=e}s<c&&e.push({range:new T(n.lineNumber,a+s,n.lineNumber,a+c)})}_addWordRanges(e,t,n){let r=t.getWordAtPosition(n);r&&e.push({range:new T(n.lineNumber,r.startColumn,n.lineNumber,r.endColumn)})}_addWhitespaceLine(e,t,n){t.getLineLength(n.lineNumber)>0&&t.getLineFirstNonWhitespaceColumn(n.lineNumber)===0&&t.getLineLastNonWhitespaceColumn(n.lineNumber)===0&&e.push({range:new T(n.lineNumber,1,n.lineNumber,t.getLineMaxColumn(n.lineNumber))})}},VA=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},HA=function(e,t){return function(n,r){t(n,r,e)}},UA,WA=class e{constructor(e,t){this.index=e,this.ranges=t}mov(t){let n=this.index+(t?1:-1);if(n<0||n>=this.ranges.length)return this;let r=new e(n,this.ranges);return r.ranges[n].equalsRange(this.ranges[this.index])?r.mov(t):r}},GA=class{static#e=UA=this;static#t=this.ID=`editor.contrib.smartSelectController`;static get(e){return e.getContribution(UA.ID)}constructor(e,t){this._editor=e,this._languageFeaturesService=t,this._ignoreSelection=!1}dispose(){this._selectionListener?.dispose()}async run(e){if(!this._editor.hasModel())return;let t=this._editor.getSelections(),n=this._editor.getModel();if(this._state||await YA(this._languageFeaturesService.selectionRangeProvider,n,t.map(e=>e.getPosition()),this._editor.getOption(114),w.None).then(e=>{if(!(!On(e)||e.length!==t.length)&&!(!this._editor.hasModel()||!Ut(this._editor.getSelections(),t,(e,t)=>e.equalsSelection(t)))){for(let n=0;n<e.length;n++)e[n]=e[n].filter(e=>e.containsPosition(t[n].getStartPosition())&&e.containsPosition(t[n].getEndPosition())),e[n].unshift(t[n]);this._state=e.map(e=>new WA(0,e)),this._selectionListener?.dispose(),this._selectionListener=this._editor.onDidChangeCursorPosition(()=>{this._ignoreSelection||(this._selectionListener?.dispose(),this._state=void 0)})}}),!this._state)return;this._state=this._state.map(t=>t.mov(e));let r=this._state.map(e=>v.fromPositions(e.ranges[e.index].getStartPosition(),e.ranges[e.index].getEndPosition()));this._ignoreSelection=!0;try{this._editor.setSelections(r)}finally{this._ignoreSelection=!1}}};GA=UA=VA([HA(1,V)],GA);var KA=class extends N{constructor(e,t){super(t),this._forward=e}async run(e,t){let n=GA.get(t);n&&await n.run(this._forward)}},qA=class extends KA{constructor(){super(!0,{id:`editor.action.smartSelect.expand`,label:S(`smartSelect.expand`,`Expand Selection`),alias:`Expand Selection`,precondition:void 0,kbOpts:{kbExpr:q.editorTextFocus,primary:1553,mac:{primary:3345,secondary:[1297]},weight:100},menuOpts:{menuId:R.MenubarSelectionMenu,group:`1_basic`,title:S({key:`miSmartSelectGrow`,comment:[`&& denotes a mnemonic`]},`&&Expand Selection`),order:2}})}};B.registerCommandAlias(`editor.action.smartSelect.grow`,`editor.action.smartSelect.expand`);var JA=class extends KA{constructor(){super(!1,{id:`editor.action.smartSelect.shrink`,label:S(`smartSelect.shrink`,`Shrink Selection`),alias:`Shrink Selection`,precondition:void 0,kbOpts:{kbExpr:q.editorTextFocus,primary:1551,mac:{primary:3343,secondary:[1295]},weight:100},menuOpts:{menuId:R.MenubarSelectionMenu,group:`1_basic`,title:S({key:`miSmartSelectShrink`,comment:[`&& denotes a mnemonic`]},`&&Shrink Selection`),order:3}})}};I(GA.ID,GA,4),L(qA),L(JA);async function YA(e,t,n,i,a){let o=e.all(t).concat(new BA(i.selectSubwords));o.length===1&&o.unshift(new OC);let s=[],c=[];for(let e of o)s.push(Promise.resolve(e.provideSelectionRanges(t,n,a)).then(e=>{if(On(e)&&e.length===n.length)for(let t=0;t<n.length;t++){c[t]||(c[t]=[]);for(let r of e[t])T.isIRange(r.range)&&T.containsPosition(r.range,n[t])&&c[t].push(T.lift(r.range))}},Re));return await Promise.all(s),c.map(e=>{if(e.length===0)return[];e.sort((e,t)=>r.isBefore(e.getStartPosition(),t.getStartPosition())?1:r.isBefore(t.getStartPosition(),e.getStartPosition())||r.isBefore(e.getEndPosition(),t.getEndPosition())?-1:r.isBefore(t.getEndPosition(),e.getEndPosition())?1:0);let n=[],a;for(let t of e)(!a||T.containsRange(t,a)&&!T.equalsRange(t,a))&&(n.push(t),a=t);if(!i.selectLeadingAndTrailingWhitespace)return n;let o=[n[0]];for(let e=1;e<n.length;e++){let r=n[e-1],i=n[e];if(i.startLineNumber!==r.startLineNumber||i.endLineNumber!==r.endLineNumber){let e=new T(r.startLineNumber,t.getLineFirstNonWhitespaceColumn(r.startLineNumber),r.endLineNumber,t.getLineLastNonWhitespaceColumn(r.endLineNumber));e.containsRange(r)&&!e.equalsRange(r)&&i.containsRange(e)&&!i.equalsRange(e)&&o.push(e);let n=new T(r.startLineNumber,1,r.endLineNumber,t.getLineMaxColumn(r.endLineNumber));n.containsRange(r)&&!n.equalsRange(e)&&i.containsRange(n)&&!i.equalsRange(n)&&o.push(n)}o.push(i)}return o})}B.registerCommand(`_executeSelectionRangeProvider`,async function(e,...t){let[n,r]=t;o(y.isUri(n));let i=e.get(V).selectionRangeProvider,a=await e.get(Bs).createModelReference(n);try{return YA(i,a.object.textEditorModel,r,{selectLeadingAndTrailingWhitespace:!0,selectSubwords:!0},w.None)}finally{a.dispose()}});const XA=Object.freeze({View:x(`view`,`View`),Help:x(`help`,`Help`),Test:x(`test`,`Test`),File:x(`file`,`File`),Preferences:x(`preferences`,`Preferences`),Developer:x({key:`developer`,comment:[`A developer on Code itself or someone diagnosing issues in Code`]},`Developer`)});var ZA=class e{constructor(e,t,n,r=null){this.startLineNumbers=e,this.endLineNumbers=t,this.lastLineRelativePosition=n,this.showEndForLine=r}equals(e){return!!e&&this.lastLineRelativePosition===e.lastLineRelativePosition&&this.showEndForLine===e.showEndForLine&&Ut(this.startLineNumbers,e.startLineNumbers)&&Ut(this.endLineNumbers,e.endLineNumbers)}static get Empty(){return new e([],[],0)}},QA=Ma(`stickyScrollViewLayer`,{createHTML:e=>e}),$A=`data-sticky-line-index`,ej=`data-sticky-is-line`,tj=`data-sticky-is-line-number`,nj=`data-sticky-is-folding-icon`,rj=class extends _{constructor(e){super(),this._editor=e,this._foldingIconStore=new n,this._rootDomNode=document.createElement(`div`),this._lineNumbersDomNode=document.createElement(`div`),this._linesDomNodeScrollable=document.createElement(`div`),this._linesDomNode=document.createElement(`div`),this._lineHeight=this._editor.getOption(67),this._renderedStickyLines=[],this._lineNumbers=[],this._lastLineRelativePosition=0,this._minContentWidthInPx=0,this._isOnGlyphMargin=!1,this._lineNumbersDomNode.className=`sticky-widget-line-numbers`,this._lineNumbersDomNode.setAttribute(`role`,`none`),this._linesDomNode.className=`sticky-widget-lines`,this._linesDomNode.setAttribute(`role`,`list`),this._linesDomNodeScrollable.className=`sticky-widget-lines-scrollable`,this._linesDomNodeScrollable.appendChild(this._linesDomNode),this._rootDomNode.className=`sticky-widget`,this._rootDomNode.classList.toggle(`peek`,e instanceof Ph),this._rootDomNode.appendChild(this._lineNumbersDomNode),this._rootDomNode.appendChild(this._linesDomNodeScrollable);let t=()=>{this._linesDomNode.style.left=this._editor.getOption(116).scrollWithEditor?`-${this._editor.getScrollLeft()}px`:`0px`};this._register(this._editor.onDidChangeConfiguration(e=>{e.hasChanged(116)&&t(),e.hasChanged(67)&&(this._lineHeight=this._editor.getOption(67))})),this._register(this._editor.onDidScrollChange(e=>{e.scrollLeftChanged&&t(),e.scrollWidthChanged&&this._updateWidgetWidth()})),this._register(this._editor.onDidChangeModel(()=>{t(),this._updateWidgetWidth()})),this._register(this._foldingIconStore),t(),this._register(this._editor.onDidLayoutChange(e=>{this._updateWidgetWidth()})),this._updateWidgetWidth()}get lineNumbers(){return this._lineNumbers}get lineNumberCount(){return this._lineNumbers.length}getRenderedStickyLine(e){return this._renderedStickyLines.find(t=>t.lineNumber===e)}getCurrentLines(){return this._lineNumbers}setState(e,t,n){if(n===void 0&&(!this._previousState&&!e||this._previousState&&this._previousState.equals(e)))return;let r=this._isWidgetHeightZero(e),i=r?void 0:e,a=r?0:this._findLineToRebuildWidgetFrom(e,n);this._renderRootNode(i,t,a),this._previousState=e}_isWidgetHeightZero(e){if(!e)return!0;let t=e.startLineNumbers.length*this._lineHeight+e.lastLineRelativePosition;if(t>0){this._lastLineRelativePosition=e.lastLineRelativePosition;let t=[...e.startLineNumbers];e.showEndForLine!==null&&(t[e.showEndForLine]=e.endLineNumbers[e.showEndForLine]),this._lineNumbers=t}else this._lastLineRelativePosition=0,this._lineNumbers=[];return t===0}_findLineToRebuildWidgetFrom(e,t){if(!e||!this._previousState)return 0;if(t!==void 0)return t;let n=this._previousState,r=e.startLineNumbers.findIndex(e=>!n.startLineNumbers.includes(e));return r===-1?0:r}_updateWidgetWidth(){let e=this._editor.getLayoutInfo(),t=e.contentLeft;this._lineNumbersDomNode.style.width=`${t}px`,this._linesDomNodeScrollable.style.setProperty(`--vscode-editorStickyScroll-scrollableWidth`,`${this._editor.getScrollWidth()-e.verticalScrollbarWidth}px`),this._rootDomNode.style.width=`${e.width-e.verticalScrollbarWidth}px`}_clearStickyLinesFromLine(e){this._foldingIconStore.clear();for(let t=e;t<this._renderedStickyLines.length;t++){let e=this._renderedStickyLines[t];e.lineNumberDomNode.remove(),e.lineDomNode.remove()}this._renderedStickyLines=this._renderedStickyLines.slice(0,e),this._rootDomNode.style.display=`none`}_useFoldingOpacityTransition(e){this._lineNumbersDomNode.style.setProperty(`--vscode-editorStickyScroll-foldingOpacityTransition`,`opacity ${e?.5:0}s`)}_setFoldingIconsVisibility(e){for(let t of this._renderedStickyLines){let n=t.foldingIcon;n&&n.setVisible(e?!0:n.isCollapsed)}}async _renderRootNode(e,t,n){if(this._clearStickyLinesFromLine(n),!e)return;for(let e of this._renderedStickyLines)this._updateTopAndZIndexOfStickyLine(e);let r=this._editor.getLayoutInfo(),i=this._lineNumbers.slice(n);for(let[e,a]of i.entries()){let i=this._renderChildNode(e+n,a,t,r);i&&(this._linesDomNode.appendChild(i.lineDomNode),this._lineNumbersDomNode.appendChild(i.lineNumberDomNode),this._renderedStickyLines.push(i))}t&&(this._setFoldingHoverListeners(),this._useFoldingOpacityTransition(!this._isOnGlyphMargin));let a=this._lineNumbers.length*this._lineHeight+this._lastLineRelativePosition;this._rootDomNode.style.display=`block`,this._lineNumbersDomNode.style.height=`${a}px`,this._linesDomNodeScrollable.style.height=`${a}px`,this._rootDomNode.style.height=`${a}px`,this._rootDomNode.style.marginLeft=`0px`,this._minContentWidthInPx=Math.max(...this._renderedStickyLines.map(e=>e.scrollWidth))+r.verticalScrollbarWidth,this._editor.layoutOverlayWidget(this)}_setFoldingHoverListeners(){this._editor.getOption(111)===`mouseover`&&(this._foldingIconStore.add(D(this._lineNumbersDomNode,j.MOUSE_ENTER,()=>{this._isOnGlyphMargin=!0,this._setFoldingIconsVisibility(!0)})),this._foldingIconStore.add(D(this._lineNumbersDomNode,j.MOUSE_LEAVE,()=>{this._isOnGlyphMargin=!1,this._useFoldingOpacityTransition(!0),this._setFoldingIconsVisibility(!1)})))}_renderChildNode(e,t,n,i){let a=this._editor._getViewModel();if(!a)return;let o=a.coordinatesConverter.convertModelPositionToViewPosition(new r(t,1)).lineNumber,s=a.getViewLineRenderingData(o),c=this._editor.getOption(68),l;try{l=Ht.filter(s.inlineDecorations,o,s.minColumn,s.maxColumn)}catch{l=[]}let u=new Zt(!0,!0,s.content,s.continuesWithWrappedLine,s.isBasicASCII,s.containsRTL,0,s.tokens,l,s.tabSize,s.startVisibleColumn,1,1,1,500,`none`,!0,!0,null),d=new $t(2e3),f=rt(u,d),p;p=QA?QA.createHTML(d.build()):d.build();let m=document.createElement(`span`);m.setAttribute($A,String(e)),m.setAttribute(ej,``),m.setAttribute(`role`,`listitem`),m.tabIndex=0,m.className=`sticky-line-content`,m.classList.add(`stickyLine${t}`),m.style.lineHeight=`${this._lineHeight}px`,m.innerHTML=p;let h=document.createElement(`span`);h.setAttribute($A,String(e)),h.setAttribute(tj,``),h.className=`sticky-line-number`,h.style.lineHeight=`${this._lineHeight}px`;let g=i.contentLeft;h.style.width=`${g}px`;let ee=document.createElement(`span`);c.renderType===1||c.renderType===3&&t%10==0?ee.innerText=t.toString():c.renderType===2&&(ee.innerText=Math.abs(t-this._editor.getPosition().lineNumber).toString()),ee.className=`sticky-line-number-inner`,ee.style.lineHeight=`${this._lineHeight}px`,ee.style.width=`${i.lineNumbersWidth}px`,ee.style.paddingLeft=`${i.lineNumbersLeft}px`,h.appendChild(ee);let te=this._renderFoldingIconForLine(n,t);te&&h.appendChild(te.domNode),this._editor.applyFontInfo(m),this._editor.applyFontInfo(ee),h.style.lineHeight=`${this._lineHeight}px`,m.style.lineHeight=`${this._lineHeight}px`,h.style.height=`${this._lineHeight}px`,m.style.height=`${this._lineHeight}px`;let _=new ij(e,t,m,h,te,f.characterMapping,m.scrollWidth);return this._updateTopAndZIndexOfStickyLine(_)}_updateTopAndZIndexOfStickyLine(e){let t=e.index,n=e.lineDomNode,r=e.lineNumberDomNode,i=t===this._lineNumbers.length-1;n.style.zIndex=i?`0`:`1`,r.style.zIndex=i?`0`:`1`;let a=`${t*this._lineHeight+this._lastLineRelativePosition+(e.foldingIcon?.isCollapsed?1:0)}px`,o=`${t*this._lineHeight}px`;return n.style.top=i?a:o,r.style.top=i?a:o,e}_renderFoldingIconForLine(e,t){let n=this._editor.getOption(111);if(!e||n===`never`)return;let r=e.regions,i=r.findRange(t),a=r.getStartLineNumber(i);if(t!==a)return;let o=r.isCollapsed(i),s=new aj(o,a,r.getEndLineNumber(i),this._lineHeight);return s.setVisible(this._isOnGlyphMargin?!0:o||n===`always`),s.domNode.setAttribute(nj,``),s}getId(){return`editor.contrib.stickyScrollWidget`}getDomNode(){return this._rootDomNode}getPosition(){return{preference:2,stackOridinal:10}}getMinContentWidthInPx(){return this._minContentWidthInPx}focusLineWithIndex(e){0<=e&&e<this._renderedStickyLines.length&&this._renderedStickyLines[e].lineDomNode.focus()}getEditorPositionFromNode(e){if(!e||e.children.length>0)return null;let t=this._getRenderedStickyLineFromChildDomNode(e);if(!t)return null;let n=tr(t.characterMapping,e,0);return new r(t.lineNumber,n)}getLineNumberFromChildDomNode(e){return this._getRenderedStickyLineFromChildDomNode(e)?.lineNumber??null}_getRenderedStickyLineFromChildDomNode(e){let t=this.getLineIndexFromChildDomNode(e);return t===null||t<0||t>=this._renderedStickyLines.length?null:this._renderedStickyLines[t]}getLineIndexFromChildDomNode(e){let t=this._getAttributeValue(e,$A);return t?parseInt(t,10):null}isInStickyLine(e){return this._getAttributeValue(e,ej)!==void 0}isInFoldingIconDomNode(e){return this._getAttributeValue(e,nj)!==void 0}_getAttributeValue(e,t){for(;e&&e!==this._rootDomNode;){let n=e.getAttribute(t);if(n!==null)return n;e=e.parentElement}}},ij=class{constructor(e,t,n,r,i,a,o){this.index=e,this.lineNumber=t,this.lineDomNode=n,this.lineNumberDomNode=r,this.foldingIcon=i,this.characterMapping=a,this.scrollWidth=o}},aj=class{constructor(e,t,n,r){this.isCollapsed=e,this.foldingStartLine=t,this.foldingEndLine=n,this.dimension=r,this.domNode=document.createElement(`div`),this.domNode.style.width=`${r}px`,this.domNode.style.height=`${r}px`,this.domNode.className=J.asClassName(e?Tb:wb)}setVisible(e){this.domNode.style.cursor=e?`pointer`:`default`,this.domNode.style.opacity=e?`1`:`0`}},oj=class{constructor(e,t){this.startLineNumber=e,this.endLineNumber=t}},sj=class{constructor(e,t,n){this.range=e,this.children=t,this.parent=n}},cj=class{constructor(e,t,n,r){this.uri=e,this.version=t,this.element=n,this.outlineProviderId=r}},lj=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},uj=function(e,t){return function(n,r){t(n,r,e)}},dj;(function(e){e.OUTLINE_MODEL=`outlineModel`,e.FOLDING_PROVIDER_MODEL=`foldingProviderModel`,e.INDENTATION_MODEL=`indentationModel`})(dj||={});var fj;(function(e){e[e.VALID=0]=`VALID`,e[e.INVALID=1]=`INVALID`,e[e.CANCELED=2]=`CANCELED`})(fj||={});var pj=class extends _{constructor(e,t,r,i){switch(super(),this._editor=e,this._modelProviders=[],this._modelPromise=null,this._updateScheduler=this._register(new Nt(300)),this._updateOperation=this._register(new n),this._editor.getOption(116).defaultModel){case dj.OUTLINE_MODEL:this._modelProviders.push(new hj(this._editor,i));case dj.FOLDING_PROVIDER_MODEL:this._modelProviders.push(new vj(this._editor,t,i));case dj.INDENTATION_MODEL:this._modelProviders.push(new _j(this._editor,r));break}}dispose(){this._modelProviders.forEach(e=>e.dispose()),this._updateOperation.clear(),this._cancelModelPromise(),super.dispose()}_cancelModelPromise(){this._modelPromise&&=(this._modelPromise.cancel(),null)}async update(e){return this._updateOperation.clear(),this._updateOperation.add({dispose:()=>{this._cancelModelPromise(),this._updateScheduler.cancel()}}),this._cancelModelPromise(),await this._updateScheduler.trigger(async()=>{for(let t of this._modelProviders){let{statusPromise:n,modelPromise:r}=t.computeStickyModel(e);this._modelPromise=r;let i=await n;if(this._modelPromise!==r)return null;switch(i){case fj.CANCELED:return this._updateOperation.clear(),null;case fj.VALID:return t.stickyModel}}return null}).catch(e=>(C(e),null))}};pj=lj([uj(2,Y),uj(3,V)],pj);var mj=class extends _{constructor(e){super(),this._editor=e,this._stickyModel=null}get stickyModel(){return this._stickyModel}_invalid(){return this._stickyModel=null,fj.INVALID}computeStickyModel(e){if(e.isCancellationRequested||!this.isProviderValid())return{statusPromise:this._invalid(),modelPromise:null};let t=et(e=>this.createModelFromProvider(e));return{statusPromise:t.then(t=>this.isModelValid(t)?e.isCancellationRequested?fj.CANCELED:(this._stickyModel=this.createStickyModel(e,t),fj.VALID):this._invalid()).then(void 0,e=>(C(e),fj.CANCELED)),modelPromise:t}}isModelValid(e){return!0}isProviderValid(){return!0}},hj=class extends mj{constructor(e,t){super(e),this._languageFeaturesService=t}createModelFromProvider(e){return Ex.create(this._languageFeaturesService.documentSymbolProvider,this._editor.getModel(),e)}createStickyModel(e,t){let{stickyOutlineElement:n,providerID:r}=this._stickyModelFromOutlineModel(t,this._stickyModel?.outlineProviderId),i=this._editor.getModel();return new cj(i.uri,i.getVersionId(),n,r)}isModelValid(e){return e&&e.children.size>0}_stickyModelFromOutlineModel(e,t){let n;if(ue.first(e.children.values())instanceof Tx){let r=ue.find(e.children.values(),e=>e.id===t);if(r)n=r.children;else{let r=``,i=-1,a;for(let[t,n]of e.children.entries()){let e=this._findSumOfRangesOfGroup(n);e>i&&(a=n,i=e,r=n.id)}t=r,n=a.children}}else n=e.children;let r=[],i=Array.from(n.values()).sort((e,t)=>{let n=new oj(e.symbol.range.startLineNumber,e.symbol.range.endLineNumber),r=new oj(t.symbol.range.startLineNumber,t.symbol.range.endLineNumber);return this._comparator(n,r)});for(let e of i)r.push(this._stickyModelFromOutlineElement(e,e.symbol.selectionRange.startLineNumber));return{stickyOutlineElement:new sj(void 0,r,void 0),providerID:t}}_stickyModelFromOutlineElement(e,t){let n=[];for(let r of e.children.values())if(r.symbol.selectionRange.startLineNumber!==r.symbol.range.endLineNumber)if(r.symbol.selectionRange.startLineNumber!==t)n.push(this._stickyModelFromOutlineElement(r,r.symbol.selectionRange.startLineNumber));else for(let e of r.children.values())n.push(this._stickyModelFromOutlineElement(e,r.symbol.selectionRange.startLineNumber));return n.sort((e,t)=>this._comparator(e.range,t.range)),new sj(new oj(e.symbol.selectionRange.startLineNumber,e.symbol.range.endLineNumber),n,void 0)}_comparator(e,t){return e.startLineNumber===t.startLineNumber?t.endLineNumber-e.endLineNumber:e.startLineNumber-t.startLineNumber}_findSumOfRangesOfGroup(e){let t=0;for(let n of e.children.values())t+=this._findSumOfRangesOfGroup(n);return e instanceof wx?t+e.symbol.range.endLineNumber-e.symbol.selectionRange.startLineNumber:t}};hj=lj([uj(1,V)],hj);var gj=class extends mj{constructor(e){super(e),this._foldingLimitReporter=new Ub(e)}createStickyModel(e,t){let n=this._fromFoldingRegions(t),r=this._editor.getModel();return new cj(r.uri,r.getVersionId(),n,void 0)}isModelValid(e){return e!==null}_fromFoldingRegions(e){let t=e.length,n=[],r=new sj(void 0,[],void 0);for(let i=0;i<t;i++){let t=e.getParentIndex(i),a;a=t===-1?r:n[t];let o=new sj(new oj(e.getStartLineNumber(i),e.getEndLineNumber(i)+1),[],a);a.children.push(o),n.push(o)}return r}},_j=class extends gj{constructor(e,t){super(e),this._languageConfigurationService=t,this.provider=this._register(new yb(e.getModel(),this._languageConfigurationService,this._foldingLimitReporter))}async createModelFromProvider(e){return this.provider.compute(e)}};_j=lj([uj(1,Ci)],_j);var vj=class extends gj{constructor(e,t,n){super(e),this._languageFeaturesService=n;let r=Hb.getFoldingRangeProviders(this._languageFeaturesService,e.getModel());r.length>0&&(this.provider=this._register(new Pb(e.getModel(),r,t,this._foldingLimitReporter,void 0)))}isProviderValid(){return this.provider!==void 0}async createModelFromProvider(e){return this.provider?.compute(e)??null}};vj=lj([uj(2,V)],vj);var yj=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},bj=function(e,t){return function(n,r){t(n,r,e)}},xj=class{constructor(e,t,n){this.startLineNumber=e,this.endLineNumber=t,this.nestingDepth=n}},Sj=class extends _{constructor(e,t,r){super(),this._languageFeaturesService=t,this._languageConfigurationService=r,this._onDidChangeStickyScroll=this._register(new g),this.onDidChangeStickyScroll=this._onDidChangeStickyScroll.event,this._model=null,this._cts=null,this._stickyModelProvider=null,this._editor=e,this._sessionStore=this._register(new n),this._updateSoon=this._register(new yt(()=>this.update(),50)),this._register(this._editor.onDidChangeConfiguration(e=>{e.hasChanged(116)&&this.readConfiguration()})),this.readConfiguration()}readConfiguration(){this._sessionStore.clear(),this._editor.getOption(116).enabled&&(this._sessionStore.add(this._editor.onDidChangeModel(()=>{this._model=null,this.updateStickyModelProvider(),this._onDidChangeStickyScroll.fire(),this.update()})),this._sessionStore.add(this._editor.onDidChangeHiddenAreas(()=>this.update())),this._sessionStore.add(this._editor.onDidChangeModelContent(()=>this._updateSoon.schedule())),this._sessionStore.add(this._languageFeaturesService.documentSymbolProvider.onDidChange(()=>this.update())),this._sessionStore.add(b(()=>{this._stickyModelProvider?.dispose(),this._stickyModelProvider=null})),this.updateStickyModelProvider(),this.update())}getVersionId(){return this._model?.version}updateStickyModelProvider(){this._stickyModelProvider?.dispose(),this._stickyModelProvider=null;let e=this._editor;e.hasModel()&&(this._stickyModelProvider=new pj(e,()=>this._updateSoon.schedule(),this._languageConfigurationService,this._languageFeaturesService))}async update(){this._cts?.dispose(!0),this._cts=new ie,await this.updateStickyModel(this._cts.token),this._onDidChangeStickyScroll.fire()}async updateStickyModel(e){if(!this._editor.hasModel()||!this._stickyModelProvider||this._editor.getModel().isTooLargeForTokenization()){this._model=null;return}let t=await this._stickyModelProvider.update(e);e.isCancellationRequested||(this._model=t)}updateIndex(e){return e===-1?e=0:e<0&&(e=-e-2),e}getCandidateStickyLinesIntersectingFromStickyModel(e,t,n,r,i){if(t.children.length===0)return;let a=i,o=[];for(let e=0;e<t.children.length;e++){let n=t.children[e];n.range&&o.push(n.range.startLineNumber)}let s=this.updateIndex(Tt(o,e.startLineNumber,(e,t)=>e-t)),c=this.updateIndex(Tt(o,e.startLineNumber+r,(e,t)=>e-t));for(let o=s;o<=c;o++){let s=t.children[o];if(!s)return;if(s.range){let t=s.range.startLineNumber,i=s.range.endLineNumber;e.startLineNumber<=i+1&&t-1<=e.endLineNumber&&t!==a&&(a=t,n.push(new xj(t,i-1,r+1)),this.getCandidateStickyLinesIntersectingFromStickyModel(e,s,n,r+1,t))}else this.getCandidateStickyLinesIntersectingFromStickyModel(e,s,n,r,i)}}getCandidateStickyLinesIntersecting(e){if(!this._model?.element)return[];let t=[];this.getCandidateStickyLinesIntersectingFromStickyModel(e,this._model.element,t,0,-1);let n=this._editor._getViewModel()?.getHiddenAreas();if(n)for(let e of n)t=t.filter(t=>!(t.startLineNumber>=e.startLineNumber&&t.endLineNumber<=e.endLineNumber+1));return t}};Sj=yj([bj(1,V),bj(2,Ci)],Sj);var Cj=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},wj=function(e,t){return function(n,r){t(n,r,e)}},Tj,Ej=class extends _{static#e=Tj=this;static#t=this.ID=`store.contrib.stickyScrollController`;constructor(e,t,r,i,a,o,s){super(),this._editor=e,this._contextMenuService=t,this._languageFeaturesService=r,this._instaService=i,this._contextKeyService=s,this._sessionStore=new n,this._maxStickyLines=2**53-1,this._candidateDefinitionsLength=-1,this._focusedStickyElementIndex=-1,this._enabled=!1,this._focused=!1,this._positionRevealed=!1,this._onMouseDown=!1,this._endLineNumbers=[],this._stickyScrollWidget=new rj(this._editor),this._stickyLineCandidateProvider=new Sj(this._editor,r,a),this._register(this._stickyScrollWidget),this._register(this._stickyLineCandidateProvider),this._widgetState=ZA.Empty,this._onDidResize(),this._readConfiguration();let c=this._stickyScrollWidget.getDomNode();this._register(this._editor.onDidChangeConfiguration(e=>{this._readConfigurationChange(e)})),this._register(D(c,j.CONTEXT_MENU,async e=>{this._onContextMenu(pt(c),e)})),this._stickyScrollFocusedContextKey=q.stickyScrollFocused.bindTo(this._contextKeyService),this._stickyScrollVisibleContextKey=q.stickyScrollVisible.bindTo(this._contextKeyService);let l=this._register(An(c));this._register(l.onDidBlur(e=>{this._positionRevealed===!1&&c.clientHeight===0?(this._focusedStickyElementIndex=-1,this.focus()):this._disposeFocusStickyScrollStore()})),this._register(l.onDidFocus(e=>{this.focus()})),this._registerMouseListeners(),this._register(D(c,j.MOUSE_DOWN,e=>{this._onMouseDown=!0}))}static get(e){return e.getContribution(Tj.ID)}_disposeFocusStickyScrollStore(){this._stickyScrollFocusedContextKey.set(!1),this._focusDisposableStore?.dispose(),this._focused=!1,this._positionRevealed=!1,this._onMouseDown=!1}focus(){if(this._onMouseDown){this._onMouseDown=!1,this._editor.focus();return}this._stickyScrollFocusedContextKey.get()!==!0&&(this._focused=!0,this._focusDisposableStore=new n,this._stickyScrollFocusedContextKey.set(!0),this._focusedStickyElementIndex=this._stickyScrollWidget.lineNumbers.length-1,this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex))}focusNext(){this._focusedStickyElementIndex<this._stickyScrollWidget.lineNumberCount-1&&this._focusNav(!0)}focusPrevious(){this._focusedStickyElementIndex>0&&this._focusNav(!1)}selectEditor(){this._editor.focus()}_focusNav(e){this._focusedStickyElementIndex=e?this._focusedStickyElementIndex+1:this._focusedStickyElementIndex-1,this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex)}goToFocused(){let e=this._stickyScrollWidget.lineNumbers;this._disposeFocusStickyScrollStore(),this._revealPosition({lineNumber:e[this._focusedStickyElementIndex],column:1})}_revealPosition(e){this._reveaInEditor(e,()=>this._editor.revealPosition(e))}_revealLineInCenterIfOutsideViewport(e){this._reveaInEditor(e,()=>this._editor.revealLineInCenterIfOutsideViewport(e.lineNumber,0))}_reveaInEditor(e,t){this._focused&&this._disposeFocusStickyScrollStore(),this._positionRevealed=!0,t(),this._editor.setSelection(T.fromPositions(e)),this._editor.focus()}_registerMouseListeners(){let e=this._register(new n),t=this._register(new Dh(this._editor,{extractLineNumberFromMouseEvent:e=>{let t=this._stickyScrollWidget.getEditorPositionFromNode(e.target.element);return t?t.lineNumber:0}})),i=e=>{if(!this._editor.hasModel()||e.target.type!==12||e.target.detail!==this._stickyScrollWidget.getId())return null;let t=e.target.element;if(!t||t.innerText!==t.innerHTML)return null;let n=this._stickyScrollWidget.getEditorPositionFromNode(t);return n?{range:new T(n.lineNumber,n.column,n.lineNumber,n.column+t.innerText.length),textElement:t}:null},a=this._stickyScrollWidget.getDomNode();this._register(Gn(a,j.CLICK,e=>{if(e.ctrlKey||e.altKey||e.metaKey||!e.leftButton)return;if(e.shiftKey){let t=this._stickyScrollWidget.getLineIndexFromChildDomNode(e.target);if(t===null)return;let n=new r(this._endLineNumbers[t],1);this._revealLineInCenterIfOutsideViewport(n);return}if(this._stickyScrollWidget.isInFoldingIconDomNode(e.target)){let t=this._stickyScrollWidget.getLineNumberFromChildDomNode(e.target);this._toggleFoldingRegionForLine(t);return}if(!this._stickyScrollWidget.isInStickyLine(e.target))return;let t=this._stickyScrollWidget.getEditorPositionFromNode(e.target);if(!t){let n=this._stickyScrollWidget.getLineNumberFromChildDomNode(e.target);if(n===null)return;t=new r(n,1)}this._revealPosition(t)})),this._register(Gn(a,j.MOUSE_MOVE,e=>{if(e.shiftKey){let t=this._stickyScrollWidget.getLineIndexFromChildDomNode(e.target);if(t===null||this._showEndForLine!==null&&this._showEndForLine===t)return;this._showEndForLine=t,this._renderStickyScroll();return}this._showEndForLine!==void 0&&(this._showEndForLine=void 0,this._renderStickyScroll())})),this._register(D(a,j.MOUSE_LEAVE,e=>{this._showEndForLine!==void 0&&(this._showEndForLine=void 0,this._renderStickyScroll())})),this._register(t.onMouseMoveOrRelevantKeyDown(([t,n])=>{let a=i(t);if(!a||!t.hasTriggerModifier||!this._editor.hasModel()){e.clear();return}let{range:o,textElement:s}=a;if(!o.equalsRange(this._stickyRangeProjectedOnEditor))this._stickyRangeProjectedOnEditor=o,e.clear();else if(s.style.textDecoration===`underline`)return;let c=new ie;e.add(b(()=>c.dispose(!0)));let l;Rg(this._languageFeaturesService.definitionProvider,this._editor.getModel(),new r(o.startLineNumber,o.startColumn+1),!1,c.token).then((t=>{if(!c.token.isCancellationRequested)if(t.length!==0){this._candidateDefinitionsLength=t.length;let n=s;l===n?l||(l=n,l.style.textDecoration=`underline`,e.add(b(()=>{l.style.textDecoration=`none`}))):(e.clear(),l=n,l.style.textDecoration=`underline`,e.add(b(()=>{l.style.textDecoration=`none`})))}else e.clear()}))})),this._register(t.onCancel(()=>{e.clear()})),this._register(t.onExecute(async e=>{if(e.target.type!==12||e.target.detail!==this._stickyScrollWidget.getId())return;let t=this._stickyScrollWidget.getEditorPositionFromNode(e.target.element);t&&(!this._editor.hasModel()||!this._stickyRangeProjectedOnEditor||(this._candidateDefinitionsLength>1&&(this._focused&&this._disposeFocusStickyScrollStore(),this._revealPosition({lineNumber:t.lineNumber,column:1})),this._instaService.invokeFunction($g,e,this._editor,{uri:this._editor.getModel().uri,range:this._stickyRangeProjectedOnEditor})))}))}_onContextMenu(e,t){let n=new wt(e,t);this._contextMenuService.showContextMenu({menuId:R.StickyScrollContext,getAnchor:()=>n})}_toggleFoldingRegionForLine(e){if(!this._foldingModel||e===null)return;let t=this._stickyScrollWidget.getRenderedStickyLine(e),n=t?.foldingIcon;if(!n)return;rb(this._foldingModel,Number.MAX_VALUE,[e]),n.isCollapsed=!n.isCollapsed;let r=(n.isCollapsed?this._editor.getTopForLineNumber(n.foldingEndLine):this._editor.getTopForLineNumber(n.foldingStartLine))-this._editor.getOption(67)*t.index+1;this._editor.setScrollTop(r),this._renderStickyScroll(e)}_readConfiguration(){let e=this._editor.getOption(116);if(e.enabled===!1){this._editor.removeOverlayWidget(this._stickyScrollWidget),this._sessionStore.clear(),this._enabled=!1;return}else e.enabled&&!this._enabled&&(this._editor.addOverlayWidget(this._stickyScrollWidget),this._sessionStore.add(this._editor.onDidScrollChange(e=>{e.scrollTopChanged&&(this._showEndForLine=void 0,this._renderStickyScroll())})),this._sessionStore.add(this._editor.onDidLayoutChange(()=>this._onDidResize())),this._sessionStore.add(this._editor.onDidChangeModelTokens(e=>this._onTokensChange(e))),this._sessionStore.add(this._stickyLineCandidateProvider.onDidChangeStickyScroll(()=>{this._showEndForLine=void 0,this._renderStickyScroll()})),this._enabled=!0);this._editor.getOption(68).renderType===2&&this._sessionStore.add(this._editor.onDidChangeCursorPosition(()=>{this._showEndForLine=void 0,this._renderStickyScroll(0)}))}_readConfigurationChange(e){(e.hasChanged(116)||e.hasChanged(73)||e.hasChanged(67)||e.hasChanged(111)||e.hasChanged(68))&&this._readConfiguration(),e.hasChanged(68)&&this._renderStickyScroll(0)}_needsUpdate(e){let t=this._stickyScrollWidget.getCurrentLines();for(let n of t)for(let t of e.ranges)if(n>=t.fromLineNumber&&n<=t.toLineNumber)return!0;return!1}_onTokensChange(e){this._needsUpdate(e)&&this._renderStickyScroll(0)}_onDidResize(){let e=this._editor.getLayoutInfo().height/this._editor.getOption(67);this._maxStickyLines=Math.round(e*.25)}async _renderStickyScroll(e){let t=this._editor.getModel();if(!t||t.isTooLargeForTokenization()){this._resetState();return}let n=this._updateAndGetMinRebuildFromLine(e),r=this._stickyLineCandidateProvider.getVersionId();if(r===void 0||r===t.getVersionId())if(!this._focused)await this._updateState(n);else if(this._focusedStickyElementIndex===-1)await this._updateState(n),this._focusedStickyElementIndex=this._stickyScrollWidget.lineNumberCount-1,this._focusedStickyElementIndex!==-1&&this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex);else{let e=this._stickyScrollWidget.lineNumbers[this._focusedStickyElementIndex];await this._updateState(n),this._stickyScrollWidget.lineNumberCount===0?this._focusedStickyElementIndex=-1:(this._stickyScrollWidget.lineNumbers.includes(e)||(this._focusedStickyElementIndex=this._stickyScrollWidget.lineNumberCount-1),this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex))}}_updateAndGetMinRebuildFromLine(e){if(e!==void 0){let t=this._minRebuildFromLine===void 0?1/0:this._minRebuildFromLine;this._minRebuildFromLine=Math.min(e,t)}return this._minRebuildFromLine}async _updateState(e){this._minRebuildFromLine=void 0,this._foldingModel=await Hb.get(this._editor)?.getFoldingModel()??void 0,this._widgetState=this.findScrollWidgetState();let t=this._widgetState.startLineNumbers.length>0;this._stickyScrollVisibleContextKey.set(t),this._stickyScrollWidget.setState(this._widgetState,this._foldingModel,e)}async _resetState(){this._minRebuildFromLine=void 0,this._foldingModel=void 0,this._widgetState=ZA.Empty,this._stickyScrollVisibleContextKey.set(!1),this._stickyScrollWidget.setState(void 0,void 0)}findScrollWidgetState(){let e=this._editor.getOption(67),t=Math.min(this._maxStickyLines,this._editor.getOption(116).maxLineCount),n=this._editor.getScrollTop(),r=0,i=[],a=[],o=this._editor.getVisibleRanges();if(o.length!==0){let s=new oj(o[0].startLineNumber,o[o.length-1].endLineNumber),c=this._stickyLineCandidateProvider.getCandidateStickyLinesIntersecting(s);for(let o of c){let s=o.startLineNumber,c=o.endLineNumber,l=o.nestingDepth;if(c-s>0){let o=(l-1)*e,u=l*e,d=this._editor.getBottomForLineNumber(s)-n,f=this._editor.getTopForLineNumber(c)-n,p=this._editor.getBottomForLineNumber(c)-n;if(o>f&&o<=p){i.push(s),a.push(c+1),r=p-u;break}else u>d&&u<=p&&(i.push(s),a.push(c+1));if(i.length===t)break}}}return this._endLineNumbers=a,new ZA(i,a,r,this._showEndForLine)}dispose(){super.dispose(),this._sessionStore.dispose()}};Ej=Tj=Cj([wj(1,Ga),wj(2,V),wj(3,Y),wj(4,Ci),wj(5,Qi),wj(6,W)],Ej);var Dj=class extends Mo{constructor(){super({id:`editor.action.toggleStickyScroll`,title:{...x(`toggleEditorStickyScroll`,`Toggle Editor Sticky Scroll`),mnemonicTitle:S({key:`mitoggleStickyScroll`,comment:[`&& denotes a mnemonic`]},`&&Toggle Editor Sticky Scroll`)},metadata:{description:x(`toggleEditorStickyScroll.description`,`Toggle/enable the editor sticky scroll which shows the nested scopes at the top of the viewport`)},category:XA.View,toggled:{condition:z.equals(`config.editor.stickyScroll.enabled`,!0),title:S(`stickyScroll`,`Sticky Scroll`),mnemonicTitle:S({key:`miStickyScroll`,comment:[`&& denotes a mnemonic`]},`&&Sticky Scroll`)},menu:[{id:R.CommandPalette},{id:R.MenubarAppearanceMenu,group:`4_editor`,order:3},{id:R.StickyScrollContext}]})}async run(e){let t=e.get(F),n=!t.getValue(`editor.stickyScroll.enabled`);return t.updateValue(`editor.stickyScroll.enabled`,n)}},Oj=100,kj=class extends Gi{constructor(){super({id:`editor.action.focusStickyScroll`,title:{...x(`focusStickyScroll`,`Focus on the editor sticky scroll`),mnemonicTitle:S({key:`mifocusStickyScroll`,comment:[`&& denotes a mnemonic`]},`&&Focus Sticky Scroll`)},precondition:z.and(z.has(`config.editor.stickyScroll.enabled`),q.stickyScrollVisible),menu:[{id:R.CommandPalette}]})}runEditorCommand(e,t){Ej.get(t)?.focus()}},Aj=class extends Gi{constructor(){super({id:`editor.action.selectNextStickyScrollLine`,title:x(`selectNextStickyScrollLine.title`,`Select the next editor sticky scroll line`),precondition:q.stickyScrollFocused.isEqualTo(!0),keybinding:{weight:Oj,primary:18}})}runEditorCommand(e,t){Ej.get(t)?.focusNext()}},jj=class extends Gi{constructor(){super({id:`editor.action.selectPreviousStickyScrollLine`,title:x(`selectPreviousStickyScrollLine.title`,`Select the previous sticky scroll line`),precondition:q.stickyScrollFocused.isEqualTo(!0),keybinding:{weight:Oj,primary:16}})}runEditorCommand(e,t){Ej.get(t)?.focusPrevious()}},Mj=class extends Gi{constructor(){super({id:`editor.action.goToFocusedStickyScrollLine`,title:x(`goToFocusedStickyScrollLine.title`,`Go to the focused sticky scroll line`),precondition:q.stickyScrollFocused.isEqualTo(!0),keybinding:{weight:Oj,primary:3}})}runEditorCommand(e,t){Ej.get(t)?.goToFocused()}},Nj=class extends Gi{constructor(){super({id:`editor.action.selectEditor`,title:x(`selectEditor.title`,`Select Editor`),precondition:q.stickyScrollFocused.isEqualTo(!0),keybinding:{weight:Oj,primary:9}})}runEditorCommand(e,t){Ej.get(t)?.selectEditor()}};I(Ej.ID,Ej,1),H(Dj),H(kj),H(jj),H(Aj),H(Mj),H(Nj);var Pj=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Fj=function(e,t){return function(n,r){t(n,r,e)}},Ij=class{constructor(e,t,n,r,i,a){this.range=e,this.insertText=t,this.filterText=n,this.additionalTextEdits=r,this.command=i,this.completion=a}},Lj=class extends oe{constructor(e,t,n,r,i,a){super(i.disposable),this.model=e,this.line=t,this.word=n,this.completionModel=r,this._suggestMemoryService=a}canBeReused(e,t,n){return this.model===e&&this.line===t&&this.word.word.length>0&&this.word.startColumn===n.startColumn&&this.word.endColumn<n.endColumn&&this.completionModel.getIncompleteProvider().size===0}get items(){let e=[],{items:t}=this.completionModel,n=this._suggestMemoryService.select(this.model,{lineNumber:this.line,column:this.word.endColumn+this.completionModel.lineContext.characterCountDelta},t),r=ue.slice(t,n),i=ue.slice(t,0,n),a=5;for(let t of ue.concat(r,i)){if(t.score===Ts.Default)continue;let n=new T(t.editStart.lineNumber,t.editStart.column,t.editInsertEnd.lineNumber,t.editInsertEnd.column+this.completionModel.lineContext.characterCountDelta),r=t.completion.insertTextRules&&t.completion.insertTextRules&4?{snippet:t.completion.insertText}:t.completion.insertText;e.push(new Ij(n,r,t.filterTextLow??t.labelLow,t.completion.additionalTextEdits,t.completion.command,t)),a-->=0&&t.resolve(w.None)}return e}};Lj=Pj([Fj(5,vC)],Lj);var Rj=class extends _{constructor(e,t,n,r){super(),this._languageFeatureService=e,this._clipboardService=t,this._suggestMemoryService=n,this._editorService=r,this._store.add(e.inlineCompletionsProvider.register(`*`,this))}async provideInlineCompletions(e,t,n,r){if(n.selectedSuggestionInfo)return;let i;for(let t of this._editorService.listCodeEditors())if(t.getModel()===e){i=t;break}if(!i)return;let a=i.getOption(90);if(NS.isAllOff(a))return;e.tokenization.tokenizeIfCheap(t.lineNumber);let o=e.tokenization.getLineTokens(t.lineNumber),s=o.getStandardTokenType(o.findTokenIndexAtOffset(Math.max(t.column-1-1,0)));if(NS.valueFor(a,s)!==`inline`)return;let c=e.getWordAtPosition(t),l;if(c?.word||(l=this._getTriggerCharacterInfo(e,t)),!c?.word&&!l||(c||=e.getWordUntilPosition(t),c.endColumn!==t.column))return;let u,d=e.getValueInRange(new T(t.lineNumber,1,t.lineNumber,t.column));if(!l&&this._lastResult?.canBeReused(e,t.lineNumber,c)){let e=new AC(d,t.column-this._lastResult.word.endColumn);this._lastResult.completionModel.lineContext=e,this._lastResult.acquire(),u=this._lastResult}else{let n=await ES(this._languageFeatureService.completionProvider,e,t,new SS(void 0,RC.createSuggestFilter(i).itemKind,l?.providers),l&&{triggerKind:1,triggerCharacter:l.ch},r),a;n.needsClipboard&&(a=await this._clipboardService.readText());let o=new jC(n.items,t.column,new AC(d,0),kC.None,i.getOption(119),i.getOption(113),{boostFullMatch:!1,firstMatchCanBeWeak:!1},a);u=new Lj(e,t.lineNumber,c,o,n,this._suggestMemoryService)}return this._lastResult=u,u}handleItemDidShow(e,t){t.completion.resolve(w.None)}freeInlineCompletions(e){e.release()}_getTriggerCharacterInfo(e,t){let n=e.getValueInRange(T.fromPositions({lineNumber:t.lineNumber,column:t.column-1},t)),r=new Set;for(let t of this._languageFeatureService.completionProvider.all(e))t.triggerCharacters?.includes(n)&&r.add(t);if(r.size!==0)return{providers:r,ch:n}}};Rj=Pj([Fj(0,V),Fj(1,_l),Fj(2,vC),Fj(3,Ko)],Rj),wl(Rj),L(class extends N{constructor(){super({id:`editor.action.forceRetokenize`,label:S(`forceRetokenize`,`Developer: Force Retokenize`),alias:`Developer: Force Retokenize`,precondition:void 0})}run(e,t){if(!t.hasModel())return;let n=t.getModel();n.tokenization.resetTokenization();let r=new u;n.tokenization.forceTokenization(n.getLineCount()),r.stop(),console.log(`tokenization took ${r.elapsed()}`)}}),H(class e extends Mo{static#e=this.ID=`editor.action.toggleTabFocusMode`;constructor(){super({id:e.ID,title:x({key:`toggle.tabMovesFocus`,comment:[`Turn on/off use of tab key for moving focus around VS Code`]},`Toggle Tab Key Moves Focus`),precondition:void 0,keybinding:{primary:2091,mac:{primary:1323},weight:100},metadata:{description:x(`tabMovesFocusDescriptions`,`Determines whether the tab key moves focus around the workbench or inserts the tab character in the current editor. This is also called tab trapping, tab navigation, or tab focus mode.`)},f1:!0})}run(){let e=!os.getTabFocusMode();os.setTabFocusMode(e),qa(e?S(`toggle.tabMovesFocus.on`,`Pressing Tab will now move focus to the next focusable element`):S(`toggle.tabMovesFocus.off`,`Pressing Tab will now insert the tab character`))}});var zj=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Bj=function(e,t){return function(n,r){t(n,r,e)}},Vj=class extends _{get enabled(){return this._enabled}set enabled(e){e?(this.el.setAttribute(`aria-disabled`,`false`),this.el.tabIndex=0,this.el.style.pointerEvents=`auto`,this.el.style.opacity=`1`,this.el.style.cursor=`pointer`,this._enabled=!1):(this.el.setAttribute(`aria-disabled`,`true`),this.el.tabIndex=-1,this.el.style.pointerEvents=`none`,this.el.style.opacity=`0.4`,this.el.style.cursor=`default`,this._enabled=!0),this._enabled=e}constructor(e,t,n={},r,i){super(),this._link=t,this._hoverService=r,this._enabled=!0,this.el=M(e,O(`a.monaco-link`,{tabIndex:t.tabIndex??0,href:t.href},t.label)),this.hoverDelegate=n.hoverDelegate??go(`mouse`),this.setTooltip(t.title),this.el.setAttribute(`role`,`button`);let a=this._register(new io(this.el,`click`)),o=this._register(new io(this.el,`keypress`)),s=we.chain(o.event,e=>e.map(e=>new pn(e)).filter(e=>e.keyCode===3)),c=this._register(new io(this.el,ki.Tap)).event;this._register(Ki.addTarget(this.el));let l=we.any(a.event,s,c);this._register(l(e=>{this.enabled&&(nr.stop(e,!0),n?.opener?n.opener(this._link.href):i.open(this._link.href,{allowCommands:!0}))})),this.enabled=!0}setTooltip(e){this.hoverDelegate.showNativeHover?this.el.title=e??``:!this.hover&&e?this.hover=this._register(this._hoverService.setupManagedHover(this.hoverDelegate,this.el,e)):this.hover&&this.hover.update(e)}};Vj=zj([Bj(3,oi),Bj(4,wi)],Vj);var Hj=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Uj=function(e,t){return function(n,r){t(n,r,e)}},Wj=26,Gj=class extends _{constructor(e,t){super(),this._editor=e,this.instantiationService=t,this.banner=this._register(this.instantiationService.createInstance(Kj))}hide(){this._editor.setBanner(null,0),this.banner.clear()}show(e){this.banner.show({...e,onClose:()=>{this.hide(),e.onClose?.()}}),this._editor.setBanner(this.banner.element,Wj)}};Gj=Hj([Uj(1,Y)],Gj);var Kj=class extends _{constructor(e){super(),this.instantiationService=e,this.markdownRenderer=this.instantiationService.createInstance(Hi,{}),this.element=O(`div.editor-banner`),this.element.tabIndex=0}getAriaLabel(e){if(e.ariaLabel)return e.ariaLabel;if(typeof e.message==`string`)return e.message}getBannerMessage(e){if(typeof e==`string`){let t=O(`span`);return t.innerText=e,t}return this.markdownRenderer.render(e).element}clear(){Fr(this.element)}show(e){Fr(this.element);let t=this.getAriaLabel(e);t&&this.element.setAttribute(`aria-label`,t);let n=M(this.element,O(`div.icon-container`));n.setAttribute(`aria-hidden`,`true`),e.icon&&n.appendChild(O(`div${J.asCSSSelector(e.icon)}`));let r=M(this.element,O(`div.message-container`));if(r.setAttribute(`aria-hidden`,`true`),r.appendChild(this.getBannerMessage(e.message)),this.messageActionsContainer=M(this.element,O(`div.message-actions-container`)),e.actions)for(let t of e.actions)this._register(this.instantiationService.createInstance(Vj,this.messageActionsContainer,{...t,tabIndex:-1},{}));let i=M(this.element,O(`div.action-container`));this.actionBar=this._register(new hl(i)),this.actionBar.push(this._register(new hs(`banner.close`,`Close Banner`,J.asClassName($s),!0,()=>{typeof e.onClose==`function`&&e.onClose()})),{icon:!0,label:!1}),this.actionBar.setFocusable(!1)}};Kj=Hj([Uj(0,Y)],Kj);var qj=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Jj=function(e,t){return function(n,r){t(n,r,e)}};const Yj=ri(`extensions-warning-message`,i.warning,S(`warningIcon`,`Icon shown with a warning message in the extensions editor.`));var Xj=class extends _{static#e=this.ID=`editor.contrib.unicodeHighlighter`;constructor(e,t,n,r){super(),this._editor=e,this._editorWorkerService=t,this._workspaceTrustService=n,this._highlighter=null,this._bannerClosed=!1,this._updateState=e=>{if(e&&e.hasMore){if(this._bannerClosed)return;let t=Math.max(e.ambiguousCharacterCount,e.nonBasicAsciiCharacterCount,e.invisibleCharacterCount),n;if(e.nonBasicAsciiCharacterCount>=t)n={message:S(`unicodeHighlighting.thisDocumentHasManyNonBasicAsciiUnicodeCharacters`,`This document contains many non-basic ASCII unicode characters`),command:new dM};else if(e.ambiguousCharacterCount>=t)n={message:S(`unicodeHighlighting.thisDocumentHasManyAmbiguousUnicodeCharacters`,`This document contains many ambiguous unicode characters`),command:new lM};else if(e.invisibleCharacterCount>=t)n={message:S(`unicodeHighlighting.thisDocumentHasManyInvisibleUnicodeCharacters`,`This document contains many invisible unicode characters`),command:new uM};else throw Error(`Unreachable`);this._bannerController.show({id:`unicodeHighlightBanner`,message:n.message,icon:Yj,actions:[{label:n.command.shortLabel,href:`command:${n.command.id}`}],onClose:()=>{this._bannerClosed=!0}})}else this._bannerController.hide()},this._bannerController=this._register(r.createInstance(Gj,e)),this._register(this._editor.onDidChangeModel(()=>{this._bannerClosed=!1,this._updateHighlighter()})),this._options=e.getOption(126),this._register(n.onDidChangeTrust(e=>{this._updateHighlighter()})),this._register(e.onDidChangeConfiguration(t=>{t.hasChanged(126)&&(this._options=e.getOption(126),this._updateHighlighter())})),this._updateHighlighter()}dispose(){this._highlighter&&=(this._highlighter.dispose(),null),super.dispose()}_updateHighlighter(){if(this._updateState(null),this._highlighter&&=(this._highlighter.dispose(),null),!this._editor.hasModel())return;let e=Zj(this._workspaceTrustService.isWorkspaceTrusted(),this._options);if([e.nonBasicASCII,e.ambiguousCharacters,e.invisibleCharacters].every(e=>e===!1))return;let t={nonBasicASCII:e.nonBasicASCII,ambiguousCharacters:e.ambiguousCharacters,invisibleCharacters:e.invisibleCharacters,includeComments:e.includeComments,includeStrings:e.includeStrings,allowedCodePoints:Object.keys(e.allowedCharacters).map(e=>e.codePointAt(0)),allowedLocales:Object.keys(e.allowedLocales).map(e=>e===`_os`?new Intl.NumberFormat().resolvedOptions().locale:e===`_vscode`?Ne:e)};this._editorWorkerService.canComputeUnicodeHighlights(this._editor.getModel().uri)?this._highlighter=new Qj(this._editor,t,this._updateState,this._editorWorkerService):this._highlighter=new $j(this._editor,t,this._updateState)}getDecorationInfo(e){return this._highlighter?this._highlighter.getDecorationInfo(e):null}};Xj=qj([Jj(1,pi),Jj(2,Fs),Jj(3,Y)],Xj);function Zj(e,t){return{nonBasicASCII:t.nonBasicASCII===`inUntrustedWorkspace`?!e:t.nonBasicASCII,ambiguousCharacters:t.ambiguousCharacters,invisibleCharacters:t.invisibleCharacters,includeComments:t.includeComments===`inUntrustedWorkspace`?!e:t.includeComments,includeStrings:t.includeStrings===`inUntrustedWorkspace`?!e:t.includeStrings,allowedCharacters:t.allowedCharacters,allowedLocales:t.allowedLocales}}var Qj=class extends _{constructor(e,t,n,r){super(),this._editor=e,this._options=t,this._updateState=n,this._editorWorkerService=r,this._model=this._editor.getModel(),this._decorations=this._editor.createDecorationsCollection(),this._updateSoon=this._register(new yt(()=>this._update(),250)),this._register(this._editor.onDidChangeModelContent(()=>{this._updateSoon.schedule()})),this._updateSoon.schedule()}dispose(){this._decorations.clear(),super.dispose()}_update(){if(this._model.isDisposed())return;if(!this._model.mightContainNonBasicASCII()){this._decorations.clear();return}let e=this._model.getVersionId();this._editorWorkerService.computedUnicodeHighlights(this._model.uri,this._options).then(t=>{if(this._model.isDisposed()||this._model.getVersionId()!==e)return;this._updateState(t);let n=[];if(!t.hasMore)for(let e of t.ranges)n.push({range:e,options:oM.instance.getDecorationFromOptions(this._options)});this._decorations.set(n)})}getDecorationInfo(e){if(!this._decorations.has(e))return null;let t=this._editor.getModel();return La(t,e)?{reason:aM(t.getValueInRange(e.range),this._options),inComment:To(t,e),inString:Lo(t,e)}:null}};Qj=qj([Jj(3,pi)],Qj);var $j=class extends _{constructor(e,t,n){super(),this._editor=e,this._options=t,this._updateState=n,this._model=this._editor.getModel(),this._decorations=this._editor.createDecorationsCollection(),this._updateSoon=this._register(new yt(()=>this._update(),250)),this._register(this._editor.onDidLayoutChange(()=>{this._updateSoon.schedule()})),this._register(this._editor.onDidScrollChange(()=>{this._updateSoon.schedule()})),this._register(this._editor.onDidChangeHiddenAreas(()=>{this._updateSoon.schedule()})),this._register(this._editor.onDidChangeModelContent(()=>{this._updateSoon.schedule()})),this._updateSoon.schedule()}dispose(){this._decorations.clear(),super.dispose()}_update(){if(this._model.isDisposed())return;if(!this._model.mightContainNonBasicASCII()){this._decorations.clear();return}let e=this._editor.getVisibleRanges(),t=[],n={ranges:[],ambiguousCharacterCount:0,invisibleCharacterCount:0,nonBasicAsciiCharacterCount:0,hasMore:!1};for(let t of e){let e=pc.computeUnicodeHighlights(this._model,this._options,t);for(let t of e.ranges)n.ranges.push(t);n.ambiguousCharacterCount+=n.ambiguousCharacterCount,n.invisibleCharacterCount+=n.invisibleCharacterCount,n.nonBasicAsciiCharacterCount+=n.nonBasicAsciiCharacterCount,n.hasMore=n.hasMore||e.hasMore}if(!n.hasMore)for(let e of n.ranges)t.push({range:e,options:oM.instance.getDecorationFromOptions(this._options)});this._updateState(n),this._decorations.set(t)}getDecorationInfo(e){if(!this._decorations.has(e))return null;let t=this._editor.getModel(),n=t.getValueInRange(e.range);return La(t,e)?{reason:aM(n,this._options),inComment:To(t,e),inString:Lo(t,e)}:null}},eM=S(`unicodeHighlight.configureUnicodeHighlightOptions`,`Configure Unicode Highlight Options`),tM=class{constructor(e,t,n){this._editor=e,this._languageService=t,this._openerService=n,this.hoverOrdinal=5}computeSync(e,t){if(!this._editor.hasModel()||e.type!==1)return[];let n=this._editor.getModel(),r=this._editor.getContribution(Xj.ID);if(!r)return[];let i=[],a=new Set,o=300;for(let e of t){let t=r.getDecorationInfo(e);if(!t)continue;let s=n.getValueInRange(e.range).codePointAt(0),c=rM(s),l;switch(t.reason.kind){case 0:l=Cr(t.reason.confusableWith)?S(`unicodeHighlight.characterIsAmbiguousASCII`,`The character {0} could be confused with the ASCII character {1}, which is more common in source code.`,c,rM(t.reason.confusableWith.codePointAt(0))):S(`unicodeHighlight.characterIsAmbiguous`,`The character {0} could be confused with the character {1}, which is more common in source code.`,c,rM(t.reason.confusableWith.codePointAt(0)));break;case 1:l=S(`unicodeHighlight.characterIsInvisible`,`The character {0} is invisible.`,c);break;case 2:l=S(`unicodeHighlight.characterIsNonBasicAscii`,`The character {0} is not a basic ASCII character.`,c);break}if(a.has(l))continue;a.add(l);let u={codePoint:s,reason:t.reason,inComment:t.inComment,inString:t.inString},d=S(`unicodeHighlight.adjustSettings`,`Adjust settings`),f=`command:${fM.ID}?${encodeURIComponent(JSON.stringify(u))}`,p=new Va(``,!0).appendMarkdown(l).appendText(` `).appendLink(f,d,eM);i.push(new mh(this,e.range,[p],!1,o++))}return i}renderHoverParts(e,t){return yh(e,t,this._editor,this._languageService,this._openerService)}};tM=qj([Jj(1,Ys),Jj(2,wi)],tM);function nM(e){return`U+${e.toString(16).padStart(4,`0`)}`}function rM(e){let t=`\`${nM(e)}\``;return Mt.isInvisibleCharacter(e)||(t+=` "${`${iM(e)}`}"`),t}function iM(e){return e===96?"`` ` ``":"`"+String.fromCodePoint(e)+"`"}function aM(e,t){return pc.computeUnicodeHighlightReason(e,t)}var oM=class e{constructor(){this.map=new Map}static#e=this.instance=new e;getDecorationFromOptions(e){return this.getDecoration(!e.includeComments,!e.includeStrings)}getDecoration(e,t){let n=`${e}${t}`,r=this.map.get(n);return r||(r=U.createDynamic({description:`unicode-highlight`,stickiness:1,className:`unicode-highlight`,showIfCollapsed:!0,overviewRuler:null,minimap:null,hideInCommentTokens:e,hideInStringTokens:t}),this.map.set(n,r)),r}},sM=class extends N{constructor(){super({id:lM.ID,label:S(`action.unicodeHighlight.disableHighlightingInComments`,`Disable highlighting of characters in comments`),alias:`Disable highlighting of characters in comments`,precondition:void 0}),this.shortLabel=S(`unicodeHighlight.disableHighlightingInComments.shortLabel`,`Disable Highlight In Comments`)}async run(e,t,n){let r=e?.get(F);r&&this.runAction(r)}async runAction(e){await e.updateValue(It.includeComments,!1,2)}},cM=class extends N{constructor(){super({id:lM.ID,label:S(`action.unicodeHighlight.disableHighlightingInStrings`,`Disable highlighting of characters in strings`),alias:`Disable highlighting of characters in strings`,precondition:void 0}),this.shortLabel=S(`unicodeHighlight.disableHighlightingInStrings.shortLabel`,`Disable Highlight In Strings`)}async run(e,t,n){let r=e?.get(F);r&&this.runAction(r)}async runAction(e){await e.updateValue(It.includeStrings,!1,2)}},lM=class e extends N{static#e=this.ID=`editor.action.unicodeHighlight.disableHighlightingOfAmbiguousCharacters`;constructor(){super({id:e.ID,label:S(`action.unicodeHighlight.disableHighlightingOfAmbiguousCharacters`,`Disable highlighting of ambiguous characters`),alias:`Disable highlighting of ambiguous characters`,precondition:void 0}),this.shortLabel=S(`unicodeHighlight.disableHighlightingOfAmbiguousCharacters.shortLabel`,`Disable Ambiguous Highlight`)}async run(e,t,n){let r=e?.get(F);r&&this.runAction(r)}async runAction(e){await e.updateValue(It.ambiguousCharacters,!1,2)}},uM=class e extends N{static#e=this.ID=`editor.action.unicodeHighlight.disableHighlightingOfInvisibleCharacters`;constructor(){super({id:e.ID,label:S(`action.unicodeHighlight.disableHighlightingOfInvisibleCharacters`,`Disable highlighting of invisible characters`),alias:`Disable highlighting of invisible characters`,precondition:void 0}),this.shortLabel=S(`unicodeHighlight.disableHighlightingOfInvisibleCharacters.shortLabel`,`Disable Invisible Highlight`)}async run(e,t,n){let r=e?.get(F);r&&this.runAction(r)}async runAction(e){await e.updateValue(It.invisibleCharacters,!1,2)}},dM=class e extends N{static#e=this.ID=`editor.action.unicodeHighlight.disableHighlightingOfNonBasicAsciiCharacters`;constructor(){super({id:e.ID,label:S(`action.unicodeHighlight.disableHighlightingOfNonBasicAsciiCharacters`,`Disable highlighting of non basic ASCII characters`),alias:`Disable highlighting of non basic ASCII characters`,precondition:void 0}),this.shortLabel=S(`unicodeHighlight.disableHighlightingOfNonBasicAsciiCharacters.shortLabel`,`Disable Non ASCII Highlight`)}async run(e,t,n){let r=e?.get(F);r&&this.runAction(r)}async runAction(e){await e.updateValue(It.nonBasicASCII,!1,2)}},fM=class e extends N{static#e=this.ID=`editor.action.unicodeHighlight.showExcludeOptions`;constructor(){super({id:e.ID,label:S(`action.unicodeHighlight.showExcludeOptions`,`Show Exclude Options`),alias:`Show Exclude Options`,precondition:void 0})}async run(e,t,n){let{codePoint:r,reason:i,inString:a,inComment:o}=n,s=String.fromCodePoint(r),c=e.get(xc),l=e.get(F);function u(e){return Mt.isInvisibleCharacter(e)?S(`unicodeHighlight.excludeInvisibleCharFromBeingHighlighted`,`Exclude {0} (invisible character) from being highlighted`,nM(e)):S(`unicodeHighlight.excludeCharFromBeingHighlighted`,`Exclude {0} from being highlighted`,`${nM(e)} "${s}"`)}let d=[];if(i.kind===0)for(let e of i.notAmbiguousInLocales)d.push({label:S(`unicodeHighlight.allowCommonCharactersInLanguage`,`Allow unicode characters that are more common in the language "{0}".`,e),run:async()=>{mM(l,[e])}});if(d.push({label:u(r),run:()=>pM(l,[r])}),o){let e=new sM;d.push({label:e.label,run:async()=>e.runAction(l)})}else if(a){let e=new cM;d.push({label:e.label,run:async()=>e.runAction(l)})}if(i.kind===0){let e=new lM;d.push({label:e.label,run:async()=>e.runAction(l)})}else if(i.kind===1){let e=new uM;d.push({label:e.label,run:async()=>e.runAction(l)})}else if(i.kind===2){let e=new dM;d.push({label:e.label,run:async()=>e.runAction(l)})}else hM(i);let f=await c.pick(d,{title:eM});f&&await f.run()}};async function pM(e,t){let n=e.getValue(It.allowedCharacters),r;r=typeof n==`object`&&n?n:{};for(let e of t)r[String.fromCodePoint(e)]=!0;await e.updateValue(It.allowedCharacters,r,2)}async function mM(e,t){let n=e.inspect(It.allowedLocales).user?.value,r;r=typeof n==`object`&&n?Object.assign({},n):{};for(let e of t)r[e]=!0;await e.updateValue(It.allowedLocales,r,2)}function hM(e){throw Error(`Unexpected value: ${e}`)}L(lM),L(uM),L(dM),L(fM),I(Xj.ID,Xj,1),um.register(tM);var gM=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},_M=function(e,t){return function(n,r){t(n,r,e)}},vM=`ignoreUnusualLineTerminators`;function yM(e,t,n){e.setModelProperty(t.uri,vM,n)}function bM(e,t){return e.getModelProperty(t.uri,vM)}var xM=class extends _{static#e=this.ID=`editor.contrib.unusualLineTerminatorsDetector`;constructor(e,t,n){super(),this._editor=e,this._dialogService=t,this._codeEditorService=n,this._isPresentingDialog=!1,this._config=this._editor.getOption(127),this._register(this._editor.onDidChangeConfiguration(e=>{e.hasChanged(127)&&(this._config=this._editor.getOption(127),this._checkForUnusualLineTerminators())})),this._register(this._editor.onDidChangeModel(()=>{this._checkForUnusualLineTerminators()})),this._register(this._editor.onDidChangeModelContent(e=>{e.isUndoing||this._checkForUnusualLineTerminators()})),this._checkForUnusualLineTerminators()}async _checkForUnusualLineTerminators(){if(this._config===`off`||!this._editor.hasModel())return;let e=this._editor.getModel();if(!e.mightContainUnusualLineTerminators()||bM(this._codeEditorService,e)===!0||this._editor.getOption(92))return;if(this._config===`auto`){e.removeUnusualLineTerminators(this._editor.getSelections());return}if(this._isPresentingDialog)return;let t;try{this._isPresentingDialog=!0,t=await this._dialogService.confirm({title:S(`unusualLineTerminators.title`,`Unusual Line Terminators`),message:S(`unusualLineTerminators.message`,`Detected unusual line terminators`),detail:S(`unusualLineTerminators.detail`,`The file '{0}' contains one or more unusual line terminator characters, like Line Separator (LS) or Paragraph Separator (PS).

It is recommended to remove them from the file. This can be configured via \`editor.unusualLineTerminators\`.`,bc(e.uri)),primaryButton:S({key:`unusualLineTerminators.fix`,comment:[`&& denotes a mnemonic`]},`&&Remove Unusual Line Terminators`),cancelButton:S(`unusualLineTerminators.ignore`,`Ignore`)})}finally{this._isPresentingDialog=!1}if(!t.confirmed){yM(this._codeEditorService,e,!0);return}e.removeUnusualLineTerminators(this._editor.getSelections())}};xM=gM([_M(1,Jr),_M(2,Ko)],xM),I(xM.ID,xM,1);var SM=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},CM=function(e,t){return function(n,r){t(n,r,e)}},wM=class{constructor(){this.selector={language:`*`}}provideDocumentHighlights(e,t,n){let r=[],i=e.getWordAtPosition({lineNumber:t.lineNumber,column:t.column});if(!i)return Promise.resolve(r);if(!e.isDisposed())return e.findMatches(i.word,!0,!1,!0,qe,!1).map(e=>({range:e.range,kind:Ie.Text}))}provideMultiDocumentHighlights(e,t,n,r){let i=new Xa,a=e.getWordAtPosition({lineNumber:t.lineNumber,column:t.column});if(!a)return Promise.resolve(i);for(let t of[e,...n]){if(t.isDisposed())continue;let e=t.findMatches(a.word,!0,!1,!0,qe,!1).map(e=>({range:e.range,kind:Ie.Text}));e&&i.set(t.uri,e)}return i}},TM=class extends _{constructor(e){super(),this._register(e.documentHighlightProvider.register(`*`,new wM)),this._register(e.multiDocumentHighlightProvider.register(`*`,new wM))}};TM=SM([CM(0,V)],TM);var EM=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},DM=function(e,t){return function(n,r){t(n,r,e)}},OM,kM,AM=new G(`hasWordHighlights`,!1);function jM(e,t,n,r){return mt(e.ordered(t).map(e=>()=>Promise.resolve(e.provideDocumentHighlights(t,n,r)).then(void 0,Re)),e=>e!=null).then(e=>{if(e){let n=new Xa;return n.set(t.uri,e),n}return new Xa})}function MM(e,t,n,r,i,a){return mt(e.ordered(t).map(e=>()=>{let r=a.filter(e=>El(e)).filter(t=>Bi(e.selector,t.uri,t.getLanguageId(),!0,void 0,void 0)>0);return Promise.resolve(e.provideMultiDocumentHighlights(t,n,r,i)).then(void 0,Re)}),e=>e!=null)}var NM=class{constructor(e,t,n){this._model=e,this._selection=t,this._wordSeparators=n,this._wordRange=this._getCurrentWordRange(e,t),this._result=null}get result(){return this._result||=et(e=>this._compute(this._model,this._selection,this._wordSeparators,e)),this._result}_getCurrentWordRange(e,t){let n=e.getWordAtPosition(t.getPosition());return n?new T(t.startLineNumber,n.startColumn,t.startLineNumber,n.endColumn):null}isValid(e,t,n){let r=t.startLineNumber,i=t.startColumn,a=t.endColumn,o=this._getCurrentWordRange(e,t),s=!!(this._wordRange&&this._wordRange.equalsRange(o));for(let e=0,t=n.length;!s&&e<t;e++){let t=n.getRange(e);t&&t.startLineNumber===r&&t.startColumn<=i&&t.endColumn>=a&&(s=!0)}return s}cancel(){this.result.cancel()}},PM=class extends NM{constructor(e,t,n,r){super(e,t,n),this._providers=r}_compute(e,t,n,r){return jM(this._providers,e,t.getPosition(),r).then(e=>e||new Xa)}},FM=class extends NM{constructor(e,t,n,r,i){super(e,t,n),this._providers=r,this._otherModels=i}_compute(e,t,n,r){return MM(this._providers,e,t.getPosition(),n,r,this._otherModels).then(e=>e||new Xa)}};function IM(e,t,n,r,i){return new PM(t,n,i,e)}function LM(e,t,n,r,i,a){return new FM(t,n,i,e,a)}Pi(`_executeDocumentHighlights`,async(e,t,n)=>(await jM(e.get(V).documentHighlightProvider,t,n,w.None))?.get(t.uri));var RM=class{static#e=OM=this;static#t=this.storedDecorationIDs=new Xa;static#n=this.query=null;constructor(e,t,r,i,a){this.toUnhook=new n,this.workerRequestTokenId=0,this.workerRequestCompleted=!1,this.workerRequestValue=new Xa,this.lastCursorPositionChangeTime=0,this.renderDecorationsTimer=-1,this.runDelayer=this.toUnhook.add(new Nt(50)),this.editor=e,this.providers=t,this.multiDocumentProviders=r,this.codeEditorService=a,this._hasWordHighlights=AM.bindTo(i),this._ignorePositionChangeEvent=!1,this.occurrencesHighlight=this.editor.getOption(81),this.model=this.editor.getModel(),this.toUnhook.add(e.onDidChangeCursorPosition(e=>{this._ignorePositionChangeEvent||this.occurrencesHighlight!==`off`&&this.runDelayer.trigger(()=>{this._onPositionChanged(e)})})),this.toUnhook.add(e.onDidFocusEditorText(e=>{this.occurrencesHighlight!==`off`&&(this.workerRequest||this.runDelayer.trigger(()=>{this._run()}))})),this.toUnhook.add(e.onDidChangeModelContent(e=>{$n(this.model.uri,`output`)||this._stopAll()})),this.toUnhook.add(e.onDidChangeModel(e=>{!e.newModelUrl&&e.oldModelUrl?this._stopSingular():OM.query&&this._run()})),this.toUnhook.add(e.onDidChangeConfiguration(e=>{let t=this.editor.getOption(81);if(this.occurrencesHighlight!==t)switch(this.occurrencesHighlight=t,t){case`off`:this._stopAll();break;case`singleFile`:this._stopAll(OM.query?.modelInfo?.model);break;case`multiFile`:OM.query&&this._run(!0);break;default:console.warn(`Unknown occurrencesHighlight setting value:`,t);break}})),this.decorations=this.editor.createDecorationsCollection(),this.workerRequestTokenId=0,this.workerRequest=null,this.workerRequestCompleted=!1,this.lastCursorPositionChangeTime=0,this.renderDecorationsTimer=-1,OM.query&&this._run()}hasDecorations(){return this.decorations.length>0}restore(){this.occurrencesHighlight!==`off`&&(this.runDelayer.cancel(),this._run())}_getSortedHighlights(){return this.decorations.getRanges().sort(T.compareRangesUsingStarts)}moveNext(){let e=this._getSortedHighlights(),t=(e.findIndex(e=>e.containsPosition(this.editor.getPosition()))+1)%e.length,n=e[t];try{this._ignorePositionChangeEvent=!0,this.editor.setPosition(n.getStartPosition()),this.editor.revealRangeInCenterIfOutsideViewport(n);let r=this._getWord();r&&qa(`${this.editor.getModel().getLineContent(n.startLineNumber)}, ${t+1} of ${e.length} for '${r.word}'`)}finally{this._ignorePositionChangeEvent=!1}}moveBack(){let e=this._getSortedHighlights(),t=(e.findIndex(e=>e.containsPosition(this.editor.getPosition()))-1+e.length)%e.length,n=e[t];try{this._ignorePositionChangeEvent=!0,this.editor.setPosition(n.getStartPosition()),this.editor.revealRangeInCenterIfOutsideViewport(n);let r=this._getWord();r&&qa(`${this.editor.getModel().getLineContent(n.startLineNumber)}, ${t+1} of ${e.length} for '${r.word}'`)}finally{this._ignorePositionChangeEvent=!1}}_removeSingleDecorations(){if(!this.editor.hasModel())return;let e=OM.storedDecorationIDs.get(this.editor.getModel().uri);e&&(this.editor.removeDecorations(e),OM.storedDecorationIDs.delete(this.editor.getModel().uri),this.decorations.length>0&&(this.decorations.clear(),this._hasWordHighlights.set(!1)))}_removeAllDecorations(e){let t=this.codeEditorService.listCodeEditors(),n=[];for(let r of t){if(!r.hasModel()||qc(r.getModel().uri,e?.uri))continue;let t=OM.storedDecorationIDs.get(r.getModel().uri);if(!t)continue;r.removeDecorations(t),n.push(r.getModel().uri);let i=zM.get(r);i?.wordHighlighter&&i.wordHighlighter.decorations.length>0&&(i.wordHighlighter.decorations.clear(),i.wordHighlighter.workerRequest=null,i.wordHighlighter._hasWordHighlights.set(!1))}for(let e of n)OM.storedDecorationIDs.delete(e)}_stopSingular(){this._removeSingleDecorations(),this.editor.hasTextFocus()&&(this.editor.getModel()?.uri.scheme!==Bt.vscodeNotebookCell&&OM.query?.modelInfo?.model.uri.scheme!==Bt.vscodeNotebookCell?(OM.query=null,this._run()):OM.query?.modelInfo&&(OM.query.modelInfo=null)),this.renderDecorationsTimer!==-1&&(clearTimeout(this.renderDecorationsTimer),this.renderDecorationsTimer=-1),this.workerRequest!==null&&(this.workerRequest.cancel(),this.workerRequest=null),this.workerRequestCompleted||=(this.workerRequestTokenId++,!0)}_stopAll(e){this._removeAllDecorations(e),this.renderDecorationsTimer!==-1&&(clearTimeout(this.renderDecorationsTimer),this.renderDecorationsTimer=-1),this.workerRequest!==null&&(this.workerRequest.cancel(),this.workerRequest=null),this.workerRequestCompleted||=(this.workerRequestTokenId++,!0)}_onPositionChanged(e){if(this.occurrencesHighlight===`off`){this._stopAll();return}if(e.reason!==3&&this.editor.getModel()?.uri.scheme!==Bt.vscodeNotebookCell){this._stopAll();return}this._run()}_getWord(){let e=this.editor.getSelection(),t=e.startLineNumber,n=e.startColumn;return this.model.isDisposed()?null:this.model.getWordAtPosition({lineNumber:t,column:n})}getOtherModelsToHighlight(e){if(!e)return[];if(e.uri.scheme===Bt.vscodeNotebookCell){let t=[],n=this.codeEditorService.listCodeEditors();for(let r of n){let n=r.getModel();n&&n!==e&&n.uri.scheme===Bt.vscodeNotebookCell&&t.push(n)}return t}let t=[],n=this.codeEditorService.listCodeEditors();for(let r of n){if(!Ya(r))continue;let n=r.getModel();n&&e===n.modified&&t.push(n.modified)}if(t.length)return t;if(this.occurrencesHighlight===`singleFile`)return[];for(let r of n){let n=r.getModel();n&&n!==e&&t.push(n)}return t}_run(e){let t;if(this.editor.hasTextFocus()){let e=this.editor.getSelection();if(!e||e.startLineNumber!==e.endLineNumber){OM.query=null,this._stopAll();return}let n=e.startColumn,r=e.endColumn,i=this._getWord();if(!i||i.startColumn>n||i.endColumn<r){OM.query=null,this._stopAll();return}t=this.workerRequest&&this.workerRequest.isValid(this.model,e,this.decorations),OM.query={modelInfo:{model:this.model,selection:e},word:i}}else if(!OM.query){this._stopAll();return}if(this.lastCursorPositionChangeTime=new Date().getTime(),t)this.workerRequestCompleted&&this.renderDecorationsTimer!==-1&&(clearTimeout(this.renderDecorationsTimer),this.renderDecorationsTimer=-1,this._beginRenderDecorations());else if(qc(this.editor.getModel().uri,OM.query.modelInfo?.model.uri)){if(!e){let e=this.decorations.getRanges();for(let t of e)if(t.containsPosition(this.editor.getPosition()))return}this._stopAll(e?this.model:void 0);let t=++this.workerRequestTokenId;this.workerRequestCompleted=!1;let n=this.getOtherModelsToHighlight(this.editor.getModel());if(!OM.query||!OM.query.modelInfo||OM.query.modelInfo.model.isDisposed())return;this.workerRequest=this.computeWithModel(OM.query.modelInfo.model,OM.query.modelInfo.selection,OM.query.word,n),this.workerRequest?.result.then(e=>{t===this.workerRequestTokenId&&(this.workerRequestCompleted=!0,this.workerRequestValue=e||[],this._beginRenderDecorations())},C)}}computeWithModel(e,t,n,r){return r.length?LM(this.multiDocumentProviders,e,t,n,this.editor.getOption(132),r):IM(this.providers,e,t,n,this.editor.getOption(132))}_beginRenderDecorations(){let e=new Date().getTime(),t=this.lastCursorPositionChangeTime+250;e>=t?(this.renderDecorationsTimer=-1,this.renderDecorations()):this.renderDecorationsTimer=setTimeout(()=>{this.renderDecorations()},t-e)}renderDecorations(){this.renderDecorationsTimer=-1;let e=this.codeEditorService.listCodeEditors();for(let t of e){let e=zM.get(t);if(!e)continue;let n=[],r=t.getModel()?.uri;if(r&&this.workerRequestValue.has(r)){let i=OM.storedDecorationIDs.get(r),a=this.workerRequestValue.get(r);if(a)for(let e of a)e.range&&n.push({range:e.range,options:JD(e.kind)});let o=[];t.changeDecorations(e=>{o=e.deltaDecorations(i??[],n)}),OM.storedDecorationIDs=OM.storedDecorationIDs.set(r,o),n.length>0&&(e.wordHighlighter?.decorations.set(n),e.wordHighlighter?._hasWordHighlights.set(!0))}}}dispose(){this._stopSingular(),this.toUnhook.dispose()}};RM=OM=EM([DM(4,Ko)],RM);var zM=class extends _{static#e=kM=this;static#t=this.ID=`editor.contrib.wordHighlighter`;static get(e){return e.getContribution(kM.ID)}constructor(e,t,n,r){super(),this._wordHighlighter=null;let i=()=>{e.hasModel()&&!e.getModel().isTooLargeForTokenization()&&(this._wordHighlighter=new RM(e,n.documentHighlightProvider,n.multiDocumentHighlightProvider,t,r))};this._register(e.onDidChangeModel(e=>{this._wordHighlighter&&=(this._wordHighlighter.dispose(),null),i()})),i()}get wordHighlighter(){return this._wordHighlighter}saveViewState(){return!!(this._wordHighlighter&&this._wordHighlighter.hasDecorations())}moveNext(){this._wordHighlighter?.moveNext()}moveBack(){this._wordHighlighter?.moveBack()}restoreViewState(e){this._wordHighlighter&&e&&this._wordHighlighter.restore()}dispose(){this._wordHighlighter&&=(this._wordHighlighter.dispose(),null),super.dispose()}};zM=kM=EM([DM(1,W),DM(2,V),DM(3,Ko)],zM);var BM=class extends N{constructor(e,t){super(t),this._isNext=e}run(e,t){let n=zM.get(t);n&&(this._isNext?n.moveNext():n.moveBack())}},VM=class extends BM{constructor(){super(!0,{id:`editor.action.wordHighlight.next`,label:S(`wordHighlight.next.label`,`Go to Next Symbol Highlight`),alias:`Go to Next Symbol Highlight`,precondition:AM,kbOpts:{kbExpr:q.editorTextFocus,primary:65,weight:100}})}},HM=class extends BM{constructor(){super(!1,{id:`editor.action.wordHighlight.prev`,label:S(`wordHighlight.previous.label`,`Go to Previous Symbol Highlight`),alias:`Go to Previous Symbol Highlight`,precondition:AM,kbOpts:{kbExpr:q.editorTextFocus,primary:1089,weight:100}})}},UM=class extends N{constructor(){super({id:`editor.action.wordHighlight.trigger`,label:S(`wordHighlight.trigger.label`,`Trigger Symbol Highlight`),alias:`Trigger Symbol Highlight`,precondition:void 0,kbOpts:{kbExpr:q.editorTextFocus,primary:0,weight:100}})}run(e,t,n){let r=zM.get(t);r&&r.restoreViewState(!0)}};I(zM.ID,zM,0),L(VM),L(HM),L(UM),wl(TM);var WM=class extends la{constructor(e){super(e),this._inSelectionMode=e.inSelectionMode,this._wordNavigationType=e.wordNavigationType}runEditorCommand(e,t,n){if(!t.hasModel())return;let i=ts(t.getOption(132),t.getOption(131)),a=t.getModel(),o=t.getSelections(),s=o.length>1,c=o.map(e=>{let t=new r(e.positionLineNumber,e.positionColumn),n=this._move(i,a,t,this._wordNavigationType,s);return this._moveTo(e,n,this._inSelectionMode)});if(a.pushStackElement(),t._getViewModel().setCursorStates(`moveWordCommand`,3,c.map(e=>Is.fromModelSelection(e))),c.length===1){let e=new r(c[0].positionLineNumber,c[0].positionColumn);t.revealPosition(e,0)}}_moveTo(e,t,n){return n?new v(e.selectionStartLineNumber,e.selectionStartColumn,t.lineNumber,t.column):new v(t.lineNumber,t.column,t.lineNumber,t.column)}},GM=class extends WM{_move(e,t,n,r,i){return al.moveWordLeft(e,t,n,r,i)}},KM=class extends WM{_move(e,t,n,r,i){return al.moveWordRight(e,t,n,r)}},qM=class extends GM{constructor(){super({inSelectionMode:!1,wordNavigationType:0,id:`cursorWordStartLeft`,precondition:void 0})}},JM=class extends GM{constructor(){super({inSelectionMode:!1,wordNavigationType:2,id:`cursorWordEndLeft`,precondition:void 0})}},YM=class extends GM{constructor(){super({inSelectionMode:!1,wordNavigationType:1,id:`cursorWordLeft`,precondition:void 0,kbOpts:{kbExpr:z.and(q.textInputFocus,z.and(ci,po)?.negate()),primary:2063,mac:{primary:527},weight:100}})}},XM=class extends GM{constructor(){super({inSelectionMode:!0,wordNavigationType:0,id:`cursorWordStartLeftSelect`,precondition:void 0})}},ZM=class extends GM{constructor(){super({inSelectionMode:!0,wordNavigationType:2,id:`cursorWordEndLeftSelect`,precondition:void 0})}},QM=class extends GM{constructor(){super({inSelectionMode:!0,wordNavigationType:1,id:`cursorWordLeftSelect`,precondition:void 0,kbOpts:{kbExpr:z.and(q.textInputFocus,z.and(ci,po)?.negate()),primary:3087,mac:{primary:1551},weight:100}})}},$M=class extends GM{constructor(){super({inSelectionMode:!1,wordNavigationType:3,id:`cursorWordAccessibilityLeft`,precondition:void 0})}_move(e,t,n,r,i){return super._move(ts(xn.wordSeparators.defaultValue,e.intlSegmenterLocales),t,n,r,i)}},eN=class extends GM{constructor(){super({inSelectionMode:!0,wordNavigationType:3,id:`cursorWordAccessibilityLeftSelect`,precondition:void 0})}_move(e,t,n,r,i){return super._move(ts(xn.wordSeparators.defaultValue,e.intlSegmenterLocales),t,n,r,i)}},tN=class extends KM{constructor(){super({inSelectionMode:!1,wordNavigationType:0,id:`cursorWordStartRight`,precondition:void 0})}},nN=class extends KM{constructor(){super({inSelectionMode:!1,wordNavigationType:2,id:`cursorWordEndRight`,precondition:void 0,kbOpts:{kbExpr:z.and(q.textInputFocus,z.and(ci,po)?.negate()),primary:2065,mac:{primary:529},weight:100}})}},rN=class extends KM{constructor(){super({inSelectionMode:!1,wordNavigationType:2,id:`cursorWordRight`,precondition:void 0})}},iN=class extends KM{constructor(){super({inSelectionMode:!0,wordNavigationType:0,id:`cursorWordStartRightSelect`,precondition:void 0})}},aN=class extends KM{constructor(){super({inSelectionMode:!0,wordNavigationType:2,id:`cursorWordEndRightSelect`,precondition:void 0,kbOpts:{kbExpr:z.and(q.textInputFocus,z.and(ci,po)?.negate()),primary:3089,mac:{primary:1553},weight:100}})}},oN=class extends KM{constructor(){super({inSelectionMode:!0,wordNavigationType:2,id:`cursorWordRightSelect`,precondition:void 0})}},sN=class extends KM{constructor(){super({inSelectionMode:!1,wordNavigationType:3,id:`cursorWordAccessibilityRight`,precondition:void 0})}_move(e,t,n,r,i){return super._move(ts(xn.wordSeparators.defaultValue,e.intlSegmenterLocales),t,n,r,i)}},cN=class extends KM{constructor(){super({inSelectionMode:!0,wordNavigationType:3,id:`cursorWordAccessibilityRightSelect`,precondition:void 0})}_move(e,t,n,r,i){return super._move(ts(xn.wordSeparators.defaultValue,e.intlSegmenterLocales),t,n,r,i)}},lN=class extends la{constructor(e){super(e),this._whitespaceHeuristics=e.whitespaceHeuristics,this._wordNavigationType=e.wordNavigationType}runEditorCommand(e,t,n){let r=e.get(Ci);if(!t.hasModel())return;let i=ts(t.getOption(132),t.getOption(131)),a=t.getModel(),o=t.getSelections(),s=t.getOption(6),c=t.getOption(11),l=r.getLanguageConfiguration(a.getLanguageId()).getAutoClosingPairs(),u=t._getViewModel(),d=o.map(e=>new Nc(this._delete({wordSeparators:i,model:a,selection:e,whitespaceHeuristics:this._whitespaceHeuristics,autoClosingDelete:t.getOption(9),autoClosingBrackets:s,autoClosingQuotes:c,autoClosingPairs:l,autoClosedCharacters:u.getCursorAutoClosedCharacters()},this._wordNavigationType),``));t.pushUndoStop(),t.executeCommands(this.id,d),t.pushUndoStop()}},uN=class extends lN{_delete(e,t){return al.deleteWordLeft(e,t)||new T(1,1,1,1)}},dN=class extends lN{_delete(e,t){let n=al.deleteWordRight(e,t);if(n)return n;let r=e.model.getLineCount(),i=e.model.getLineMaxColumn(r);return new T(r,i,r,i)}},fN=class extends uN{constructor(){super({whitespaceHeuristics:!1,wordNavigationType:0,id:`deleteWordStartLeft`,precondition:q.writable})}},pN=class extends uN{constructor(){super({whitespaceHeuristics:!1,wordNavigationType:2,id:`deleteWordEndLeft`,precondition:q.writable})}},mN=class extends uN{constructor(){super({whitespaceHeuristics:!0,wordNavigationType:0,id:`deleteWordLeft`,precondition:q.writable,kbOpts:{kbExpr:q.textInputFocus,primary:2049,mac:{primary:513},weight:100}})}},hN=class extends dN{constructor(){super({whitespaceHeuristics:!1,wordNavigationType:0,id:`deleteWordStartRight`,precondition:q.writable})}},gN=class extends dN{constructor(){super({whitespaceHeuristics:!1,wordNavigationType:2,id:`deleteWordEndRight`,precondition:q.writable})}},_N=class extends dN{constructor(){super({whitespaceHeuristics:!0,wordNavigationType:2,id:`deleteWordRight`,precondition:q.writable,kbOpts:{kbExpr:q.textInputFocus,primary:2068,mac:{primary:532},weight:100}})}},vN=class extends N{constructor(){super({id:`deleteInsideWord`,precondition:q.writable,label:S(`deleteInsideWord`,`Delete Word`),alias:`Delete Word`})}run(e,t,n){if(!t.hasModel())return;let r=ts(t.getOption(132),t.getOption(131)),i=t.getModel(),a=t.getSelections().map(e=>new Nc(al.deleteInsideWord(r,i,e),``));t.pushUndoStop(),t.executeCommands(this.id,a),t.pushUndoStop()}};P(new qM),P(new JM),P(new YM),P(new XM),P(new ZM),P(new QM),P(new tN),P(new nN),P(new rN),P(new iN),P(new aN),P(new oN),P(new $M),P(new eN),P(new sN),P(new cN),P(new fN),P(new pN),P(new mN),P(new hN),P(new gN),P(new _N),L(vN);var yN=class extends lN{constructor(){super({whitespaceHeuristics:!0,wordNavigationType:0,id:`deleteWordPartLeft`,precondition:q.writable,kbOpts:{kbExpr:q.textInputFocus,primary:0,mac:{primary:769},weight:100}})}_delete(e,t){return _s.deleteWordPartLeft(e)||new T(1,1,1,1)}},bN=class extends lN{constructor(){super({whitespaceHeuristics:!0,wordNavigationType:2,id:`deleteWordPartRight`,precondition:q.writable,kbOpts:{kbExpr:q.textInputFocus,primary:0,mac:{primary:788},weight:100}})}_delete(e,t){let n=_s.deleteWordPartRight(e);if(n)return n;let r=e.model.getLineCount(),i=e.model.getLineMaxColumn(r);return new T(r,i,r,i)}},xN=class extends WM{_move(e,t,n,r,i){return _s.moveWordPartLeft(e,t,n,i)}},SN=class extends xN{constructor(){super({inSelectionMode:!1,wordNavigationType:0,id:`cursorWordPartLeft`,precondition:void 0,kbOpts:{kbExpr:q.textInputFocus,primary:0,mac:{primary:783},weight:100}})}};B.registerCommandAlias(`cursorWordPartStartLeft`,`cursorWordPartLeft`);var CN=class extends xN{constructor(){super({inSelectionMode:!0,wordNavigationType:0,id:`cursorWordPartLeftSelect`,precondition:void 0,kbOpts:{kbExpr:q.textInputFocus,primary:0,mac:{primary:1807},weight:100}})}};B.registerCommandAlias(`cursorWordPartStartLeftSelect`,`cursorWordPartLeftSelect`);var wN=class extends WM{_move(e,t,n,r,i){return _s.moveWordPartRight(e,t,n)}},TN=class extends wN{constructor(){super({inSelectionMode:!1,wordNavigationType:2,id:`cursorWordPartRight`,precondition:void 0,kbOpts:{kbExpr:q.textInputFocus,primary:0,mac:{primary:785},weight:100}})}},EN=class extends wN{constructor(){super({inSelectionMode:!0,wordNavigationType:2,id:`cursorWordPartRightSelect`,precondition:void 0,kbOpts:{kbExpr:q.textInputFocus,primary:0,mac:{primary:1809},weight:100}})}};P(new yN),P(new bN),P(new SN),P(new CN),P(new TN),P(new EN);var DN=class extends _{static#e=this.ID=`editor.contrib.readOnlyMessageController`;constructor(e){super(),this.editor=e,this._register(this.editor.onDidAttemptReadOnlyEdit(()=>this._onDidAttemptReadOnlyEdit()))}_onDidAttemptReadOnlyEdit(){let e=Sd.get(this.editor);if(e&&this.editor.hasModel()){let t=this.editor.getOptions().get(93);t||=this.editor.isSimpleWidget?new Va(S(`editor.simple.readonly`,`Cannot edit in read-only input`)):new Va(S(`editor.readonly`,`Cannot edit in read-only editor`)),e.showMessage(t,this.editor.getPosition())}}};I(DN.ID,DN,2);var ON=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},kN=function(e,t){return function(n,r){t(n,r,e)}},AN=class extends _{constructor(e,t,n){super(),this._textModel=e,this._languageFeaturesService=t,this._outlineModelService=n,this._currentModel=uc(this,void 0);let r=Oo(`documentSymbolProvider.onDidChange`,this._languageFeaturesService.documentSymbolProvider.onDidChange),i=Oo(`_textModel.onDidChangeContent`,we.debounce(e=>this._textModel.onDidChangeContent(e),()=>void 0,100));this._register(Ss(async(e,t)=>{r.read(e),i.read(e);let n=t.add(new Ni),a=await this._outlineModelService.getOrCreate(this._textModel,n.token);t.isDisposed||this._currentModel.set(a,void 0)}))}getBreadcrumbItems(e,t){let n=this._currentModel.read(t);if(!n)return[];let r=n.asListOfDocumentSymbols().filter(t=>e.contains(t.range.startLineNumber)&&!e.contains(t.range.endLineNumber));return r.sort(vr(cn(e=>e.range.endLineNumber-e.range.startLineNumber,mr))),r.map(e=>({name:e.name,kind:e.kind,startLineNumber:e.range.startLineNumber}))}};AN=ON([kN(1,V),kN(2,Dx)],AN),ec.setBreadcrumbsSourceFactory((e,t)=>t.createInstance(AN,e));var jN=class extends _{static#e=this.ID=`editor.contrib.iPadShowKeyboard`;constructor(e){super(),this.editor=e,this.widget=null,xe&&(this._register(e.onDidChangeConfiguration(()=>this.update())),this.update())}update(){let e=!this.editor.getOption(92);!this.widget&&e?this.widget=new MN(this.editor):this.widget&&!e&&(this.widget.dispose(),this.widget=null)}dispose(){super.dispose(),this.widget&&=(this.widget.dispose(),null)}},MN=class e extends _{static#e=this.ID=`editor.contrib.ShowKeyboardWidget`;constructor(e){super(),this.editor=e,this._domNode=document.createElement(`textarea`),this._domNode.className=`iPadShowKeyboard`,this._register(D(this._domNode,`touchstart`,e=>{this.editor.focus()})),this._register(D(this._domNode,`focus`,e=>{this.editor.focus()})),this.editor.addOverlayWidget(this)}dispose(){this.editor.removeOverlayWidget(this),super.dispose()}getId(){return e.ID}getDomNode(){return this._domNode}getPosition(){return{preference:1}}};I(jN.ID,jN,3);var NN=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},PN=function(e,t){return function(n,r){t(n,r,e)}},FN,IN=class extends _{static#e=FN=this;static#t=this.ID=`editor.contrib.inspectTokens`;static get(e){return e.getContribution(FN.ID)}constructor(e,t,n){super(),this._editor=e,this._languageService=n,this._widget=null,this._register(this._editor.onDidChangeModel(e=>this.stop())),this._register(this._editor.onDidChangeModelLanguage(e=>this.stop())),this._register(He.onDidChange(e=>this.stop())),this._register(this._editor.onKeyUp(e=>e.keyCode===9&&this.stop()))}dispose(){this.stop(),super.dispose()}launch(){this._widget||this._editor.hasModel()&&(this._widget=new BN(this._editor,this._languageService))}stop(){this._widget&&=(this._widget.dispose(),null)}};IN=FN=NN([PN(1,so),PN(2,Ys)],IN);var LN=class extends N{constructor(){super({id:`editor.action.inspectTokens`,label:ul.inspectTokensAction,alias:`Developer: Inspect Tokens`,precondition:void 0})}run(e,t){IN.get(t)?.launch()}};function RN(e){let t=``;for(let n=0,r=e.length;n<r;n++){let r=e.charCodeAt(n);switch(r){case 9:t+=``;break;case 32:t+=``;break;default:t+=String.fromCharCode(r)}}return t}function zN(e,t){let n=He.get(t);if(n)return n;let r=e.encodeLanguageId(t);return{getInitialState:()=>Co,tokenize:(e,n,r)=>Li(t,r),tokenizeEncoded:(e,t,n)=>oa(r,n)}}var BN=class e extends _{static#e=this._ID=`editor.contrib.inspectTokensWidget`;constructor(e,t){super(),this.allowEditorOverflow=!0,this._editor=e,this._languageService=t,this._model=this._editor.getModel(),this._domNode=document.createElement(`div`),this._domNode.className=`tokens-inspect-widget`,this._tokenizationSupport=zN(this._languageService.languageIdCodec,this._model.getLanguageId()),this._compute(this._editor.getPosition()),this._register(this._editor.onDidChangeCursorPosition(e=>this._compute(this._editor.getPosition()))),this._editor.addContentWidget(this)}dispose(){this._editor.removeContentWidget(this),super.dispose()}getId(){return e._ID}_compute(e){let t=this._getTokensAtLine(e.lineNumber),n=0;for(let r=t.tokens1.length-1;r>=0;r--){let i=t.tokens1[r];if(e.column-1>=i.offset){n=r;break}}let r=0;for(let n=t.tokens2.length>>>1;n>=0;n--)if(e.column-1>=t.tokens2[n<<1]){r=n;break}let i=this._model.getLineContent(e.lineNumber),a=``;if(n<t.tokens1.length){let e=t.tokens1[n].offset,r=n+1<t.tokens1.length?t.tokens1[n+1].offset:i.length;a=i.substring(e,r)}Ar(this._domNode,O(`h2.tm-token`,void 0,RN(a),O(`span.tm-token-length`,void 0,`${a.length} ${a.length===1?`char`:`chars`}`))),M(this._domNode,O(`hr.tokens-inspect-separator`,{style:`clear:both`}));let o=(r<<1)+1<t.tokens2.length?this._decodeMetadata(t.tokens2[(r<<1)+1]):null;M(this._domNode,O(`table.tm-metadata-table`,void 0,O(`tbody`,void 0,O(`tr`,void 0,O(`td.tm-metadata-key`,void 0,`language`),O(`td.tm-metadata-value`,void 0,`${o?o.languageId:`-?-`}`)),O(`tr`,void 0,O(`td.tm-metadata-key`,void 0,`token type`),O(`td.tm-metadata-value`,void 0,`${o?this._tokenTypeToString(o.tokenType):`-?-`}`)),O(`tr`,void 0,O(`td.tm-metadata-key`,void 0,`font style`),O(`td.tm-metadata-value`,void 0,`${o?this._fontStyleToString(o.fontStyle):`-?-`}`)),O(`tr`,void 0,O(`td.tm-metadata-key`,void 0,`foreground`),O(`td.tm-metadata-value`,void 0,`${o?E.Format.CSS.formatHex(o.foreground):`-?-`}`)),O(`tr`,void 0,O(`td.tm-metadata-key`,void 0,`background`),O(`td.tm-metadata-value`,void 0,`${o?E.Format.CSS.formatHex(o.background):`-?-`}`))))),M(this._domNode,O(`hr.tokens-inspect-separator`)),n<t.tokens1.length&&M(this._domNode,O(`span.tm-token-type`,void 0,t.tokens1[n].type)),this._editor.layoutContentWidget(this)}_decodeMetadata(e){let t=He.getColorMap(),n=Ic.getLanguageId(e),r=Ic.getTokenType(e),i=Ic.getFontStyle(e),a=Ic.getForeground(e),o=Ic.getBackground(e);return{languageId:this._languageService.languageIdCodec.decodeLanguageId(n),tokenType:r,fontStyle:i,foreground:t[a],background:t[o]}}_tokenTypeToString(e){switch(e){case 0:return`Other`;case 1:return`Comment`;case 2:return`String`;case 3:return`RegEx`;default:return`??`}}_fontStyleToString(e){let t=``;return e&1&&(t+=`italic `),e&2&&(t+=`bold `),e&4&&(t+=`underline `),e&8&&(t+=`strikethrough `),t.length===0&&(t=`---`),t}_getTokensAtLine(e){let t=this._getStateBeforeLine(e),n=this._tokenizationSupport.tokenize(this._model.getLineContent(e),!0,t),r=this._tokenizationSupport.tokenizeEncoded(this._model.getLineContent(e),!0,t);return{startState:t,tokens1:n.tokens,tokens2:r.tokens,endState:n.endState}}_getStateBeforeLine(e){let t=this._tokenizationSupport.getInitialState();for(let n=1;n<e;n++)t=this._tokenizationSupport.tokenize(this._model.getLineContent(n),!0,t).endState;return t}getDomNode(){return this._domNode}getPosition(){return{position:this._editor.getPosition(),preference:[2,1]}}};I(IN.ID,IN,4),L(LN);var VN=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},HN=function(e,t){return function(n,r){t(n,r,e)}},UN,WN=class{static#e=UN=this;static#t=this.PREFIX=`?`;constructor(e,t){this.quickInputService=e,this.keybindingService=t,this.registry=un.as(Ws.Quickaccess)}provide(e){let t=new n;return t.add(e.onDidAccept(()=>{let[t]=e.selectedItems;t&&this.quickInputService.quickAccess.show(t.prefix,{preserveValue:!0})})),t.add(e.onDidChangeValue(e=>{let t=this.registry.getQuickAccessProvider(e.substr(UN.PREFIX.length));t&&t.prefix&&t.prefix!==UN.PREFIX&&this.quickInputService.quickAccess.show(t.prefix,{preserveValue:!0})})),e.items=this.getQuickAccessProviders().filter(e=>e.prefix!==UN.PREFIX),t}getQuickAccessProviders(){return this.registry.getQuickAccessProviders().sort((e,t)=>e.prefix.localeCompare(t.prefix)).flatMap(e=>this.createPicks(e))}createPicks(e){return e.helpEntries.map(t=>{let n=t.prefix||e.prefix,r=n||``;return{prefix:n,label:r,keybinding:t.commandId?this.keybindingService.lookupKeybinding(t.commandId):void 0,ariaLabel:S(`helpPickAriaLabel`,`{0}, {1}`,r,t.description),description:t.description}})}};WN=UN=VN([HN(0,xc),HN(1,ua)],WN),un.as(Ws.Quickaccess).registerQuickAccessProvider({ctor:WN,prefix:``,helpEntries:[{description:as.helpQuickAccessActionLabel}]});var GN=class{constructor(e){this.options=e,this.rangeHighlightDecorationId=void 0}provide(e,t,r){let i=new n;e.canAcceptInBackground=!!this.options?.canAcceptInBackground,e.matchOnLabel=e.matchOnDescription=e.matchOnDetail=e.sortByLabel=!1;let a=i.add(new l);return a.value=this.doProvide(e,t,r),i.add(this.onDidActiveTextEditorControlChange(()=>{a.value=void 0,a.value=this.doProvide(e,t)})),i}doProvide(e,t,r){let i=new n,a=this.activeTextEditorControl;if(a&&this.canProvideWithTextEditor(a)){let n={editor:a},o=es(a);if(o){let e=a.saveViewState()??void 0;i.add(o.onDidChangeCursorPosition(()=>{e=a.saveViewState()??void 0})),n.restoreViewState=()=>{e&&a===this.activeTextEditorControl&&a.restoreViewState(e)},i.add(te(t.onCancellationRequested)(()=>n.restoreViewState?.()))}i.add(b(()=>this.clearDecorations(a))),i.add(this.provideWithTextEditor(n,e,t,r))}else i.add(this.provideWithoutTextEditor(e,t));return i}canProvideWithTextEditor(e){return!0}gotoLocation({editor:e},t){e.setSelection(t.range,`code.jump`),e.revealRangeInCenter(t.range,0),t.preserveFocus||e.focus();let n=e.getModel();n&&`getLineContent`in n&&Il(`${n.getLineContent(t.range.startLineNumber)}`)}getModel(e){return Ya(e)?e.getModel()?.modified:e.getModel()}addDecorations(e,t){e.changeDecorations(e=>{let n=[];this.rangeHighlightDecorationId&&=(n.push(this.rangeHighlightDecorationId.overviewRulerDecorationId),n.push(this.rangeHighlightDecorationId.rangeHighlightId),void 0);let r=[{range:t,options:{description:`quick-access-range-highlight`,className:`rangeHighlight`,isWholeLine:!0}},{range:t,options:{description:`quick-access-range-highlight-overview`,overviewRuler:{color:Bc(Ol),position:sl.Full}}}],[i,a]=e.deltaDecorations(n,r);this.rangeHighlightDecorationId={rangeHighlightId:i,overviewRulerDecorationId:a}})}clearDecorations(e){let t=this.rangeHighlightDecorationId;t&&(e.changeDecorations(e=>{e.deltaDecorations([t.overviewRulerDecorationId,t.rangeHighlightId],[])}),this.rangeHighlightDecorationId=void 0)}},KN=class e extends GN{static#e=this.PREFIX=`:`;constructor(){super({canAcceptInBackground:!0})}provideWithoutTextEditor(e){let t=S(`cannotRunGotoLine`,`Open a text editor first to go to a line.`);return e.items=[{label:t}],e.ariaLabel=t,_.None}provideWithTextEditor(t,r,i){let a=t.editor,o=new n;o.add(r.onDidAccept(e=>{let[n]=r.selectedItems;if(n){if(!this.isValidLineNumber(a,n.lineNumber))return;this.gotoLocation(t,{range:this.toRange(n.lineNumber,n.column),keyMods:r.keyMods,preserveFocus:e.inBackground}),e.inBackground||r.hide()}}));let s=()=>{let t=this.parsePosition(a,r.value.trim().substr(e.PREFIX.length)),n=this.getPickLabel(a,t.lineNumber,t.column);if(r.items=[{lineNumber:t.lineNumber,column:t.column,label:n}],r.ariaLabel=n,!this.isValidLineNumber(a,t.lineNumber)){this.clearDecorations(a);return}let i=this.toRange(t.lineNumber,t.column);a.revealRangeInCenter(i,0),this.addDecorations(a,i)};s(),o.add(r.onDidChangeValue(()=>s()));let c=es(a);return c&&c.getOptions().get(68).renderType===2&&(c.updateOptions({lineNumbers:`on`}),o.add(b(()=>c.updateOptions({lineNumbers:`relative`})))),o}toRange(e=1,t=1){return{startLineNumber:e,startColumn:t,endLineNumber:e,endColumn:t}}parsePosition(e,t){let n=t.split(/,|:|#/).map(e=>parseInt(e,10)).filter(e=>!isNaN(e)),r=this.lineCount(e)+1;return{lineNumber:n[0]>0?n[0]:r+n[0],column:n[1]}}getPickLabel(e,t,n){if(this.isValidLineNumber(e,t))return this.isValidColumn(e,t,n)?S(`gotoLineColumnLabel`,`Go to line {0} and character {1}.`,t,n):S(`gotoLineLabel`,`Go to line {0}.`,t);let r=e.getPosition()||{lineNumber:1,column:1},i=this.lineCount(e);return i>1?S(`gotoLineLabelEmptyWithLimit`,`Current Line: {0}, Character: {1}. Type a line number between 1 and {2} to navigate to.`,r.lineNumber,r.column,i):S(`gotoLineLabelEmpty`,`Current Line: {0}, Character: {1}. Type a line number to navigate to.`,r.lineNumber,r.column)}isValidLineNumber(e,t){return!t||typeof t!=`number`?!1:t>0&&t<=this.lineCount(e)}isValidColumn(e,t,n){if(!n||typeof n!=`number`)return!1;let r=this.getModel(e);if(!r)return!1;let i={lineNumber:t,column:n};return r.validatePosition(i).equals(i)}lineCount(e){return this.getModel(e)?.getLineCount()??0}},qN=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},JN=function(e,t){return function(n,r){t(n,r,e)}},YN=class extends KN{constructor(e){super(),this.editorService=e,this.onDidActiveTextEditorControlChange=we.None}get activeTextEditorControl(){return this.editorService.getFocusedCodeEditor()??void 0}};YN=qN([JN(0,Ko)],YN);var XN=class e extends N{static#e=this.ID=`editor.action.gotoLine`;constructor(){super({id:e.ID,label:qo.gotoLineActionLabel,alias:`Go to Line/Column...`,precondition:void 0,kbOpts:{kbExpr:q.focus,primary:2085,mac:{primary:293},weight:100}})}run(e){e.get(xc).quickAccess.show(YN.PREFIX)}};L(XN),un.as(Ws.Quickaccess).registerQuickAccessProvider({ctor:YN,prefix:YN.PREFIX,helpEntries:[{description:qo.gotoLineActionLabel,commandId:XN.ID}]});var ZN=[void 0,[]];function QN(e,t,n=0,r=0){let i=t;return i.values&&i.values.length>1?$N(e,i.values,n,r):eP(e,t,n,r)}function $N(e,t,n,r){let i=0,a=[];for(let o of t){let[t,s]=eP(e,o,n,r);if(typeof t!=`number`)return ZN;i+=t,a.push(...s)}return[i,tP(a)]}function eP(e,t,n,r){let i=Ms(t.original,t.originalLowercase,n,e,e.toLowerCase(),r,{firstMatchCanBeWeak:!0,boostFullMatch:!0});return i?[i[0],Rs(i)]:ZN}Object.freeze({score:0});function tP(e){let t=e.sort((e,t)=>e.start-t.start),n=[],r;for(let e of t)!r||!nP(r,e)?(r=e,n.push(e)):(r.start=Math.min(r.start,e.start),r.end=Math.max(r.end,e.end));return n}function nP(e,t){return!(e.end<t.start||t.end<e.start)}function rP(e){return e.startsWith(`"`)&&e.endsWith(`"`)}var iP=` `;function aP(e){typeof e!=`string`&&(e=``);let t=e.toLowerCase(),{pathNormalized:n,normalized:r,normalizedLowercase:i}=oP(e),a=n.indexOf(de)>=0,o=rP(e),s,c=e.split(iP);if(c.length>1)for(let e of c){let t=rP(e),{pathNormalized:n,normalized:r,normalizedLowercase:i}=oP(e);r&&(s||=[],s.push({original:e,originalLowercase:e.toLowerCase(),pathNormalized:n,normalized:r,normalizedLowercase:i,expectContiguousMatch:t}))}return{original:e,originalLowercase:t,pathNormalized:n,normalized:r,normalizedLowercase:i,values:s,containsPathSeparator:a,expectContiguousMatch:o}}function oP(e){let t;t=_e?e.replace(/\//g,de):e.replace(/\\/g,de);let n=nt(t).replace(/\s|"/g,``);return{pathNormalized:t,normalized:n,normalizedLowercase:n.toLowerCase()}}function sP(e){return aP(Array.isArray(e)?e.map(e=>e.original).join(iP):e.original)}var cP=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},lP=function(e,t){return function(n,r){t(n,r,e)}},uP,dP=class extends GN{static#e=uP=this;static#t=this.PREFIX=`@`;static#n=this.SCOPE_PREFIX=`:`;static#r=this.PREFIX_BY_CATEGORY=`${this.PREFIX}${this.SCOPE_PREFIX}`;constructor(e,t,n=Object.create(null)){super(n),this._languageFeaturesService=e,this._outlineModelService=t,this.options=n,this.options.canAcceptInBackground=!0}provideWithoutTextEditor(e){return this.provideLabelPick(e,S(`cannotRunGotoSymbolWithoutEditor`,`To go to a symbol, first open a text editor with symbol information.`)),_.None}provideWithTextEditor(e,t,n,r){let i=e.editor,a=this.getModel(i);return a?this._languageFeaturesService.documentSymbolProvider.has(a)?this.doProvideWithEditorSymbols(e,a,t,n,r):this.doProvideWithoutEditorSymbols(e,a,t,n):_.None}doProvideWithoutEditorSymbols(e,t,r,i){let a=new n;return this.provideLabelPick(r,S(`cannotRunGotoSymbolWithoutSymbolProvider`,`The active text editor does not provide symbol information.`)),(async()=>{!await this.waitForLanguageSymbolRegistry(t,a)||i.isCancellationRequested||a.add(this.doProvideWithEditorSymbols(e,t,r,i))})(),a}provideLabelPick(e,t){e.items=[{label:t,index:0,kind:14}],e.ariaLabel=t}async waitForLanguageSymbolRegistry(e,t){if(this._languageFeaturesService.documentSymbolProvider.has(e))return!0;let n=new Zn,r=t.add(this._languageFeaturesService.documentSymbolProvider.onDidChange(()=>{this._languageFeaturesService.documentSymbolProvider.has(e)&&(r.dispose(),n.complete(!0))}));return t.add(b(()=>n.complete(!1))),n.p}doProvideWithEditorSymbols(e,t,r,i,a){let o=e.editor,s=new n;s.add(r.onDidAccept(t=>{let[n]=r.selectedItems;n&&n.range&&(this.gotoLocation(e,{range:n.range.selection,keyMods:r.keyMods,preserveFocus:t.inBackground}),a?.handleAccept?.(n),t.inBackground||r.hide())})),s.add(r.onDidTriggerItemButton(({item:t})=>{t&&t.range&&(this.gotoLocation(e,{range:t.range.selection,keyMods:r.keyMods,forceSideBySide:!0}),r.hide())}));let c=this.getDocumentSymbols(t,i),l,u=async e=>{l?.dispose(!0),r.busy=!1,l=new ie(i),r.busy=!0;try{let n=aP(r.value.substr(uP.PREFIX.length).trim()),a=await this.doGetSymbolPicks(c,n,void 0,l.token,t);if(i.isCancellationRequested)return;if(a.length>0){if(r.items=a,e&&n.original.length===0){let t=ws(a,t=>!!(t.type!==`separator`&&t.range&&T.containsPosition(t.range.decoration,e)));t&&(r.activeItems=[t])}}else n.original.length>0?this.provideLabelPick(r,S(`noMatchingSymbolResults`,`No matching editor symbols`)):this.provideLabelPick(r,S(`noSymbolResults`,`No editor symbols`))}finally{i.isCancellationRequested||(r.busy=!1)}};return s.add(r.onDidChangeValue(()=>u(void 0))),u(o.getSelection()?.getPosition()),s.add(r.onDidChangeActive(()=>{let[e]=r.activeItems;e&&e.range&&(o.revealRangeInCenter(e.range.selection,0),this.addDecorations(o,e.range.decoration))})),s}async doGetSymbolPicks(e,t,n,r,a){let o=await e;if(r.isCancellationRequested)return[];let s=t.original.indexOf(uP.SCOPE_PREFIX)===0,c=s?1:0,l,u;t.values&&t.values.length>1?(l=sP(t.values[0]),u=sP(t.values.slice(1))):l=t;let d,f=this.options?.openSideBySideDirection?.();f&&(d=[{iconClass:f===`right`?J.asClassName(i.splitHorizontal):J.asClassName(i.splitVertical),tooltip:f===`right`?S(`openToSide`,`Open to the Side`):S(`openToBottom`,`Open to the Bottom`)}]);let p=[];for(let e=0;e<o.length;e++){let r=o[e],i=Lr(r.name),s=`$(${ye.toIcon(r.kind).id}) ${i}`,f=s.length-i.length,m=r.containerName;n?.extraContainerLabel&&(m=m?`${n.extraContainerLabel}  ${m}`:n.extraContainerLabel);let h,g,ee,te;if(t.original.length>c){let e=!1;if(l!==t&&([h,g]=QN(s,{...t,values:void 0},c,f),typeof h==`number`&&(e=!0)),typeof h!=`number`&&([h,g]=QN(s,l,c,f),typeof h!=`number`))continue;if(!e&&u){if(m&&u.original.length>0&&([ee,te]=QN(m,u)),typeof ee!=`number`)continue;typeof h==`number`&&(h+=ee)}}let _=r.tags&&r.tags.indexOf(1)>=0;p.push({index:e,kind:r.kind,score:h,label:s,ariaLabel:Ue(r.name,r.kind),description:m,highlights:_?void 0:{label:g,description:te},range:{selection:T.collapseToStart(r.selectionRange),decoration:r.range},uri:a.uri,symbolName:i,strikethrough:_,buttons:d})}let m=p.sort((e,t)=>s?this.compareByKindAndScore(e,t):this.compareByScore(e,t)),h=[];if(s){let e,t,n=0;function r(){t&&typeof e==`number`&&n>0&&(t.label=dn(pP[e]||fP,n))}for(let i of m)e===i.kind?n++:(r(),e=i.kind,n=1,t={type:`separator`},h.push(t)),h.push(i);r()}else m.length>0&&(h=[{label:S(`symbols`,`symbols ({0})`,p.length),type:`separator`},...m]);return h}compareByScore(e,t){if(typeof e.score!=`number`&&typeof t.score==`number`)return 1;if(typeof e.score==`number`&&typeof t.score!=`number`)return-1;if(typeof e.score==`number`&&typeof t.score==`number`){if(e.score>t.score)return-1;if(e.score<t.score)return 1}return e.index<t.index?-1:e.index>t.index?1:0}compareByKindAndScore(e,t){let n=pP[e.kind]||fP,r=pP[t.kind]||fP,i=n.localeCompare(r);return i===0?this.compareByScore(e,t):i}async getDocumentSymbols(e,t){let n=await this._outlineModelService.getOrCreate(e,t);return t.isCancellationRequested?[]:n.asListOfDocumentSymbols()}};dP=uP=cP([lP(0,V),lP(1,Dx)],dP);var fP=S(`property`,`properties ({0})`),pP={5:S(`method`,`methods ({0})`),11:S(`function`,`functions ({0})`),8:S(`_constructor`,`constructors ({0})`),12:S(`variable`,`variables ({0})`),4:S(`class`,`classes ({0})`),22:S(`struct`,`structs ({0})`),23:S(`event`,`events ({0})`),24:S(`operator`,`operators ({0})`),10:S(`interface`,`interfaces ({0})`),2:S(`namespace`,`namespaces ({0})`),3:S(`package`,`packages ({0})`),25:S(`typeParameter`,`type parameters ({0})`),1:S(`modules`,`modules ({0})`),6:S(`property`,`properties ({0})`),9:S(`enum`,`enumerations ({0})`),21:S(`enumMember`,`enumeration members ({0})`),14:S(`string`,`strings ({0})`),0:S(`file`,`files ({0})`),17:S(`array`,`arrays ({0})`),15:S(`number`,`numbers ({0})`),16:S(`boolean`,`booleans ({0})`),18:S(`object`,`objects ({0})`),19:S(`key`,`keys ({0})`),7:S(`field`,`fields ({0})`),13:S(`constant`,`constants ({0})`)},mP=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},hP=function(e,t){return function(n,r){t(n,r,e)}},gP=class extends dP{constructor(e,t,n){super(t,n),this.editorService=e,this.onDidActiveTextEditorControlChange=we.None}get activeTextEditorControl(){return this.editorService.getFocusedCodeEditor()??void 0}};gP=mP([hP(0,Ko),hP(1,V),hP(2,Dx)],gP);var _P=class e extends N{static#e=this.ID=`editor.action.quickOutline`;constructor(){super({id:e.ID,label:Cl.quickOutlineActionLabel,alias:`Go to Symbol...`,precondition:q.hasDocumentSymbolProvider,kbOpts:{kbExpr:q.focus,primary:3117,weight:100},contextMenuOpts:{group:`navigation`,order:3}})}run(e){e.get(xc).quickAccess.show(dP.PREFIX,{itemActivation:Hc.NONE})}};L(_P),un.as(Ws.Quickaccess).registerQuickAccessProvider({ctor:gP,prefix:dP.PREFIX,helpEntries:[{description:Cl.quickOutlineActionLabel,prefix:dP.PREFIX,commandId:_P.ID},{description:Cl.quickOutlineByCategoryActionLabel,prefix:dP.PREFIX_BY_CATEGORY}]});function vP(e){let t=new Map;for(let n of e)t.set(n,(t.get(n)??0)+1);return t}var yP=class e{constructor(){this.chunkCount=0,this.chunkOccurrences=new Map,this.documents=new Map}calculateScores(e,t){let n=this.computeEmbedding(e),r=new Map,i=[];for(let[e,a]of this.documents){if(t.isCancellationRequested)return[];for(let t of a.chunks){let a=this.computeSimilarityScore(t,n,r);a>0&&i.push({key:e,score:a})}}return i}static termFrequencies(t){return vP(e.splitTerms(t))}static*splitTerms(e){let t=e=>e.toLowerCase();for(let[n]of e.matchAll(/\b\p{Letter}[\p{Letter}\d]{2,}\b/gu)){yield t(n);let e=n.replace(/([a-z])([A-Z])/g,`$1 $2`).split(/\s+/g);if(e.length>1)for(let n of e)n.length>2&&/\p{Letter}{3,}/gu.test(n)&&(yield t(n))}}updateDocuments(t){for(let{key:e}of t)this.deleteDocument(e);for(let n of t){let t=[];for(let r of n.textChunks){let n=e.termFrequencies(r);for(let e of n.keys())this.chunkOccurrences.set(e,(this.chunkOccurrences.get(e)??0)+1);t.push({text:r,tf:n})}this.chunkCount+=t.length,this.documents.set(n.key,{chunks:t})}return this}deleteDocument(e){let t=this.documents.get(e);if(t){this.documents.delete(e),this.chunkCount-=t.chunks.length;for(let e of t.chunks)for(let t of e.tf.keys()){let e=this.chunkOccurrences.get(t);if(typeof e==`number`){let n=e-1;n<=0?this.chunkOccurrences.delete(t):this.chunkOccurrences.set(t,n)}}}}computeSimilarityScore(e,t,n){let r=0;for(let[i,a]of Object.entries(t)){let t=e.tf.get(i);if(!t)continue;let o=n.get(i);typeof o!=`number`&&(o=this.computeIdf(i),n.set(i,o));let s=t*o;r+=s*a}return r}computeEmbedding(t){let n=e.termFrequencies(t);return this.computeTfidf(n)}computeIdf(e){let t=this.chunkOccurrences.get(e)??0;return t>0?Math.log((this.chunkCount+1)/t):0}computeTfidf(e){let t=Object.create(null);for(let[n,r]of e){let e=this.computeIdf(n);e>0&&(t[n]=r*e)}return t}};function bP(e){let t=e.slice(0);t.sort((e,t)=>t.score-e.score);let n=t[0]?.score??0;if(n>0)for(let e of t)e.score/=n;return t}var xP;(function(e){e[e.NO_ACTION=0]=`NO_ACTION`,e[e.CLOSE_PICKER=1]=`CLOSE_PICKER`,e[e.REFRESH_PICKER=2]=`REFRESH_PICKER`,e[e.REMOVE_ITEM=3]=`REMOVE_ITEM`})(xP||={});function SP(e){let t=e;return Array.isArray(t.items)}function CP(e){let t=e;return!!t.picks&&t.additionalPicks instanceof Promise}var wP=class extends _{constructor(e,t){super(),this.prefix=e,this.options=t}provide(e,t,r){let i=new n;e.canAcceptInBackground=!!this.options?.canAcceptInBackground,e.matchOnLabel=e.matchOnDescription=e.matchOnDetail=e.sortByLabel=!1;let a,o=i.add(new l),s=async()=>{let i=o.value=new n;a?.dispose(!0),e.busy=!1,a=new ie(t);let s=a.token,c=e.value.substring(this.prefix.length);this.options?.shouldSkipTrimPickFilter||(c=c.trim());let l=this._getPicks(c,i,s,r),u=(t,n)=>{let r,i;if(SP(t)?(r=t.items,i=t.active):r=t,r.length===0){if(n)return!1;(c.length>0||e.hideInput)&&this.options?.noResultsPick&&(r=Te(this.options.noResultsPick)?[this.options.noResultsPick(c)]:[this.options.noResultsPick])}return e.items=r,i&&(e.activeItems=[i]),!0},d=async t=>{let n=!1,r=!1;await Promise.all([(async()=>{typeof t.mergeDelay==`number`&&(await Ot(t.mergeDelay),s.isCancellationRequested)||r||(n=u(t.picks,!0))})(),(async()=>{e.busy=!0;try{let r=await t.additionalPicks;if(s.isCancellationRequested)return;let i,a;SP(t.picks)?(i=t.picks.items,a=t.picks.active):i=t.picks;let o,c;if(SP(r)?(o=r.items,c=r.active):o=r,o.length>0||!n){let t;if(!a&&!c){let n=e.activeItems[0];n&&i.indexOf(n)!==-1&&(t=n)}u({items:[...i,...o],active:a||c||t})}}finally{s.isCancellationRequested||(e.busy=!1),r=!0}})()])};if(l!==null)if(CP(l))await d(l);else if(!(l instanceof Promise))u(l);else{e.busy=!0;try{let e=await l;if(s.isCancellationRequested)return;CP(e)?await d(e):u(e)}finally{s.isCancellationRequested||(e.busy=!1)}}};i.add(e.onDidChangeValue(()=>s())),s(),i.add(e.onDidAccept(t=>{if(r?.handleAccept){t.inBackground||e.hide(),r.handleAccept?.(e.activeItems[0]);return}let[n]=e.selectedItems;typeof n?.accept==`function`&&(t.inBackground||e.hide(),n.accept(e.keyMods,t))}));let c=async(n,r)=>{if(typeof r.trigger!=`function`)return;let i=r.buttons?.indexOf(n)??-1;if(i>=0){let n=r.trigger(i,e.keyMods),a=typeof n==`number`?n:await n;if(t.isCancellationRequested)return;switch(a){case xP.NO_ACTION:break;case xP.CLOSE_PICKER:e.hide();break;case xP.REFRESH_PICKER:s();break;case xP.REMOVE_ITEM:{let t=e.items.indexOf(r);if(t!==-1){let n=e.items.slice(),r=n.splice(t,1),i=e.activeItems.filter(e=>e!==r[0]),a=e.keepScrollPosition;e.keepScrollPosition=!0,e.items=n,i&&(e.activeItems=i),e.keepScrollPosition=a}break}}}};return i.add(e.onDidTriggerItemButton(({button:e,item:t})=>c(e,t))),i.add(e.onDidTriggerSeparatorButton(({button:e,separator:t})=>c(e,t))),i}},TP=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},EP=function(e,t){return function(n,r){t(n,r,e)}},DP,OP,kP=class extends wP{static#e=DP=this;static#t=this.PREFIX=`>`;static#n=this.TFIDF_THRESHOLD=.5;static#r=this.TFIDF_MAX_RESULTS=5;static#i=this.WORD_FILTER=Za(Dl,bl,cl);constructor(e,t,n,r,i,a){super(DP.PREFIX,e),this.instantiationService=t,this.keybindingService=n,this.commandService=r,this.telemetryService=i,this.dialogService=a,this.commandsHistory=this._register(this.instantiationService.createInstance(AP)),this.options=e}async _getPicks(e,t,n,r){let i=await this.getCommandPicks(n);if(n.isCancellationRequested)return[];let a=te(()=>{let t=new yP;return t.updateDocuments(i.map(e=>({key:e.commandId,textChunks:[this.getTfIdfChunk(e)]}))),bP(t.calculateScores(e,n)).filter(e=>e.score>DP.TFIDF_THRESHOLD).slice(0,DP.TFIDF_MAX_RESULTS)}),o=[];for(let t of i){let r=DP.WORD_FILTER(e,t.label)??void 0,i=t.commandAlias?DP.WORD_FILTER(e,t.commandAlias)??void 0:void 0;if(r||i)t.highlights={label:r,detail:this.options.showAlias?i:void 0},o.push(t);else if(e===t.commandId)o.push(t);else if(e.length>=3){let e=a();if(n.isCancellationRequested)return[];let r=e.find(e=>e.key===t.commandId);r&&(t.tfIdfScore=r.score,o.push(t))}}let s=new Map;for(let e of o){let t=s.get(e.label);t?(e.description=e.commandId,t.description=t.commandId):s.set(e.label,e)}o.sort((e,t)=>{if(e.tfIdfScore&&t.tfIdfScore)return e.tfIdfScore===t.tfIdfScore?e.label.localeCompare(t.label):t.tfIdfScore-e.tfIdfScore;if(e.tfIdfScore)return 1;if(t.tfIdfScore)return-1;let n=this.commandsHistory.peek(e.commandId),r=this.commandsHistory.peek(t.commandId);if(n&&r)return n>r?-1:1;if(n)return-1;if(r)return 1;if(this.options.suggestedCommandIds){let n=this.options.suggestedCommandIds.has(e.commandId),r=this.options.suggestedCommandIds.has(t.commandId);if(n&&r)return 0;if(n)return-1;if(r)return 1}return e.label.localeCompare(t.label)});let c=[],l=!1,u=!0,d=!!this.options.suggestedCommandIds;for(let e=0;e<o.length;e++){let t=o[e];e===0&&this.commandsHistory.peek(t.commandId)&&(c.push({type:`separator`,label:S(`recentlyUsed`,`recently used`)}),l=!0),u&&t.tfIdfScore!==void 0&&(c.push({type:`separator`,label:S(`suggested`,`similar commands`)}),u=!1),d&&t.tfIdfScore===void 0&&!this.commandsHistory.peek(t.commandId)&&this.options.suggestedCommandIds?.has(t.commandId)&&(c.push({type:`separator`,label:S(`commonlyUsed`,`commonly used`)}),l=!0,d=!1),l&&t.tfIdfScore===void 0&&!this.commandsHistory.peek(t.commandId)&&!this.options.suggestedCommandIds?.has(t.commandId)&&(c.push({type:`separator`,label:S(`morecCommands`,`other commands`)}),l=!1),c.push(this.toCommandPick(t,r))}return this.hasAdditionalCommandPicks(e,n)?{picks:c,additionalPicks:(async()=>{let t=await this.getAdditionalCommandPicks(i,o,e,n);if(n.isCancellationRequested)return[];let a=t.map(e=>this.toCommandPick(e,r));return u&&a[0]?.type!==`separator`&&a.unshift({type:`separator`,label:S(`suggested`,`similar commands`)}),a})()}:c}toCommandPick(e,t){if(e.type===`separator`)return e;let n=this.keybindingService.lookupKeybinding(e.commandId),r=n?S(`commandPickAriaLabelWithKeybinding`,`{0}, {1}`,e.label,n.getAriaLabel()):e.label;return{...e,ariaLabel:r,detail:this.options.showAlias&&e.commandAlias!==e.label?e.commandAlias:void 0,keybinding:n,accept:async()=>{this.commandsHistory.push(e.commandId),this.telemetryService.publicLog2(`workbenchActionExecuted`,{id:e.commandId,from:t?.from??`quick open`});try{e.args?.length?await this.commandService.executeCommand(e.commandId,...e.args):await this.commandService.executeCommand(e.commandId)}catch(t){pe(t)||this.dialogService.error(S(`canNotRun`,`Command '{0}' resulted in an error`,e.label),Dd(t))}}}}getTfIdfChunk({label:e,commandAlias:t,commandDescription:n}){let r=e;return t&&t!==e&&(r+=` - ${t}`),n&&n.value!==e&&(r+=` - ${n.value===n.original?n.value:`${n.value} (${n.original})`}`),r}};kP=DP=TP([EP(1,Y),EP(2,ua),EP(3,lc),EP(4,Zi),EP(5,Jr)],kP);var AP=class extends _{static#e=OP=this;static#t=this.DEFAULT_COMMANDS_HISTORY_LENGTH=50;static#n=this.PREF_KEY_CACHE=`commandPalette.mru.cache`;static#r=this.PREF_KEY_COUNTER=`commandPalette.mru.counter`;static#i=this.counter=1;static#a=this.hasChanges=!1;constructor(e,t,n){super(),this.storageService=e,this.configurationService=t,this.logService=n,this.configuredCommandsHistoryLength=0,this.updateConfiguration(),this.load(),this.registerListeners()}registerListeners(){this._register(this.configurationService.onDidChangeConfiguration(e=>this.updateConfiguration(e))),this._register(this.storageService.onWillSaveState(e=>{e.reason===Ai.SHUTDOWN&&this.saveState()}))}updateConfiguration(e){e&&!e.affectsConfiguration(`workbench.commandPalette.history`)||(this.configuredCommandsHistoryLength=OP.getConfiguredCommandHistoryLength(this.configurationService),OP.cache&&OP.cache.limit!==this.configuredCommandsHistoryLength&&(OP.cache.limit=this.configuredCommandsHistoryLength,OP.hasChanges=!0))}load(){let e=this.storageService.get(OP.PREF_KEY_CACHE,0),t;if(e)try{t=JSON.parse(e)}catch(e){this.logService.error(`[CommandsHistory] invalid data: ${e}`)}let n=OP.cache=new yl(this.configuredCommandsHistoryLength,1);if(t){let e;e=t.usesLRU?t.entries:t.entries.sort((e,t)=>e.value-t.value),e.forEach(e=>n.set(e.key,e.value))}OP.counter=this.storageService.getNumber(OP.PREF_KEY_COUNTER,0,OP.counter)}push(e){OP.cache&&(OP.cache.set(e,OP.counter++),OP.hasChanges=!0)}peek(e){return OP.cache?.peek(e)}saveState(){if(!OP.cache||!OP.hasChanges)return;let e={usesLRU:!0,entries:[]};OP.cache.forEach((t,n)=>e.entries.push({key:n,value:t})),this.storageService.store(OP.PREF_KEY_CACHE,JSON.stringify(e),0,0),this.storageService.store(OP.PREF_KEY_COUNTER,OP.counter,0,0),OP.hasChanges=!1}static getConfiguredCommandHistoryLength(e){let t=e.getValue().workbench?.commandPalette?.history;return typeof t==`number`?t:OP.DEFAULT_COMMANDS_HISTORY_LENGTH}};AP=OP=TP([EP(0,Pa),EP(1,F),EP(2,Fc)],AP);var jP=class extends kP{constructor(e,t,n,r,i,a){super(e,t,n,r,i,a)}getCodeEditorCommandPicks(){let e=this.activeTextEditorControl;if(!e)return[];let t=[];for(let n of e.getSupportedActions()){let e;n.metadata?.description&&(e=qi(n.metadata.description)?n.metadata.description:{original:n.metadata.description,value:n.metadata.description}),t.push({commandId:n.id,commandAlias:n.alias,commandDescription:e,label:ps(n.label)||n.id})}return t}},MP=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},NP=function(e,t){return function(n,r){t(n,r,e)}},PP=class extends jP{get activeTextEditorControl(){return this.codeEditorService.getFocusedCodeEditor()??void 0}constructor(e,t,n,r,i,a){super({showAlias:!1},e,n,r,i,a),this.codeEditorService=t}async getCommandPicks(){return this.getCodeEditorCommandPicks()}hasAdditionalCommandPicks(){return!1}async getAdditionalCommandPicks(){return[]}};PP=MP([NP(0,Y),NP(1,Ko),NP(2,ua),NP(3,lc),NP(4,Zi),NP(5,Jr)],PP);var FP=class e extends N{static#e=this.ID=`editor.action.quickCommand`;constructor(){super({id:e.ID,label:Al.quickCommandActionLabel,alias:`Command Palette`,precondition:void 0,kbOpts:{kbExpr:q.focus,primary:59,weight:100},contextMenuOpts:{group:`z_commands`,order:1}})}run(e){e.get(xc).quickAccess.show(PP.PREFIX)}};L(FP),un.as(Ws.Quickaccess).registerQuickAccessProvider({ctor:PP,prefix:PP.PREFIX,helpEntries:[{description:Al.quickCommandHelp,commandId:FP.ID}]});var IP=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},LP=function(e,t){return function(n,r){t(n,r,e)}},RP=class extends Og{constructor(e,t,n,r,i,a,o){super(!0,e,t,n,r,i,a,o)}};RP=IP([LP(1,W),LP(2,Ko),LP(3,Ro),LP(4,Y),LP(5,Pa),LP(6,F)],RP),I(Og.ID,RP,4),L(class extends N{constructor(){super({id:`editor.action.toggleHighContrast`,label:eo.toggleHighContrast,alias:`Toggle High Contrast Theme`,precondition:void 0}),this._originalThemeName=null}run(e,t){let n=e.get(so),r=n.getColorTheme();Mn(r.type)?(n.setTheme(this._originalThemeName||(Hr(r.type)?`vs-dark`:`vs`)),this._originalThemeName=null):(n.setTheme(Hr(r.type)?Di:xi),this._originalThemeName=r.themeName)}});